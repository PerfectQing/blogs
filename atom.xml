<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://perfectqing.github.io/blogs</id>
    <title>BLOG</title>
    <updated>2021-07-20T08:59:16.746Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://perfectqing.github.io/blogs"/>
    <link rel="self" href="https://perfectqing.github.io/blogs/atom.xml"/>
    <subtitle>Carry on what you want...</subtitle>
    <logo>https://perfectqing.github.io/blogs/images/avatar.png</logo>
    <icon>https://perfectqing.github.io/blogs/favicon.ico</icon>
    <rights>All rights reserved 2021, BLOG</rights>
    <entry>
        <title type="html"><![CDATA[ç¬¬å…­ç«  å¾ªç¯ç¥ç»ç½‘ç»œ]]></title>
        <id>https://perfectqing.github.io/blogs/post/ç¬¬å…­ç«  å¾ªç¯ç¥ç»ç½‘ç»œ/</id>
        <link href="https://perfectqing.github.io/blogs/post/ç¬¬å…­ç«  å¾ªç¯ç¥ç»ç½‘ç»œ/">
        </link>
        <updated>2021-07-18T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  ç¬¬å…­ç«  å¾ªç¯ç¥ç»ç½‘ç»œ<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šç”¨RNNå®ç°è¿ç»­æ•°æ®çš„é¢„æµ‹ï¼ˆä»¥è‚¡ç¥¨é¢„æµ‹ä¸ºä¾‹ï¼‰ã€å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œã€å¾ªç¯ç¥ç»ç½‘ç»œã€å®è·µï¼šABCDEå­—æ¯é¢„æµ‹ã€å®è·µï¼šè‚¡ç¥¨é¢„æµ‹</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  ç¬¬å…­ç«  å¾ªç¯ç¥ç»ç½‘ç»œ<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šç”¨RNNå®ç°è¿ç»­æ•°æ®çš„é¢„æµ‹ï¼ˆä»¥è‚¡ç¥¨é¢„æµ‹ä¸ºä¾‹ï¼‰ã€å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œã€å¾ªç¯ç¥ç»ç½‘ç»œã€å®è·µï¼šABCDEå­—æ¯é¢„æµ‹ã€å®è·µï¼šè‚¡ç¥¨é¢„æµ‹</p>
<!-- more -->
<h3 id="ç¬¬å…­ç« -å¾ªç¯ç¥ç»ç½‘ç»œ">ç¬¬å…­ç«  å¾ªç¯ç¥ç»ç½‘ç»œ</h3>
<p>æœ¬è®²ç›®æ ‡ï¼šç”¨RNNå®ç°è¿ç»­æ•°æ®çš„é¢„æµ‹ï¼ˆä»¥è‚¡ç¥¨é¢„æµ‹ä¸ºä¾‹ï¼‰</p>
<ol>
<li>
<p>å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œ</p>
</li>
<li>
<p>å¾ªç¯ç¥ç»ç½‘ç»œ</p>
<ul>
<li>å¾ªç¯æ ¸</li>
<li>å¾ªç¯æ ¸æ—¶é—´æ­¥å±•å¼€</li>
<li>å¾ªç¯è®¡ç®—å±‚</li>
<li>TFæè¿°å¾ªç¯è®¡ç®—å±‚</li>
<li>å¾ªç¯è®¡ç®—è¿‡ç¨‹</li>
</ul>
</li>
<li>
<p>å®è·µï¼šABCDEå­—æ¯é¢„æµ‹</p>
<ul>
<li>One-hot</li>
<li>Emebedding</li>
</ul>
</li>
<li>
<p>å®è·µï¼šè‚¡ç¥¨é¢„æµ‹</p>
<ul>
<li>RNN</li>
<li>LSTM</li>
<li>GRU</li>
</ul>
</li>
</ol>
<h4 id="61-å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œ">6.1 å›é¡¾å·ç§¯ç¥ç»ç½‘ç»œ</h4>
<ul>
<li>
<p>å·ç§¯æ ¸ï¼šå‚æ•°ç©ºé—´å…±äº«ï¼Œå·ç§¯å±‚æå–ç©ºé—´ä¿¡æ¯ã€‚</p>
<ol>
<li>
<p>å·ç§¯ç¥ç»ç½‘ç»œçš„ä¸»è¦æ¨¡å—</p>
<p>å·ç§¯(Convolutional)ã€æ‰¹æ ‡å‡†åŒ–(BN)ã€æ¿€æ´»(Activation)ã€æ± åŒ–(Pooling)ã€å…¨è¿æ¥(FC)</p>
</li>
<li>
<p>å·ç§¯æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å·ç§¯å°±æ˜¯ç‰¹å¾æå–å™¨ï¼Œå°±æ˜¯CBAPD</p>
</li>
</ol>
<blockquote>
<p>å·ç§¯ç¥ç»ç½‘ç»œï¼šå€ŸåŠ©å·ç§¯æ ¸æå–ç©ºé—´ç‰¹å¾åï¼Œé€å…¥å…¨è¿æ¥ç½‘ç»œã€‚</p>
</blockquote>
</li>
</ul>
<h4 id="62-å¾ªç¯ç¥ç»ç½‘ç»œ">6.2 å¾ªç¯ç¥ç»ç½‘ç»œ</h4>
<ul>
<li>
<p>å¾ªç¯æ ¸ï¼šå‚æ•°æ—¶é—´å…±äº«ï¼Œå¾ªç¯å±‚æå–æ—¶é—´ä¿¡æ¯ã€‚</p>
<p>é€šè¿‡ä¸åŒæ—¶åˆ»çš„å‚æ•°å…±äº«ï¼Œå®ç°å¯¹æ—¶é—´åºåˆ—çš„ä¿¡æ¯æå–ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107181002296-1.png" alt="6-1" loading="lazy"></figure>
<p>å‰å‘ä¼ æ’­æ—¶ï¼šè®°å¿†ä½“å†…å­˜å‚¨çš„çŠ¶æ€ä¿¡æ¯<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œåœ¨æ¯ä¸ªæ—¶åˆ»éƒ½è¢«åˆ·æ–°ï¼Œä¸‰ä¸ªå‚æ•°çŸ©é˜µ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>x</mi><mi>h</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>h</mi><mi>h</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>h</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{xh},  w_{hh}, w_{hy}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>è‡ªå§‹è‡³ç»ˆéƒ½æ˜¯å›ºå®šä¸å˜çš„ã€‚</p>
<p>åå‘ä¼ æ’­æ—¶ï¼šä¸‰ä¸ªå‚æ•°çŸ©é˜µ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>x</mi><mi>h</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>h</mi><mi>h</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>h</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{xh},  w_{hh}, w_{hy}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>è¢«æ¢¯åº¦ä¸‹é™æ³•æ›´æ–°ã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><msub><mi>h</mi><mi>t</mi></msub><msub><mi>w</mi><mrow><mi>h</mi><mi>y</mi></mrow></msub><mo>+</mo><msub><mi>b</mi><mi>y</mi></msub><mo>)</mo><mspace linebreak="newline"></mspace><msub><mi>h</mi><mi>t</mi></msub><mo>=</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><mo>(</mo><msub><mi>x</mi><mi>t</mi></msub><msub><mi>w</mi><mrow><mi>x</mi><mi>h</mi></mrow></msub><mo>+</mo><msub><mi>h</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><msub><mi>w</mi><mrow><mi>h</mi><mi>h</mi></mrow></msub><mo>+</mo><msub><mi>b</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">y_t=softmax(h_tw_{hy}+b_y)\\
h_t=tanh(x_tw_{xh}+h_{t-1}w_{hh}+b_h
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p>å¾ªç¯æ ¸æŒ‰æ—¶é—´æ­¥å±•å¼€</p>
<p>æŒ‰ç…§æ—¶é—´æ­¥å±•å¼€ï¼Œå°±æ˜¯æŠŠå¾ªç¯æ ¸æŒ‰ç…§æ—¶é—´è½´æ–¹å‘å±•å¼€ã€‚æ¯ä¸ªæ—¶åˆ»è®°å¿†ä½“çŠ¶æ€ä¿¡æ¯<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>è¢«åˆ·æ–°ï¼Œå‘¨å›´çš„å‚æ•°çŸ©é˜µå›ºå®šä¸å˜ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191230196-2.png" alt="6-2" loading="lazy"></figure>
<blockquote>
<p>å¾ªç¯ç¥ç»ç½‘ç»œï¼šå€ŸåŠ©å¾ªç¯æ ¸æå–æ—¶é—´ç‰¹å¾åï¼Œé€å…¥å…¨è¿æ¥ç½‘ç»œã€‚</p>
</blockquote>
</li>
<li>
<p>å¾ªç¯è®¡ç®—å±‚ï¼šå‘è¾“å‡ºæ–¹å‘ç”Ÿé•¿</p>
<figure data-type="image" tabindex="3"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191230256-3.png" alt="6-3" loading="lazy"></figure>
<blockquote>
<p>æ¯ä¸ªå¾ªç¯æ ¸ä¸­è®°å¿†ä½“çš„ä¸ªæ•°æ˜¯æ ¹æ®éœ€æ±‚ä»»æ„æŒ‡å®šçš„ã€‚</p>
</blockquote>
</li>
<li>
<p>TFæè¿°å¾ªç¯è®¡ç®—å±‚</p>
<pre><code class="language-python">tf.keras.layers.SimpleRNN(è®°å¿†ä½“ä¸ªæ•°, activation='æ¿€æ´»å‡½æ•°', return_sequences=æ˜¯å¦æ¯ä¸ªæ—¶åˆ»è¾“å‡ºhtåˆ°ä¸‹ä¸€å±‚)

activation='æ¿€æ´»å‡½æ•°'  # ä¸å†™é»˜è®¤ä½¿ç”¨tanh
return_sequences=True  # å„æ—¶é—´æ­¥è¾“å‡ºht
return_sequences=False  # ä»…æœ€åæ—¶é—´æ­¥è¾“å‡ºhtï¼ˆé»˜è®¤ï¼‰

# Example
SimpleRNN(3, return_sequences=True)  # å®šä¹‰ä¸€ä¸ªæœ‰ä¸‰ä¸ªè®°å¿†ä½“çš„å¾ªç¯æ ¸ï¼Œæ¯ä¸ªæ—¶é—´æ­¥è¾“å‡ºht
</code></pre>
<p><code>return_sequences=True</code> å¾ªç¯æ ¸å„æ—¶åˆ»ä¼šæŠŠhtæ¨é€åˆ°ä¸‹ä¸€å±‚</p>
<figure data-type="image" tabindex="4"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191230316-4.png" alt="6-4" loading="lazy"></figure>
<p><code>return_sequences=False</code> å¾ªç¯æ ¸ä»…åœ¨æœ€åä¸€ä¸ªæ—¶åˆ»æŠŠhtæ¨é€åˆ°ä¸‹ä¸€å±‚</p>
<figure data-type="image" tabindex="5"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191230376-5.png" alt="6-5" loading="lazy"></figure>
<ul>
<li>
<p>é€å…¥RNNæ—¶ï¼Œx_trainç»´åº¦ï¼š</p>
<p>[é€å…¥æ ·æœ¬æ•°, å¾ªç¯æ ¸æ—¶é—´æ­¥å±•å¼€æ­¥æ•°, æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]</p>
<p>Exampleï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191230436-6.png" alt="6-6" loading="lazy"></figure>
<p>å·¦è¾¹<strong>2</strong>ç»„æ•°æ®ï¼Œæ¯ç»„æ•°æ®ç»è¿‡<strong>1</strong>ä¸ªæ—¶é—´æ­¥å°±ä¼šå¾—åˆ°è¾“å‡ºç»“æœï¼Œæ¯ä¸ªæ—¶é—´æ­¥é€å…¥<strong>3</strong>ä¸ªæ•°å€¼ã€‚  [2, 1, 3]<br>
å³è¾¹åªæœ‰ä¸€ç»„æ•°æ®ï¼Œåˆ†å››ä¸ªæ—¶é—´æ­¥é€å…¥å¾ªç¯å±‚ï¼Œæ¯ä¸ªæ—¶é—´æ­¥é€å…¥ä¸¤ä¸ªæ•°å€¼ã€‚  [1, 4, 2]</p>
</li>
</ul>
</li>
</ul>
<h4 id="63-å®è·µå­—æ¯é¢„æµ‹">6.3 å®è·µï¼šå­—æ¯é¢„æµ‹</h4>
<ul>
<li>
<p>å¾ªç¯è®¡ç®—è¿‡ç¨‹â… ï¼ˆå­—æ¯é¢„æµ‹ä¸ºä¾‹å­ï¼Œè¾“å…¥ä¸€ä¸ªå­—æ¯é¢„æµ‹ä¸‹ä¸€ä¸ªï¼‰</p>
<p>å­—æ¯é¢„æµ‹ï¼šè¾“å…¥aé¢„æµ‹å‡ºbï¼Œè¾“å…¥bé¢„æµ‹å‡ºcï¼Œè¾“å…¥cé¢„æµ‹å‡ºdï¼Œè¾“å…¥dé¢„æµ‹å‡ºeï¼Œè¾“å…¥eé¢„æµ‹å‡ºaã€‚</p>
<p>è¯å‘é‡ç©ºé—´ï¼šï¼ˆç‹¬çƒ­ç è¡¨ç¤ºï¼‰</p>
<table>
<thead>
<tr>
<th style="text-align:center">ç‹¬çƒ­ç </th>
<th style="text-align:center">å­—æ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">10000</td>
<td style="text-align:center">a</td>
</tr>
<tr>
<td style="text-align:center">01000</td>
<td style="text-align:center">b</td>
</tr>
<tr>
<td style="text-align:center">00100</td>
<td style="text-align:center">c</td>
</tr>
<tr>
<td style="text-align:center">00010</td>
<td style="text-align:center">d</td>
</tr>
<tr>
<td style="text-align:center">00001</td>
<td style="text-align:center">e</td>
</tr>
</tbody>
</table>
<p>éšæœºç”Ÿæˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>x</mi><mi>h</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>h</mi><mi>h</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>h</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{xh},  w_{hh}, w_{hy}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></p>
<pre><code class="language-python"># Why
[[-1.7  0.7 -1.7 1.7  0.7]
 [-1.6 -1.6  0.7 1.7  0.7]
 [-1.4  1.9  1.2 1.7 -1.9]]
# by
[0.0 0.1 0.4 -0.7 0.1]

# Whh
[[-0.9 -0.2 -0.4]
 [-0.3  0.9  0.2]
 [ 0.4  0.3 -0.9]]

# Why
[[ 0.5 -1.7  1.7]
 [-2.3  0.8  1.1]
 [ 1.3  1.7  1.4]
 [ 0.3  0.8 -1.1]
 [-1.8 -2.0 -1.0]]
# bh
[0.5 0.3 -0.2]

# ht
[0.0 0.0 0.0]
</code></pre>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub><mo>=</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><mo>(</mo><msub><mi>x</mi><mi>t</mi></msub><msub><mi>w</mi><mrow><mi>x</mi><mi>h</mi></mrow></msub><mo>+</mo><msub><mi>h</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><msub><mi>w</mi><mrow><mi>h</mi><mi>h</mi></mrow></msub><mo>+</mo><msub><mi>b</mi><mi>h</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">h_t=tanh(x_tw_{xh}+h_{t-1}w_{hh}+b_h)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<figure data-type="image" tabindex="7"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191230486-7.png" alt="6-7" loading="lazy"></figure>
</li>
<li>
<p>ç”¨RNNå®ç°è¾“å…¥ä¸€ä¸ªå­—æ¯ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯ä»£ç ï¼ˆOne hot ç¼–ç ï¼‰</p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dense, SimpleRNN
import matplotlib.pyplot as plt
import os

input_word = &quot;abcde&quot;
w_to_id = {'a': 0, 'b': 1, 'c': 2, 'd': 3, 'e': 4}  # å•è¯æ˜ å°„åˆ°æ•°å€¼idçš„è¯å…¸
id_to_onehot = {0: [1., 0., 0., 0., 0.], 1: [0., 1., 0., 0., 0.], 2: [0., 0., 1., 0., 0.], 3: [0., 0., 0., 1., 0.],
                4: [0., 0., 0., 0., 1.]}  # idç¼–ç ä¸ºone-hot

x_train = [id_to_onehot[w_to_id['a']], id_to_onehot[w_to_id['b']], id_to_onehot[w_to_id['c']],
           id_to_onehot[w_to_id['d']], id_to_onehot[w_to_id['e']]]
y_train = [w_to_id['b'], w_to_id['c'], w_to_id['d'], w_to_id['e'], w_to_id['a']]

np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)

# ä½¿x_trainç¬¦åˆSimpleRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºlen(x_train)ï¼›è¾“å…¥1ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º1; è¡¨ç¤ºä¸ºç‹¬çƒ­ç æœ‰5ä¸ªè¾“å…¥ç‰¹å¾ï¼Œæ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º5
x_train = np.reshape(x_train, (len(x_train), 1, 5))
y_train = np.array(y_train)

model = tf.keras.Sequential([
    SimpleRNN(3),  # å…·æœ‰ä¸‰ä¸ªè®°å¿†ä½“çš„å¾ªç¯å±‚
    Dense(5, activation='softmax')
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.01),
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/rnn_onehot_1pre1.ckpt&quot;

if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True,
                                                 monitor='loss')  # ç”±äºfitæ²¡æœ‰ç»™å‡ºæµ‹è¯•é›†ï¼Œä¸è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œæ ¹æ®lossï¼Œä¿å­˜æœ€ä¼˜æ¨¡å‹

history = model.fit(x_train, y_train, batch_size=32, epochs=100, callbacks=[cp_callback])

model.summary()

# print(model.trainable_variables)
file = open('./weights.txt', 'w')  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history['sparse_categorical_accuracy']
loss = history.history['loss']

plt.subplot(1, 2, 1)
plt.plot(acc, label='Training Accuracy')
plt.title('Training Accuracy')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label='Training Loss')
plt.title('Training Loss')
plt.legend()
plt.show()

############### predict #############

preNum = int(input(&quot;input the number of test alphabet:&quot;))
for i in range(preNum):
    alphabet1 = input(&quot;input test alphabet:&quot;)
    alphabet = [id_to_onehot[w_to_id[alphabet1]]]
    # ä½¿alphabetç¬¦åˆSimpleRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚æ­¤å¤„éªŒè¯æ•ˆæœé€å…¥äº†1ä¸ªæ ·æœ¬ï¼Œé€å…¥æ ·æœ¬æ•°ä¸º1ï¼›è¾“å…¥1ä¸ªå­—æ¯å‡ºç»“æœï¼Œæ‰€ä»¥å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º1; è¡¨ç¤ºä¸ºç‹¬çƒ­ç æœ‰5ä¸ªè¾“å…¥ç‰¹å¾ï¼Œæ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º5
    alphabet = np.reshape(alphabet, (1, 1, 5))
    result = model.predict([alphabet])
    pred = tf.argmax(result, axis=1)
    pred = int(pred)
    tf.print(alphabet1 + '-&gt;' + input_word[pred])

# è¿è¡Œç»“æœ
# Epoch 100/100
# 1/1 [==============================] - 0s 3ms/step - loss: 0.4303 - sparse_categorical_accuracy: 1.0000
# Model: &quot;sequential&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #   
# =================================================================
# simple_rnn (SimpleRNN)       (None, 3)                 27        
# _________________________________________________________________
# dense (Dense)                (None, 5)                 20        
# =================================================================
# Total params: 47
# Trainable params: 47
# Non-trainable params: 0
# _________________________________________________________________
# input the number of test alphabet:2
# 2
# input test alphabet:a
# a
# a-&gt;b
# input test alphabet:d
# d
# d-&gt;e
</code></pre>
</li>
<li>
<p>å¾ªç¯è®¡ç®—è¿‡ç¨‹â…¡ï¼ˆå­—æ¯é¢„æµ‹ä¾‹å­ï¼Œè¾“å…¥å¤šä¸ªå­—æ¯ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯ï¼‰</p>
<p>è¿ç»­è¾“å…¥å››ä¸ªå­—æ¯ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯ã€‚</p>
<p>ä½¿ç”¨ä¸‰ä¸ªè®°å¿†ä½“ã€‚</p>
<figure data-type="image" tabindex="8"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191230546-8.png" alt="6-8" loading="lazy"></figure>
</li>
<li>
<p>ç”¨RNNå®ç°è¾“å…¥è¿ç»­å››ä¸ªå­—æ¯ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯ï¼ˆOne hotç¼–ç ï¼‰</p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dense, SimpleRNN
import matplotlib.pyplot as plt
import os

input_word = &quot;abcde&quot;
w_to_id = {'a': 0, 'b': 1, 'c': 2, 'd': 3, 'e': 4}  # å•è¯æ˜ å°„åˆ°æ•°å€¼idçš„è¯å…¸
id_to_onehot = {0: [1., 0., 0., 0., 0.], 1: [0., 1., 0., 0., 0.], 2: [0., 0., 1., 0., 0.], 3: [0., 0., 0., 1., 0.],
                4: [0., 0., 0., 0., 1.]}  # idç¼–ç ä¸ºone-hot

x_train = [
    [id_to_onehot[w_to_id['a']], id_to_onehot[w_to_id['b']], id_to_onehot[w_to_id['c']], id_to_onehot[w_to_id['d']]],
    [id_to_onehot[w_to_id['b']], id_to_onehot[w_to_id['c']], id_to_onehot[w_to_id['d']], id_to_onehot[w_to_id['e']]],
    [id_to_onehot[w_to_id['c']], id_to_onehot[w_to_id['d']], id_to_onehot[w_to_id['e']], id_to_onehot[w_to_id['a']]],
    [id_to_onehot[w_to_id['d']], id_to_onehot[w_to_id['e']], id_to_onehot[w_to_id['a']], id_to_onehot[w_to_id['b']]],
    [id_to_onehot[w_to_id['e']], id_to_onehot[w_to_id['a']], id_to_onehot[w_to_id['b']], id_to_onehot[w_to_id['c']]],
]
y_train = [w_to_id['e'], w_to_id['a'], w_to_id['b'], w_to_id['c'], w_to_id['d']]

np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)

# ä½¿x_trainç¬¦åˆSimpleRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºlen(x_train)ï¼›è¾“å…¥4ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º4; è¡¨ç¤ºä¸ºç‹¬çƒ­ç æœ‰5ä¸ªè¾“å…¥ç‰¹å¾ï¼Œæ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º5
x_train = np.reshape(x_train, (len(x_train), 4, 5))
y_train = np.array(y_train)

model = tf.keras.Sequential([
    SimpleRNN(3),
    Dense(5, activation='softmax')
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.01),
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/rnn_onehot_4pre1.ckpt&quot;

if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True,
                                                 monitor='loss')  # ç”±äºfitæ²¡æœ‰ç»™å‡ºæµ‹è¯•é›†ï¼Œä¸è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œæ ¹æ®lossï¼Œä¿å­˜æœ€ä¼˜æ¨¡å‹

history = model.fit(x_train, y_train, batch_size=32, epochs=100, callbacks=[cp_callback])

model.summary()

# print(model.trainable_variables)
file = open('./weights.txt', 'w')  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history['sparse_categorical_accuracy']
loss = history.history['loss']

plt.subplot(1, 2, 1)
plt.plot(acc, label='Training Accuracy')
plt.title('Training Accuracy')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label='Training Loss')
plt.title('Training Loss')
plt.legend()
plt.show()

############### predict #############

preNum = int(input(&quot;input the number of test alphabet:&quot;))
for i in range(preNum):
    alphabet1 = input(&quot;input test alphabet:&quot;)
    alphabet = [id_to_onehot[w_to_id[a]] for a in alphabet1]
    # ä½¿alphabetç¬¦åˆSimpleRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚æ­¤å¤„éªŒè¯æ•ˆæœé€å…¥äº†1ä¸ªæ ·æœ¬ï¼Œé€å…¥æ ·æœ¬æ•°ä¸º1ï¼›è¾“å…¥4ä¸ªå­—æ¯å‡ºç»“æœï¼Œæ‰€ä»¥å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º4; è¡¨ç¤ºä¸ºç‹¬çƒ­ç æœ‰5ä¸ªè¾“å…¥ç‰¹å¾ï¼Œæ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º5
    alphabet = np.reshape(alphabet, (1, 4, 5))
    result = model.predict([alphabet])
    pred = tf.argmax(result, axis=1)
    pred = int(pred)
    tf.print(alphabet1 + '-&gt;' + input_word[pred])

# è¿è¡Œç»“æœ
# Epoch 100/100
# 1/1 [==============================] - 0s 4ms/step - loss: 0.0846 - sparse_categorical_accuracy: 1.0000
# Model: &quot;sequential&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #   
# =================================================================
# simple_rnn (SimpleRNN)       (None, 3)                 27        
# _________________________________________________________________
# dense (Dense)                (None, 5)                 20        
# =================================================================
# Total params: 47
# Trainable params: 47
# Non-trainable params: 0
# _________________________________________________________________
# input the number of test alphabet:5
# 5
# input test alphabet:abcd
# abcd
# abcd-&gt;e
# input test alphabet:bcde
# bcde
# bcde-&gt;a
# input test alphabet:cdea
# cdea
# cdea-&gt;b
# input test alphabet:deab
# deab
# deab-&gt;c
# input test alphabet:eabc
# eabc
# eabc-&gt;d
# 
# Process finished with exit code 0
</code></pre>
</li>
<li>
<p>Embeddingç¼–ç </p>
<p>ç‹¬çƒ­ç ï¼šæ•°æ®é‡å¤§ï¼Œè¿‡äºç¨€ç–ï¼Œæ˜ å°„ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰è¡¨ç°å‡ºå…³è”æ€§ã€‚<br>
Embeddingï¼šæ˜¯ä¸€ç§å•è¯ç¼–ç æ–¹æ³•ï¼Œç”¨ä½ç»´å‘é‡å®ç°äº†ç¼–ç ï¼Œè¿™ç§ç¼–ç é€šè¿‡ç¥ç»ç½‘ç»œè®­ç»ƒä¼˜åŒ–ï¼Œèƒ½è¡¨è¾¾å‡ºå•è¯é—´çš„ç›¸å…³æ€§ã€‚</p>
<pre><code class="language-python">tf.keras.layers.Embedding(è¯æ±‡è¡¨å¤§å°, ç¼–ç ä¸ºåº¦)
# è¯æ±‡è¡¨å¤§å°å°±æ˜¯ä¸€å…±è¦è¡¨ç¤ºå¤šå°‘ä¸ªå•è¯
# ç¼–ç ç»´åº¦å°±æ˜¯ç”¨å‡ ä¸ªæ•°å­—è¡¨è¾¾ä¸€ä¸ªå•è¯
# å¯¹1-100è¿›è¡Œç¼–ç ï¼Œå…¶ä¸­[4]ç¼–ç ä¸º [0.25, 0.1, 0.11]
# å¦‚ä¸‹ä¾‹å­
tf.keras.layers.Embedding(100, 3)
</code></pre>
<p>è¾“å…¥Embeddingæ—¶ï¼Œx_trainç»´åº¦ï¼š[é€å…¥æ ·æœ¬æ•°, å¾ªç¯æ ¸äº‹ä»¶å±•å¼€æ­¥æ•°]</p>
</li>
<li>
<p>ç”¨RNNå®ç°è¾“å…¥ä¸€ä¸ªå­—æ¯ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯ï¼ˆEmbeddingç¼–ç ï¼‰</p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dense, SimpleRNN, Embedding
import matplotlib.pyplot as plt
import os

input_word = &quot;abcde&quot;
w_to_id = {'a': 0, 'b': 1, 'c': 2, 'd': 3, 'e': 4}  # å•è¯æ˜ å°„åˆ°æ•°å€¼idçš„è¯å…¸

x_train = [w_to_id['a'], w_to_id['b'], w_to_id['c'], w_to_id['d'], w_to_id['e']]
y_train = [w_to_id['b'], w_to_id['c'], w_to_id['d'], w_to_id['e'], w_to_id['a']]

np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)

# ä½¿x_trainç¬¦åˆEmbeddingè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°] ï¼Œ
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥æ‰€ä»¥é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºlen(x_train)ï¼›è¾“å…¥1ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º1ã€‚
x_train = np.reshape(x_train, (len(x_train), 1))
y_train = np.array(y_train)

model = tf.keras.Sequential([
    Embedding(5, 2),
    SimpleRNN(3),
    Dense(5, activation='softmax')
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.01),
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/run_embedding_1pre1.ckpt&quot;

if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True,
                                                 monitor='loss')  # ç”±äºfitæ²¡æœ‰ç»™å‡ºæµ‹è¯•é›†ï¼Œä¸è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œæ ¹æ®lossï¼Œä¿å­˜æœ€ä¼˜æ¨¡å‹

history = model.fit(x_train, y_train, batch_size=32, epochs=100, callbacks=[cp_callback])

model.summary()

# print(model.trainable_variables)
file = open('./weights.txt', 'w')  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history['sparse_categorical_accuracy']
loss = history.history['loss']

plt.subplot(1, 2, 1)
plt.plot(acc, label='Training Accuracy')
plt.title('Training Accuracy')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label='Training Loss')
plt.title('Training Loss')
plt.legend()
plt.show()

############### predict #############

preNum = int(input(&quot;input the number of test alphabet:&quot;))
for i in range(preNum):
    alphabet1 = input(&quot;input test alphabet:&quot;)
    alphabet = [w_to_id[alphabet1]]
    # ä½¿alphabetç¬¦åˆEmbeddingè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°]ã€‚
    # æ­¤å¤„éªŒè¯æ•ˆæœé€å…¥äº†1ä¸ªæ ·æœ¬ï¼Œé€å…¥æ ·æœ¬æ•°ä¸º1ï¼›è¾“å…¥1ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º1ã€‚
    alphabet = np.reshape(alphabet, (1, 1))
    result = model.predict(alphabet)
    pred = tf.argmax(result, axis=1)
    pred = int(pred)
    tf.print(alphabet1 + '-&gt;' + input_word[pred])

# è¿è¡Œç»“æœ
# Epoch 100/100
# 1/1 [==============================] - 0s 3ms/step - loss: 0.6305 - sparse_categorical_accuracy: 1.0000
# Model: &quot;sequential&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# embedding (Embedding)        (None, None, 2)           10
# _________________________________________________________________
# simple_rnn (SimpleRNN)       (None, 3)                 18
# _________________________________________________________________
# dense (Dense)                (None, 5)                 20
# =================================================================
# Total params: 48
# Trainable params: 48
# Non-trainable params: 0
# _________________________________________________________________
# input the number of test alphabet:2
# 2
# input test alphabet:a
# a
# a-&gt;b
# input test alphabet:e
# e
# e-&gt;a
#
# Process finished with exit code 0
</code></pre>
</li>
<li>
<p>ç”¨RNNå®ç°è¾“å…¥è¿ç»­å››ä¸ªå­—æ¯ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—æ¯ï¼ˆEmbeddingç¼–ç ï¼‰</p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dense, SimpleRNN, Embedding
import matplotlib.pyplot as plt
import os

input_word = &quot;abcdefghijklmnopqrstuvwxyz&quot;
w_to_id = {'a': 0, 'b': 1, 'c': 2, 'd': 3, 'e': 4,
           'f': 5, 'g': 6, 'h': 7, 'i': 8, 'j': 9,
           'k': 10, 'l': 11, 'm': 12, 'n': 13, 'o': 14,
           'p': 15, 'q': 16, 'r': 17, 's': 18, 't': 19,
           'u': 20, 'v': 21, 'w': 22, 'x': 23, 'y': 24, 'z': 25}  # å•è¯æ˜ å°„åˆ°æ•°å€¼idçš„è¯å…¸

training_set_scaled = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                       11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                       21, 22, 23, 24, 25]

x_train = []
y_train = []

for i in range(4, 26):
    x_train.append(training_set_scaled[i - 4:i])
    y_train.append(training_set_scaled[i])

np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)

# ä½¿x_trainç¬¦åˆEmbeddingè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°] ï¼Œ
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥æ‰€ä»¥é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºlen(x_train)ï¼›è¾“å…¥4ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º4ã€‚
x_train = np.reshape(x_train, (len(x_train), 4))
y_train = np.array(y_train)

model = tf.keras.Sequential([
    Embedding(26, 2),
    SimpleRNN(10),
    Dense(26, activation='softmax')
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.01),
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/rnn_embedding_4pre1.ckpt&quot;

if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True,
                                                 monitor='loss')  # ç”±äºfitæ²¡æœ‰ç»™å‡ºæµ‹è¯•é›†ï¼Œä¸è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼Œæ ¹æ®lossï¼Œä¿å­˜æœ€ä¼˜æ¨¡å‹

history = model.fit(x_train, y_train, batch_size=32, epochs=100, callbacks=[cp_callback])

model.summary()

file = open('./weights.txt', 'w')  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history['sparse_categorical_accuracy']
loss = history.history['loss']

plt.subplot(1, 2, 1)
plt.plot(acc, label='Training Accuracy')
plt.title('Training Accuracy')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label='Training Loss')
plt.title('Training Loss')
plt.legend()
plt.show()

################# predict ##################

preNum = int(input(&quot;input the number of test alphabet:&quot;))
for i in range(preNum):
    alphabet1 = input(&quot;input test alphabet:&quot;)
    alphabet = [w_to_id[a] for a in alphabet1]
    # ä½¿alphabetç¬¦åˆEmbeddingè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ æ—¶é—´å±•å¼€æ­¥æ•°]ã€‚
    # æ­¤å¤„éªŒè¯æ•ˆæœé€å…¥äº†1ä¸ªæ ·æœ¬ï¼Œé€å…¥æ ·æœ¬æ•°ä¸º1ï¼›è¾“å…¥4ä¸ªå­—æ¯å‡ºç»“æœï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º4ã€‚
    alphabet = np.reshape(alphabet, (1, 4))
    result = model.predict([alphabet])
    pred = tf.argmax(result, axis=1)
    pred = int(pred)
    tf.print(alphabet1 + '-&gt;' + input_word[pred])

# è¿è¡Œç»“æœ
# Epoch 100/100
# 1/1 [==============================] - 0s 5ms/step - loss: 0.1948 - sparse_categorical_accuracy: 1.0000
# Model: &quot;sequential&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #
# =================================================================
# embedding (Embedding)        (None, None, 2)           52
# _________________________________________________________________
# simple_rnn (SimpleRNN)       (None, 10)                130
# _________________________________________________________________
# dense (Dense)                (None, 26)                286
# =================================================================
# Total params: 468
# Trainable params: 468
# Non-trainable params: 0
# _________________________________________________________________
# input the number of test alphabet:2
# 2
# input test alphabet:abcd
# abcd
# abcd-&gt;e
# input test alphabet:hijk
# hijk
# hijk-&gt;l
</code></pre>
</li>
</ul>
<h4 id="64-å®è·µè‚¡ç¥¨é¢„æµ‹">6.4 å®è·µï¼šè‚¡ç¥¨é¢„æµ‹</h4>
<ul>
<li>
<p>æ•°æ®æº</p>
<p>SH600519è´µå·èŒ…å°çš„æ—¥kçº¿æ•°æ®</p>
<figure data-type="image" tabindex="9"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191231566-9.png" alt="6-9" loading="lazy"></figure>
<p>åªç”¨cåˆ—æ•°æ®ï¼Œè¿ç»­60å¤©å¼€ç›˜ä»·é¢„æµ‹ç¬¬61å¤©çš„å¼€ç›˜ä»·ã€‚</p>
<p>ä¸‹è½½ä»£ç ï¼š</p>
<pre><code class="language-python">import tushare as ts
import matplotlib.pyplot as plt

df1 = ts.get_k_data('600519', ktype='D', start='2010-04-26', end='2020-04-26')

datapath1 = &quot;./SH600519.csv&quot;
df1.to_csv(datapath1)
</code></pre>
</li>
<li>
<p>RNNå®ç°è‚¡ç¥¨é¢„æµ‹ä»£ç </p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf
from tensorflow.keras.layers import Dropout, Dense, SimpleRNN
import matplotlib.pyplot as plt
import os
import pandas as pd
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error, mean_absolute_error
import math

maotai = pd.read_csv('./SH600519.csv')  # è¯»å–è‚¡ç¥¨æ–‡ä»¶

training_set = maotai.iloc[0:2426 - 300, 2:3].values  # å‰(2426-300=2126)å¤©çš„å¼€ç›˜ä»·ä½œä¸ºè®­ç»ƒé›†,è¡¨æ ¼ä»0å¼€å§‹è®¡æ•°ï¼Œ2:3 æ˜¯æå–[2:3)åˆ—ï¼Œå‰é—­åå¼€,æ•…æå–å‡ºCåˆ—å¼€ç›˜ä»·
test_set = maotai.iloc[2426 - 300:, 2:3].values  # å300å¤©çš„å¼€ç›˜ä»·ä½œä¸ºæµ‹è¯•é›†

# å½’ä¸€åŒ–
sc = MinMaxScaler(feature_range=(0, 1))  # å®šä¹‰å½’ä¸€åŒ–ï¼šå½’ä¸€åŒ–åˆ°(0ï¼Œ1)ä¹‹é—´
training_set_scaled = sc.fit_transform(training_set)  # æ±‚å¾—è®­ç»ƒé›†çš„æœ€å¤§å€¼ï¼Œæœ€å°å€¼è¿™äº›è®­ç»ƒé›†å›ºæœ‰çš„å±æ€§ï¼Œå¹¶åœ¨è®­ç»ƒé›†ä¸Šè¿›è¡Œå½’ä¸€åŒ–
test_set = sc.transform(test_set)  # åˆ©ç”¨è®­ç»ƒé›†çš„å±æ€§å¯¹æµ‹è¯•é›†è¿›è¡Œå½’ä¸€åŒ–

x_train = []
y_train = []

x_test = []
y_test = []

# æµ‹è¯•é›†ï¼šcsvè¡¨æ ¼ä¸­å‰2426-300=2126å¤©æ•°æ®
# åˆ©ç”¨forå¾ªç¯ï¼Œéå†æ•´ä¸ªè®­ç»ƒé›†ï¼Œæå–è®­ç»ƒé›†ä¸­è¿ç»­60å¤©çš„å¼€ç›˜ä»·ä½œä¸ºè¾“å…¥ç‰¹å¾x_trainï¼Œç¬¬61å¤©çš„æ•°æ®ä½œä¸ºæ ‡ç­¾ï¼Œforå¾ªç¯å…±æ„å»º2426-300-60=2066ç»„æ•°æ®ã€‚
for i in range(60, len(training_set_scaled)):
    x_train.append(training_set_scaled[i - 60:i, 0])
    y_train.append(training_set_scaled[i, 0])
# å¯¹è®­ç»ƒé›†è¿›è¡Œæ‰“ä¹±
np.random.seed(7)
np.random.shuffle(x_train)
np.random.seed(7)
np.random.shuffle(y_train)
tf.random.set_seed(7)
# å°†è®­ç»ƒé›†ç”±listæ ¼å¼å˜ä¸ºarrayæ ¼å¼
x_train, y_train = np.array(x_train), np.array(y_train)

# ä½¿x_trainç¬¦åˆRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚
# æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºx_train.shape[0]å³2066ç»„æ•°æ®ï¼›è¾“å…¥60ä¸ªå¼€ç›˜ä»·ï¼Œé¢„æµ‹å‡ºç¬¬61å¤©çš„å¼€ç›˜ä»·ï¼Œå¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ä¸º60; æ¯ä¸ªæ—¶é—´æ­¥é€å…¥çš„ç‰¹å¾æ˜¯æŸä¸€å¤©çš„å¼€ç›˜ä»·ï¼Œåªæœ‰1ä¸ªæ•°æ®ï¼Œæ•…æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°ä¸º1
x_train = np.reshape(x_train, (x_train.shape[0], 60, 1))
# æµ‹è¯•é›†ï¼šcsvè¡¨æ ¼ä¸­å300å¤©æ•°æ®
# åˆ©ç”¨forå¾ªç¯ï¼Œéå†æ•´ä¸ªæµ‹è¯•é›†ï¼Œæå–æµ‹è¯•é›†ä¸­è¿ç»­60å¤©çš„å¼€ç›˜ä»·ä½œä¸ºè¾“å…¥ç‰¹å¾x_trainï¼Œç¬¬61å¤©çš„æ•°æ®ä½œä¸ºæ ‡ç­¾ï¼Œforå¾ªç¯å…±æ„å»º300-60=240ç»„æ•°æ®ã€‚
for i in range(60, len(test_set)):
    x_test.append(test_set[i - 60:i, 0])
    y_test.append(test_set[i, 0])
# æµ‹è¯•é›†å˜arrayå¹¶reshapeä¸ºç¬¦åˆRNNè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]
x_test, y_test = np.array(x_test), np.array(y_test)
x_test = np.reshape(x_test, (x_test.shape[0], 60, 1))

model = tf.keras.Sequential([
    SimpleRNN(80, return_sequences=True),
    Dropout(0.2),
    SimpleRNN(100),
    Dropout(0.2),
    Dense(1)
])

model.compile(optimizer=tf.keras.optimizers.Adam(0.001),
              loss='mean_squared_error')  # æŸå¤±å‡½æ•°ç”¨å‡æ–¹è¯¯å·®
# è¯¥åº”ç”¨åªè§‚æµ‹lossæ•°å€¼ï¼Œä¸è§‚æµ‹å‡†ç¡®ç‡ï¼Œæ‰€ä»¥åˆ å»metricsé€‰é¡¹ï¼Œä¸€ä¼šåœ¨æ¯ä¸ªepochè¿­ä»£æ˜¾ç¤ºæ—¶åªæ˜¾ç¤ºlosså€¼

checkpoint_save_path = &quot;./checkpoint/rnn_stock.ckpt&quot;

if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True,
                                                 monitor='val_loss')

history = model.fit(x_train, y_train, batch_size=64, epochs=50, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])

model.summary()

file = open('./weights.txt', 'w')  # å‚æ•°æå–
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()

loss = history.history['loss']
val_loss = history.history['val_loss']

plt.plot(loss, label='Training Loss')
plt.plot(val_loss, label='Validation Loss')
plt.title('Training and Validation Loss')
plt.legend()
plt.show()

################## predict ######################
# æµ‹è¯•é›†è¾“å…¥æ¨¡å‹è¿›è¡Œé¢„æµ‹
predicted_stock_price = model.predict(x_test)
# å¯¹é¢„æµ‹æ•°æ®è¿˜åŸ---ä»ï¼ˆ0ï¼Œ1ï¼‰åå½’ä¸€åŒ–åˆ°åŸå§‹èŒƒå›´
predicted_stock_price = sc.inverse_transform(predicted_stock_price)
# å¯¹çœŸå®æ•°æ®è¿˜åŸ---ä»ï¼ˆ0ï¼Œ1ï¼‰åå½’ä¸€åŒ–åˆ°åŸå§‹èŒƒå›´
real_stock_price = sc.inverse_transform(test_set[60:])
# ç”»å‡ºçœŸå®æ•°æ®å’Œé¢„æµ‹æ•°æ®çš„å¯¹æ¯”æ›²çº¿
plt.plot(real_stock_price, color='red', label='MaoTai Stock Price')
plt.plot(predicted_stock_price, color='blue', label='Predicted MaoTai Stock Price')
plt.title('MaoTai Stock Price Prediction')
plt.xlabel('Time')
plt.ylabel('MaoTai Stock Price')
plt.legend()
plt.show()

##########evaluate##############
# calculate MSE å‡æ–¹è¯¯å·® ---&gt; E[(é¢„æµ‹å€¼-çœŸå®å€¼)^2] (é¢„æµ‹å€¼å‡çœŸå®å€¼æ±‚å¹³æ–¹åæ±‚å‡å€¼)
mse = mean_squared_error(predicted_stock_price, real_stock_price)
# calculate RMSE å‡æ–¹æ ¹è¯¯å·®---&gt;sqrt[MSE]    (å¯¹å‡æ–¹è¯¯å·®å¼€æ–¹)
rmse = math.sqrt(mean_squared_error(predicted_stock_price, real_stock_price))
# calculate MAE å¹³å‡ç»å¯¹è¯¯å·®-----&gt;E[|é¢„æµ‹å€¼-çœŸå®å€¼|](é¢„æµ‹å€¼å‡çœŸå®å€¼æ±‚ç»å¯¹å€¼åæ±‚å‡å€¼ï¼‰
mae = mean_absolute_error(predicted_stock_price, real_stock_price)
print('å‡æ–¹è¯¯å·®: %.6f' % mse)
print('å‡æ–¹æ ¹è¯¯å·®: %.6f' % rmse)
print('å¹³å‡ç»å¯¹è¯¯å·®: %.6f' % mae)


# è¿è¡Œç»“æœ
# Epoch 50/50
# 33/33 [==============================] - 2s 70ms/step - loss: 0.0011 - val_loss: 0.0081
# Model: &quot;sequential&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #   
# =================================================================
# simple_rnn (SimpleRNN)       (None, 60, 80)            6560      
# _________________________________________________________________
# dropout (Dropout)            (None, 60, 80)            0         
# _________________________________________________________________
# simple_rnn_1 (SimpleRNN)     (None, 100)               18100     
# _________________________________________________________________
# dropout_1 (Dropout)          (None, 100)               0         
# _________________________________________________________________
# dense (Dense)                (None, 1)                 101       
# =================================================================
# Total params: 24,761
# Trainable params: 24,761
# Non-trainable params: 0
# _________________________________________________________________
# å‡æ–¹è¯¯å·®: 4064.439908
# å‡æ–¹æ ¹è¯¯å·®: 63.752960
# å¹³å‡ç»å¯¹è¯¯å·®: 59.361609
</code></pre>
</li>
<li>
<p>LSTMå®ç°è‚¡ç¥¨é¢„æµ‹</p>
<p>ä¼ ç»Ÿå¾ªç¯ç½‘ç»œRNNï¼Œå¯ä»¥é€šè¿‡è®°å¿†ä½“å®ç°çŸ­æœŸè®°å¿†è¿›è¡Œè¿ç»­æ•°æ®çš„é¢„æµ‹ã€‚ä½†æ˜¯å½“è¿ç»­æ•°æ®çš„åºåˆ—å˜é•¿æ—¶ï¼Œä¼šä½¿å±•å¼€æ—¶é—´æ­¥è¿‡é•¿ã€‚åœ¨åå‘ä¼ æ’­æ›´æ–°å‚æ•°æ—¶ï¼Œæ¢¯åº¦è¦æŒ‰ç…§æ—¶é—´æ­¥è¿ç»­ç›¸ä¹˜ï¼Œä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
<blockquote>
<p>LSTM ç”±Hochreiter &amp; Schmidhuber äº1997å¹´æå‡ºï¼Œé€šè¿‡é—¨æ§å•å…ƒæ”¹å–„äº†RNNé•¿æœŸä¾èµ–é—®é¢˜ã€‚ Sepp Hochreiter,Jurgen Schmidhuber.LONG SHORT-TERM MEMORY.Neural Computation,December 1997.</p>
</blockquote>
<figure data-type="image" tabindex="10"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191232006-10.png" alt="6-10" loading="lazy"></figure>
<p>ä¸‰ä¸ªé—¨é™å…¬å¼ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>f</mi></msub><mo separator="true">,</mo><msub><mi>W</mi><mi>o</mi></msub></mrow><annotation encoding="application/x-tex">W_i, W_f, W_o</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">o</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯å¾…è®­ç»ƒå‚æ•°çŸ©é˜µï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>f</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>o</mi></msub></mrow><annotation encoding="application/x-tex">b_i, b_f, b_o</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">o</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯å¾…è®­ç»ƒåç½®é¡¹ã€‚ç»è¿‡sigmoidå‡½æ•°åï¼Œä½¿é—¨é™èŒƒå›´åœ¨[0, 1]ä¹‹é—´ã€‚</p>
<p>å½“æœ‰å¤šå±‚å¾ªç¯ç½‘ç»œæ—¶ï¼Œç¬¬äºŒå±‚å¾ªç¯ç½‘ç»œçš„è¾“å…¥<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å°±æ˜¯ç¬¬ä¸€å±‚å¾ªç¯ç½‘ç»œçš„è¾“å‡º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚ï¼ˆè¾“å…¥ç¬¬äºŒå±‚ç½‘ç»œçš„æ˜¯<strong>ç¬¬ä¸€å±‚</strong>ç½‘ç»œæå–å‡ºçš„ç²¾åï¼‰</p>
</li>
<li>
<p>TFæè¿°LSTMå±‚</p>
<pre><code class="language-python">tf.keras.layers.LSTM(è®°å¿†ä½“ä¸ªæ•°, return_sequences=æ˜¯å¦è¿”å›è¾“å‡º)
return_sequences=True  # å„æ—¶é—´æ­¥è¾“å‡ºht
return_sequences=False  # ä»…æœ€åæ—¶é—´æ­¥è¾“å‡ºhtï¼ˆé»˜è®¤ï¼‰
# ä¸€èˆ¬æœ€åä¸€å±‚ç”¨Fasleï¼Œå…¶ä»–å±‚ç”¨True
</code></pre>
<p>Example:</p>
<pre><code class="language-python">model = tf.keras.Sequential([
    LSTM(80, return_sequences=True),  # å„æ—¶é—´æ­¥è¾“å‡ºht
    Dropout(0.2),
    LSTM(100),  # ä»…æœ€åæ—¶é—´æ­¥è¾“å‡ºhtï¼ˆé»˜è®¤ï¼‰
    Dropout(0.2),
    Dense(1)
])
</code></pre>
</li>
<li>
<p>LSTMå®ç°è‚¡ç¥¨é¢„æµ‹çš„ä»£ç </p>
<p>ä»…å±•ç¤ºä¸ä¸Šä¸€ä»£ç ï¼ˆp38ï¼‰ä¸åŒä¹‹å¤„:</p>
<pre><code class="language-python">from tensorflow.keras.layers import Dropout, Dense, LSTM

model = tf.keras.Sequential([
    LSTM(80, return_sequences=True),  # å„æ—¶é—´æ­¥è¾“å‡ºht
    Dropout(0.2),
    LSTM(100),  # ä»…æœ€åæ—¶é—´æ­¥è¾“å‡ºhtï¼ˆé»˜è®¤ï¼‰
    Dropout(0.2),
    Dense(1)
])
</code></pre>
</li>
<li>
<p>ç”¨GRUå®ç°è‚¡ç¥¨é¢„æµ‹</p>
<blockquote>
<p>GRUç”±Choç­‰äººäº2014å¹´æå‡ºï¼Œä¼˜åŒ–LSTMç»“æ„ã€‚ Kyunghyun Cho,Bart van Merrienboer,Caglar Gulcehre,Dzmitry Bahdanau,Fethi Bougares,Holger  Schwenk,Yoshua Bengio.Learning Phrase Representations using RNN Encoderâ€“Decoder for Statistical  Machine Translation.Computer ence, 2014.</p>
</blockquote>
<p>GRUè®¡ç®—è¿‡ç¨‹<br>
<img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107191232056-11.png" alt="6-11" loading="lazy"></p>
<p>ä¸¤ä¸ªé—¨é™å–å€¼èŒƒå›´ä¹Ÿæ˜¯[0, 1]ï¼Œå‰å‘ä¼ æ’­æ—¶å€™ï¼Œä½¿ç”¨è®°å¿†ä½“æ›´æ–°å…¬å¼ä½“å°±å¯ä»¥ç®—å‡ºæ¯ä¸ªæ—¶åˆ»çš„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">h_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å€¼äº†ã€‚</p>
</li>
<li>
<p>TFæè¿°GRUå±‚</p>
<pre><code class="language-python">tf.keras.layers.GRU(è®°å¿†ä½“ä¸ªæ•°, return_sequences=æ˜¯å¦è¿”å›è¾“å‡º)
return_sequences=True  # å„æ—¶é—´æ­¥è¾“å‡ºht
return_sequences=False  # ä»…æœ€åæ—¶é—´æ­¥è¾“å‡ºhtï¼ˆé»˜è®¤ï¼‰
# ä¸€èˆ¬æœ€åä¸€å±‚ç”¨Fasleï¼Œå…¶ä»–å±‚ç”¨True
</code></pre>
<p>Example</p>
<pre><code class="language-python">model = tf.keras.Sequential([
    GRU(80, return_sequences=True),  # æ¯ä¸ªæ—¶é—´æ­¥è¾“å‡ºht
    Dropout(0.2),
    GRU(100),  # ä»…æœ€åæ—¶é—´æ­¥è¾“å‡ºhtï¼ˆé»˜è®¤ï¼‰
    Dropout(0.2),
    Dense(1)
])
</code></pre>
</li>
<li>
<p>GRUå®ç°è‚¡ç¥¨é¢„æµ‹çš„ä»£ç </p>
<p>ä»…å±•ç¤ºä¸ä¸Šä¸Šä¸ªä»£ç ï¼ˆp38ï¼‰ä¸åŒä¹‹å¤„:</p>
<pre><code class="language-python">from tensorflow.keras.layers import Dropout, Dense, GRU

model = tf.keras.Sequential([
    GRU(80, return_sequences=True),
    Dropout(0.2),
    GRU(100),
    Dropout(0.2),
    Dense(1)
])
</code></pre>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—]]></title>
        <id>https://perfectqing.github.io/blogs/post/ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—/</id>
        <link href="https://perfectqing.github.io/blogs/post/ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—/">
        </link>
        <updated>2021-07-17T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—<br>
âœï¸  æœ¬ç« ç›®æ ‡ï¼šä»‹ç»ä»¥åŠå®ç°ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—<br>
âœï¸  æœ¬ç« ç›®æ ‡ï¼šä»‹ç»ä»¥åŠå®ç°ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—</p>
<!-- more -->
<h3 id="ç¬¬äº”ç« -ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—">ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—</h3>
<h4 id="51-å·ç§¯è®¡ç®—è¿‡ç¨‹">5.1 å·ç§¯è®¡ç®—è¿‡ç¨‹</h4>
<ul>
<li>
<p>å…¨è¿æ¥NNï¼šæ¯ä¸ªç¥ç»å…ƒä¸å‰å‘ç›¸é‚»å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½æœ‰è¿æ¥å…³ç³»ï¼Œè¾“å…¥æ˜¯ç‰¹å¾ï¼Œè¾“å‡ºä¸ºé¢„æµ‹çš„ç»“æœã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">å‚</mi><mi mathvariant="normal">æ•°</mi><mi mathvariant="normal">ä¸ª</mi><mi mathvariant="normal">æ•°</mi><mi mathvariant="normal">ï¼š</mi><msub><mo>âˆ‘</mo><mrow><mi mathvariant="normal">å„</mi><mi mathvariant="normal">å±‚</mi></mrow></msub><mo>(</mo><mi mathvariant="normal">å‰</mi><mi mathvariant="normal">å±‚</mi><mo>Ã—</mo><mi mathvariant="normal">å</mi><mi mathvariant="normal">å±‚</mi><mo>+</mo><mi mathvariant="normal">å</mi><mi mathvariant="normal">å±‚</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">å‚æ•°ä¸ªæ•°ï¼š\sum_{å„å±‚}(å‰å±‚\timesåå±‚+åå±‚)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mord cjk_fallback">å‚</span><span class="mord cjk_fallback">æ•°</span><span class="mord cjk_fallback">ä¸ª</span><span class="mord cjk_fallback">æ•°</span><span class="mord cjk_fallback">ï¼š</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.29971000000000003em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">å„</span><span class="mord cjk_fallback mtight">å±‚</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord cjk_fallback">å‰</span><span class="mord cjk_fallback">å±‚</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å±‚</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å±‚</span><span class="mclose">)</span></span></span></span></p>
<figure data-type="image" tabindex="1"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180548055-1.png" alt="5-1" loading="lazy"></figure>
<p>ç”±äºå®é™…é¡¹ç›®ä¸­çš„å›¾ç‰‡æ˜¯é«˜åˆ†è¾¨ç‡å½©è‰²å›¾ï¼Œå‚æ•°è¿‡å¤šï¼Œå°†å¯èƒ½å¯¼è‡´æ¨¡å‹è¿‡æ‹Ÿåˆã€‚<br>
æ•…å®é™…åº”ç”¨æ—¶ä¼šå…ˆå¯¹åŸå§‹å›¾åƒè¿›è¡Œç‰¹å¾æå–ï¼Œå†æŠŠæå–åˆ°çš„ç‰¹å¾é€ç»™å…¨è¿æ¥ç½‘ç»œã€‚</p>
</li>
<li>
<p>å·ç§¯ (Convolutional)</p>
<p>å·ç§¯è®¡ç®—å¯è®¤ä¸ºæ˜¯ä¸€ç§æœ‰æ•ˆæå–å›¾åƒç‰¹å¾çš„æ–¹æ³•<br>
è¾“å…¥ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨ï¼Œéå†è¾“å…¥ç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªåƒç´ ç‚¹ã€‚æ¯ä¸€ä¸ªæ­¥é•¿ï¼Œå·ç§¯æ ¸ä¼šä¸è¾“å…¥ç‰¹å¾å›¾å‡ºç°é‡åˆåŒºåŸŸï¼Œé‡åˆåŒºåŸŸå¯¹åº”å…ƒç´ ç›¸ä¹˜ã€æ±‚å’Œå†åŠ ä¸Šåç½®é¡¹å¾—åˆ°è¾“å‡ºç‰¹å¾çš„ä¸€ä¸ªåƒç´ ç‚¹ã€‚</p>
<p>è¦ä½¿å·ç§¯æ ¸çš„é€šé“æ•°ä¸è¾“å…¥ç‰¹å¾å›¾çš„é€šé“æ•°ä¸€è‡´ã€‚</p>
<p><strong>è¾“å…¥ç‰¹å¾å›¾çš„æ·±åº¦ï¼ˆchannelæ•°ï¼‰ï¼Œå†³å®šäº†å½“å‰å±‚å·ç§¯æ ¸çš„æ·±åº¦ï¼›</strong><br>
<strong>å½“å‰å±‚å·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œå†³å®šäº†å½“å‰å±‚è¾“å‡ºç‰¹å¾å›¾çš„æ·±åº¦ã€‚</strong></p>
<figure data-type="image" tabindex="2"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180550435-2.png" alt="5-2" loading="lazy"></figure>
<ul>
<li>å•é€šé“</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180550525-3.png" alt="5-3" loading="lazy"></figure>
<ul>
<li>ä¸‰é€šé“</li>
</ul>
<figure data-type="image" tabindex="4"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180550585-4.png" alt="5-4" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://mlnotebook.github.io/img/CNN/convSobel.gif" alt="5-5" loading="lazy"></figure>
<p>å½“æœ‰nä¸ªå·ç§¯æ ¸æ—¶ï¼Œä¼šæœ‰nå¼ è¾“å‡ºç‰¹å¾å›¾ï¼Œå åŠ åœ¨è¾“å‡ºç‰¹å¾å›¾çš„åé¢ã€‚</p>
</li>
</ul>
<h4 id="52-æ„Ÿå—é‡">5.2 æ„Ÿå—é‡</h4>
<ul>
<li>
<p>æ„Ÿå—é‡ï¼ˆReceptive Fieldï¼‰ï¼šå·ç§¯ç¥ç»ç½‘ç»œå„è¾“å‡ºç‰¹å¾å›¾çš„æ¯ä¸ªåƒç´ ç‚¹ï¼Œåœ¨åŸå§‹è¾“å…¥å›¾ç‰‡ä¸Šæ˜ å°„åŒºåŸŸçš„å¤§å°ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180551055-6.png" alt="5-6" loading="lazy"></figure>
<p>ä¸Šè¿°ä¸¤ä¸ªæ„Ÿå—é‡ç›¸åŒï¼Œæ•…ç‰¹å¾æå–èƒ½åŠ›æ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li>
<p>å¦‚ä½•é€‰æ‹©ï¼Œåˆ™éœ€è¦è€ƒè™‘è®¡ç®—é‡</p>
<figure data-type="image" tabindex="7"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180551105-7.png" alt="5-7" loading="lazy"></figure>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>9</mn><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>+</mo><mn>9</mn><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>=</mo><mn>18</mn><msup><mi>x</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>180</mn><mi>x</mi><mo>+</mo><mn>180</mn><mspace linebreak="newline"></mspace><mn>25</mn><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>4</mn><mo>)</mo><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>4</mn><mo>)</mo><mo>=</mo><mn>25</mn><msup><mi>x</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>200</mn><mi>x</mi><mo>+</mo><mn>400</mn></mrow><annotation encoding="application/x-tex">9(x-2)(x-2) + 9(x-2-2)(x-2-2)=18x^2-180x+180\\
25(x-4)(x-4) = 25x^2-200x+400
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">9</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">9</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">8</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">8</span><span class="mord">0</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">8</span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">0</span><span class="mord">0</span></span></span></span></span></p>
</li>
</ul>
<h4 id="53-å…¨é›¶å¡«å……-padding">5.3 å…¨é›¶å¡«å…… (Padding)</h4>
<figure data-type="image" tabindex="8"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180931445-8.png" alt="5-8" loading="lazy"></figure>
<ul>
<li>
<p>å·ç§¯ç‰¹å¾å›¾ç»´åº¦è®¡ç®—å…¬å¼</p>
<figure data-type="image" tabindex="9"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180931505-9.png" alt="5-9" loading="lazy"></figure>
<p>TensorFlowç”¨å‚æ•°<code>padding='SAME'</code> æˆ–è€… <code>padding='VALID'</code> è¡¨ç¤ºæ˜¯å¦ä¸ºå…¨é›¶å¡«å……</p>
</li>
</ul>
<h4 id="54-tensorflow-æè¿°å·ç§¯è®¡ç®—å±‚">5.4 TensorFlow æè¿°å·ç§¯è®¡ç®—å±‚</h4>
<pre><code class="language-python">tf.keras.layers.Conv2D(
    filters=å·ç§¯æ ¸ä¸ªæ•°,
    kernel_size=å·ç§¯æ ¸å°ºå¯¸,  #  æ­£æ–¹å½¢å†™æ ¸é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆæ ¸é«˜hï¼Œæ ¸å®½wï¼‰
    strides=æ»‘åŠ¨æ­¥é•¿,  # æ¨ªçºµå‘ç›¸åŒå†™æ­¥é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆçºµå‘æ­¥é•¿hï¼Œæ¨ªå‘æ­¥é•¿wï¼‰ï¼Œé»˜è®¤1
    padding='same' or 'valid',  # ä½¿ç”¨å…¨é›¶å¡«å……æ˜¯'same'ï¼Œä¸ä½¿ç”¨æ˜¯'valid'(é»˜è®¤)
    activation='relu' or 'sigmoid' or 'tanh' or 'softmax'ç­‰,  # å¦‚æœ‰BN(æ‰¹æ ‡å‡†åŒ–)æ­¤å¤„ä¸å†™
    input_shape=(é«˜, å®½, é€šé“æ•°)  # è¾“å…¥ç‰¹å¾å›¾ç»´åº¦ï¼Œå¯çœç•¥
)
</code></pre>
<pre><code class="language-python">model = tf.keras.models.Sequential([
    Conv2D(6, 5, padding='valid', activation='sigmoid'),
    MaxPool2D(2, 2),
    Conv2D(6, (5, 5), padding='valid', activation='sigmoid'),
    MaxPool2D(2, (2, 2)),
    Conv2D(filters=6, kernel_size=(5, 5), padding='valid', activation='sigmoid'),
    MaxPool2D(pool_size(2, 2), strides=2),
    Flatten(),
    Dense(10, activation='softmax')
])
</code></pre>
<h4 id="55-æ‰¹æ ‡å‡†åŒ–batch-normalization-bn">5.5 æ‰¹æ ‡å‡†åŒ–ï¼ˆBatch Normalization, BNï¼‰</h4>
<p>æ ‡å‡†åŒ–ï¼šä½¿æ•°æ®ç¬¦åˆ0å‡å€¼ï¼Œ1ä¸ºæ ‡å‡†å·®çš„åˆ†å¸ƒã€‚<br>
æ‰¹æ ‡å‡†åŒ–ï¼šå¯¹ä¸€å°æ‰¹æ•°æ®ï¼ˆbatchï¼‰ï¼Œåšæ ‡å‡†åŒ–å¤„ç†ã€‚</p>
<p>æ‰¹æ ‡å‡†åŒ–åï¼Œç¬¬kä¸ªå·ç§¯æ ¸çš„è¾“å‡ºç‰¹å¾å›¾ï¼ˆfeature mapï¼‰ä¸­ç¬¬iä¸ªåƒç´ ç‚¹</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>H</mi><mo mathvariant="normal">â€²</mo></msup><mi>i</mi><mi>k</mi></msubsup><mo>=</mo><mfrac><mrow><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup><mo>âˆ’</mo><msubsup><mi>Î¼</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mrow><msubsup><mi>Î´</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mfrac></mrow><annotation encoding="application/x-tex">{H&#x27;}_{i}^{k}=\frac{H_i^k-\mu_{batch}^k}{\delta_{batch}^k}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2879em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0409em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.548324em;vertical-align:-1.0222159999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.526108em;"><span style="top:-2.2790920000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8309079999999999em;"><span style="top:-2.398692em;margin-left:-0.03785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0222159999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<figure data-type="image" tabindex="10"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180931575-10.png" alt="5-10" loading="lazy"></figure>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">H_i^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.107772em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>: æ‰¹æ ‡å‡†åŒ–å‰ï¼Œç¬¬kä¸ªå·ç§¯æ ¸ï¼Œè¾“å‡ºç‰¹å¾å›¾ç¬¬iä¸ªåƒç´ ç‚¹</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î¼</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">\mu_{batch}^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.132216em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span>: æ‰¹æ ‡å‡†åŒ–å‰ï¼Œç¬¬kä¸ªå·ç§¯æ ¸ï¼Œbatchå¼ è¾“å‡ºç‰¹å¾å›¾ä¸­æ‰€æœ‰åƒç´ ç‚¹å¹³å‡å€¼</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î´</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">\delta_{batch}^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.132216em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span>: æ‰¹æ ‡å‡†åŒ–å‰ï¼Œç¬¬kä¸ªå·ç§¯æ ¸ï¼Œbatchå¼ è¾“å‡ºç‰¹å¾å›¾ä¸­æ‰€æœ‰åƒç´ ç‚¹æ ‡å‡†å·®</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î¼</mi><mrow></mrow><mi>k</mi></msubsup><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">\mu_{}^k=\frac{1}{m}\sum_{i=1}^m H_i^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.096108em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.194108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>             <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î´</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup><mo>=</mo><msqrt><mrow><mi>Î´</mi><mo>+</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mo>(</mo><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup><mo>âˆ’</mo><msubsup><mi>Î¼</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup><msup><mo>)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\delta_{batch}^k =\sqrt{\delta+\frac{1}{m}\sum_{i=1}^m (H_i^k-\mu_{batch}^k)^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.132216em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.604946em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.235054em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.830908em;"><span style="top:-2.4231360000000004em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8309079999999999em;"><span style="top:-2.398692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.195054em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.604946em;"><span></span></span></span></span></span></span></span></span></p>
<ul>
<li>
<p>ä¸ºæ¯ä¸ªå·ç§¯æ ¸**å¼•å…¥å¯è®­ç»ƒå‚æ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î³</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">Î³</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î²</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span></span></span></span>ï¼Œè°ƒæ•´æ‰¹å½’ä¸€åŒ–çš„åŠ›åº¦ã€‚</p>
<figure data-type="image" tabindex="11"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932045-11.png" alt="5-11" loading="lazy"></figure>
</li>
<li>
<p>BNå±‚ä½äºå·ç§¯å±‚ä¹‹åï¼Œæ¿€æ´»å±‚ä¹‹å‰ã€‚</p>
<p><code>å·ç§¯(Convolutional)</code>  â†’  <code>æ‰¹æ ‡å‡†åŒ–(BN)</code>  â†’  <code>æ¿€æ´»(Activation)</code></p>
</li>
<li>
<p>TensorFlow æè¿°æ‰¹æ ‡å‡†åŒ–</p>
<p><code>tf.keras.layers.BatchNormalization()</code></p>
<pre><code class="language-python">model = tf.keras.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # å·ç§¯å±‚
    BatchNormalization(),  # BNå±‚
    Activation('relu'),  # æ¿€æ´»å±‚
    MaxPool2D(pool_size(2, 2), strides=2, padding='same'),  #æ± åŒ–å±‚
    Dropout(0.2)  # Dropoutå±‚
])
</code></pre>
</li>
</ul>
<h4 id="56-æ± åŒ–pooling">5.6 æ± åŒ–ï¼ˆPoolingï¼‰</h4>
<p>æ± åŒ–ç”¨äºå‡å°‘ç‰¹å¾æ•°æ®é‡ã€‚<br>
<strong>æœ€å¤§æ± åŒ–</strong>å¯æå–å›¾ç‰‡çº¹ç†ï¼Œ<strong>å‡å€¼æ± åŒ–</strong>å¯ä¿ç•™èƒŒæ™¯ç‰¹å¾ã€‚</p>
<figure data-type="image" tabindex="12"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932125-12.png" alt="5-12" loading="lazy"></figure>
<ul>
<li>
<p>TensorFlow æè¿°æ± åŒ–</p>
<pre><code class="language-python"># æœ€å¤§æ± åŒ–
tf.keras.layers.MaxPool2D(
    pool_size=æ± åŒ–æ ¸å°ºå¯¸,  # æ­£æ–¹å½¢å†™æ ¸é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆæ ¸é«˜hï¼Œæ ¸å®½wï¼‰
    sreides=æ± åŒ–æ­¥é•¿,  # æ­¥é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆçºµå‘æ­¥é•¿hï¼Œæ¨ªå‘æ­¥é•¿wï¼‰ï¼Œé»˜è®¤ä¸ºpool_size
    padding='valid' or 'same'  # ä½¿ç”¨å…¨é›¶å¡«å……æ˜¯'same'ï¼Œä¸ä½¿ç”¨æ˜¯'valid'ï¼ˆé»˜è®¤ï¼‰
)
</code></pre>
<pre><code class="language-python"># å‡å€¼æ± åŒ–
tf.keras.layers.MaxPool2D(
    pool_size=æ± åŒ–æ ¸å°ºå¯¸,  # æ­£æ–¹å½¢å†™æ ¸é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆæ ¸é«˜hï¼Œæ ¸å®½wï¼‰
    sreides=æ± åŒ–æ­¥é•¿,  # æ­¥é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆçºµå‘æ­¥é•¿hï¼Œæ¨ªå‘æ­¥é•¿wï¼‰ï¼Œé»˜è®¤ä¸ºpool_size
    padding='valid' or 'same'  # ä½¿ç”¨å…¨é›¶å¡«å……æ˜¯'same'ï¼Œä¸ä½¿ç”¨æ˜¯'valid'ï¼ˆé»˜è®¤ï¼‰
)
</code></pre>
<pre><code class="language-python">model = tf.keras.layers.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # å·ç§¯å±‚
    BatchNormalization(),  # BNå±‚
    Activation('relu'),  # æ¿€æ´»å±‚
    MaxPool2D(pool_size=(2, 2), strides=2, padding='same'),  # æ± åŒ–å±‚
    Dropout(0.2)  # Dropoutå±‚
])
</code></pre>
</li>
</ul>
<h4 id="57-èˆå¼ƒdropout">5.7 èˆå¼ƒï¼ˆDropoutï¼‰</h4>
<p>åœ¨ç¥ç»ç½‘ç»œè®­ç»ƒæ—¶ï¼Œï¼ˆä¸ºäº†ç¼“è§£ç¥ç»ç½‘ç»œçš„è¿‡æ‹Ÿåˆï¼‰å°†ä¸€éƒ¨åˆ†ç¥ç»å…ƒæŒ‰ç…§ä¸€å®šæ¦‚ç‡ä»ç¥ç»ç½‘ç»œä¸­æš‚æ—¶èˆå¼ƒã€‚ç¥ç»ç½‘ç»œä½¿ç”¨æ—¶ï¼Œè¢«èˆå¼ƒçš„ç¥ç»å…ƒæ¢å¤é“¾æ¥ã€‚</p>
<figure data-type="image" tabindex="13"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932215-13.png" alt="5-13" loading="lazy"></figure>
<p><code>tf.keras.layers.Dropout(èˆå¼ƒçš„æ¦‚ç‡)</code></p>
<pre><code class="language-python">model = tf.keras.layers.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # å·ç§¯å±‚
    BatchNormalization(),  # BNå±‚
    Activation('relu'),  # æ¿€æ´»å±‚
    MaxPool2D(pool_size=(2, 2), strides=2, padding='same'),  # æ± åŒ–å±‚
    Dropout(0.2)  # Dropoutå±‚  éšæœºèˆå¼ƒ20%çš„ç¥ç»å…ƒ
])
</code></pre>
<h4 id="58-å·ç§¯ç¥ç»ç½‘ç»œå°ç»“">5.8 å·ç§¯ç¥ç»ç½‘ç»œå°ç»“</h4>
<p>å·ç§¯ç¥ç»ç½‘ç»œï¼šå€ŸåŠ©å·ç§¯æ ¸æå–ç‰¹å¾åï¼Œé€å…¥å…¨è¿æ¥ç½‘ç»œã€‚</p>
<ul>
<li>
<p>å·ç§¯ç¥ç»ç½‘ç»œçš„ä¸»è¦æ¨¡å—</p>
<p><code>å·ç§¯(Convolutional)</code>ã€<code>æ‰¹æ ‡å‡†åŒ–(BN)</code>ã€<code>æ¿€æ´»(Activation)</code>ã€<code>æ± åŒ–(Pooling)</code>ã€<code>å…¨è¿æ¥(FC)</code></p>
<p>å‰å››ä¸ªæ˜¯å¯¹è¾“å…¥ç‰¹å¾æå–</p>
</li>
<li>
<p>å·ç§¯æ˜¯ä»€ä¹ˆï¼Ÿ  <strong>å·ç§¯å°±æ˜¯ç‰¹å¾æå–å™¨ï¼Œå°±æ˜¯CBAPD</strong></p>
<pre><code class="language-python">model = tf.keras.layers.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # C
    BatchNormalization(),  # B
    Activation('relu'),  # A
    MaxPool2D(pool_size=(2, 2), strides=2, padding='same'),  # P
    Dropout(0.2)  # D
])
</code></pre>
</li>
</ul>
<h4 id="59-cifar10æ•°æ®é›†">5.9 CIFAR10æ•°æ®é›†</h4>
<p><code>æä¾›5ä¸‡å¼ 32*32åƒç´ ç‚¹çš„ååˆ†ç±»å½©è‰²å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒã€‚ æä¾›1ä¸‡å¼ 32*32åƒç´ ç‚¹çš„ååˆ†ç±»å½©è‰²å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯•ã€‚</code></p>
<figure data-type="image" tabindex="14"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932275-14.png" alt="5-14" loading="lazy"></figure>
<ul>
<li>
<p>å¯¼å…¥cifar10æ•°æ®é›†ï¼š</p>
<pre><code class="language-python">cifar10 = tf.keras.datasets.cifar10
(x_train, y_train), (x_test, y_test) = cifar10.load_data()
</code></pre>
<pre><code class="language-python">plt.imshow(x_train[0])  # ç»˜åˆ¶å›¾ç‰‡
plt.show()
</code></pre>
<pre><code class="language-python">print('x_train[0]:\n', x_train[0])
print('y_train[0]:', y_train[0])
print('x_test.shape:', x_test.shape)
</code></pre>
</li>
</ul>
<h4 id="510-å·ç§¯ç¥ç»ç½‘ç»œæ­å»ºç¤ºä¾‹">5.10 å·ç§¯ç¥ç»ç½‘ç»œæ­å»ºç¤ºä¾‹</h4>
<pre><code>C(æ ¸ï¼š6*5*5ï¼Œæ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼šsame)
B(yes)
A(relu)
P(maxï¼Œæ ¸ï¼š2*2ï¼Œæ­¥é•¿ï¼š2ï¼Œå¡«å……ï¼šsame)
D(0.2)

Flatten
Dense(ç¥ç»å…ƒï¼š128ï¼Œæ¿€æ´»ï¼šreluï¼ŒDropoutï¼š0.2)
Dense(ç¥ç»å…ƒï¼š10ï¼Œæ¿€æ´»ï¼šsoftmax)
</code></pre>
<pre><code class="language-python"># å…¶ä»–ä¸åŒç½‘ç»œç»“æ„ä¹Ÿä»…åœ¨æ­¤å¤„classå®šä¹‰ç»“æ„çš„ä¸åŒ
class Baseline(Model):
    def __init__(self):
        super(Baseline, self).__init__()
        self.c1 = Conv2D(filters=6, kernel_size=(5, 5), padding='same')
        self.b1 = BatchNormalization()
        self.a1 = Activation()
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d1 = Dropout(0.2)
        
        self.flatten = Flatten()
        self.f1 = Dense(128, activation='relu')
        self.d2 = Dropout(0.2)
        self.f2 = Dense(10, activation='softmax')
    
    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.p1(x)
        x = self.d1(x)
        
        x = self.flatten(x)
        x = self.f1(x)
        x = self.d2(x)
        y = self.f2(x)
        return y
</code></pre>
<ul>
<li>
<p>å®Œæ•´cifar10ä»£ç </p>
<pre><code class="language-python">import tensorflow as tf
import os
import numpy as np
from matplotlib import pyplot as plt
from tensorflow.keras.layers import Conv2D, BatchNormalization, Activation, MaxPool2D, Dropout, Flatten, Dense
from tensorflow.keras import Model

np.set_printoptions(threshold=np.inf)

cifar10 = tf.keras.datasets.cifar10
(x_train, y_train), (x_test, y_test) = cifar10.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0


class Baseline(Model):
    def __init__(self):
        super(Baseline, self).__init__()
        self.c1 = Conv2D(filters=6, kernel_size=(5, 5), padding='same')  # å·ç§¯å±‚
        self.b1 = BatchNormalization()  # BNå±‚
        self.a1 = Activation('relu')  # æ¿€æ´»å±‚
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')  # æ± åŒ–å±‚
        self.d1 = Dropout(0.2)  # dropoutå±‚

        self.flatten = Flatten()
        self.f1 = Dense(128, activation='relu')
        self.d2 = Dropout(0.2)
        self.f2 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.p1(x)
        x = self.d1(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.d2(x)
        y = self.f2(x)
        return y


model = Baseline()

model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/Baseline.ckpt&quot;
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True)

history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])
model.summary()

# print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']

plt.subplot(1, 2, 1)
plt.plot(acc, label='Training Accuracy')
plt.plot(val_acc, label='Validation Accuracy')
plt.title('Training and Validation Accuracy')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label='Training Loss')
plt.plot(val_loss, label='Validation Loss')
plt.title('Training and Validation Loss')
plt.legend()
plt.show()


# è¿è¡Œç»“æœ
# Epoch 4/5
# 1563/1563 [==============================] - 4s 3ms/step - loss: 1.1299 - sparse_categorical_accuracy: 0.5955 - val_loss: 1.4539 - val_sparse_categorical_accuracy: 0.5108
# Epoch 5/5
# 1563/1563 [==============================] - 4s 3ms/step - loss: 1.1136 - sparse_categorical_accuracy: 0.6032 - val_loss: 1.1590 - val_sparse_categorical_accuracy: 0.5951
# Model: &quot;baseline&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #   
# =================================================================
# conv2d (Conv2D)              multiple                  456       
# _________________________________________________________________
# batch_normalization (BatchNo multiple                  24        
# _________________________________________________________________
# activation (Activation)      multiple                  0         
# _________________________________________________________________
# max_pooling2d (MaxPooling2D) multiple                  0         
# _________________________________________________________________
# dropout (Dropout)            multiple                  0         
# _________________________________________________________________
# flatten (Flatten)            multiple                  0         
# _________________________________________________________________
# dense (Dense)                multiple                  196736    
# _________________________________________________________________
# dropout_1 (Dropout)          multiple                  0         
# _________________________________________________________________
# dense_1 (Dense)              multiple                  1290      
# =================================================================
# Total params: 198,506
# Trainable params: 198,494
# Non-trainable params: 12
# _________________________________________________________________
# 
# Process finished with exit code 0
</code></pre>
</li>
</ul>
<h4 id="511-ç»å…¸å·ç§¯ç½‘ç»œlenet">5.11 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”LeNet</h4>
<p>LeNetç”±Yann LeCunäº1998å¹´æå‡ºï¼Œå·ç§¯ç½‘ç»œå¼€ç¯‡ä¹‹ä½œã€‚</p>
<blockquote>
<p>Yann Lecun, Leon Bottou, Y. Bengio, Patrick Haffner. Gradient-Based Learning Applied to Document Recognition. Proceedings of the IEEE, 1998</p>
</blockquote>
<p>é€šè¿‡å…±äº«å·ç§¯æ ¸ï¼Œå‡å°äº†ç½‘ç»œå‚æ•°ã€‚</p>
<figure data-type="image" tabindex="15"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932315-15.png" alt="5-15" loading="lazy"></figure>
<p>Noneè¡¨ç¤ºLeNetæå‡ºå½“æ—¶è¿˜æ²¡æœ‰è¿™äº›æ“ä½œã€‚</p>
<ul>
<li>
<p>LeNetç½‘ç»œç»“æ„</p>
<pre><code class="language-python">class LeNet5(Model):
    def __init__(self):
        super(LeNet5, self).__init__()
        self.c1 = Conv2D(filters=6, kernel_size=(5, 5), activation='sigmoid')
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2)
        self.c2 = Conv2D(filters=16, kernel_size=(5, 5), activation='sigmoid')
        self.p2 = MaxPool2D(pool_size=(2, 2), strides=2)
        
        self.flatten = Flatten()
        self.f1 = Dense(120, activation='sigmoid')
        self.f2 = Dense(84, activation='sigmoid')
        self.f3 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.p1(x)

        x = self.c2(x)
        x = self.p2(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.f2(x)
        y = self.f3(x)
        return y
</code></pre>
</li>
</ul>
<h4 id="512-ç»å…¸å·ç§¯ç½‘ç»œalexnet">5.12 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”AlexNet</h4>
<p>AlexNetç½‘ç»œè¯ç”Ÿäº2012å¹´ï¼Œå½“å¹´ImageNetç«èµ›çš„å† å†›ï¼ŒTop5é”™è¯¯ç‡ä¸º16.4%ã€‚</p>
<blockquote>
<p>Alex Krizhevsky, Ilya Sutskever, Geoffrey E. Hinton. ImageNet Classification with Deep Convolutional Neural Networks. In NIPS, 2012</p>
</blockquote>
<figure data-type="image" tabindex="16"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932385-16.png" alt="5-16" loading="lazy"></figure>
<ul>
<li>
<p>AlexNet class ä»£ç </p>
<pre><code class="language-python">class AlexNet8(Model):
    def __init__(self):
        super(AlexNet8, self).__init__()
        self.c1 = Conv2D(filters=96, kernel_size=(3, 3))
        self.b1 = BatchNormalization()
        self.a1 = Activation('relu')
        self.p1 = MaxPool2D(pool_size=(3, 3), strides=2)
        
        self.c2 = Conv2D(filters=256, kernel_size=(3, 3))
        self.b2 = BatchNormalization()
        self.a2 = Activation('relu')
        self.p2 = MaxPool2D(pool_size=(3, 3), strides=2)
        
        self.c3 = Conv2D(filters=384, kernel_size=(3, 3), padding='same', activation='relu')
                         
        self.c4 = Conv2D(filters=384, kernel_size=(3, 3), padding='same', activation='relu')
                         
        self.c5 = Conv2D(filters=256, kernel_size=(3, 3), padding='same', activation='relu')
        self.p3 = MaxPool2D(pool_size=(3, 3), strides=2)

        self.flatten = Flatten()
        self.f1 = Dense(2048, activation='relu')
        self.d1 = Dropout(0.5)
        self.f2 = Dense(2048, activation='relu')
        self.d2 = Dropout(0.5)
        self.f3 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.p1(x)

        x = self.c2(x)
        x = self.b2(x)
        x = self.a2(x)
        x = self.p2(x)

        x = self.c3(x)

        x = self.c4(x)

        x = self.c5(x)
        x = self.p3(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.d1(x)
        x = self.f2(x)
        x = self.d2(x)
        y = self.f3(x)
        return y
</code></pre>
</li>
</ul>
<h4 id="513-ç»å…¸å·ç§¯ç½‘ç»œvggnet">5.13 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”VGGNet</h4>
<p>VGGNetè¯ç”Ÿäº2014å¹´ï¼Œå½“å¹´ImageNetç«èµ›çš„äºšå†›ï¼ŒTop5é”™è¯¯ç‡å‡å°åˆ°7.3%ã€‚</p>
<blockquote>
<p>K. Simonyan, A. Zisserman. Very Deep Convolutional Networks for Large-Scale Image Recognition.In ICLR, 2015.</p>
</blockquote>
<figure data-type="image" tabindex="17"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932445-17.png" alt="5-17" loading="lazy"></figure>
<ul>
<li>
<p>VGGNet class ä»£ç </p>
<pre><code class="language-python">class VGG16(Model):
    def __init__(self):
        super(VGG16, self).__init__()
        self.c1 = Conv2D(filters=64, kernel_size=(3, 3), padding='same')  # å·ç§¯å±‚1
        self.b1 = BatchNormalization()  # BNå±‚1
        self.a1 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c2 = Conv2D(filters=64, kernel_size=(3, 3), padding='same')
        self.b2 = BatchNormalization()  # BNå±‚1
        self.a2 = Activation('relu')  # æ¿€æ´»å±‚1
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d1 = Dropout(0.2)  # dropoutå±‚

        self.c3 = Conv2D(filters=128, kernel_size=(3, 3), padding='same')
        self.b3 = BatchNormalization()  # BNå±‚1
        self.a3 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c4 = Conv2D(filters=128, kernel_size=(3, 3), padding='same')
        self.b4 = BatchNormalization()  # BNå±‚1
        self.a4 = Activation('relu')  # æ¿€æ´»å±‚1
        self.p2 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d2 = Dropout(0.2)  # dropoutå±‚

        self.c5 = Conv2D(filters=256, kernel_size=(3, 3), padding='same')
        self.b5 = BatchNormalization()  # BNå±‚1
        self.a5 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c6 = Conv2D(filters=256, kernel_size=(3, 3), padding='same')
        self.b6 = BatchNormalization()  # BNå±‚1
        self.a6 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c7 = Conv2D(filters=256, kernel_size=(3, 3), padding='same')
        self.b7 = BatchNormalization()
        self.a7 = Activation('relu')
        self.p3 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d3 = Dropout(0.2)

        self.c8 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b8 = BatchNormalization()  # BNå±‚1
        self.a8 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c9 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b9 = BatchNormalization()  # BNå±‚1
        self.a9 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c10 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b10 = BatchNormalization()
        self.a10 = Activation('relu')
        self.p4 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d4 = Dropout(0.2)

        self.c11 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b11 = BatchNormalization()  # BNå±‚1
        self.a11 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c12 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b12 = BatchNormalization()  # BNå±‚1
        self.a12 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c13 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b13 = BatchNormalization()
        self.a13 = Activation('relu')
        self.p5 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d5 = Dropout(0.2)

        self.flatten = Flatten()  # æœªè®¡å…¥å±‚æ•°
        self.f1 = Dense(512, activation='relu')
        self.d6 = Dropout(0.2)
        self.f2 = Dense(512, activation='relu')
        self.d7 = Dropout(0.2)
        self.f3 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.c2(x)
        x = self.b2(x)
        x = self.a2(x)
        x = self.p1(x)
        x = self.d1(x)

        x = self.c3(x)
        x = self.b3(x)
        x = self.a3(x)
        x = self.c4(x)
        x = self.b4(x)
        x = self.a4(x)
        x = self.p2(x)
        x = self.d2(x)

        x = self.c5(x)
        x = self.b5(x)
        x = self.a5(x)
        x = self.c6(x)
        x = self.b6(x)
        x = self.a6(x)
        x = self.c7(x)
        x = self.b7(x)
        x = self.a7(x)
        x = self.p3(x)
        x = self.d3(x)

        x = self.c8(x)
        x = self.b8(x)
        x = self.a8(x)
        x = self.c9(x)
        x = self.b9(x)
        x = self.a9(x)
        x = self.c10(x)
        x = self.b10(x)
        x = self.a10(x)
        x = self.p4(x)
        x = self.d4(x)

        x = self.c11(x)
        x = self.b11(x)
        x = self.a11(x)
        x = self.c12(x)
        x = self.b12(x)
        x = self.a12(x)
        x = self.c13(x)
        x = self.b13(x)
        x = self.a13(x)
        x = self.p5(x)
        x = self.d5(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.d6(x)
        x = self.f2(x)
        x = self.d7(x)
        y = self.f3(x)
        return y
</code></pre>
</li>
</ul>
<h4 id="514-ç»å…¸å·ç§¯ç½‘ç»œinceptionnet">5.14 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”InceptionNet</h4>
<p>InceptionNetè¯ç”Ÿäº2014å¹´ï¼Œå½“å¹´ImageNetç«èµ›å† å†›ï¼ŒTop5é”™è¯¯ç‡ä¸º6.67%ã€‚</p>
<blockquote>
<p>Szegedy C, Liu W, Jia Y, et al. Going Deeper with Convolutions. In CVPR, 2015.</p>
</blockquote>
<figure data-type="image" tabindex="18"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932495-18.png" alt="5-18" loading="lazy"></figure>
<blockquote>
<p>åŒä¸€å±‚ç½‘ç»œå†…ä½¿ç”¨ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸ï¼Œæå‡äº†æ¨¡å‹æ„ŸçŸ¥åŠ›ï¼›ä½¿ç”¨äº†æ‰¹æ ‡å‡†åŒ–ï¼Œç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
</blockquote>
<ul>
<li>
<p>InceptionNet class ä»£ç </p>
<pre><code class="language-python">class ConvBNRelu(Model):
    def __init__(self, ch, kernelsz=3, strides=1, padding='same'):
        super(ConvBNRelu, self).__init__()
        self.model = tf.keras.models.Sequential([
            Conv2D(ch, kernelsz, strides=strides, padding=padding),
            BatchNormalization(),
            Activation('relu')
        ])

    def call(self, x):
        x = self.model(x, training=False) #åœ¨training=Falseæ—¶ï¼ŒBNé€šè¿‡æ•´ä¸ªè®­ç»ƒé›†è®¡ç®—å‡å€¼ã€æ–¹å·®å»åšæ‰¹å½’ä¸€åŒ–ï¼Œtraining=Trueæ—¶ï¼Œé€šè¿‡å½“å‰batchçš„å‡å€¼ã€æ–¹å·®å»åšæ‰¹å½’ä¸€åŒ–ã€‚æ¨ç†æ—¶ training=Falseæ•ˆæœå¥½
        return x
    
    
class InceptionBlk(Model):
    def __init__(self, ch, strides=1):
        super(InceptionBlk, self).__init__()
        self.ch = ch
        self.strides = strides
        self.c1 = ConvBNRelu(ch, kernelsz=1, strides=strides)
        self.c2_1 = ConvBNRelu(ch, kernelsz=1, strides=strides)
        self.c2_2 = ConvBNRelu(ch, kernelsz=3, strides=1)
        self.c3_1 = ConvBNRelu(ch, kernelsz=1, strides=strides)
        self.c3_2 = ConvBNRelu(ch, kernelsz=5, strides=1)
        self.p4_1 = MaxPool2D(3, strides=1, padding='same')
        self.c4_2 = ConvBNRelu(ch, kernelsz=1, strides=strides)

    def call(self, x):
        x1 = self.c1(x)
        x2_1 = self.c2_1(x)
        x2_2 = self.c2_2(x2_1)
        x3_1 = self.c3_1(x)
        x3_2 = self.c3_2(x3_1)
        x4_1 = self.p4_1(x)
        x4_2 = self.c4_2(x4_1)
        # concat along axis=channel
        x = tf.concat([x1, x2_2, x3_2, x4_2], axis=3)
        return x

class Inception10(Model):
    def __init__(self, num_blocks, num_classes, init_ch=16, **kwargs):
        super(Inception10, self).__init__(**kwargs)
        self.in_channels = init_ch
        self.out_channels = init_ch
        self.num_blocks = num_blocks
        self.init_ch = init_ch
        self.c1 = ConvBNRelu(init_ch)
        self.blocks = tf.keras.models.Sequential()
        for block_id in range(num_blocks):
            for layer_id in range(2):
                if layer_id == 0:
                    block = InceptionBlk(self.out_channels, strides=2)
                else:
                    block = InceptionBlk(self.out_channels, strides=1)
                self.blocks.add(block)
            # enlarger out_channels per block
            self.out_channels *= 2
        self.p1 = GlobalAveragePooling2D()
        self.f1 = Dense(num_classes, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.blocks(x)
        x = self.p1(x)
        y = self.f1(x)
        return y
    
model = Inception10(num_blocks=2, num_classes=10)
</code></pre>
</li>
</ul>
<h4 id="515-ç»å…¸å·ç§¯ç½‘ç»œresnet">5.15 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”ResNet</h4>
<p>ResNetè¯ç”Ÿäº2015å¹´ï¼Œå½“å¹´ImageNetç«èµ›å† å†›ï¼ŒTop5é”™è¯¯ç‡ä¸º3.57%ã€‚</p>
<blockquote>
<p>Kaiming He, Xiangyu Zhang, Shaoqing Ren. Deep Residual Learning for Image Recognition. In CPVR, 2016</p>
</blockquote>
<ul>
<li>
<p>ç½‘ç»œå±‚æ•°åŠ æ·±æé«˜è¯†åˆ«å‡†ç¡®ç‡</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ¨¡å‹åç§°</th>
<th style="text-align:center">ç½‘ç»œå±‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">LeNet</td>
<td style="text-align:center">5</td>
</tr>
<tr>
<td style="text-align:center">AlexNet</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:center">VGGNet</td>
<td style="text-align:center">16/19</td>
</tr>
<tr>
<td style="text-align:center">InceptionNet V1</td>
<td style="text-align:center">22</td>
</tr>
</tbody>
</table>
<figure data-type="image" tabindex="19"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932545-19.png" alt="5-19" loading="lazy"></figure>
</li>
</ul>
<blockquote>
<p>ResNetæå‡ºäº†å±‚é—´æ®‹å·®è·³è¿ï¼Œå¼•å…¥äº†å‰æ–¹ä¿¡æ¯ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œä½¿ç¥ç»ç½‘ç»œå±‚æ•°å¢åŠ æˆä¸ºå¯èƒ½ã€‚</p>
</blockquote>
<ul>
<li>
<p>æ®‹å·®è·³è¿</p>
<figure data-type="image" tabindex="20"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932595-20.png" alt="5-20" loading="lazy"></figure>
<p>Inceptionå—ä¸­çš„â€+â€œæ˜¯æ²¿æ·±åº¦æ–¹å‘å åŠ ï¼ˆåƒå±‚è›‹ç³•å±‚æ•°å åŠ ï¼‰<br>
ResNetå—ä¸­çš„â€+â€œæ˜¯ç‰¹å¾å›¾å¯¹åº”å…ƒç´ å€¼ç›¸åŠ ï¼ˆçŸ©é˜µå€¼ç›¸åŠ ï¼‰</p>
</li>
<li>
<p>è¿æ¥æ–¹å¼</p>
<figure data-type="image" tabindex="21"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180933065-21.png" alt="5-21" loading="lazy"></figure>
<p>ä¸¤ç§å †å ä¸åŒçš„æ–¹æ³•ï¼šï¼ˆå †å å‰åçš„ç»´åº¦ä¼šä¸ç›¸åŒï¼‰</p>
<figure data-type="image" tabindex="22"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180933135-22.png" alt="5-22" loading="lazy"></figure>
<pre><code class="language-python">class ResnetBlock(Model):

    def __init__(self, filters, strides=1, residual_path=False):
        super(ResnetBlock, self).__init__()
        self.filters = filters
        self.strides = strides
        self.residual_path = residual_path

        self.c1 = Conv2D(filters, (3, 3), strides=strides, padding='same', use_bias=False)
        self.b1 = BatchNormalization()
        self.a1 = Activation('relu')

        self.c2 = Conv2D(filters, (3, 3), strides=1, padding='same', use_bias=False)
        self.b2 = BatchNormalization()

        # residual_pathä¸ºTrueæ—¶ï¼Œå¯¹è¾“å…¥è¿›è¡Œä¸‹é‡‡æ ·ï¼Œå³ç”¨1x1çš„å·ç§¯æ ¸åšå·ç§¯æ“ä½œï¼Œä¿è¯xèƒ½å’ŒF(x)ç»´åº¦ç›¸åŒï¼Œé¡ºåˆ©ç›¸åŠ 
        if residual_path:
            self.down_c1 = Conv2D(filters, (1, 1), strides=strides, padding='same', use_bias=False)
            self.down_b1 = BatchNormalization()
        
        self.a2 = Activation('relu')

    def call(self, inputs):
        residual = inputs  # residualç­‰äºè¾“å…¥å€¼æœ¬èº«ï¼Œå³residual=x
        # å°†è¾“å…¥é€šè¿‡å·ç§¯ã€BNå±‚ã€æ¿€æ´»å±‚ï¼Œè®¡ç®—F(x)
        x = self.c1(inputs)
        x = self.b1(x)
        x = self.a1(x)

        x = self.c2(x)
        y = self.b2(x)

        if self.residual_path:
            residual = self.down_c1(inputs)
            residual = self.down_b1(residual)

        out = self.a2(y + residual)  # æœ€åè¾“å‡ºçš„æ˜¯ä¸¤éƒ¨åˆ†çš„å’Œï¼Œå³F(x)+xæˆ–F(x)+Wx,å†è¿‡æ¿€æ´»å‡½æ•°
        return out
</code></pre>
</li>
<li>
<p>ResNet è¡¨ç¤º</p>
<figure data-type="image" tabindex="23"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180933195-23.png" alt="5-23" loading="lazy"></figure>
<pre><code class="language-python">class ResNet18(Model):

    def __init__(self, block_list, initial_filters=64):  # block_listè¡¨ç¤ºæ¯ä¸ªblockæœ‰å‡ ä¸ªå·ç§¯å±‚
        super(ResNet18, self).__init__()
        self.num_blocks = len(block_list)  # å…±æœ‰å‡ ä¸ªblock
        self.block_list = block_list
        self.out_filters = initial_filters
        self.c1 = Conv2D(self.out_filters, (3, 3), strides=1, padding='same', use_bias=False)
        self.b1 = BatchNormalization()
        self.a1 = Activation('relu')
        self.blocks = tf.keras.models.Sequential()
        # æ„å»ºResNetç½‘ç»œç»“æ„
        for block_id in range(len(block_list)):  # ç¬¬å‡ ä¸ªresnet block
            for layer_id in range(block_list[block_id]):  # ç¬¬å‡ ä¸ªå·ç§¯å±‚

                if block_id != 0 and layer_id == 0:  # å¯¹é™¤ç¬¬ä¸€ä¸ªblockä»¥å¤–çš„æ¯ä¸ªblockçš„è¾“å…¥è¿›è¡Œä¸‹é‡‡æ ·
                    block = ResnetBlock(self.out_filters, strides=2, residual_path=True)
                else:
                    block = ResnetBlock(self.out_filters, residual_path=False)
                self.blocks.add(block)  # å°†æ„å»ºå¥½çš„blockåŠ å…¥resnet
            self.out_filters *= 2  # ä¸‹ä¸€ä¸ªblockçš„å·ç§¯æ ¸æ•°æ˜¯ä¸Šä¸€ä¸ªblockçš„2å€
        self.p1 = tf.keras.layers.GlobalAveragePooling2D()
        self.f1 = tf.keras.layers.Dense(10, activation='softmax', kernel_regularizer=tf.keras.regularizers.l2())

    def call(self, inputs):
        x = self.c1(inputs)
        x = self.b1(x)
        x = self.a1(x)
        x = self.blocks(x)
        x = self.p1(x)
        y = self.f1(x)
        return y
model = ResNet18([2, 2, 2, 2])
</code></pre>
</li>
</ul>
<h4 id="516-ç»å…¸å·ç§¯ç½‘ç»œå°ç»“">5.16 ç»å…¸å·ç§¯ç½‘ç»œå°ç»“</h4>
<ul>
<li>
<p>LeNet</p>
<p>å·ç§¯ç½‘ç»œå¼€ç¯‡ä¹‹ä½œï¼Œå…±äº«å·ç§¯æ ¸ï¼Œå‡å°‘ç½‘ç»œå‚æ•°ã€‚</p>
</li>
<li>
<p>AlexNet</p>
<p>ä½¿ç”¨reluæ¿€æ´»å‡½æ•°ï¼Œæå‡è®­ç»ƒé€Ÿåº¦ï¼›<br>
ä½¿ç”¨Dropoutï¼Œç¼“è§£è¿‡æ‹Ÿåˆã€‚</p>
</li>
<li>
<p>VGGNet</p>
<p>å°å°ºå¯¸å·ç§¯æ ¸å‡å°‘å‚æ•°ï¼Œç½‘ç»œç»“æ„è§„æ•´ï¼Œé€‚åˆå¹¶è¡ŒåŠ é€Ÿã€‚</p>
</li>
<li>
<p>InceptionNet</p>
<p>ä¸€å±‚å†…ä½¿ç”¨ä¸åŒå°ºå¯¸å·ç§¯æ ¸ï¼Œæå‡æ„ŸçŸ¥åŠ›ï¼›ä½¿ç”¨BNï¼ˆæ‰¹æ ‡å‡†åŒ–ï¼‰æ“ä½œï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
</li>
<li>
<p>ResNet</p>
<p>å±‚é—´æ®‹å·®è·³è¿ï¼Œå¼•å…¥å‰æ–¹ä¿¡æ¯ï¼Œç¼“è§£æ¨¡å‹é€€åŒ–ï¼Œä½¿ç¥ç»ç½‘ç»œå±‚æ•°åŠ æ·±æˆä¸ºå¯èƒ½ã€‚</p>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•]]></title>
        <id>https://perfectqing.github.io/blogs/post/ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•/</id>
        <link href="https://perfectqing.github.io/blogs/post/ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•/">
        </link>
        <updated>2021-07-15T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•<br>
âœï¸  æœ¬ç« ç›®æ ‡ï¼šè‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨ã€æ•°æ®å¢å¼ºï¼Œæ‰©å……æ•°æ®é›†ã€æ–­ç‚¹ç»­è®­ï¼Œå­˜å–æ¨¡å‹ã€å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬ã€acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœã€åº”ç”¨ç¨‹åºï¼Œç»™å›¾è¯†ç‰©</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•<br>
âœï¸  æœ¬ç« ç›®æ ‡ï¼šè‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨ã€æ•°æ®å¢å¼ºï¼Œæ‰©å……æ•°æ®é›†ã€æ–­ç‚¹ç»­è®­ï¼Œå­˜å–æ¨¡å‹ã€å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬ã€acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœã€åº”ç”¨ç¨‹åºï¼Œç»™å›¾è¯†ç‰©</p>
<!-- more -->
<h2 id="ç¬¬å››ç« -ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•">ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•</h2>
<h4 id="æœ¬ç« ç›®æ ‡">æœ¬ç« ç›®æ ‡ï¼š</h4>
<ol>
<li>è‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨</li>
<li>æ•°æ®å¢å¼ºï¼Œæ‰©å……æ•°æ®é›†</li>
<li>æ–­ç‚¹ç»­è®­ï¼Œå­˜å–æ¨¡å‹</li>
<li>å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬</li>
<li>acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœ</li>
<li>åº”ç”¨ç¨‹åºï¼Œç»™å›¾è¯†ç‰©</li>
</ol>
<h4 id="41-è‡ªåˆ¶æ•°æ®é›†è§£å†³æœ¬é¢†åŸŸåº”ç”¨">4.1 è‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨</h4>
<p>è§‚å¯Ÿæ•°æ®é›†ç»“æ„ï¼Œç»™x_train, y_train, x_test, y_testèµ‹å€¼</p>
<p>mnist_image_labelæ–‡ä»¶å¤¹ï¼š <code>class4 &gt; MNIST_FC &gt; mnist_image_label</code></p>
<p>mnist_train_jpg_60000<br>
mnist_test_jpg_10000</p>
<figure data-type="image" tabindex="1"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_210715130025image-20210319084059005.png" alt="4-1" loading="lazy"></figure>
<p>mnist_train_jpg_60000.txt<br>
mnist_test_jpg_10000.txt</p>
<figure data-type="image" tabindex="2"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107151301194-2.png" alt="4-2" loading="lazy"></figure>
<pre><code class="language-python">mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
</code></pre>
<pre><code class="language-python">def generareds(å›¾ç‰‡è·¯å¾„, æ ‡ç­¾æ–‡ä»¶):  # æ›¿æ¢ä¸ŠåŠ è½½æ–‡ä»¶ä¸ºæœ¬åœ°æ•°æ®é›†
</code></pre>
<pre><code class="language-python">def generateds(path, txt):
    f = open(txt, 'r')  # ä»¥åªè¯»å½¢å¼æ‰“å¼€txtæ–‡ä»¶
    contents = f.readlines()  # è¯»å–æ–‡ä»¶ä¸­æ‰€æœ‰è¡Œ
    f.close()  # å…³é—­txtæ–‡ä»¶
    x, y_ = [], []  # å»ºç«‹ç©ºåˆ—è¡¨
    for content in contents:  # é€è¡Œå–å‡º
        value = content.split()  # ä»¥ç©ºæ ¼åˆ†å¼€ï¼Œå›¾ç‰‡è·¯å¾„ä¸ºvalue[0] , æ ‡ç­¾ä¸ºvalue[1] , å­˜å…¥åˆ—è¡¨
        img_path = path + value[0]  # æ‹¼å‡ºå›¾ç‰‡è·¯å¾„å’Œæ–‡ä»¶å
        img = Image.open(img_path)  # è¯»å…¥å›¾ç‰‡
        img = np.array(img.convert('L'))  # å›¾ç‰‡å˜ä¸º8ä½å®½ç°åº¦å€¼çš„np.arrayæ ¼å¼
        img = img / 255.  # æ•°æ®å½’ä¸€åŒ– ï¼ˆå®ç°é¢„å¤„ç†ï¼‰
        x.append(img)  # å½’ä¸€åŒ–åçš„æ•°æ®ï¼Œè´´åˆ°åˆ—è¡¨x
        y_.append(value[1])  # æ ‡ç­¾è´´åˆ°åˆ—è¡¨y_
        print('loading : ' + content)  # æ‰“å°çŠ¶æ€æç¤º

    x = np.array(x)  # å˜ä¸ºnp.arrayæ ¼å¼
    y_ = np.array(y_)  # å˜ä¸ºnp.arrayæ ¼å¼
    y_ = y_.astype(np.int64)  # å˜ä¸º64ä½æ•´å‹
    return x, y_  # è¿”å›è¾“å…¥ç‰¹å¾xï¼Œè¿”å›æ ‡ç­¾y_
</code></pre>
<h4 id="42-æ•°æ®å¢å¼º">4.2 æ•°æ®å¢å¼º</h4>
<p>æ•°æ®å¢å¼ºï¼ˆå¢å¤§æ•°æ®é‡ï¼‰</p>
<pre><code class="language-python"># tensorflow2 ç»™å‡ºçš„æ•°æ®å¢å¼ºå‡½æ•°
image_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(
	rescale = æ‰€æœ‰æ•°æ®å°†ä¹˜ä»¥è¯¥æ•°å€¼
    rotation_range = éšæœºæ—‹è½¬è§’åº¦æ•°èŒƒå›´
    width_shift_range = éšæœºå®½åº¦åç§»é‡
    height_shift_range = éšæœºé«˜åº¦åç§»é‡
    æ°´å¹³ç¿»è½¬ï¼šhorizontal_flip = æ˜¯å¦éšæœºæ°´å¹³ç¿»è½¬
    éšå³ç¼©æ”¾ï¼šzoom_range = éšæœºç¼©æ”¾çš„èŒƒå›´[1 - n, 1 + n]
)
image_gen_train.fit(x_train)
</code></pre>
<p><strong>ğŸ’¬ Example</strong></p>
<pre><code class="language-python">image_gen_train = ImageDataGenerator(
	rescale=1. / 1.,  # å¦‚ä¸ºå›¾åƒï¼Œåˆ†æ¯ä¸º255æ—¶ï¼Œå¯å½’è‡³0~1
    rotation_range=45,  # éšæœº45åº¦æ—‹è½¬
    width_shift_range=.15,  # å®½åº¦åç§»
    height_shift_range=.15,  # é«˜åº¦åç§»
    horizontal_flip=False,  # æ°´å¹³ç¿»è½¬
    zoom_range=0.5  # å°†å›¾åƒéšæœºç¼©æ”¾é˜ˆé‡50%
)
image_gen_train.fit(x_train)
# æ­¤å¤„x_trainè¦ä¿®æ”¹ç»´åº¦
x_train = x_train.reshape(x_train.shape[0], 28, 28, 1)
# (60000, 28, 28)  â†’  (60000, 28, 28, 1)
model.fit(x_trsain, y_train, batch_size=32, ......)
# æ”¹ä¸º
model.fit(image_gen_train.flow(x_train, y_train, batch_size=32), ......)
</code></pre>
<p><strong>p13_mnist_train_ex2.py</strong></p>
<pre><code class="language-python">import tensorflow as tf
from tensorflow.keras.preprocessing.image import ImageDataGenerator

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0
x_train = x_train.reshape(x_train.shape[0], 28, 28, 1)  # ç»™æ•°æ®å¢åŠ ä¸€ä¸ªç»´åº¦,ä»(60000, 28, 28)reshapeä¸º(60000, 28, 28, 1)  æœ€åä¸€ä¸ª1è¡¨ç¤ºå•é€šé“(ç°åº¦å€¼)

image_gen_train = ImageDataGenerator(
    rescale=1. / 1.,  # å¦‚ä¸ºå›¾åƒï¼Œåˆ†æ¯ä¸º255æ—¶ï¼Œå¯å½’è‡³0ï½1
    rotation_range=45,  # éšæœº45åº¦æ—‹è½¬
    width_shift_range=.15,  # å®½åº¦åç§»
    height_shift_range=.15,  # é«˜åº¦åç§»
    horizontal_flip=False,  # æ°´å¹³ç¿»è½¬
    zoom_range=0.5  # å°†å›¾åƒéšæœºç¼©æ”¾é˜ˆé‡50ï¼…
)
image_gen_train.fit(x_train)

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

model.fit(image_gen_train.flow(x_train, y_train, batch_size=32), epochs=5, validation_data=(x_test, y_test),
          validation_freq=1)
model.summary()
</code></pre>
<h4 id="43-æ–­ç‚¹ç»­è®­">4.3 æ–­ç‚¹ç»­è®­</h4>
<h5 id="è¯»å–ä¿å­˜æ¨¡å‹">è¯»å–ä¿å­˜æ¨¡å‹</h5>
<ul>
<li>
<p>è¯»å–æ¨¡å‹</p>
<p>load_weights(è·¯å¾„æ–‡ä»¶å)</p>
<pre><code class="language-python">checkpoint_save_path = './checkpoint/mnist.ckpt'
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model------------')
    model.load_weights(checkpoint_save_path)
</code></pre>
</li>
<li>
<p>ä¿å­˜æ¨¡å‹</p>
<pre><code class="language-python">tf.keras.callbacks.ModelCheckpoint(
    filepath=è·¯å¾„æ–‡ä»¶å,
    save_weights_only=True/False,  # åªä¿ç•™æ¨¡å‹å‚æ•°
    save_best_only=True/False  # åªä¿ç•™æœ€ä¼˜æ¨¡å‹
)
history = model.fit(callbacks=[cp_callback])
</code></pre>
<pre><code class="language-python">cp_callback = tf.keras.callbacks.ModelCheckpoint(
	filepath=checkpoint_save_path,
    save_weights_only=True,  # åªä¿ç•™æ¨¡å‹å‚æ•°
    save_best_only=True  # åªä¿ç•™æœ€ä¼˜æ¨¡å‹
)
history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1, callbacks=[cp_callback])
</code></pre>
</li>
<li>
<p>å®Œæ•´ä»£ç </p>
<pre><code class="language-python">import tensorflow as tf
import os

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/mnist.ckpt&quot;
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True)

history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])
model.summary()
</code></pre>
</li>
</ul>
<h4 id="44-å‚æ•°æå–æŠŠå‚æ•°å­˜å…¥æ–‡æœ¬">4.4 å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬</h4>
<ul>
<li>
<p>æå–å¯è®­ç»ƒå‚æ•°</p>
<p><code>model.trainable_variables</code>  è¿”å›æ¨¡å‹ä¸­å¯è®­ç»ƒçš„å‚æ•°</p>
</li>
<li>
<p>è®¾ç½®printè¾“å‡ºæ ¼å¼</p>
<p><code>np.set_printoptions(threshold=è¶…è¿‡å¤šå°‘çœç•¥æ˜¾ç¤º)</code></p>
<pre><code class="language-python">np.set_printoptions(threshold=np.inf)  # np.infè¡¨ç¤ºæ— é™å¤§

print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()
</code></pre>
</li>
<li>
<p>å®Œæ•´ä»£ç </p>
<pre><code class="language-python">import tensorflow as tf
import os
import numpy as np
np.set_printoptions(threshold=np.inf)
mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0
model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])
model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])
checkpoint_save_path = &quot;./checkpoint/mnist.ckpt&quot;
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)
cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True)
history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])
model.summary()
print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()
</code></pre>
</li>
</ul>
<h4 id="45-acclosså¯è§†åŒ–æŸ¥çœ‹è®­ç»ƒæ•ˆæœ">4.5 acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœ</h4>
<ul>
<li>
<p>accæ›²çº¿ä¸lossæ›²çº¿</p>
<p><strong>history = model.fit</strong>(è®­ç»ƒé›†æ•°æ®, è®­ç»ƒé›†æ ‡ç­¾, batch_size=, epochs=, validation_split=ç”¨ä½œæµ‹è¯•æ•°æ®çš„æ¯”ä¾‹, validation_data=æµ‹è¯•é›†, validation_freq=æµ‹è¯•é¢‘ç‡)</p>
<p><strong>history:</strong> (è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šä¿å­˜è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„loss)</p>
<p>è®­ç»ƒé›†lossï¼šloss<br>
æµ‹è¯•é›†lossï¼šval_loss<br>
è®­ç»ƒé›†å‡†ç¡®ç‡ï¼šsparse_categorical_accuracy<br>
æµ‹è¯•é›†å‡†ç¡®ç‡ï¼šval_sparse_categorical_accuracy</p>
<pre><code class="language-python">acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']
</code></pre>
</li>
<li>
<p>å®Œæ•´ä»£ç  (æœ€å¥½å¯ä»¥èƒŒä¸‹æ¥)</p>
<pre><code class="language-python">import os

import numpy as np
import tensorflow as tf
import matplotlib.pyplot as plt

np.set_printoptions(threshold=np.inf)

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(
	optimizer='adam',
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

checkpoint_save_path = './checkpoint/mnist.ckpt'
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model------------')
    model.load_weights(checkpoint_save_path)
    
cp_callback = tf.keras.callbacks.ModelCheckpoint(
    filepath=checkpoint_save_path,
    save_weights_only=True,
    save_best_only=True                                                )

history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1, callbacks=[cp_callback])
model.summary()

print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()


########################Show###################
acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']

plt.subplot(1, 2, 1)  # åˆ†ä¸ºä¸€è¡Œä¸¤åˆ—ï¼Œå…ˆç”»ç¬¬ä¸€åˆ—
plt.plot(acc, label='Training Accuracy')
plt.plot(val_acc, label='Validation Accuracy')
plt.title('Training and Validation Accuracy')
plt.legend()

plt.subplot(1, 2, 2)  # åˆ†ä¸ºä¸€è¡Œä¸¤åˆ—ï¼Œç”»ç¬¬äºŒåˆ—
plt.plot(loss, label='Training Loss')
plt.plot(val_loss, label='Validation Loss')
plt.title('Training and Validation Loss')
plt.legend()
plt.show()
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107151302104-3.png" alt="4-3" loading="lazy"></figure>
</li>
</ul>
<h4 id="46-ç»™å›¾è¯†ç‰©">4.6 ç»™å›¾è¯†ç‰©</h4>
<ul>
<li>
<p>å‰å‘ä¼ æ’­æ‰§è¡Œåº”ç”¨</p>
<p>predict(è¾“å…¥ç‰¹å¾, batch_size=æ•´æ•°)</p>
<p>è¿”å›å‰å‘ä¼ æ’­è®¡ç®—ç»“æœ</p>
</li>
</ul>
<p><strong>å¤ç°æ¨¡å‹ï¼ˆå‰å‘ä¼ æ’­ï¼‰</strong>  <code>model = tf.keras.models.Sequential([......])</code><br>
<strong>åŠ è½½å‚æ•°</strong>  <code>model.load_weights(model_save_path)</code><br>
<strong>é¢„æµ‹ç»“æœ</strong>  <code>result = model.predict(x_predict)</code></p>
<pre><code class="language-python">from PIL import Image
import numpy as np
import tensorflow as tf
import matplotlib.pyplot as plt

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.load_weights(model_save_path)

preNum = int(input('input the number of test pictures:'))


for i in range(preNum):
    image_path = input('the path of test picture:')
    img = Image.open(image_path)
    # è®­ç»ƒå›¾ç‰‡æ˜¯28è¡Œ28åˆ—çš„ç°åº¦å›¾ï¼Œæ•…è¾“å…¥çš„ä»»æ„å°ºå¯¸çš„å›¾ç‰‡éœ€è¦resize()
    img = img.resize((28, 28), Image.ANTIALIAS)
    img_arr = np.array(img.convert('L'))
    
    # img_arr = 255 - img_arr  # é¢„å¤„ç†ï¼Œä¸åé¢çš„é¢„å¤„ç†äºŒé€‰å…¶ä¸€
    
    # å°†å›¾ç‰‡å¤„ç†ä¸ºé«˜å¯¹æ¯”åº¦å›¾ç‰‡ï¼Œå³é¢„å¤„ç†
    for i in range(28):
        for j in range(28):
            if img_arr[i][j] &lt; 200:
                img_arr[i][j] = 255
            else:
                img_arr[i][j] = 0
    
    
    img_arr = img_arr / 255.0  # å½’ä¸€åŒ–
    x_predict = img_arr[tf.newaxis, ...]
    result = model.predict(x_predict)
    pred = tf.argmax(result, axis=1)
    print('\n')
    tf.print(pred)
    
    plt.pause(1)
    plt.close()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ]]></title>
        <id>https://perfectqing.github.io/blogs/post/ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ/</id>
        <link href="https://perfectqing.github.io/blogs/post/ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ/">
        </link>
        <updated>2021-07-14T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šç¥ç»ç½‘ç»œæ­å»ºå…«è‚¡ã€irisä»£ç å¤ç°ã€MNISTæ•°æ®é›†ã€è®­ç»ƒMNISTæ•°æ®é›†ã€Fashionæ•°æ®é›†</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šç¥ç»ç½‘ç»œæ­å»ºå…«è‚¡ã€irisä»£ç å¤ç°ã€MNISTæ•°æ®é›†ã€è®­ç»ƒMNISTæ•°æ®é›†ã€Fashionæ•°æ®é›†</p>
<!-- more -->
<h2 id="ç¬¬ä¸‰ç« -ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ">ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ</h2>
<p>æœ¬è®²ç›®æ ‡ï¼š</p>
<ul>
<li>ç¥ç»ç½‘ç»œæ­å»ºå…«è‚¡</li>
<li>irisä»£ç å¤ç°</li>
<li>MNISTæ•°æ®é›†</li>
<li>è®­ç»ƒMNISTæ•°æ®é›†</li>
<li>Fashionæ•°æ®é›†</li>
</ul>
<h3 id="31-æ­å»ºç½‘ç»œå…«è‚¡-sequential">3.1 æ­å»ºç½‘ç»œå…«è‚¡ Sequential</h3>
<h4 id="ç”¨-tensorflow-api-tfkeras-æ­å»ºç½‘ç»œå…«è‚¡">ç”¨ Tensorflow API: tf.keras æ­å»ºç½‘ç»œå…«è‚¡</h4>
<ul>
<li>
<p>å…­æ­¥æ³•</p>
<ul>
<li><code>import</code></li>
<li><code>train, test</code>  # æŒ‡å®šè®­ç»ƒé›†ç‰¹å¾å’Œæ ‡ç­¾</li>
<li><code>model = tf.keras.models.Sequential</code>  # é€å±‚æè¿°ç½‘ç»œ</li>
<li><code>model.compile</code>  # ä½¿ç”¨å“ªç§ä¼˜åŒ–å™¨ã€æŸå¤±å‡½æ•°ã€è¯„æµ‹æŒ‡æ ‡ç­‰</li>
<li><code>model.fit</code>  # è®­ç»ƒè¿‡ç¨‹ï¼Œå‘ŠçŸ¥è®­ç»ƒé›†è¾“å…¥ç‰¹å¾æ ‡ç­¾ï¼Œbatchï¼Œè¿­ä»£æ¬¡æ•°</li>
<li><code>model.summray</code>  # æ‰“å°å‡ºç½‘ç»œç»“æ„å’Œå‚æ•°ç»Ÿè®¡</li>
</ul>
</li>
<li>
<p>model = tf.keras.models.Sequential([ç½‘ç»œç»“æ„])  # æè¿°å„å±‚ç½‘ç»œ</p>
<p>ç½‘ç»œç»“æ„ä¸¾ä¾‹ï¼š</p>
<ul>
<li>
<p>æ‹‰ç›´å±‚ï¼štf.keras.layers.Flatten()</p>
</li>
<li>
<p>å…¨è¿æ¥å±‚ï¼štf.keras.layers.Dense(ç¥ç»å…ƒä¸ªæ•°, activation=&quot;æ¿€æ´»å‡½æ•°&quot;, kernel_regularizer=å“ªç§æ­£åˆ™åŒ–)</p>
<p>activation('å¯é€‰å­—ç¬¦ä¸²'): relu, softmax, sigmoid, tanh<br>
kernel_regularizerå¯é€‰: tf.keras.regularizers.l1(), tf.kers.regularizers.l2()</p>
</li>
<li>
<p>å·ç§¯å±‚ï¼štf.keras.layers.Conv2D(filters=å·ç§¯æ ¸ä¸ªæ•°, kernel_size=å·ç§¯æ ¸å°ºå¯¸, strides=å·ç§¯æ­¥é•¿, padding=&quot;valid&quot; or &quot;same&quot;)</p>
</li>
<li>
<p>LSTMå±‚ï¼štf.keras.layers.LSTM()</p>
</li>
</ul>
</li>
<li>
<p>model.compile(optimizer=ä¼˜åŒ–å™¨, loss=æŸå¤±å‡½æ•°, metrics=['å‡†ç¡®ç‡'])</p>
<p>Optimizerå¯é€‰ï¼š(ä½¿ç”¨å·¦è¾¹å­—ç¬¦ä¸²æˆ–å³è¾¹å‡½æ•°å½¢å¼ï¼Œè‡ªå®šä¹‰å­¦ä¹ ç‡ç­‰)</p>
<ul>
<li><code>'sgd'</code> or <code>tf.keras.optimizers.SGD(lr=å­¦ä¹ ç‡, momentum=åŠ¨é‡å‚æ•°)</code></li>
<li><code>'adagrad'</code> or <code>tf.keras.optimizer.Adagrad(lr=å­¦ä¹ ç‡)</code></li>
<li><code>'adadelta'</code> or <code>tf.keras.optimizer.Adadelta(lr=å­¦ä¹ ç‡)</code></li>
<li><code>'adam'</code> or <code>tf.keras.optimizer.Adam(lr=å­¦ä¹ ç‡, beta_1=0.9, beta_2=0.999)</code></li>
</ul>
<p>losså¯é€‰ï¼š</p>
<ul>
<li><code>'mse'</code> or <code>tf,keras.losses.MeanSquaredError()</code></li>
<li><code>'sparse_categorical_crossentropy'</code> or <code>tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False)</code>  # åœ¨è¯¢é—®æ˜¯å¦æ˜¯åŸå§‹è¾“å‡ºï¼Œç»è¿‡æ¦‚ç‡åˆ†å¸ƒä¸ºFalseï¼Œæ²¡æœ‰ç»è¿‡æ¦‚ç‡åˆ†å¸ƒç›´æ¥è¾“å‡ºä¸ºTrue</li>
</ul>
<p>Metricså¯é€‰ï¼š</p>
<ul>
<li><code>'accuracy'</code>: y_ å’Œ y éƒ½æ˜¯æ•°å€¼ï¼Œå¦‚ y_=[1]    y=[1]</li>
<li><code>'categorical_accuracy'</code>: y_ å’Œ y éƒ½æ˜¯ç‹¬çƒ­ç ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰ï¼Œå¦‚ y_=[0, 1, 0]    y=[0.256, 0.695, 0.048]</li>
<li><code>'sparse_categorical_accuracy'</code>: y_ æ˜¯æ•°å€¼ï¼Œy æ˜¯ç‹¬çƒ­ç ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰ï¼Œå¦‚ y_=[1]    y=[0.256, 0.695, 0.048]</li>
</ul>
</li>
<li>
<p>model.fit()</p>
<p><code>model.fit(è®­ç»ƒé›†çš„è¾“å…¥ç‰¹å¾, è®­ç»ƒé›†çš„æ ‡ç­¾, batch_size= , epocher= , validation_data=(æµ‹è¯•é›†çš„è¾“å…¥ç‰¹å¾ï¼Œæµ‹è¯•é›†çš„æ ‡ç­¾), validation_split=ä»è®­ç»ƒé›†åˆ’åˆ†å¤šå°‘æ¯”ä¾‹ç»™æµ‹è¯•é›†, validation_freq=å¤šå°‘æ¬¡epochæµ‹è¯•ä¸€æ¬¡)</code></p>
<p>â­• <code>validation_data</code>, <code>validation_split</code> äºŒé€‰å…¶ä¸€</p>
</li>
<li>
<p>model.summary()  # æ‰“å°å‡ºç½‘ç»œçš„ç»“æ„å’Œå‚æ•°ç»Ÿè®¡</p>
<pre><code class="language-powershell">Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
dense (Dense)                (None, 3)                 15
=================================================================
Total params: 15
Trainable params: 15
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<p>ä¸Šè¿°ä¸ºä¸€ä¸ª4è¾“å…¥å±‚ï¼Œ3è¾“å‡ºå±‚çš„ç½‘ç»œã€‚ (4 * 3 + 3 = 15)</p>
</li>
<li>
<p>p8_iris_sequential</p>
<pre><code class="language-python">import tensorflow as tf
from sklearn import datasets
import numpy as np

x_train = datasets.load_iris().data
y_train = datasets.load_iris().target

np.random.seed(116)
np.random.shuffle(x_train)
np.random.seed(116)
np.random.shuffle(y_train)
tf.random.set_seed(116)

model = tf.keras.models.Sequential([
    tf.keras.layers.Dense(3, activation='softmax', kernel_regularizer=tf.keras.regularizers.l2())
])

model.compile(optimizer=tf.keras.optimizers.SGD(lr=0.1),
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

model.fit(x_train, y_train, batch_size=32, epochs=500, validation_split=0.2, validation_freq=20)

model.summary()

# è¿è¡Œç»“æœ
# Epoch 498/500
# 4/4 [==============================] - 0s 1ms/step - loss: 0.3509 - sparse_categorical_accuracy: 0.9658
# Epoch 499/500
# 4/4 [==============================] - 0s 1ms/step - loss: 0.3691 - sparse_categorical_accuracy: 0.9306
# Epoch 500/500
# 4/4 [==============================] - 0s 14ms/step - loss: 0.3634 - sparse_categorical_accuracy: 0.9304 - val_loss: 0.3516 - val_sparse_categorical_accuracy: 0.8667
# Model: &quot;sequential&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #   
# =================================================================
# dense (Dense)                (None, 3)                 15        
# =================================================================
# Total params: 15
# Trainable params: 15
# Non-trainable params: 0
# _________________________________________________________________
</code></pre>
</li>
</ul>
<h3 id="32-æ­å»ºç½‘ç»œå…«è‚¡-class">3.2 æ­å»ºç½‘ç»œå…«è‚¡ class</h3>
<ul>
<li>
<p>ç”¨Tensorflow API: tf.keras æ­å»ºç½‘ç»œå…«è‚¡</p>
<pre><code class="language-python">class MyModel(Model):  # Modelè¡¨ç¤ºç»§æ‰¿äº†TensorFlowçš„Modelç±»
    def __init__(self):
        super(MyModel, self).__init__()
        å®šä¹‰ç½‘ç»œç»“æ„å—
    def call(self, x):  # x ä¸ºè¾“å…¥æ•°æ®
        è°ƒç”¨ç½‘ç»œç»“æ„å—ï¼Œå®ç°å‰å‘ä¼ æ’­
        return y
model = MyModel()
</code></pre>
<p><code>__init__()</code>  å®šä¹‰æ‰€æ¬²è¦ç½‘ç»œç»“æ„å—<br>
<code>call()</code>   å†™å‡ºå‰å‘ä¼ æ’­</p>
</li>
<li>
<p>iris_class ä»£ç </p>
<pre><code class="language-python"># ä¸iris_sequentialä¸åŒä¹‹å¤„
from tensorflow.keras.layers import Dense
from tensorflow.keras import Model

class IrisModel(Model):
    def __init__(self):
        super(IrisModel, self).__init__()
        self.d1 = Dense(3, activation='softmax', kernel_regularizer=tf.keras.regularizers.l2())

    def call(self, x):
        y = self.d1(x)
        return y

model = IrisModel()

# è¿è¡Œç»“æœ
# åŒiris_Sequential
</code></pre>
</li>
</ul>
<h3 id="33-mnistæ•°æ®é›†">3.3 MNISTæ•°æ®é›†ï¼š</h3>
<p>æä¾›6ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„ 0~9 æ‰‹å†™æ•°å­—å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒã€‚<br>
æä¾›1ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„ 0~9 æ‰‹å†™æ•°å­—å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯•ã€‚</p>
<ol>
<li>
<p>å¯¼å…¥MNISTæ•°æ®é›†ï¼š</p>
<pre><code class="language-python">mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
</code></pre>
</li>
<li>
<p>ä½œä¸ºè¾“å…¥ç‰¹å¾ï¼Œè¾“å…¥ç¥ç»ç½‘ç»œæ—¶ï¼Œå°†æ•°æ®æ‹‰ä¼¸ä¸ºä¸€ç»´æ•°ç»„ï¼š</p>
<pre><code class="language-python">tf.keras.layers.Flatten()
# [0 0 0 48 238 252 252 ... ... ... 253 186 12 0 0 0 0 0 0]
</code></pre>
</li>
<li>
<p>å¯è§†åŒ–å„ä¸ªæ•°æ®ä»¥åŠå®Œæ•´ä»£ç </p>
<pre><code class="language-python">import tensorflow as tf
from matplotlib import pyplot as plt

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()

# å¯è§†åŒ–è®­ç»ƒé›†è¾“å…¥ç‰¹å¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
plt.imshow(x_train[0], cmap='gray')  # ç»˜åˆ¶ç°åº¦å›¾
plt.show()

# æ‰“å°å‡ºè®­ç»ƒé›†è¾“å…¥ç‰¹å¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
print(&quot;x_train[0]:\n&quot;, x_train[0])
# æ‰“å°å‡ºè®­ç»ƒé›†æ ‡ç­¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
print(&quot;y_train[0]:\n&quot;, y_train[0])

# æ‰“å°å‡ºæ•´ä¸ªè®­ç»ƒé›†è¾“å…¥ç‰¹å¾å½¢çŠ¶
print(&quot;x_train.shape:\n&quot;, x_train.shape)
# æ‰“å°å‡ºæ•´ä¸ªè®­ç»ƒé›†æ ‡ç­¾çš„å½¢çŠ¶
print(&quot;y_train.shape:\n&quot;, y_train.shape)
# æ‰“å°å‡ºæ•´ä¸ªæµ‹è¯•é›†è¾“å…¥ç‰¹å¾çš„å½¢çŠ¶
print(&quot;x_test.shape:\n&quot;, x_test.shape)
# æ‰“å°å‡ºæ•´ä¸ªæµ‹è¯•é›†æ ‡ç­¾çš„å½¢çŠ¶
print(&quot;y_test.shape:\n&quot;, y_test.shape)

# è¿è¡Œç»“æœ
# x_train[0]:
#  'ä¸€ä¸ªäºŒç»´æ•°ç»„'
# y_train[0]:
#  5
# x_train.shape:
#  (60000, 28, 28)
# y_train.shape:
#  (60000,)
# x_test.shape:
#  (10000, 28, 28)
# y_test.shape:
#  (10000,)
</code></pre>
</li>
</ol>
<p><strong>ğŸ’¬ Codes å®Œæ•´çš„Mnistæ‰‹å†™æ•°æ®é›†ä»£ç </strong></p>
<pre><code class="language-python">import tensorflow as tf

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0  # æ•°å€¼å˜å°åæ›´åˆ©äºç¥ç»ç½‘ç»œçš„å¸æ”¶

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),  # å°†æ•°æ®é›†æ‹‰ä¼¸ä¸ºä¸€ç»´
    tf.keras.layers.Dense(128, activation='relu'),  # ç¬¬ä¸€ä¸ªDenseæ˜¯éšè—å±‚
    tf.keras.layers.Dense(10, activation='softmax')  # ç¬¬äºŒä¸ªDenseæ˜¯è¾“å‡ºå±‚
])

model.compile(
    optimizer='adam',
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1)
model.summary()


# è¿è¡Œç»“æœ
# Epoch 1/5
# 2021-07-13 13:32:15.085136: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.10
# 1875/1875 [==============================] - 4s 2ms/step - loss: 0.4395 - sparse_categorical_accuracy: 0.8750 - val_loss: 0.1424 - val_sparse_categorical_accuracy: 0.9567
# Epoch 2/5
# 1875/1875 [==============================] - 4s 2ms/step - loss: 0.1232 - sparse_categorical_accuracy: 0.9626 - val_loss: 0.1036 - val_sparse_categorical_accuracy: 0.9679
# Epoch 3/5
# 1875/1875 [==============================] - 4s 2ms/step - loss: 0.0828 - sparse_categorical_accuracy: 0.9749 - val_loss: 0.0934 - val_sparse_categorical_accuracy: 0.9701
# Epoch 4/5
# 1875/1875 [==============================] - 3s 2ms/step - loss: 0.0582 - sparse_categorical_accuracy: 0.9827 - val_loss: 0.0789 - val_sparse_categorical_accuracy: 0.9742
# Epoch 5/5
# 1875/1875 [==============================] - 4s 2ms/step - loss: 0.0432 - sparse_categorical_accuracy: 0.9870 - val_loss: 0.0768 - val_sparse_categorical_accuracy: 0.9767
# Model: &quot;sequential&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #   
# =================================================================
# flatten (Flatten)            (None, 784)               0         
# _________________________________________________________________
# dense (Dense)                (None, 128)               100480    
# _________________________________________________________________
# dense_1 (Dense)              (None, 10)                1290      
# =================================================================
# Total params: 101,770
# Trainable params: 101,770
# Non-trainable params: 0
# _________________________________________________________________
</code></pre>
<pre><code class="language-python"># class
from tensorflow.keras.layers import Dense, Flatten
from tensorflow.keras import Model

class MnistModel(Model):
    def __init__(self):
        super(MnistModel, self).__init__()
        self.flatten = Flatten()
        self.d1 = Dense(128, activation='relu')
        self.d2 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.flatten(x)
        x = self.d1(x)
        y = self.d2(x)
        return y
</code></pre>
<h3 id="34-fashionæ•°æ®é›†">3.4 FASHIONæ•°æ®é›†ï¼š</h3>
<p>æä¾›6ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„è¡£è£¤ç­‰å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒã€‚<br>
æä¾›1ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„è¡£è£¤ç­‰å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯•ã€‚</p>
<ul>
<li>
<p>å¯¼å…¥FASHIONæ•°æ®é›†ï¼š</p>
<pre><code class="language-python">fashion = tf.keras.datasets.fashion_mnist
(x_train, y_train), (x_test, y_test) = fashion.load_data()
</code></pre>
</li>
</ul>
<p><strong>ğŸ’¬ Codes</strong></p>
<pre><code class="language-python">import tensorflow as tf

fashion = tf.keras.datasets.fashion_mnist
(x_train, y_train), (x_test, y_test) = fashion.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(
    optimizer='adam',
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1)
model.summary()

# è¿è¡Œç»“æœ
# è®°å¾—è‡ªå·±åŠ¨æ‰‹ try 
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¬¬äºŒç«  ç¥ç»ç½‘ç»œä¼˜åŒ–åŠå‚æ•°æ›´æ–°]]></title>
        <id>https://perfectqing.github.io/blogs/post/ç¬¬äºŒç«  ç¥ç»ç½‘ç»œä¼˜åŒ–åŠå‚æ•°æ›´æ–°/</id>
        <link href="https://perfectqing.github.io/blogs/post/ç¬¬äºŒç«  ç¥ç»ç½‘ç»œä¼˜åŒ–åŠå‚æ•°æ›´æ–°/">
        </link>
        <updated>2021-07-12T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  ç¬¬äºŒç«  ç¥ç»ç½‘ç»œä¼˜åŒ–åŠå‚æ•°æ›´æ–°<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šå­¦ä¼šç¥ç»ç½‘ç»œä¼˜åŒ–è¿‡ç¨‹ï¼Œä½¿ç”¨æ­£åˆ™åŒ–å‡å°‘è¿‡æ‹Ÿåˆï¼Œä½¿ç”¨ä¼˜åŒ–å™¨æ›´æ–°ç½‘ç»œå‚æ•°ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  ç¬¬äºŒç«  ç¥ç»ç½‘ç»œä¼˜åŒ–åŠå‚æ•°æ›´æ–°<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šå­¦ä¼šç¥ç»ç½‘ç»œä¼˜åŒ–è¿‡ç¨‹ï¼Œä½¿ç”¨æ­£åˆ™åŒ–å‡å°‘è¿‡æ‹Ÿåˆï¼Œä½¿ç”¨ä¼˜åŒ–å™¨æ›´æ–°ç½‘ç»œå‚æ•°ã€‚</p>
<!-- more -->
<h2 id="ç¬¬äºŒç« -ç¥ç»ç½‘ç»œä¼˜åŒ–åŠå‚æ•°æ›´æ–°">ç¬¬äºŒç«  ç¥ç»ç½‘ç»œä¼˜åŒ–åŠå‚æ•°æ›´æ–°</h2>
<p>â€‹	æœ¬è®²ç›®æ ‡ï¼šå­¦ä¼šç¥ç»ç½‘ç»œä¼˜åŒ–è¿‡ç¨‹ï¼Œä½¿ç”¨æ­£åˆ™åŒ–å‡å°‘è¿‡æ‹Ÿåˆï¼Œä½¿ç”¨ä¼˜åŒ–å™¨æ›´æ–°ç½‘ç»œå‚æ•°ã€‚</p>
<ul>
<li>é¢„å¤‡çŸ¥è¯†</li>
<li>ç¥ç»ç½‘ç»œå¤æ‚åº¦</li>
<li>æŒ‡æ•°è¡°å‡å­¦ä¹ ç‡</li>
<li>æ¿€æ´»å‡½æ•°</li>
<li>æŸå¤±å‡½æ•°</li>
<li>æ¬ æ‹Ÿåˆä¸è¿‡æ‹Ÿåˆ</li>
<li>æ­£åˆ™åŒ–å‡å°‘è¿‡æ‹Ÿåˆ</li>
<li>ä¼˜åŒ–å™¨æ›´æ–°ç½‘ç»œå‚æ•°</li>
</ul>
<h3 id="21-é¢„å¤‡çŸ¥è¯†">2.1 é¢„å¤‡çŸ¥è¯†</h3>
<h4 id="tfwhere">tf.where()</h4>
<p>æ¡ä»¶è¯­å¥çœŸè¿”å›A,æ¡ä»¶è¯­å¥å‡è¿”å›B<br>
tf.where(æ¡ä»¶è¯­å¥, çœŸè¿”å›A, å‡è¿”å›B)</p>
<pre><code class="language-python">import tensorflow as tf

a = tf.constant([1, 2, 3, 1, 1])
b = tf.constant([0, 1, 3, 4, 5])
c = tf.where(tf.greater(a, b), a, b)  # è‹¥ a &gt; b, è¿”å› a å¯¹åº”ä½ç½®çš„å…ƒç´ ,å¦åˆ™è¿”å› b å¯¹åº”çš„å…ƒç´ 
print('c:', c)

# è¿è¡Œç»“æœ:
# c: tf.Tensor([1 2 3 4 5], shape=(5,), dtype=int32)
</code></pre>
<h4 id="nprandomrandomstaterand">np.random.RandomState.rand()</h4>
<p>è¿”å›ä¸€ä¸ª [0, 1) ä¹‹é—´çš„éšæœºæ•°<br>
np.random.RandomState.rand(ç»´åº¦)  # ç»´åº¦ä¸ºç©ºï¼Œè¿”å›æ ‡é‡</p>
<pre><code class="language-python">import numpy as np
rdm = np.random.RandomState(seed=1)  # seed å®šä¹‰ç”Ÿæˆéšæœºæ•°
a = rdm.rand()  # è¿”å›ä¸€ä¸ªæ ‡é‡
b = rdm.rand(2, 3) # è¿”å›ç»´åº¦ä¸º2è¡Œ3åˆ—éšæœºæ•°çŸ©é˜µ
print('a:', a)
print('b:', b)
# è¿è¡Œç»“æœ:
# a: 0.417022004702574
# b: [[7.20324493e-01 1.14374817e-04 3.02332573e-01]
# 	  [1.46755891e-01 9.23385948e-02 1.86260211e-01]]
</code></pre>
<h4 id="npvstack">np.vstack()</h4>
<p>å°†ä¸¤ä¸ªæ•°ç»„æŒ‰å‚ç›´æ–¹å‘å åŠ (ç»„åˆç§°æ–°çš„æ•°ç»„)<br>
np.vstack(æ•°ç»„1,  æ•°ç»„2)</p>
<pre><code class="language-python">import numpy as np
a = np.array([1, 2, 3])
b = np.array([4, 5, 6])
c = np.vstack((a, b))
print('c:', c)

# è¿è¡Œç»“æœ:
# c: [[1 2 3]
#     [4 5 6]]
</code></pre>
<h4 id="npmgrid-ravle-npc_">np.mgrid[]    .ravle()     np.c_[]</h4>
<p>np.mgrid[]            [èµ·å§‹å€¼, ç»“æŸå€¼)<br>
np.mgrid[èµ·å§‹å€¼: ç»“æŸå€¼: æ­¥é•¿, èµ·å§‹å€¼: ç»“æŸå€¼: æ­¥é•¿, ...]</p>
<p>.ravle()   å°†xå˜ä¸ºä¸€ç»´æ•°ç»„ï¼Œâ€œæŠŠ .å‰å˜é‡æ‹‰ç›´â€</p>
<p>np.c[]  ä½¿è¿”å›çš„é—´éš”æ•°å€¼ç‚¹é…å¯¹<br>
np.c[æ•°ç»„1, æ•°ç»„2, ...]</p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf

# ç”Ÿæˆç­‰é—´éš”æ•°å€¼ç‚¹
x, y = np.mgrid[1:3:1, 2:4:0.5]
# ä¸ºäº†ä¿æŒç»´åº¦ç›¸åŒï¼Œæ„æˆç½‘æ ¼ï¼Œæ•… x, y éƒ½æ˜¯å››åˆ—çš„

# å°†x, yæ‹‰ç›´ï¼Œå¹¶åˆå¹¶é…å¯¹ä¸ºäºŒç»´å¼ é‡ï¼Œç”ŸæˆäºŒç»´åæ ‡ç‚¹
grid = np.c_[x.ravel(), y.ravel()]
print(&quot;x:\n&quot;, x)
print(&quot;y:\n&quot;, y)
print(&quot;x.ravel():\n&quot;, x.ravel())
print(&quot;y.ravel():\n&quot;, y.ravel())
print('grid:\n', grid)

# è¿è¡Œç»“æœ
# x:
#  [[1. 1. 1. 1.]
#  [2. 2. 2. 2.]]
# y:
#  [[2.  2.5 3.  3.5]
#  [2.  2.5 3.  3.5]]
# x.ravel():
#  [1. 1. 1. 1. 2. 2. 2. 2.]
# y.ravel():
#  [2.  2.5 3.  3.5 2.  2.5 3.  3.5]
# grid:
#  [[1.  2. ]
#  [1.  2.5]
#  [1.  3. ]
#  [1.  3.5]
#  [2.  2. ]
#  [2.  2.5]
#  [2.  3. ]
#  [2.  3.5]]
</code></pre>
<h3 id="22-å¤æ‚åº¦å­¦ä¹ ç‡">2.2 å¤æ‚åº¦å­¦ä¹ ç‡</h3>
<h4 id="ç¥ç»ç½‘ç»œçš„å¤æ‚åº¦">ç¥ç»ç½‘ç»œçš„å¤æ‚åº¦</h4>
<ul>
<li>
<p>NNå¤æ‚åº¦ï¼šå¤šç”¨NNå±‚æ•°å’ŒNNå‚æ•°çš„ä¸ªæ•°è¡¨ç¤º</p>
<figure data-type="image" tabindex="1"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107111241201-3.png" alt="2-1" loading="lazy"></figure>
<ul>
<li>
<p>ç©ºé—´å¤æ‚åº¦ï¼š</p>
<p>âœ… å±‚æ•° = éšè—å±‚çš„å±‚æ•° + 1ä¸ªè¾“å‡ºå±‚<br>
<u>ä¸Šå›¾ä¸º2å±‚NN</u></p>
<p>âœ…æ€»å‚æ•° = æ€»w + æ€»b<br>
<u>ä¸Šå›¾ä¸º3 * 4 + 4 + 4 * 2 + 2 = 26</u></p>
</li>
<li>
<p>æ—¶é—´å¤æ‚åº¦ï¼š</p>
<p>âœ…ä¹˜åŠ è¿ç®—æ¬¡æ•°</p>
<p><u>ä¸Šå›¾ 3 * 4 + 4 * 2 = 20</u></p>
</li>
</ul>
</li>
</ul>
<h4 id="å­¦ä¹ ç‡">å­¦ä¹ ç‡</h4>
<p>å­¦ä¹ ç‡lr=0.001è¿‡æ…¢, lr=0.999ä¸æ”¶æ•›</p>
<ul>
<li>
<p>æŒ‡æ•°è¡°å‡å­¦ä¹ ç‡</p>
<p>å¯ä»¥å…ˆç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡ï¼Œå¿«é€Ÿå¾—åˆ°è¾ƒä¼˜è§£ï¼Œç„¶åé€æ­¥å‡å°å­¦ä¹ ç‡ï¼Œä½¿æ¨¡å‹åœ¨è®­ç»ƒåæœŸç¨³å®šã€‚</p>
<p>æŒ‡æ•°è¡°å‡å­¦ä¹ ç‡ = åˆå§‹å­¦ä¹ ç‡ * å­¦ä¹ è¡°å‡ç‡ ^ (å½“å‰è½®æ•° / å¤šå°‘è½®è¡°å‡ä¸€æ¬¡)</p>
</li>
</ul>
<pre><code class="language-python">epoch = 40
LR_BASE = 0.2
LRDECAY = 0.99
LR_STEP = 1

for epoch in range(epoch):
    lr = LR_BASE * LR_DECAY ** (epoch / LR_STEP)  # æŒ‡æ•°è¡°å‡
    with tf.GradientTape() as tape:
        loss = tf.square(w + 1)
    grads = tape.gradient(loss, w)

    w.assign_sub(lr * grads)
    print(&quot;After %s epoch,w is %f,loss is %fï¼Œ lr is %f&quot; % (epoch, w.numpy(), loss, lr))
# è¿è¡Œç»“æœ
# After 33 epoch,w is -0.999996,loss is 0.000000,lr is 0.143546
# After 34 epoch,w is -0.999997,loss is 0.000000,lr is 0.142111
# After 35 epoch,w is -0.999998,loss is 0.000000,lr is 0.140690
# After 36 epoch,w is -0.999999,loss is 0.000000,lr is 0.139283
# After 37 epoch,w is -0.999999,loss is 0.000000,lr is 0.137890
# After 38 epoch,w is -0.999999,loss is 0.000000,lr is 0.136511
# After 39 epoch,w is -0.999999,loss is 0.000000,lr is 0.135146
</code></pre>
<h3 id="23-æ¿€æ´»å‡½æ•°">2.3 æ¿€æ´»å‡½æ•°</h3>
<ul>
<li>
<p>Sigmoidå‡½æ•°</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">f(x)=\frac{1}{1+e^{-x}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>tf.nn.sigmoid(x)  # å°†è¾“å…¥å€¼å˜æ¢åˆ° (0, 1) ä¹‹é—´è¾“å‡º</p>
<p>ç‰¹ç‚¹ï¼š<br>
ï¼ˆ1ï¼‰æ˜“é€ æˆæ¢¯åº¦æ¶ˆå¤±<br>
ï¼ˆ2ï¼‰è¾“å‡ºé0å‡å€¼ï¼Œæ”¶æ•›æ…¢<br>
ï¼ˆ3ï¼‰å¹‚è¿ç®—å¤æ‚ï¼Œè®­ç»ƒæ—¶é—´é•¿</p>
<figure data-type="image" tabindex="2"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107130057302-2.png" alt="2-2" loading="lazy"></figure>
</li>
<li>
<p>Tanhå‡½æ•°</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mfrac><mrow><mn>1</mn><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mn>2</mn><mi>x</mi></mrow></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mn>2</mn><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">f(x)=\frac{1-e^{-2x}}{1+e^{-2x}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">2</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">2</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>tf.math.tanh(x)</p>
<p>ç‰¹ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰è¾“å‡ºæ˜¯0å‡å€¼<br>
ï¼ˆ2ï¼‰æ˜“é€ æˆæ¢¯åº¦æ¶ˆå¤±<br>
ï¼ˆ3ï¼‰å¹‚è¿ç®—å¤æ‚ï¼Œè®­ç»ƒæ—¶é—´é•¿</p>
<figure data-type="image" tabindex="3"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107130101032-3.png" alt="2-3" loading="lazy"></figure>
</li>
<li>
<p>Reluå‡½æ•°</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mn>0</mn><mo>)</mo><mo>=</mo></mrow><annotation encoding="application/x-tex">f(x)=max(x, 0)=
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span></span></p>
<p>tf.nn.relu(x)</p>
<p>ä¼˜ç‚¹ï¼š<br>
ï¼ˆ1ï¼‰è§£å†³äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼ˆåœ¨æ­£åŒºé—´ï¼‰<br>
ï¼ˆ2ï¼‰åªéœ€åˆ¤æ–­è¾“å…¥æ˜¯å¦å¤§äº0ï¼Œè®¡ç®—é€Ÿåº¦å¿«<br>
ï¼ˆ3ï¼‰æ”¶æ•›é€Ÿåº¦è¿œå¿«äºsigmoidå’Œtanh</p>
<p>ç¼ºç‚¹ï¼š<br>
ï¼ˆ1ï¼‰è¾“å‡ºé0å‡å€¼ï¼Œæ”¶æ•›æ…¢<br>
ï¼ˆ2ï¼‰Dead ReIUé—®é¢˜ï¼šæŸäº›ç¥ç»å…ƒå¯èƒ½æ°¸è¿œä¸ä¼šè¢«æ¿€æ´»ï¼Œå¯¼è‡´ç›¸åº”çš„å‚æ•°æ°¸è¿œä¸èƒ½è¢«æ›´æ–°ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107130101162-4.png" alt="2-4" loading="lazy"></figure>
</li>
<li>
<p>Leaky Relu</p>
<p>tf.nn.leaky_relu(x)</p>
<p>ç‰¹ç‚¹ï¼š<br>
ç†è®ºä¸Šæ¥è®²ï¼ŒLeaky Reluæœ‰Reluçš„æ‰€æœ‰ä¼˜ç‚¹ï¼Œå¤–åŠ ä¸ä¼šæœ‰Dead Relué—®é¢˜ï¼Œä½†æ˜¯åœ¨å®é™…æ“ä½œå½“ä¸­ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è¯æ˜Leaky Reluæ€»æ˜¯å¥½äºReluã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107130101212-5.png" alt="2-5" loading="lazy"></figure>
</li>
<li>
<p><strong>å¯¹äºåˆå­¦è€…çš„å»ºè®®</strong></p>
<ul>
<li>é¦–é€‰reluæ¿€æ´»å‡½æ•°</li>
<li>å­¦ä¹ ç‡è®¾ç½®è¾ƒå°å€¼</li>
<li>è¾“å…¥ç‰¹å¾æ ‡å‡†åŒ–ï¼Œå³è®©è¾“å…¥ç‰¹å¾æ»¡è¶³ä»¥0ä¸ºå‡å€¼ï¼Œ1ä¸ºæ ‡å‡†å·®çš„æ­£æ€åˆ†å¸ƒ</li>
<li>åˆå§‹å‚æ•°ä¸­å¿ƒåŒ–ï¼Œå³è®©éšæœºç”Ÿæˆçš„å‚æ•°æ»¡è¶³ä»¥0ä¸ºå‡å€¼ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mfrac><mn>2</mn><mrow><mi mathvariant="normal">å½“</mi><mi mathvariant="normal">å‰</mi><mi mathvariant="normal">è¾“</mi><mi mathvariant="normal">å…¥</mi><mi mathvariant="normal">ç‰¹</mi><mi mathvariant="normal">å¾</mi><mi mathvariant="normal">ä¸ª</mi><mi mathvariant="normal">æ•°</mi></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{\frac{2}{å½“å‰è¾“å…¥ç‰¹å¾ä¸ªæ•°}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.604946em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.235054em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">å½“</span><span class="mord cjk_fallback mtight">å‰</span><span class="mord cjk_fallback mtight">è¾“</span><span class="mord cjk_fallback mtight">å…¥</span><span class="mord cjk_fallback mtight">ç‰¹</span><span class="mord cjk_fallback mtight">å¾</span><span class="mord cjk_fallback mtight">ä¸ª</span><span class="mord cjk_fallback mtight">æ•°</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.195054em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.604946em;"><span></span></span></span></span></span></span></span></span> ä¸ºæ ‡å‡†å·®çš„æ­£æ€åˆ†å¸ƒã€‚</li>
</ul>
</li>
</ul>
<h3 id="24-æŸå¤±å‡½æ•°">2.4 æŸå¤±å‡½æ•°</h3>
<ul>
<li>
<p>æŸå¤±å‡½æ•° (loss): é¢„æµ‹å€¼ (y) ä¸å·²çŸ¥ç­”æ¡ˆ (y_) çš„å·®è·</p>
<p>NNä¼˜åŒ–ç›®æ ‡ï¼š lossæœ€å°</p>
<ul>
<li>mse(Mean Squared Error)</li>
<li>è‡ªå®šä¹‰</li>
<li>ce(Cross Entropy)  # äº¤å‰ç†µ</li>
</ul>
</li>
<li>
<p>å‡æ–¹è¯¯å·® mse</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>S</mi><mi>E</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mfrac><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo>(</mo><mi>y</mi><mo>âˆ’</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">MSE({y_\_},y)=\frac{\sum_{i=1}^n (y - y_\_)^2}{n}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.257108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5711080000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.757em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<pre><code class="language-python">loss_mse = tf.reduce_mean(tf.square(y_ -  y))
</code></pre>
<p>ğŸ’¬ Example</p>
<pre><code>é¢„æµ‹é…¸å¥¶æ—¥é”€é‡yï¼Œx1ï¼Œx2æ˜¯å½±å“æ—¥é”€é‡çš„å› ç´ ã€‚
å»ºæ¨¡å‰ï¼Œåº”é¢„å…ˆé‡‡é›†çš„æ•°æ®æœ‰ï¼šæ¯æ—¥x1ã€x2å’Œé”€é‡y_ï¼ˆå³å·²çŸ¥ç­”æ¡ˆï¼Œæœ€ä½³æƒ…å†µï¼šäº§é‡=é”€é‡ï¼‰
æ‹Ÿé€ æ•°æ®é›†X, Y_: y_ = x1 + x2  å™ªå£°ï¼š-0.05~+0.05  æ‹Ÿåˆå¯ä»¥é¢„æµ‹é”€é‡çš„å‡½æ•°
</code></pre>
<pre><code class="language-python">import tensorflow as tf
import numpy as np

SEED = 23455

rdm = np.random.RandomState(seed=SEED)  # ç”Ÿæˆ[0,1)ä¹‹é—´çš„éšæœºæ•°
x = rdm.rand(32, 2)  # 32è¡Œä¸¤åˆ—çš„ [0, 1) ä¹‹é—´çš„éšæœºæ•°
y_ = [[x1 + x2 + (rdm.rand() / 10.0 - 0.05)] for (x1, x2) in x]  # ç”Ÿæˆå™ªå£°[0,1)/10=[0,0.1); [0,0.1)-0.05=[-0.05,0.05)
x = tf.cast(x, dtype=tf.float32)

w1 = tf.Variable(tf.random.normal([2, 1], stddev=1, seed=1))

epoch = 15000
lr = 0.002

for epoch in range(epoch):
    with tf.GradientTape() as tape:
        y = tf.matmul(x, w1)
        loss_mse = tf.reduce_mean(tf.square(y_ - y))

    grads = tape.gradient(loss_mse, w1)
    w1.assign_sub(lr * grads)

    if epoch % 500 == 0:
        print(&quot;After %d training steps,w1 is &quot; % (epoch))
        print(w1.numpy(), &quot;\n&quot;)
print(&quot;Final w1 is: &quot;, w1.numpy())

# è¿è¡Œç»“æœ
# After 14500 training steps,w1 is
# [[1.0002553 ]
#  [0.99838644]]
#
# Final w1 is:  [[1.0009792]
#  [0.9977485]]
</code></pre>
</li>
<li>
<p>è‡ªå®šä¹‰æŸå¤±å‡½æ•°ï¼š</p>
<p>å¦‚é¢„æµ‹å•†å“é”€é‡ï¼Œé¢„æµ‹å¤šäº†ï¼ŒæŸå¤±æˆæœ¬ï¼Œé¢„æµ‹å°‘äº†ï¼ŒæŸå¤±åˆ©æ¶¦ã€‚</p>
<p>è‹¥åˆ©æ¶¦ â‰  æˆæœ¬ï¼Œåˆ™ mse äº§ç”Ÿçš„ loss æ— æ³•åˆ©ç›Šæœ€å¤§åŒ–</p>
<p>è‡ªå®šä¹‰æŸå¤±å‡½æ•°  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><msub><mo>âˆ‘</mo><mi>n</mi></msub><mrow><mi>f</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">loss(y_\_,y)=\sum_{n}{f(y_\_,y)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0016819999999999613em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></p>
<figure data-type="image" tabindex="6"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107130101262-6.png" alt="2-6" loading="lazy"></figure>
<pre><code class="language-python">import tensorflow as tf
import numpy as np

SEED = 23455
COST = 1
PROFIT = 99

rdm = np.random.RandomState(SEED)
x = rdm.rand(32, 2)
y_ = [[x1 + x2 + (rdm.rand() / 10.0 - 0.05)] for (x1, x2) in x]  # ç”Ÿæˆå™ªå£°[0,1)/10=[0,0.1); [0,0.1)-0.05=[-0.05,0.05)
x = tf.cast(x, dtype=tf.float32)

w1 = tf.Variable(tf.random.normal([2, 1], stddev=1, seed=1))

epoch = 10000
lr = 0.002

for epoch in range(epoch):
   with tf.GradientTape() as tape:
       y = tf.matmul(x, w1)
       loss = tf.reduce_sum(tf.where(tf.greater(y, y_), (y - y_) * COST, (y_ - y) * PROFIT))

   grads = tape.gradient(loss, w1)
   w1.assign_sub(lr * grads)

   if epoch % 500 == 0:
       print(&quot;After %d training steps,w1 is &quot; % (epoch))
       print(w1.numpy(), &quot;\n&quot;)
print(&quot;Final w1 is: &quot;, w1.numpy())

# è¿è¡Œç»“æœ
# After 9500 training steps,w1 is 
# [[1.1611756]
#  [1.0651482]] 
# 
# Final w1 is:  [[1.1626335]
#  [1.1191947]]

# è‡ªå®šä¹‰æŸå¤±å‡½æ•°
# é…¸å¥¶æˆæœ¬1å…ƒï¼Œ é…¸å¥¶åˆ©æ¶¦99å…ƒ
# æˆæœ¬å¾ˆä½ï¼Œåˆ©æ¶¦å¾ˆé«˜ï¼Œäººä»¬å¸Œæœ›å¤šé¢„æµ‹äº›ï¼Œç”Ÿæˆæ¨¡å‹ç³»æ•°å¤§äº1ï¼Œå¾€å¤šäº†é¢„æµ‹
</code></pre>
</li>
<li>
<p>äº¤å‰ç†µæŸå¤±å‡½æ•° CE (Cross Entropy): è¡¨å¾ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mo>âˆ’</mo><mo>âˆ‘</mo><mrow><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mi>y</mi></mrow></mrow><annotation encoding="application/x-tex">H(y_\_,y)=-\sum{y_\_*\ln y}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span></span></span></p>
<p>eg. äºŒåˆ†ç±»å·²çŸ¥ç­”æ¡ˆ y_ = (1, 0)    é¢„æµ‹ y1=(0.6, 0.5)  y2 = (0.8, 0.2), å“ªä¸ªæ›´æ¥è¿‘æ ‡å‡†ç­”æ¡ˆï¼Ÿ</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mn>1</mn></msub><mo>(</mo><mo>(</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>0.6</mn><mo separator="true">,</mo><mn>0.4</mn><mo>)</mo><mo>)</mo><mo>=</mo><mo>âˆ’</mo><mo>(</mo><mn>1</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.6</mn><mo>+</mo><mn>0</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.4</mn><mo>)</mo><mo>â‰ˆ</mo><mo>âˆ’</mo><mo>(</mo><mo>âˆ’</mo><mn>0.511</mn><mo>+</mo><mn>0</mn><mo>)</mo><mo>=</mo><mn>0.511</mn><mspace linebreak="newline"></mspace><msub><mi>H</mi><mn>2</mn></msub><mo>(</mo><mo>(</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>0.8</mn><mo separator="true">,</mo><mn>0.2</mn><mo>)</mo><mo>)</mo><mo>=</mo><mo>âˆ’</mo><mo>(</mo><mn>1</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.8</mn><mo>+</mo><mn>0</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.2</mn><mo>)</mo><mo>â‰ˆ</mo><mo>âˆ’</mo><mo>(</mo><mo>âˆ’</mo><mn>0.223</mn><mo>+</mo><mn>0</mn><mo>)</mo><mo>=</mo><mn>0.223</mn></mrow><annotation encoding="application/x-tex">H_1((1, 0), (0.6, 0.4)) = -(1 * \ln0.6 + 0 * \ln0.4)\approx -(-0.511 +0)=0.511\\
H_2((1, 0), (0.8, 0.2)) = -(1 * \ln0.8 + 0 * \ln0.2)\approx -(-0.223 +0)=0.223
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mord">1</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mord">1</span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">2</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">2</span><span class="mord">3</span></span></span></span></span></p>
<p>å› ä¸º H1 &gt; H2ï¼Œæ‰€ä»¥ y2 é¢„æµ‹æ›´å‡†</p>
<pre><code class="language-python">tf.losses.categorical_crossentropy(y_, y)
</code></pre>
<pre><code class="language-python">import tensorflow as tf

loss_ce1 = tf.losses.categorical_crossentropy([1, 0], [0.6, 0.4])
loss_ce2 = tf.losses.categorical_crossentropy([1, 0], [0.8, 0.2])
print(&quot;loss_ce1:&quot;, loss_ce1)
print(&quot;loss_ce2:&quot;, loss_ce2)

# äº¤å‰ç†µæŸå¤±å‡½æ•°

# è¿è¡Œç»“æœ
# loss_ce1: tf.Tensor(0.5108256, shape=(), dtype=float32)
# loss_ce2: tf.Tensor(0.22314353, shape=(), dtype=float32)
</code></pre>
</li>
<li>
<p>softmax ä¸äº¤å‰ç†µç»“åˆ</p>
<p>è¾“å‡ºå…ˆè¿‡softmaxå‡½æ•°ï¼Œå†è®¡ç®—yä¸y_çš„äº¤å‰ç†µæŸå¤±å‡½æ•°</p>
<p>tf.nn.softmax_cross_entropy_with_logits(y_, y)</p>
<pre><code class="language-python"># softmaxä¸äº¤å‰ç†µæŸå¤±å‡½æ•°çš„ç»“åˆ
import tensorflow as tf
import numpy as np

y_ = np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1], [1, 0, 0], [0, 1, 0]])
y = np.array([[12, 3, 2], [3, 10, 1], [1, 2, 5], [4, 6.5, 1.2], [3, 6, 1]])
y_pro = tf.nn.softmax(y)
loss_ce1 = tf.losses.categorical_crossentropy(y_,y_pro)
loss_ce2 = tf.nn.softmax_cross_entropy_with_logits(y_, y)

print('åˆ†æ­¥è®¡ç®—çš„ç»“æœ:\n', loss_ce1)
print('ç»“åˆè®¡ç®—çš„ç»“æœ:\n', loss_ce2)


# è¾“å‡ºçš„ç»“æœç›¸åŒ

# è¿è¡Œç»“æœ
# åˆ†æ­¥è®¡ç®—çš„ç»“æœ:
#  tf.Tensor(
# [1.68795487e-04 1.03475622e-03 6.58839038e-02 2.58349207e+00
#  5.49852354e-02], shape=(5,), dtype=float64)
# ç»“åˆè®¡ç®—çš„ç»“æœ:
#  tf.Tensor(
# [1.68795487e-04 1.03475622e-03 6.58839038e-02 2.58349207e+00
#  5.49852354e-02], shape=(5,), dtype=float64)
</code></pre>
</li>
</ul>
<h3 id="25-ç¼“è§£è¿‡æ‹Ÿåˆ">2.5 ç¼“è§£è¿‡æ‹Ÿåˆ</h3>
<ul>
<li>
<p>æ¬ æ‹Ÿåˆä¸è¿‡æ‹Ÿåˆ</p>
<figure data-type="image" tabindex="7"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107130101302-7.png" alt="2-7" loading="lazy"></figure>
</li>
<li>
<p>æ¬ æ‹Ÿåˆçš„è§£å†³æ–¹æ³•:</p>
<ul>
<li>å¢åŠ è¾“å…¥ç‰¹å¾é¡¹</li>
<li>å¢åŠ ç½‘ç»œå‚æ•°</li>
<li>å‡å°‘æ­£åˆ™åŒ–å‚æ•°</li>
</ul>
</li>
<li>
<p>è¿‡æ‹Ÿåˆçš„è§£å†³æ–¹æ³•:</p>
<ul>
<li>æ•°æ®æ¸…æ´—</li>
<li>å¢å¤§è®­ç»ƒé›†</li>
<li>é‡‡ç”¨æ­£åˆ™åŒ–</li>
<li>å¢å¤§æ­£åˆ™åŒ–å‚æ•°</li>
</ul>
</li>
<li>
<p>æ­£åˆ™åŒ–ç¼“è§£è¿‡æ‹Ÿåˆ</p>
<p>æ­£åˆ™åŒ–åœ¨æŸå¤±å‡½æ•°ä¸­å¼•å…¥æ¨¡å‹å¤æ‚åº¦æŒ‡æ ‡ï¼Œåˆ©ç”¨<strong>ç»™WåŠ æƒå€¼</strong>ï¼Œå¼±åŒ–äº†è®­ç»ƒæ•°æ®çš„å™ªå£°ï¼ˆ<strong>ä¸€èˆ¬ä¸æ­£åˆ™åŒ–b</strong>ï¼‰</p>
<p><code>loss = loss(y, y_) + REGULARIZER * loss(w)</code></p>
<p><code>loss(y, y_)</code>æ¨¡å‹ä¸­æ‰€æœ‰å‚æ•°çš„æŸå¤±å‡½æ•°å¦‚ï¼šäº¤å‰ç†µã€å‡æ–¹è¯¯å·®<br>
<code>REGULARIZER</code>ç”¨è¶…å‚æ•°REGULARIZERç»™å‡ºå‚æ•°wåœ¨æ€»lossä¸­çš„æ¯”ä¾‹ï¼Œå³æ­£åˆ™åŒ–çš„æƒé‡<br>
<code>loss(w)</code>éœ€è¦æ­£åˆ™åŒ–çš„å‚æ•°</p>
<p><code>loss(w)</code>åŒ…æ‹¬ä¸¤ç§æ­£åˆ™åŒ–:<br>
L1æ­£åˆ™åŒ– <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mrow><mi>L</mi><mn>1</mn></mrow></msub><mo>(</mo><mi>w</mi><mo>)</mo><mo>=</mo><msub><mo>âˆ‘</mo><mi>i</mi></msub><mo>âˆ£</mo><msub><mi>w</mi><mi>i</mi></msub><mo>âˆ£</mo></mrow><annotation encoding="application/x-tex">loss_{L1}(w)=\sum_i \lvert w_i \rvert</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">âˆ£</span></span></span></span><br>
L2æ­£åˆ™åŒ– <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mrow><mi>L</mi><mn>2</mn></mrow></msub><mo>(</mo><mi>w</mi><mo>)</mo><mo>=</mo><msub><mo>âˆ‘</mo><mi>i</mi></msub><mo>âˆ£</mo><msubsup><mi>w</mi><mi>i</mi><mn>2</mn></msubsup><mo>âˆ£</mo></mrow><annotation encoding="application/x-tex">loss_{L2}(w)=\sum_i \lvert w_i^2 \rvert</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.113818em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.441336em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mclose">âˆ£</span></span></span></span></p>
</li>
<li>
<p>æ­£åˆ™åŒ–çš„é€‰æ‹©</p>
<p><strong>L1æ­£åˆ™åŒ–</strong>å¤§æ¦‚ç‡ä¼šä½¿å¾ˆå¤šå‚æ•°å˜ä¸ºé›¶ï¼Œå› æ­¤è¯¥æ–¹æ³•å¯<strong>é€šè¿‡ç¨€ç–å‚æ•°</strong>ï¼Œ<strong>å³å‡å°‘å‚æ•°çš„æ•°é‡ï¼Œé™ä½å¤æ‚åº¦ã€‚</strong></p>
<p><strong>L2æ­£åˆ™åŒ–</strong>ä¼šä½¿å‚æ•°å¾ˆæ¥è¿‘é›¶ä½†ä¸ä¸ºé›¶ï¼Œå› æ­¤è¯¥æ–¹æ³•å¯é€šè¿‡<strong>å‡å°å‚æ•°çš„å€¼çš„å¤§å°é™ä½å¤æ‚åº¦ã€‚</strong></p>
</li>
<li>
<p>æ­£åˆ™åŒ–ç¼“è§£è¿‡æ‹Ÿåˆ</p>
<pre><code class="language-python">with tf.GradientTape() as tape:  # è®°å½•æ¢¯åº¦ä¿¡æ¯
    
    h1 = tf.matmul(x_train, w1) + b1  # è®°å½•ç¥ç»ç½‘ç»œä¹˜åŠ è¿ç®—
    h1 = tf.nn.relu(h1)
    y = tf.matmul(h1, w2) + b2

    # é‡‡ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°mse = mean(sum(y-out)^2)
    loss_mse = tf.reduce_mean(tf.square(y_train - y))
    # æ·»åŠ l2æ­£åˆ™åŒ–
    loss_regularization = []
    # tf.nn.l2_loss(w)=sum(w ** 2) / 2
    loss_regularization.append(tf.nn.l2_loss(w1))
    loss_regularization.append(tf.nn.l2_loss(w2))
	# æ±‚å’Œ
    # ä¾‹ï¼šx=tf.constant(([1,1,1],[1,1,1]))
    #   tf.reduce_sum(x)
    # &gt;&gt;&gt;6
    loss_regularization = tf.reduce_sum(loss_regularization)
    loss = loss_mse + 0.03 * loss_regularization  # REGULARIZER = 0.03
Variable = [w1, b1, w2, b2]
grads = tape.gradient(loss, variables)
</code></pre>
</li>
<li>
<p>example å®ä¾‹</p>
<table>
<thead>
<tr>
<th style="text-align:center">x1</th>
<th style="text-align:center">x2</th>
<th style="text-align:center">y_c</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-0.416757847</td>
<td style="text-align:center">-0.056266827</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">-2.136196096</td>
<td style="text-align:center">1.640270808</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">-1.793435585</td>
<td style="text-align:center">-0.841747366</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0.502881417</td>
<td style="text-align:center">-1.245288087</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">-1.057952219</td>
<td style="text-align:center">-0.909007615</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">0.551454045</td>
<td style="text-align:center">2.292208013</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">0.041539393</td>
<td style="text-align:center">-1.117925445</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">0.539058321</td>
<td style="text-align:center">-0.5961597</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">-0.019130497</td>
<td style="text-align:center">1.17500122</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">0.0380472</td>
<td style="text-align:center">-0.21714</td>
<td style="text-align:center">?</td>
</tr>
</tbody>
</table>
<pre><code class="language-python"># å¯¼å…¥æ‰€éœ€æ¨¡å—
import tensorflow as tf
from matplotlib import pyplot as plt
import numpy as np
import pandas as pd

# è¯»å…¥æ•°æ®/æ ‡ç­¾ ç”Ÿæˆx_train y_train
df = pd.read_csv('dot.csv')
x_data = np.array(df[['x1', 'x2']])
y_data = np.array(df['y_c'])

x_train = np.vstack(x_data).reshape(-1, 2)
y_train = np.vstack(y_data).reshape(-1, 1)

Y_c = [['red' if y else 'blue'] for y in y_train]

# è½¬æ¢xçš„æ•°æ®ç±»å‹ï¼Œå¦åˆ™åé¢çŸ©é˜µç›¸ä¹˜æ—¶ä¼šå› æ•°æ®ç±»å‹é—®é¢˜æŠ¥é”™
x_train = tf.cast(x_train, tf.float32)
y_train = tf.cast(y_train, tf.float32)

# from_tensor_sliceså‡½æ•°åˆ‡åˆ†ä¼ å…¥çš„å¼ é‡çš„ç¬¬ä¸€ä¸ªç»´åº¦ï¼Œç”Ÿæˆç›¸åº”çš„æ•°æ®é›†ï¼Œä½¿è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾å€¼ä¸€ä¸€å¯¹åº”
train_db = tf.data.Dataset.from_tensor_slices((x_train, y_train)).batch(32)

# ç”Ÿæˆç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œè¾“å…¥å±‚ä¸º2ä¸ªç¥ç»å…ƒï¼Œéšè—å±‚ä¸º11ä¸ªç¥ç»å…ƒ(è‡ªå·±éšæœºé€‰æ‹©çš„)ï¼Œ1å±‚éšè—å±‚ï¼Œè¾“å‡ºå±‚ä¸º1ä¸ªç¥ç»å…ƒ
# ç”¨tf.Variable()ä¿è¯å‚æ•°å¯è®­ç»ƒ
w1 = tf.Variable(tf.random.normal([2, 11]), dtype=tf.float32)
b1 = tf.Variable(tf.constant(0.01, shape=[11]))

w2 = tf.Variable(tf.random.normal([11, 1]), dtype=tf.float32)
b2 = tf.Variable(tf.constant(0.01, shape=[1]))

lr = 0.01  # å­¦ä¹ ç‡
epoch = 400  # å¾ªç¯è½®æ•°

# è®­ç»ƒéƒ¨åˆ†
for epoch in range(epoch):
    for step, (x_train, y_train) in enumerate(train_db):
        with tf.GradientTape() as tape:  # è®°å½•æ¢¯åº¦ä¿¡æ¯

            h1 = tf.matmul(x_train, w1) + b1  # è®°å½•ç¥ç»ç½‘ç»œä¹˜åŠ è¿ç®—
            h1 = tf.nn.relu(h1)
            y = tf.matmul(h1, w2) + b2

            # é‡‡ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°mse = mean(sum(y-out)^2)
            loss = tf.reduce_mean(tf.square(y_train - y))

        # è®¡ç®—losså¯¹å„ä¸ªå‚æ•°çš„æ¢¯åº¦
        variables = [w1, b1, w2, b2]
        grads = tape.gradient(loss, variables)

        # å®ç°æ¢¯åº¦æ›´æ–°
        # w1 = w1 - lr * w1_grad tape.gradientæ˜¯è‡ªåŠ¨æ±‚å¯¼ç»“æœä¸[w1, b1, w2, b2] ç´¢å¼•ä¸º0ï¼Œ1ï¼Œ2ï¼Œ3 
        w1.assign_sub(lr * grads[0])
        b1.assign_sub(lr * grads[1])
        w2.assign_sub(lr * grads[2])
        b2.assign_sub(lr * grads[3])

    # æ¯20ä¸ªepochï¼Œæ‰“å°lossä¿¡æ¯
    if epoch % 20 == 0:
        print('epoch:', epoch, 'loss:', float(loss))

# é¢„æµ‹éƒ¨åˆ†
print(&quot;*******predict*******&quot;)
# xxåœ¨-3åˆ°3ä¹‹é—´ä»¥æ­¥é•¿ä¸º0.01ï¼Œyyåœ¨-3åˆ°3ä¹‹é—´ä»¥æ­¥é•¿0.01,ç”Ÿæˆé—´éš”æ•°å€¼ç‚¹
xx, yy = np.mgrid[-3:3:.1, -3:3:.1]
# å°†xx , yyæ‹‰ç›´ï¼Œå¹¶åˆå¹¶é…å¯¹ä¸ºäºŒç»´å¼ é‡ï¼Œç”ŸæˆäºŒç»´åæ ‡ç‚¹
grid = np.c_[xx.ravel(), yy.ravel()]
grid = tf.cast(grid, tf.float32)
# å°†ç½‘æ ¼åæ ‡ç‚¹å–‚å…¥ç¥ç»ç½‘ç»œï¼Œè¿›è¡Œé¢„æµ‹ï¼Œprobsä¸ºè¾“å‡º
probs = []
for x_test in grid:
    # ä½¿ç”¨è®­ç»ƒå¥½çš„å‚æ•°è¿›è¡Œé¢„æµ‹
    h1 = tf.matmul([x_test], w1) + b1
    h1 = tf.nn.relu(h1)
    y = tf.matmul(h1, w2) + b2  # yä¸ºé¢„æµ‹ç»“æœ
    probs.append(y)

# å–ç¬¬0åˆ—ç»™x1ï¼Œå–ç¬¬1åˆ—ç»™x2
x1 = x_data[:, 0]
x2 = x_data[:, 1]
# probsçš„shapeè°ƒæ•´æˆxxçš„æ ·å­
probs = np.array(probs).reshape(xx.shape)
plt.scatter(x1, x2, color=np.squeeze(Y_c)) #squeezeå»æ‰çº¬åº¦æ˜¯1çš„çº¬åº¦,ç›¸å½“äºå»æ‰[['red'],[''blue]],å†…å±‚æ‹¬å·å˜ä¸º['red','blue']
# æŠŠåæ ‡xx yyå’Œå¯¹åº”çš„å€¼probsæ”¾å…¥contour&lt;[â€˜kÉ‘ntÊŠr]&gt;å‡½æ•°ï¼Œç»™probså€¼ä¸º0.5çš„æ‰€æœ‰ç‚¹ä¸Šè‰²  pltç‚¹showå æ˜¾ç¤ºçš„æ˜¯çº¢è“ç‚¹çš„åˆ†ç•Œçº¿
plt.contour(xx, yy, probs, levels=[.5])
plt.show()

# è¯»å…¥çº¢è“ç‚¹ï¼Œç”»å‡ºåˆ†å‰²çº¿ï¼Œä¸åŒ…å«æ­£åˆ™åŒ–
# ä¸æ¸…æ¥šçš„æ•°æ®ï¼Œå»ºè®®printå‡ºæ¥æŸ¥çœ‹

# è¿è¡Œç»“æœ
# epoch: 360 loss: 0.01718108169734478
# epoch: 380 loss: 0.017415596172213554
</code></pre>
<figure data-type="image" tabindex="8"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107130101352-8.png" alt="2-8" loading="lazy"></figure>
<p>æ›²çº¿ä¸å¹³æ»‘ï¼Œå­˜åœ¨è¿‡æ‹Ÿåˆã€‚</p>
<p>ä¸‹é¢æ”¹è¿›</p>
<pre><code class="language-python"># å¯¼å…¥æ‰€éœ€æ¨¡å—
import tensorflow as tf
from matplotlib import pyplot as plt
import numpy as np
import pandas as pd

# è¯»å…¥æ•°æ®/æ ‡ç­¾ ç”Ÿæˆx_train y_train
df = pd.read_csv('dot.csv')
x_data = np.array(df[['x1', 'x2']])
y_data = np.array(df['y_c'])

x_train = x_data
y_train = y_data.reshape(-1, 1)

Y_c = [['red' if y else 'blue'] for y in y_train]

# è½¬æ¢xçš„æ•°æ®ç±»å‹ï¼Œå¦åˆ™åé¢çŸ©é˜µç›¸ä¹˜æ—¶ä¼šå› æ•°æ®ç±»å‹é—®é¢˜æŠ¥é”™
x_train = tf.cast(x_train, tf.float32)
y_train = tf.cast(y_train, tf.float32)

# from_tensor_sliceså‡½æ•°åˆ‡åˆ†ä¼ å…¥çš„å¼ é‡çš„ç¬¬ä¸€ä¸ªç»´åº¦ï¼Œç”Ÿæˆç›¸åº”çš„æ•°æ®é›†ï¼Œä½¿è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾å€¼ä¸€ä¸€å¯¹åº”
train_db = tf.data.Dataset.from_tensor_slices((x_train, y_train)).batch(32)

# ç”Ÿæˆç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œè¾“å…¥å±‚ä¸º4ä¸ªç¥ç»å…ƒï¼Œéšè—å±‚ä¸º32ä¸ªç¥ç»å…ƒï¼Œ2å±‚éšè—å±‚ï¼Œè¾“å‡ºå±‚ä¸º3ä¸ªç¥ç»å…ƒ
# ç”¨tf.Variable()ä¿è¯å‚æ•°å¯è®­ç»ƒ
w1 = tf.Variable(tf.random.normal([2, 11]), dtype=tf.float32)
b1 = tf.Variable(tf.constant(0.01, shape=[11]))

w2 = tf.Variable(tf.random.normal([11, 1]), dtype=tf.float32)
b2 = tf.Variable(tf.constant(0.01, shape=[1]))

lr = 0.01  # å­¦ä¹ ç‡ä¸º
epoch = 400  # å¾ªç¯è½®æ•°

# è®­ç»ƒéƒ¨åˆ†
for epoch in range(epoch):
    for step, (x_train, y_train) in enumerate(train_db):
        with tf.GradientTape() as tape:  # è®°å½•æ¢¯åº¦ä¿¡æ¯

            h1 = tf.matmul(x_train, w1) + b1  # è®°å½•ç¥ç»ç½‘ç»œä¹˜åŠ è¿ç®—
            h1 = tf.nn.relu(h1)
            y = tf.matmul(h1, w2) + b2

            # é‡‡ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°mse = mean(sum(y-out)^2)
            loss_mse = tf.reduce_mean(tf.square(y_train - y))
            # æ·»åŠ l2æ­£åˆ™åŒ–
            loss_regularization = []
            # tf.nn.l2_loss(w)=sum(w ** 2) / 2
            loss_regularization.append(tf.nn.l2_loss(w1))
            loss_regularization.append(tf.nn.l2_loss(w2))
            # æ±‚å’Œ
            # ä¾‹ï¼šx=tf.constant(([1,1,1],[1,1,1]))
            #   tf.reduce_sum(x)
            # &gt;&gt;&gt;6
            # loss_regularization = tf.reduce_sum(tf.stack(loss_regularization))
            loss_regularization = tf.reduce_sum(loss_regularization)
            loss = loss_mse + 0.03 * loss_regularization #REGULARIZER = 0.03

        # è®¡ç®—losså¯¹å„ä¸ªå‚æ•°çš„æ¢¯åº¦
        variables = [w1, b1, w2, b2]
        grads = tape.gradient(loss, variables)

        # å®ç°æ¢¯åº¦æ›´æ–°
        # w1 = w1 - lr * w1_grad
        w1.assign_sub(lr * grads[0])
        b1.assign_sub(lr * grads[1])
        w2.assign_sub(lr * grads[2])
        b2.assign_sub(lr * grads[3])

    # æ¯200ä¸ªepochï¼Œæ‰“å°lossä¿¡æ¯
    if epoch % 20 == 0:
        print('epoch:', epoch, 'loss:', float(loss))

# é¢„æµ‹éƒ¨åˆ†
print(&quot;*******predict*******&quot;)
# xxåœ¨-3åˆ°3ä¹‹é—´ä»¥æ­¥é•¿ä¸º0.01ï¼Œyyåœ¨-3åˆ°3ä¹‹é—´ä»¥æ­¥é•¿0.01,ç”Ÿæˆé—´éš”æ•°å€¼ç‚¹
xx, yy = np.mgrid[-3:3:.1, -3:3:.1]
# å°†xx, yyæ‹‰ç›´ï¼Œå¹¶åˆå¹¶é…å¯¹ä¸ºäºŒç»´å¼ é‡ï¼Œç”ŸæˆäºŒç»´åæ ‡ç‚¹
grid = np.c_[xx.ravel(), yy.ravel()]
grid = tf.cast(grid, tf.float32)
# å°†ç½‘æ ¼åæ ‡ç‚¹å–‚å…¥ç¥ç»ç½‘ç»œï¼Œè¿›è¡Œé¢„æµ‹ï¼Œprobsä¸ºè¾“å‡º
probs = []
for x_predict in grid:
    # ä½¿ç”¨è®­ç»ƒå¥½çš„å‚æ•°è¿›è¡Œé¢„æµ‹
    h1 = tf.matmul([x_predict], w1) + b1
    h1 = tf.nn.relu(h1)
    y = tf.matmul(h1, w2) + b2  # yä¸ºé¢„æµ‹ç»“æœ
    probs.append(y)

# å–ç¬¬0åˆ—ç»™x1ï¼Œå–ç¬¬1åˆ—ç»™x2
x1 = x_data[:, 0]
x2 = x_data[:, 1]
# probsçš„shapeè°ƒæ•´æˆxxçš„æ ·å­
probs = np.array(probs).reshape(xx.shape)
plt.scatter(x1, x2, color=np.squeeze(Y_c))
# æŠŠåæ ‡xx yyå’Œå¯¹åº”çš„å€¼probsæ”¾å…¥contour&lt;[â€˜kÉ‘ntÊŠr]&gt;å‡½æ•°ï¼Œç»™probså€¼ä¸º0.5çš„æ‰€æœ‰ç‚¹ä¸Šè‰²  pltç‚¹showå æ˜¾ç¤ºçš„æ˜¯çº¢è“ç‚¹çš„åˆ†ç•Œçº¿
plt.contour(xx, yy, probs, levels=[.5])
plt.show()

# è¯»å…¥çº¢è“ç‚¹ï¼Œç”»å‡ºåˆ†å‰²çº¿ï¼ŒåŒ…å«æ­£åˆ™åŒ–
# ä¸æ¸…æ¥šçš„æ•°æ®ï¼Œå»ºè®®printå‡ºæ¥æŸ¥çœ‹ 

# è¿è¡Œç»“æœ
# epoch: 340 loss: 0.10149043053388596
# epoch: 360 loss: 0.09740603715181351
# epoch: 380 loss: 0.09389346837997437
</code></pre>
<figure data-type="image" tabindex="9"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210712211915835.png" alt="image-20210712211915835" loading="lazy"></figure>
<p>ç›¸å¯¹å¹³æ»‘ï¼Œç¼“è§£è¿‡æ‹Ÿåˆã€‚</p>
</li>
</ul>
<h3 id="26-ä¼˜åŒ–å™¨">2.6 ä¼˜åŒ–å™¨</h3>
<h4 id="ç¥ç»ç½‘ç»œå‚æ•°ä¼˜åŒ–å™¨">ç¥ç»ç½‘ç»œå‚æ•°ä¼˜åŒ–å™¨</h4>
<p>å¾…ä¼˜åŒ–å‚æ•°wï¼ŒæŸå¤±å‡½æ•°lossï¼Œå­¦ä¹ ç‡lrï¼Œæ¯æ¬¡è¿­ä»£ä¸€ä¸ªbatchï¼Œt è¡¨ç¤ºå½“å‰batchè¿­ä»£çš„æ€»æ¬¡æ•°ï¼šï¼ˆæ¯ä¸ªbatché€šå¸¸åŒ…å«2çš„næ¬¡æ–¹ä¸ªæ•°ï¼‰</p>
<ol>
<li>è®¡ç®— t æ—¶åˆ»æŸå¤±å‡½æ•°å…³äºå½“å‰å‚æ•°çš„æ¢¯åº¦ $ g_t=\nabla loss = \frac{\partial loss}{\partial (w_t)} $</li>
<li>è®¡ç®— t æ—¶åˆ»ä¸€é˜¶åŠ¨é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">m_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’ŒäºŒé˜¶åŠ¨é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">V_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>è®¡ç®— t æ—¶åˆ»ä¸‹é™æ¢¯åº¦ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt></mrow><annotation encoding="application/x-tex">\eta_t = lr * m_t / \sqrt{V_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span></span></li>
<li>è®¡ç®— t + 1 æ—¶åˆ»å‚æ•°ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta _t = w_t - lr * m_t / \sqrt{V_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span></span></li>
</ol>
<p><strong>ä¸€é˜¶åŠ¨é‡</strong>ï¼šä¸æ¢¯åº¦ç›¸å…³çš„å‡½æ•°</p>
<p><strong>äºŒé˜¶åŠ¨é‡</strong>ï¼šä¸æ¢¯åº¦å¹³æ–¹ç›¸å…³çš„å‡½æ•°</p>
<h4 id="ä¼˜åŒ–å™¨">ä¼˜åŒ–å™¨</h4>
<ul>
<li>
<p>SGDï¼ˆæ—  momentumï¼‰ï¼Œå¸¸ç”¨çš„æ¢¯åº¦ä¸‹é™æ³•ã€‚ï¼ˆä¸å«åŠ¨é‡ï¼‰</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m_t = g_t \ \ \ \ \ \ \ \  V_t = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\eta _t = lr * m_t / \sqrt{V_t} = lr * g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta _t = w_t - lr * m_t / \sqrt{V_t} = w_t -lr * g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>w</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - lr * \frac {\partial loss} {\partial w_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.325208em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<pre><code class="language-python"># SGD  å•å±‚ç½‘ç»œ
w1.assign_sub(lr * grads[0])  # å‚æ•°w1è‡ªæ›´æ–°
b1.assign_sub(lr * grads[1])  # å‚æ•°b1è‡ªæ›´æ–°
</code></pre>
<pre><code class="language-python"># åˆ©ç”¨é¸¢å°¾èŠ±æ•°æ®é›†ï¼Œå®ç°å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­ï¼Œå¯è§†åŒ–lossæ›²çº¿

# å¯¼å…¥æ‰€éœ€æ¨¡å—
import tensorflow as tf
from sklearn import datasets
from matplotlib import pyplot as plt
import numpy as np
import time  ##1##  å¼•å…¥æ—¶é—´æ¨¡å—ï¼Œå¯ä»¥å¯¹æ¯”ä¸åŒä¼˜åŒ–å™¨è¿è¡Œæ—¶é—´

# å¯¼å…¥æ•°æ®ï¼Œåˆ†åˆ«ä¸ºè¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾
x_data = datasets.load_iris().data
y_data = datasets.load_iris().target

# éšæœºæ‰“ä¹±æ•°æ®ï¼ˆå› ä¸ºåŸå§‹æ•°æ®æ˜¯é¡ºåºçš„ï¼Œé¡ºåºä¸æ‰“ä¹±ä¼šå½±å“å‡†ç¡®ç‡ï¼‰
# seed: éšæœºæ•°ç§å­ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå½“è®¾ç½®ä¹‹åï¼Œæ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°éƒ½ä¸€æ ·ï¼ˆä¸ºæ–¹ä¾¿æ•™å­¦ï¼Œä»¥ä¿æ¯ä½åŒå­¦ç»“æœä¸€è‡´ï¼‰
np.random.seed(116)  # ä½¿ç”¨ç›¸åŒçš„seedï¼Œä¿è¯è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾ä¸€ä¸€å¯¹åº”
np.random.shuffle(x_data)
np.random.seed(116)
np.random.shuffle(y_data)
tf.random.set_seed(116)

# å°†æ‰“ä¹±åçš„æ•°æ®é›†åˆ†å‰²ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè®­ç»ƒé›†ä¸ºå‰120è¡Œï¼Œæµ‹è¯•é›†ä¸ºå30è¡Œ
x_train = x_data[:-30]
y_train = y_data[:-30]
x_test = x_data[-30:]
y_test = y_data[-30:]

# è½¬æ¢xçš„æ•°æ®ç±»å‹ï¼Œå¦åˆ™åé¢çŸ©é˜µç›¸ä¹˜æ—¶ä¼šå› æ•°æ®ç±»å‹ä¸ä¸€è‡´æŠ¥é”™
x_train = tf.cast(x_train, tf.float32)
x_test = tf.cast(x_test, tf.float32)

# from_tensor_sliceså‡½æ•°ä½¿è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾å€¼ä¸€ä¸€å¯¹åº”ã€‚ï¼ˆæŠŠæ•°æ®é›†åˆ†æ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡batchç»„æ•°æ®ï¼‰
train_db = tf.data.Dataset.from_tensor_slices((x_train, y_train)).batch(32)
test_db = tf.data.Dataset.from_tensor_slices((x_test, y_test)).batch(32)

# ç”Ÿæˆç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œ4ä¸ªè¾“å…¥ç‰¹å¾æ•…ï¼Œè¾“å…¥å±‚ä¸º4ä¸ªè¾“å…¥èŠ‚ç‚¹ï¼›å› ä¸º3åˆ†ç±»ï¼Œæ•…è¾“å‡ºå±‚ä¸º3ä¸ªç¥ç»å…ƒ
# ç”¨tf.Variable()æ ‡è®°å‚æ•°å¯è®­ç»ƒ
# ä½¿ç”¨seedä½¿æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°ç›¸åŒï¼ˆæ–¹ä¾¿æ•™å­¦ï¼Œä½¿å¤§å®¶ç»“æœéƒ½ä¸€è‡´ï¼Œåœ¨ç°å®ä½¿ç”¨æ—¶ä¸å†™seedï¼‰
w1 = tf.Variable(tf.random.truncated_normal([4, 3], stddev=0.1, seed=1))
b1 = tf.Variable(tf.random.truncated_normal([3], stddev=0.1, seed=1))

lr = 0.1  # å­¦ä¹ ç‡ä¸º0.1
train_loss_results = []  # å°†æ¯è½®çš„lossè®°å½•åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œä¸ºåç»­ç”»lossæ›²çº¿æä¾›æ•°æ®
test_acc = []  # å°†æ¯è½®çš„accè®°å½•åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œä¸ºåç»­ç”»accæ›²çº¿æä¾›æ•°æ®
epoch = 500  # å¾ªç¯500è½®
loss_all = 0  # æ¯è½®åˆ†4ä¸ªstepï¼Œloss_allè®°å½•å››ä¸ªstepç”Ÿæˆçš„4ä¸ªlossçš„å’Œ

# è®­ç»ƒéƒ¨åˆ†
now_time = time.time()  ##2##
for epoch in range(epoch):  # æ•°æ®é›†çº§åˆ«çš„å¾ªç¯ï¼Œæ¯ä¸ªepochå¾ªç¯ä¸€æ¬¡æ•°æ®é›†
    for step, (x_train, y_train) in enumerate(train_db):  # batchçº§åˆ«çš„å¾ªç¯ ï¼Œæ¯ä¸ªstepå¾ªç¯ä¸€ä¸ªbatch
        with tf.GradientTape() as tape:  # withç»“æ„è®°å½•æ¢¯åº¦ä¿¡æ¯
            y = tf.matmul(x_train, w1) + b1  # ç¥ç»ç½‘ç»œä¹˜åŠ è¿ç®—
            y = tf.nn.softmax(y)  # ä½¿è¾“å‡ºyç¬¦åˆæ¦‚ç‡åˆ†å¸ƒï¼ˆæ­¤æ“ä½œåä¸ç‹¬çƒ­ç åŒé‡çº§ï¼Œå¯ç›¸å‡æ±‚lossï¼‰
            y_ = tf.one_hot(y_train, depth=3)  # å°†æ ‡ç­¾å€¼è½¬æ¢ä¸ºç‹¬çƒ­ç æ ¼å¼ï¼Œæ–¹ä¾¿è®¡ç®—losså’Œaccuracy
            loss = tf.reduce_mean(tf.square(y_ - y))  # é‡‡ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°mse = mean(sum(y-out)^2)
            loss_all += loss.numpy()  # å°†æ¯ä¸ªstepè®¡ç®—å‡ºçš„lossç´¯åŠ ï¼Œä¸ºåç»­æ±‚losså¹³å‡å€¼æä¾›æ•°æ®ï¼Œè¿™æ ·è®¡ç®—çš„lossæ›´å‡†ç¡®
        # è®¡ç®—losså¯¹å„ä¸ªå‚æ•°çš„æ¢¯åº¦
        grads = tape.gradient(loss, [w1, b1])

        # å®ç°æ¢¯åº¦æ›´æ–° w1 = w1 - lr * w1_grad    b = b - lr * b_grad
        w1.assign_sub(lr * grads[0])  # å‚æ•°w1è‡ªæ›´æ–°
        b1.assign_sub(lr * grads[1])  # å‚æ•°bè‡ªæ›´æ–°

    # æ¯ä¸ªepochï¼Œæ‰“å°lossä¿¡æ¯
    print(&quot;Epoch {}, loss: {}&quot;.format(epoch, loss_all / 4))
    train_loss_results.append(loss_all / 4)  # å°†4ä¸ªstepçš„lossæ±‚å¹³å‡è®°å½•åœ¨æ­¤å˜é‡ä¸­
    loss_all = 0  # loss_allå½’é›¶ï¼Œä¸ºè®°å½•ä¸‹ä¸€ä¸ªepochçš„lossåšå‡†å¤‡

    # æµ‹è¯•éƒ¨åˆ†
    # total_correctä¸ºé¢„æµ‹å¯¹çš„æ ·æœ¬ä¸ªæ•°, total_numberä¸ºæµ‹è¯•çš„æ€»æ ·æœ¬æ•°ï¼Œå°†è¿™ä¸¤ä¸ªå˜é‡éƒ½åˆå§‹åŒ–ä¸º0
    total_correct, total_number = 0, 0
    for x_test, y_test in test_db:
        # ä½¿ç”¨æ›´æ–°åçš„å‚æ•°è¿›è¡Œé¢„æµ‹
        y = tf.matmul(x_test, w1) + b1
        y = tf.nn.softmax(y)
        pred = tf.argmax(y, axis=1)  # è¿”å›yä¸­æœ€å¤§å€¼çš„ç´¢å¼•ï¼Œå³é¢„æµ‹çš„åˆ†ç±»
        # å°†predè½¬æ¢ä¸ºy_testçš„æ•°æ®ç±»å‹
        pred = tf.cast(pred, dtype=y_test.dtype)
        # è‹¥åˆ†ç±»æ­£ç¡®ï¼Œåˆ™correct=1ï¼Œå¦åˆ™ä¸º0ï¼Œå°†boolå‹çš„ç»“æœè½¬æ¢ä¸ºintå‹
        correct = tf.cast(tf.equal(pred, y_test), dtype=tf.int32)
        # å°†æ¯ä¸ªbatchçš„correctæ•°åŠ èµ·æ¥
        correct = tf.reduce_sum(correct)
        # å°†æ‰€æœ‰batchä¸­çš„correctæ•°åŠ èµ·æ¥
        total_correct += int(correct)
        # total_numberä¸ºæµ‹è¯•çš„æ€»æ ·æœ¬æ•°ï¼Œä¹Ÿå°±æ˜¯x_testçš„è¡Œæ•°ï¼Œshape[0]è¿”å›å˜é‡çš„è¡Œæ•°
        total_number += x_test.shape[0]
    # æ€»çš„å‡†ç¡®ç‡ç­‰äºtotal_correct/total_number
    acc = total_correct / total_number
    test_acc.append(acc)
    print(&quot;Test_acc:&quot;, acc)
    print(&quot;--------------------------&quot;)
total_time = time.time() - now_time  ##3##
print(&quot;total_time&quot;, total_time)  ##4##

# ç»˜åˆ¶ loss æ›²çº¿
plt.title('Loss Function Curve')  # å›¾ç‰‡æ ‡é¢˜
plt.xlabel('Epoch')  # xè½´å˜é‡åç§°
plt.ylabel('Loss')  # yè½´å˜é‡åç§°
plt.plot(train_loss_results, label=&quot;$Loss$&quot;)  # é€ç‚¹ç”»å‡ºtrian_loss_resultså€¼å¹¶è¿çº¿ï¼Œè¿çº¿å›¾æ ‡æ˜¯Loss
plt.legend()  # ç”»å‡ºæ›²çº¿å›¾æ ‡
plt.show()  # ç”»å‡ºå›¾åƒ

# ç»˜åˆ¶ Accuracy æ›²çº¿
plt.title('Acc Curve')  # å›¾ç‰‡æ ‡é¢˜
plt.xlabel('Epoch')  # xè½´å˜é‡åç§°
plt.ylabel('Acc')  # yè½´å˜é‡åç§°
plt.plot(test_acc, label=&quot;$Accuracy$&quot;)  # é€ç‚¹ç”»å‡ºtest_accå€¼å¹¶è¿çº¿ï¼Œè¿çº¿å›¾æ ‡æ˜¯Accuracy
plt.legend()
plt.show()

# æœ¬æ–‡ä»¶è¾ƒ class1\p45_iris.py ä»…æ·»åŠ å››å¤„æ—¶é—´è®°å½•  ç”¨ ##n## æ ‡è¯†
# è¿è¡Œç»“æœ
# Epoch 497, loss: 0.03235237207263708
# Test_acc: 1.0
# --------------------------
# Epoch 498, loss: 0.03232626663520932
# Test_acc: 1.0
# --------------------------
# Epoch 499, loss: 0.032300274819135666
# Test_acc: 1.0
# --------------------------
# total_time 7.877314805984497
</code></pre>
</li>
<li>
<p>SGDMï¼ˆå«momentumçš„SGDï¼‰ï¼Œåœ¨SGDåŸºç¡€ä¸Šå¢åŠ ä¸€é˜¶åŠ¨é‡ã€‚</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>T</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m_t = \beta * m_{t-1} + (1-\beta)*g_t \ \ \ \ \ \ \ \  V_T = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mo>(</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">\eta _t = lr * m_t / \sqrt{V_t} = lr * m_t = lr*(\beta*m_{t-1}+(1-\beta)*g_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mo>(</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta _t = w_t - lr * (\beta*m_{t-1}+(1-\beta)*g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m_t = \beta * m_{t-1} + (1-\beta)*g_t \ \ \ \ \ \ \ \  V_t = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„
m_w, m_b = 0, 0
beta = 0.9
# sgd-momentum
m_w = beta * m_w + (1 - beta) * grads[0]
m_b = beta * m_b + (1 - beta) * grads[1]
w1.assign_sub(lr * m_w)
b1.assign_sub(lr * m_b)
# è¿è¡Œç»“æœï¼š
# --------------------------
# Epoch 498, loss: 0.03065542411059141
# --------------------------
# Epoch 499, loss: 0.030630568508058786
# Test_acc: 1.0
# --------------------------
# total_time 10.623216390609741
</code></pre>
</li>
<li>
<p>Adagradï¼Œåœ¨SGDåŸºç¡€ä¸Šå¢åŠ äºŒé˜¶åŠ¨é‡ï¼ˆäºŒé˜¶åŠ¨é‡ï¼Œä»å¼€å§‹åˆ°ç°åœ¨ï¼Œæ¢¯åº¦å¹³æ–¹çš„ç´¯è®¡å’Œï¼‰</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></munderover><msubsup><mi>g</mi><mi>Ï„</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">m_t = g_t \   \ \ \ \ \ \ V_t =\sum_{\tau=1}^t g_\tau ^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.047674em;vertical-align:-1.267113em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7805610000000003em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>)</mo><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></msubsup><msubsup><mi>g</mi><mi>Ï„</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">\eta_t = lr * m_t / (\sqrt{V_t})=lr*g_t / (\sqrt{\sum_{\tau=1}^t g_\tau ^2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.8399999999999999em;vertical-align:-0.5381269999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.301873em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.933456em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.261873em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5381269999999999em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><munderover><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></munderover><msubsup><mi>g</mi><mi>Ï„</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta_t = w_t - lr * g_t/ (\sqrt{\sum_{\tau=1}^t g_\tau ^2})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.275424em;vertical-align:-1.267113em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0083110000000004em;"><span class="svg-align" style="top:-5.235424em;"><span class="pstrut" style="height:5.235424em;"></span><span class="mord" style="padding-left:1.056em;"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7805610000000003em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.968311000000001em;"><span class="pstrut" style="height:5.235424em;"></span><span class="hide-tail" style="min-width:0.742em;height:3.315424em;"><svg width='400em' height='3.315424em' viewBox='0 0 400000 3315' preserveAspectRatio='xMinYMin slice'><path d='M702 80H400000v40H742v3181l-4 4-4 4c-.667.7
-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667
-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155
 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„ï¼š
v_w, v_b = 0, 0
# adagrad
v_w += tf.square(grads[0])
v_b += tf.square(grads[1])
w1.assign_sub(lr * grads[0] / tf.sqrt(v_w))
b1.assign_sub(lr * grads[1] / tf.sqrt(v_b))
# è¿è¡Œç»“æœï¼š
# --------------------------
# Epoch 498, loss: 0.03176002576947212
# Test_acc: 1.0
# --------------------------
# Epoch 499, loss: 0.03173917159438133
# Test_acc: 1.0
# --------------------------
# total_time 7.388378620147705
</code></pre>
</li>
<li>
<p>RMSPropï¼ŒSGDåŸºç¡€ä¸Šå¢åŠ äºŒé˜¶åŠ¨é‡</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">m_t = g_t \   \ \ \ \ \ \ V_t =\beta * V_{t-1}+(1-\beta)*g_t ^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>)</mo><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><mi>Î²</mi><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">\eta_t = lr * m_t / (\sqrt{V_t})=lr*g_t / (\sqrt{\beta * V_{t-1}+(1-\beta)*g_t ^2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.282046em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.957954em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959079999999998em;"><span style="top:-2.454244em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24575599999999992em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.917954em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.282046em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><mi>Î²</mi><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta_t = w_t - lr * g_t/ (\sqrt{\beta * V_{t-1}+(1-\beta)*g_t ^2})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.5331710000000001em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.306829em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959079999999998em;"><span style="top:-2.454244em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24575599999999992em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2668289999999995em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5331710000000001em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„
v_w, v_b = 0, 0
beta = 0.9
# rmsprop
v_w = beta * v_w + (1 - beta) * tf.square(grads[0])
v_b = beta * v_b + (1 - beta) * tf.square(grads[1])
w1.assign_sub(lr * grads[0] / tf.sqrt(v_w))
b1.assign_sub(lr * grads[1] / tf.sqrt(v_b))
# è¿è¡Œç»“æœï¼š
# --------------------------
# Epoch 498, loss: nan
# Test_acc: 0.36666666666666664
# --------------------------
# Epoch 499, loss: nan
# Test_acc: 0.36666666666666664
# --------------------------
# total_time 12.019102573394775
</code></pre>
</li>
<li>
<p>Adamï¼ŒåŒæ—¶ç»“åˆSGDMä¸€é˜¶åŠ¨é‡å’ŒRMSPropäºŒé˜¶åŠ¨é‡</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">m_t = \beta_1*m_{t-1}+(1-\beta_1)*g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>ä¿®æ­£ä¸€é˜¶åŠ¨é‡çš„åå·®ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><msub><mi>m</mi><mi>t</mi></msub><mo>^</mo></mover><mo>=</mo><mfrac><msub><mi>m</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>Î²</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\hat{m_t}=\frac{m_t}{1-\beta_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1925999999999999em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7114919999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>2</mn></msub><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>s</mi><mi>t</mi><mi>e</mi><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>Î²</mi><mn>2</mn></msub><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">V_t=\beta_2*V_{step-1}+(1-\beta_2)*g_t ^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">p</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.061108em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>ä¿®æ­£äºŒé˜¶åŠ¨é‡çš„åå·®ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><msub><mi>V</mi><mi>t</mi></msub><mo>^</mo></mover><mo>=</mo><mfrac><msub><mi>V</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\hat{V_t}=\frac {V_t}{1-\beta_2 ^t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0967699999999998em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4653909999999999em;vertical-align:-0.5769599999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.22222em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mover accent="true"><msub><mi>m</mi><mi>t</mi></msub><mo>^</mo></mover><mi mathvariant="normal">/</mi><msqrt><mover accent="true"><msub><mi>V</mi><mi>t</mi></msub><mo>^</mo></mover></msqrt><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mfrac><msub><mi>m</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>1</mn><mi>t</mi></msubsup></mrow></mfrac><mi mathvariant="normal">/</mi><msqrt><mfrac><msub><mi>V</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">\eta_t = lr *\hat{m_t}/\sqrt{\hat{V_t}}=lr*\frac{m_t}{1-\beta_1 ^t} / \sqrt{\frac{V_t}{1-\beta_2 ^t}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.3333849999999998em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0833849999999998em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3.0433850000000002em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15661500000000006em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.6992644999999997em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7114919999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1407355000000003em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.22222em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.1007355em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6992644999999997em;"><span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mfrac><msub><mi>m</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>1</mn><mi>t</mi></msubsup></mrow></mfrac><mi mathvariant="normal">/</mi><msqrt><mfrac><msub><mi>V</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta_t = w_t-lr*\frac{m_t}{1-\beta_1^t}/ \sqrt{\frac{V_t}{1-\beta_2 ^t}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.6992644999999997em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7114919999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1407355000000003em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.22222em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.1007355em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6992644999999997em;"><span></span></span></span></span></span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„
m_w, m_b = 0, 0
v_w, v_b = 0, 0
beta1, beta2 = 0.9, 0.999
delta_w, delta_b = 0, 0
global_step = 0  # åé¢ +1
# adam
m_w = beta1 * m_w + (1 - beta1) * grads[0]
m_b = beta1 * m_b + (1 - beta1) * grads[1]
v_w = beta2 * v_w + (1 - beta2) * tf.square(grads[0])
v_b = beta2 * v_b + (1 - beta2) * tf.square(grads[1])

m_w_correction = m_w / (1 - tf.pow(beta1, int(global_step)))
m_b_correction = m_b / (1 - tf.pow(beta1, int(global_step)))
v_w_correction = v_w / (1 - tf.pow(beta2, int(global_step)))
v_b_correction = v_b / (1 - tf.pow(beta2, int(global_step)))

w1.assign_sub(lr * m_w_correction / tf.sqrt(v_w_correction))
b1.assign_sub(lr * m_b_correction / tf.sqrt(v_b_correction))

# è¿è¡Œç»“æœï¼š
# --------------------------
# Epoch 498, loss: 0.013929554144851863
# Test_acc: 1.0
# --------------------------
# Epoch 499, loss: 0.013926223502494395
# Test_acc: 1.0
# --------------------------
# total_time 8.114784002304077
</code></pre>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç¬¬ä¸€ç«   ç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹åŠä»‹ç»]]></title>
        <id>https://perfectqing.github.io/blogs/post/ç¬¬ä¸€ç«   ç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹åŠä»‹ç»/</id>
        <link href="https://perfectqing.github.io/blogs/post/ç¬¬ä¸€ç«   ç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹åŠä»‹ç»/">
        </link>
        <updated>2021-07-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  ç¬¬ä¸€ç«   ç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹åŠä»‹ç»<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šå­¦ä¼šç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹ï¼Œä½¿ç”¨åŸºäºTF2åŸç”Ÿä»£ç æ­å»ºä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œè®­ç»ƒæ¨¡å‹ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  ç¬¬ä¸€ç«   ç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹åŠä»‹ç»<br>
âœï¸  æœ¬è®²ç›®æ ‡ï¼šå­¦ä¼šç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹ï¼Œä½¿ç”¨åŸºäºTF2åŸç”Ÿä»£ç æ­å»ºä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œè®­ç»ƒæ¨¡å‹ã€‚</p>
<!-- more -->
<h2 id="ç¬¬ä¸€ç« -ç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹åŠä»‹ç»">ç¬¬ä¸€ç«   ç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹åŠä»‹ç»</h2>
<p>æœ¬è®²ç›®æ ‡ï¼šå­¦ä¼šç¥ç»ç½‘ç»œè®¡ç®—è¿‡ç¨‹ï¼Œä½¿ç”¨åŸºäºTF2åŸç”Ÿä»£ç æ­å»ºä½ çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œè®­ç»ƒæ¨¡å‹ã€‚</p>
<p>äººå·¥æ™ºèƒ½ï¼šè®©æœºå™¨å…·å¤‡äººçš„æ€ç»´å’Œæ„è¯†ã€‚</p>
<h3 id="11-äººå·¥æ™ºèƒ½ä¸‰å­¦æ´¾">1.1 äººå·¥æ™ºèƒ½ä¸‰å­¦æ´¾</h3>
<ul>
<li>è¡Œä¸ºä¸»ä¹‰ï¼šåŸºäºæ§åˆ¶è®ºï¼Œæ„å»ºæ„ŸçŸ¥-åŠ¨ä½œæ§åˆ¶ç³»ç»Ÿã€‚ï¼ˆæ§åˆ¶è®ºï¼Œå¦‚å¹³è¡¡ã€è¡Œèµ°ã€é¿éšœç­‰è‡ªé€‚åº”æ§åˆ¶ç³»ç»Ÿï¼‰</li>
<li>ç¬¦å·ä¸»ä¹‰ï¼šåŸºäºç®—æ•°é€»è¾‘è¡¨è¾¾å¼ï¼Œæ±‚è§£é—®é¢˜æ—¶å…ˆæŠŠé—®é¢˜æè¿°ä¸ºè¡¨è¾¾å¼ï¼Œå†æ±‚è§£è¡¨è¾¾å¼ã€‚ï¼ˆå¯ç”¨å…¬å¼æè¿°ã€å®ç°ç†æ€§æ€ç»´ï¼Œå¦‚ä¸“å®¶ç³»ç³»ç»Ÿï¼‰</li>
<li>è¿æ¥ä¸»ä¹‰ï¼šä»¿ç”Ÿå­¦ï¼Œæ¨¡ä»¿ç¥ç»å…ƒè¿æ¥å…³ç³»ã€‚ï¼ˆä»¿è„‘ç¥ç»å…ƒè¿æ¥ï¼Œå®ç°æ„Ÿæ€§æ€ç»´ï¼Œå¦‚ç¥ç»ç½‘ç»œï¼‰</li>
</ul>
<h3 id="12-ç¥ç»ç½‘ç»œçš„è®¾è®¡è¿‡ç¨‹">1.2 ç¥ç»ç½‘ç»œçš„è®¾è®¡è¿‡ç¨‹</h3>
<ol>
<li>
<h4 id="é¸¢å°¾èŠ±åˆ†ç±»iris">é¸¢å°¾èŠ±åˆ†ç±»ï¼ˆIrisï¼‰</h4>
<pre><code>0  ç‹—å°¾è‰é¸¢å°¾
1  æ‚è‰²é¸¢å°¾
2  ä½›å‰å°¼äºšé¸¢å°¾
</code></pre>
<ul>
<li>ç®€åŒ–æ¨¡å‹ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>x</mi><mo>Ã—</mo><mi>w</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">y=x\times w+ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span></li>
<li>å‡æ–¹è¯¯å·®ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>S</mi><mi>E</mi><mo>(</mo><mi>y</mi><mo separator="true">,</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo>)</mo><mo>=</mo><mfrac><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></msubsup><mo>(</mo><mi>y</mi><mo>âˆ’</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">MSE(y,y_\_)=\frac{\sum_{k=0}^n(y-y_\_)^2}{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.53402em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.18902em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5651em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.05688571428571432em;"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.36442857142857144em;"><span></span></span></span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li>
</ul>
</li>
<li>
<h4 id="ç”¨ç¥ç»ç½‘ç»œå®ç°é¸¢å°¾èŠ±åˆ†ç±»æ¢¯åº¦ä¸‹é™">ç”¨ç¥ç»ç½‘ç»œå®ç°é¸¢å°¾èŠ±åˆ†ç±»ï¼šæ¢¯åº¦ä¸‹é™</h4>
<ul>
<li>ç›®çš„ï¼šæ‰¾åˆ°ä¸€ç»„å‚æ•°wå’Œbï¼Œä½¿å¾—æŸå¤±å‡½æ•°æœ€å°ã€‚</li>
<li>æ¢¯åº¦ï¼šå‡½æ•°å¯¹å„å‚æ•°æ±‚åå¯¼åçš„å‘é‡ã€‚å‡½æ•°æ¢¯åº¦ä¸‹é™æ–¹å‘æ˜¯å‡½æ•°å‡å°æ–¹å‘ã€‚</li>
<li>æ¢¯åº¦ä¸‹é™æ³•ï¼šæ²¿æŸå¤±å‡½æ•°æ¢¯åº¦ä¸‹é™çš„æ–¹å‘ï¼Œå¯»æ‰¾æŸå¤±å‡½æ•°çš„æœ€å°å€¼ï¼Œå¾—åˆ°æœ€ä¼˜å‚æ•°çš„æ–¹æ³•ã€‚</li>
</ul>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: Undefined control sequence: \part at position 26: â€¦t - lr * \frac{\Ì²pÌ²aÌ²rÌ²tÌ² Ì²loss}{\part w_tâ€¦'>w_{t+1}=w_t - lr * \frac{\part loss}{\part w_t}\\
b_{t+1} = b_t -  lr * \frac{\part loss}{\part b_t}\\
w_{t+1} * x + b_{t+1} = y
</p>
<ul>
<li>å­¦ä¹ ç‡ï¼ˆlearning rateï¼Œ lrï¼‰ï¼šå½“å­¦ä¹ ç‡è®¾ç½®çš„è¿‡å°æ—¶ï¼Œæ”¶æ•›è¿‡ç¨‹å°†å˜å¾—ååˆ†ç¼“æ…¢ã€‚è€Œå½“å­¦ä¹ ç‡è®¾ç½®çš„è¿‡å¤§æ—¶ï¼Œæ¢¯åº¦å¯èƒ½ä¼šåœ¨æœ€å°å€¼é™„è¿‘æ¥å›éœ‡è¡ï¼Œç”šè‡³å¯èƒ½æ— æ³•æ”¶æ•›ã€‚</li>
</ul>
</li>
<li>
<h4 id="ç”¨ç¥ç»ç½‘ç»œå®ç°é¸¢å°¾èŠ±åˆ†ç±»åå‘ä¼ æ’­">ç”¨ç¥ç»ç½‘ç»œå®ç°é¸¢å°¾èŠ±åˆ†ç±»ï¼šåå‘ä¼ æ’­</h4>
<p class='katex-block katex-error' title='ParseError: KaTeX parse error: Undefined control sequence: \part at position 26: â€¦t - lr * \frac{\Ì²pÌ²aÌ²rÌ²tÌ² Ì²loss}{\part w_tâ€¦'>w_{t+1}=w_t - lr * \frac{\part loss}{\part w_t}
</p>
<ul>
<li>åå‘ä¼ æ’­ï¼šä»åå‘å‰ï¼Œé€å±‚æ±‚æŸå¤±å‡½æ•°å¯¹æ¯å±‚ç¥ç»å…ƒå‚æ•°çš„åå¯¼æ•°ï¼Œè¿­ä»£æ›´æ–°æ‰€æœ‰å‚æ•°ã€‚</li>
<li>egï¼šæŸå¤±å‡½æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mo>(</mo><mi>w</mi><mo>+</mo><mn>1</mn><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">loss=(w+1)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>,  <span class='katex-error' title='ParseError: KaTeX parse error: Undefined control sequence: \part at position 7: \frac{\Ì²pÌ²aÌ²rÌ²tÌ² Ì²loss}{\part w}=â€¦'>\frac{\part loss}{\part w}=2w+2</span></li>
</ul>
<pre><code>å‚æ•°åˆå§‹åŒ–ä¸º5ï¼Œå­¦ä¹ ç‡ä¸º0.2ï¼Œåˆ™
1æ¬¡  å‚æ•°w:5      5-0.2*(2*5+2)=2.6
2æ¬¡  å‚æ•°w:2.6    2.6-0.2*(2*2.6+2)=1.16
3æ¬¡  å‚æ•°w:1.16   1.16-0.2*(2*1.16+2)=0.296
4æ¬¡  å‚æ•°w:0.296
......
</code></pre>
<ul>
<li>Code  p13_backpropagation.py</li>
</ul>
<pre><code class="language-python">import tensorflow as tf

w = tf.Variable(tf.constant(5, dtype=tf.float32))
lr = 0.2
epoch = 40

for epoch in range(epoch):  # for epoch å®šä¹‰é¡¶å±‚å¾ªç¯ï¼Œè¡¨ç¤ºå¯¹æ•°æ®é›†å¾ªç¯epochæ¬¡ï¼Œæ­¤ä¾‹æ•°æ®é›†æ•°æ®ä»…æœ‰1ä¸ªw,åˆå§‹åŒ–æ—¶å€™constantèµ‹å€¼ä¸º5ï¼Œå¾ªç¯40æ¬¡è¿­ä»£ã€‚
    with tf.GradientTape() as tape:  # withç»“æ„åˆ°gradsæ¡†èµ·äº†æ¢¯åº¦çš„è®¡ç®—è¿‡ç¨‹ã€‚
        loss = tf.square(w + 1)
    grads = tape.gradient(loss, w)  # .gradientå‡½æ•°å‘ŠçŸ¥è°å¯¹è°æ±‚å¯¼

    w.assign_sub(lr * grads)  # .assign_sub å¯¹å˜é‡åšè‡ªå‡ å³ï¼šw -= lr*grads å³ w = w - lr*grads
    print(&quot;After %s epoch,w is %f,loss is %f&quot; % (epoch, w.numpy(), loss))

# lråˆå§‹å€¼ï¼š0.2   è¯·è‡ªæ”¹å­¦ä¹ ç‡  0.001  0.999 çœ‹æ”¶æ•›è¿‡ç¨‹
# æœ€ç»ˆç›®çš„ï¼šæ‰¾åˆ° loss æœ€å° å³ w = -1 çš„æœ€ä¼˜å‚æ•°w

</code></pre>
</li>
</ol>
<h3 id="13-å¼ é‡ç”Ÿæˆ">1.3 å¼ é‡ç”Ÿæˆ</h3>
<ul>
<li>
<p>**å¼ é‡ï¼ˆTensorï¼‰ï¼š**å¤šç»´æ•°ç»„ï¼ˆåˆ—è¡¨ï¼‰  é˜¶ï¼šå¼ é‡çš„ç»´æ•°</p>
<table>
<thead>
<tr>
<th style="text-align:center">ç»´æ•°</th>
<th style="text-align:center">é˜¶</th>
<th style="text-align:left">åå­—</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0-D</td>
<td style="text-align:center">0</td>
<td style="text-align:left">æ ‡é‡ scalar</td>
<td>s=1 2 3</td>
</tr>
<tr>
<td style="text-align:center">1-D</td>
<td style="text-align:center">1</td>
<td style="text-align:left">å‘é‡ vector</td>
<td>v=[1, 2, 3]</td>
</tr>
<tr>
<td style="text-align:center">2-D</td>
<td style="text-align:center">2</td>
<td style="text-align:left">çŸ©é˜µ matrix</td>
<td>m=[[1, 2, 3], [4, 5, 6], [7, 8, 9]]</td>
</tr>
<tr>
<td style="text-align:center">n-D</td>
<td style="text-align:center">n</td>
<td style="text-align:left">å¼ é‡ tensor</td>
<td>t=[[[    nä¸ª</td>
</tr>
</tbody>
</table>
<p>å¼ é‡å¯ä»¥è¡¨ç¤º0é˜¶åˆ°né˜¶æ•°ç»„ï¼ˆåˆ—è¡¨ï¼‰</p>
</li>
<li>
<p>æ•°æ®ç±»å‹</p>
<ul>
<li>
<p>tf.int, tf.float ......</p>
<p>tf.int32, tf.float32, tf.float64</p>
</li>
<li>
<p>tf.bool</p>
<p>tf.constant([True, False])</p>
</li>
<li>
<p>tf.string</p>
<p>tf.constant(&quot;hello, world!&quot;)</p>
</li>
</ul>
</li>
<li>
<p>å¦‚ä½•åˆ›å»ºä¸€ä¸ªTensor</p>
<p>åˆ›å»ºä¸€ä¸ªå¼ é‡<br>
tf.constant(å¼ é‡å†…å®¹, dtype=æ•°æ®ç±»å‹(å¯é€‰))</p>
<pre><code class="language-python">import tensorflow as tf

a = tf.constant([1, 5], dtype=tf.int64)
print(a)
print(a.dtype)
print(a.shape)

# è¿è¡Œç»“æœ
# tf.Tensor([1 5], shape=(2,), dtype=int64)
# &lt;dtype: 'int64'&gt;
# (2,)  ä¸€ç»´å¼ é‡ï¼Œå«æœ‰ä¸¤ä¸ªå…ƒç´ 
</code></pre>
</li>
<li>
<p>å°†numpyçš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºTensoræ•°æ®ç±»å‹</p>
<p>tf.convert_to_tensor(æ•°æ®å, dtype=æ•°æ®ç±»å‹(å¯é€‰))</p>
<pre><code class="language-python">import tensorflow as tf
import numpy as np
a = np.arange(0, 5)
b = tf.convert_to_tensor(a, dtype=tf.int64)
print(a)
print(b)

# è¿è¡Œç»“æœ
# [0 1 2 3 4]
# tf.Tensor([0 1 2 3 4], shape=(5,), dtype=int64)
</code></pre>
</li>
<li>
<p>åˆ›å»ºå…¨ä¸º0çš„å¼ é‡</p>
<p>tf.zeros(ç»´åº¦)</p>
</li>
<li>
<p>åˆ›å»ºå…¨ä¸º1çš„å¼ é‡</p>
<p>tf.ones(ç»´åº¦)</p>
</li>
<li>
<p>åˆ›å»ºå…¨ä¸ºæŒ‡å®šç»´åº¦çš„å¼ é‡</p>
<p>tf.fill(ç»´åº¦, æŒ‡å®šå€¼)</p>
<p>ç»´åº¦ï¼šä¸€ç»´ç›´æ¥å†™ä¸ªæ•°ï¼ŒäºŒç»´ç”¨[è¡Œ, åˆ—]ï¼Œå¤šä¸ºç”¨[n, m, j, k ......]</p>
<pre><code class="language-python">import tensorflow as tf

a = tf.zeros([2, 3])
b = tf.ones(4)
c = tf.fill([2, 2], 9)
print(a)
print(b)
print(c)

# è¿è¡Œç»“æœ
# tf.Tensor(
# [[0. 0. 0.]
#  [0. 0. 0.]], shape=(2, 3), dtype=float32)
# tf.Tensor([1. 1. 1. 1.], shape=(4,), dtype=float32)
# tf.Tensor(
# [[9 9]
#  [9 9]], shape=(2, 2), dtype=int32)
</code></pre>
</li>
<li>
<p>ç”Ÿæˆæ­£æ€åˆ†å¸ƒçš„éšæœºæ•°, é»˜è®¤å‡å€¼ä¸º0, æ ‡å‡†å·®ä¸º1</p>
<p>tf.random.normal(ç»´åº¦, mean=å‡å€¼, stddev=æ ‡å‡†å·®)</p>
</li>
<li>
<p>ç”Ÿæˆæˆªæ–­å¼æ­£æ€åˆ†å¸ƒçš„éšæœºæ•°</p>
<p>tf.random.truncated_normal(ç»´åº¦, mean=å‡å€¼, stddev=æ ‡å‡†å·®)</p>
<p>åœ¨tf.truncated_normalä¸­å¦‚æœéšæœºç”Ÿæˆæ•°æ®çš„å–å€¼åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>Î¼</mi><mo>âˆ’</mo><mn>2</mn><mi>Î´</mi><mo separator="true">,</mo><mi>Î¼</mi><mo>+</mo><mn>2</mn><mi>Î´</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(\mu-2\delta,\mu+2\delta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">Î¼</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">Î¼</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="mclose">)</span></span></span></span> ä¹‹å¤–åˆ™é‡æ–°è¿›è¡Œç”Ÿæˆï¼Œä¿è¯äº†ç”Ÿæˆå€¼åœ¨å‡å€¼é™„è¿‘ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î¼</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">Î¼</span></span></span></span>ï¼šå‡å€¼ï¼Œ  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î´</mi></mrow><annotation encoding="application/x-tex">\delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span></span></span></span>ï¼šæ ‡å‡†å·®<br>
æ ‡å‡†å·®è®¡ç®—å…¬å¼ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î´</mi><mo>=</mo><msqrt><mfrac><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><mover accent="true"><mi>x</mi><mo>Ë‰</mo></mover><mo>)</mo></mrow><mi>n</mi></mfrac></msqrt></mrow><annotation encoding="application/x-tex">\delta=\sqrt{\frac{\sum_{i=1}^n (x_i-\bar x)}{n}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.4974965em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3425035em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.060007em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5350070000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7046857142857144em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.8971428571428572em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="mord mathdefault mtight">x</span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span class="accent-body" style="left:-0.22222em;"><span class="mtight">Ë‰</span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.3025035em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4974965em;"><span></span></span></span></span></span></span></span></span></p>
<pre><code class="language-python">import tensorflow as tf

d = tf.random.normal([2, 2], mean=0.5, stddev=1)
print(&quot;d:&quot;, d)
e = tf.random.truncated_normal([2, 2], mean=0.5, stddev=1)
print(&quot;e:&quot;, e)

# è¿è¡Œç»“æœ
# d: tf.Tensor(
# [[ 1.9877443  -1.2797751 ]
#  [ 1.6146473   0.39082623]], shape=(2, 2), dtype=float32)
# e: tf.Tensor(
# [[ 1.3543694   1.0639844 ]
#  [-0.9956173  -0.16789067]], shape=(2, 2), dtype=float32)
</code></pre>
</li>
<li>
<p>ç”Ÿæˆå‡åŒ€åˆ†å¸ƒéšæœºæ•° [minval, maxval]</p>
<p>tf.random.uniform(ç»´åº¦, minval=æœ€å°å€¼, maxval=æœ€å¤§å€¼)</p>
<pre><code class="language-python">import tensorflow as tf

f = tf.random.uniform([2, 2], minval=0, maxval=1)
print(&quot;f:&quot;, f)

# è¿è¡Œç»“æœ
# f: tf.Tensor(
# [[0.78154075 0.5844718 ]
#  [0.6193285  0.62899697]], shape=(2, 2), dtype=float32)
</code></pre>
</li>
</ul>
<h3 id="14-å¸¸ç”¨å‡½æ•°">1.4 å¸¸ç”¨å‡½æ•°</h3>
<ul>
<li>
<p>å¼ºåˆ¶tensorè½¬æ¢ä¸ºè¯¥æ•°æ®ç±»å‹</p>
<p>tf.cast(å¼ é‡å, dtype=æ•°æ®ç±»å‹)</p>
</li>
<li>
<p>è®¡ç®—å¼ é‡ç»´åº¦ä¸Šå…ƒç´ çš„æœ€å°å€¼</p>
<p>tf.reduce_min(å¼ é‡å)</p>
</li>
<li>
<p>è®¡ç®—å¼ é‡ç»´åº¦ä¸Šçš„æœ€å¤§å€¼</p>
<p>tf.reduce_max(å¼ é‡å)</p>
</li>
</ul>
<pre><code class="language-python">import tensorflow as tf

x1 = tf.constant([1., 2., 3.], dtype=tf.float64)
print(&quot;x1:&quot;, x1)
x2 = tf.cast(x1, tf.int32)
print(&quot;x2&quot;, x2)
print(&quot;minimum of x2ï¼š&quot;, tf.reduce_min(x2))
print(&quot;maxmum of x2:&quot;, tf.reduce_max(x2))

# è¿è¡Œç»“æœ
# x1: tf.Tensor([1. 2. 3.], shape=(3,), dtype=float64)
# x2 tf.Tensor([1 2 3], shape=(3,), dtype=int32)
# minimum of x2ï¼š tf.Tensor(1, shape=(), dtype=int32)
# maxmum of x2: tf.Tensor(3, shape=(), dtype=int32)
</code></pre>
<ul>
<li>
<p>ç†è§£axis</p>
<p>åœ¨ä¸€ä¸ªäºŒä½å¼ é‡æˆ–è€…æ•°ç»„ä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´axisç­‰äº0æˆ–1æ§åˆ¶æ‰§è¡Œç»´åº¦ã€‚</p>
<ul>
<li>axis=0ä»£è¡¨è·¨è¡Œï¼ˆç»åº¦ï¼Œdownï¼‰ï¼Œè€Œaxis=1ä»£è¡¨è·¨åˆ—ï¼ˆçº¬åº¦ï¼Œacrossï¼‰</li>
<li>å¦‚æœä¸æŒ‡å®šaxisï¼Œåˆ™æ‰€æœ‰å…ƒç´ å‚ä¸è®¡ç®—</li>
</ul>
</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107111240321-1.png" alt="image-20210710134643046" loading="lazy"></figure>
<ul>
<li>
<p>è®¡ç®—å¼ é‡æ²¿æŒ‡å®šç»´åº¦çš„å¹³å‡å€¼</p>
<p>tf.reduce_mean(å¼ é‡å, axis=æ“ä½œè½´)</p>
</li>
<li>
<p>è®¡ç®—å¼ é‡æ²¿ç€æŒ‡å®šç»´åº¦çš„å’Œ</p>
<p>tf.reduce_sum(å¼ é‡å, axis=æ“ä½œè½´)</p>
</li>
</ul>
<pre><code class="language-python">import tensorflow as tf

x = tf.constant([[1, 2, 3], [2, 2, 3]])
print(&quot;x:&quot;, x)
print(&quot;mean of x:&quot;, tf.reduce_mean(x))  # æ±‚xä¸­æ‰€æœ‰æ•°çš„å‡å€¼
print(&quot;mean of x by rows:&quot;, tf.reduce_mean(x, axis=0))  # æ±‚xä¸­æ¯ä¸€è¡Œæ•°çš„å‡å€¼
print(&quot;sum of x:&quot;, tf.reduce_sum(x, axis=1))  # æ±‚æ¯ä¸€è¡Œçš„å’Œ

# è¿è¡Œç»“æœ
# x: tf.Tensor(
# [[1 2 3]
#  [2 2 3]], shape=(2, 3), dtype=int32)
# mean of x: tf.Tensor(2, shape=(), dtype=int32)
# mean of x by rows: tf.Tensor([1 2 3], shape=(3,), dtype=int32)
# sum of x: tf.Tensor([6 7], shape=(2,), dtype=int32)
</code></pre>
<ul>
<li>
<p>tf.Variable</p>
<p>tf.Variable() å°†å˜é‡æ ‡è®°ä¸ºâ€œå¯è®­ç»ƒâ€ï¼Œ<strong>è¢«æ ‡è®°çš„å˜é‡ä¼šåœ¨åå‘ä¼ æ’­ä¸­è®°å½•æ¢¯åº¦ä¿¡æ¯</strong>ã€‚ç¥ç»ç½‘ç»œè®­ç»ƒä¸­ï¼Œå¸¸ç”¨è¯¥å‡½æ•°æ ‡è®°å¾…è®­ç»ƒå‚æ•°ã€‚<br>
tf.Variable(åˆå§‹å€¼)<br>
w = tf.Variable(tf.random.normal([2, 2], mean=0, stddev=1))</p>
</li>
<li>
<p>TensorFlowä¸­çš„æ•°å­¦è¿ç®—</p>
<ul>
<li>
<p><strong>å¯¹åº”å…ƒç´ </strong>çš„å››åˆ™è¿ç®—ï¼štf.add, tf.subtract, tf.multiply, tf.divide</p>
<p>tf.add(å¼ é‡1, å¼ é‡2)</p>
<pre><code class="language-python">import tensorflow as tf

a = tf.ones([1, 3])
b = tf.fill([1, 3], 3.)
print(&quot;a:&quot;, a)
print(&quot;b:&quot;, b)
print(&quot;a+b:&quot;, tf.add(a, b))
print(&quot;a-b:&quot;, tf.subtract(a, b))
print(&quot;a*b:&quot;, tf.multiply(a, b))
print(&quot;b/a:&quot;, tf.divide(b, a))

# è¿è¡Œç»“æœ
# a: tf.Tensor([[1. 1. 1.]], shape=(1, 3), dtype=float32)
# b: tf.Tensor([[3. 3. 3.]], shape=(1, 3), dtype=float32)
# a+b: tf.Tensor([[4. 4. 4.]], shape=(1, 3), dtype=float32)
# a-b: tf.Tensor([[-2. -2. -2.]], shape=(1, 3), dtype=float32)
# a*b: tf.Tensor([[3. 3. 3.]], shape=(1, 3), dtype=float32)
# b/a: tf.Tensor([[3. 3. 3.]], shape=(1, 3), dtype=float32)
</code></pre>
</li>
<li>
<p>å¹³æ–¹ã€æ¬¡æ–¹ä¸å¼€æ–¹ï¼štf.square, tf.pow, tf.sqrt</p>
<p>tf.square(å¼ é‡å)  # è®¡ç®—æŸä¸ªå¼ é‡çš„å¹³æ–¹<br>
tf.pow(å¼ é‡å, næ¬¡æ–¹æ•°)  # è®¡ç®—æŸä¸ªå¼ é‡çš„næ¬¡æ–¹<br>
tf.sqrt(å¼ é‡å)  # è®¡ç®—æŸä¸ªå¼ é‡çš„å¼€æ–¹</p>
<pre><code class="language-python">import tensorflow as tf

a = tf.fill([1, 2], 3.)
print(&quot;a:&quot;, a)
print(&quot;açš„å¹³æ–¹:&quot;, tf.pow(a, 3))
print(&quot;açš„å¹³æ–¹:&quot;, tf.square(a))
print(&quot;açš„å¼€æ–¹:&quot;, tf.sqrt(a))

# è¿è¡Œç»“æœ
# a: tf.Tensor([[3. 3.]], shape=(1, 2), dtype=float32)
# açš„å¹³æ–¹: tf.Tensor([[27. 27.]], shape=(1, 2), dtype=float32)
# açš„å¹³æ–¹: tf.Tensor([[9. 9.]], shape=(1, 2), dtype=float32)
# açš„å¼€æ–¹: tf.Tensor([[1.7320508 1.7320508]], shape=(1, 2), dtype=float32)
</code></pre>
</li>
<li>
<p>çŸ©é˜µä¹˜ï¼štf.matmul</p>
<p>tf.marmul(çŸ©é˜µ1, çŸ©é˜µ2)  # å®ç°ä¸¤ä¸ªçŸ©é˜µçš„ç›¸ä¹˜</p>
<pre><code class="language-python">import tensorflow as tf

a = tf.ones([3, 2])
b = tf.fill([2, 3], 3.)
print(&quot;a:&quot;, a)
print(&quot;b:&quot;, b)
print(&quot;a*b:&quot;, tf.matmul(a, b))

# è¿è¡Œç»“æœ
# a: tf.Tensor(
# [[1. 1.]
#  [1. 1.]
#  [1. 1.]], shape=(3, 2), dtype=float32)
# b: tf.Tensor(
# [[3. 3. 3.]
#  [3. 3. 3.]], shape=(2, 3), dtype=float32)
# a*b: tf.Tensor(
# [[6. 6. 6.]
#  [6. 6. 6.]
#  [6. 6. 6.]], shape=(3, 3), dtype=float32)
</code></pre>
</li>
</ul>
</li>
<li>
<p>tf.Dataset.from_tensor_slices</p>
<p>å°†åˆ‡åˆ†ä¼ å…¥å¼ é‡çš„ç¬¬ä¸€ç»´åº¦ï¼Œç”Ÿæˆè¾“å…¥ç‰¹å¾/æ ‡ç­¾å¯¹ï¼Œæ„å»ºæ•°æ®é›†data = tf.data.Dataset.from_tensor_slices((è¾“å…¥ç‰¹å¾, æ ‡ç­¾))<br>
(Numpyå’ŒTensoræ ¼å¼éƒ½å¯ç”¨è¯¥è¯­å¥è¯»å…¥æ•°æ®)</p>
<pre><code class="language-python">import tensorflow as tf

features = tf.constant([12, 23, 10, 17])
labels = tf.constant([0, 1, 1, 0])
dataset = tf.data.Dataset.from_tensor_slices((features, labels))
for element in dataset:
    print(element)

# è¿è¡Œç»“æœ
# (&lt;tf.Tensor: shape=(), dtype=int32, numpy=12&gt;, &lt;tf.Tensor: shape=(), dtype=int32, numpy=0&gt;)
# (&lt;tf.Tensor: shape=(), dtype=int32, numpy=23&gt;, &lt;tf.Tensor: shape=(), dtype=int32, numpy=1&gt;)
# (&lt;tf.Tensor: shape=(), dtype=int32, numpy=10&gt;, &lt;tf.Tensor: shape=(), dtype=int32, numpy=1&gt;)
# (&lt;tf.Tensor: shape=(), dtype=int32, numpy=17&gt;, &lt;tf.Tensor: shape=(), dtype=int32, numpy=0&gt;)
</code></pre>
</li>
<li>
<p>tf.GradientTape</p>
<p>withç»“æ„è®°å½•è®¡ç®—è¿‡ç¨‹ï¼Œgradientæ±‚å‡ºå¼ é‡çš„æ¢¯åº¦</p>
<pre><code class="language-python">with tf.GradientTape() as tape:
	è‹¥å¹²ä¸ªè®¡ç®—è¿‡ç¨‹
grad = tape.gradient(å‡½æ•°, å¯¹è°æ±‚å¯¼)
</code></pre>
<pre><code class="language-python">import tensorflow as tf

with tf.GradientTape() as tape:
    x = tf.Variable(tf.constant(3.0))
    y = tf.pow(x, 2)
grad = tape.gradient(y, x)
print(grad)

# è¿è¡Œç»“æœ
# tf.Tensor(6.0, shape=(), dtype=float32)
</code></pre>
</li>
<li>
<p>enumerate</p>
<p>enumerateæ˜¯pythonçš„å†…å»ºå‡½æ•°ï¼Œå®ƒå¯ä»¥éå†æ¯ä¸ªå…ƒç´ ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„æˆ–å­—ç¬¦ä¸²ï¼‰ï¼Œç»„åˆä¸ºï¼šç´¢å¼•   å…ƒç´ ï¼Œå¸¸åœ¨forå¾ªç¯ä¸­ä½¿ç”¨ã€‚<br>
enumerate(åˆ—è¡¨å)</p>
<pre><code class="language-python">seq = ['one', 'two', 'three']
for i, element in enumerate(seq):
    print(i, element)

# è¿è¡Œç»“æœ
# 0 one
# 1 two
# 2 three
</code></pre>
</li>
<li>
<p>tf.one_hot</p>
<p>ç‹¬çƒ­ç¼–ç ï¼ˆone-hot encodeingï¼‰ï¼šåœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œå¸¸ç”¨ç‹¬çƒ­ç åšæ ‡ç­¾ï¼Œæ ‡è®°ç±»åˆ«ï¼š1è¡¨ç¤ºæ˜¯ï¼Œ0è¡¨ç¤ºéã€‚<br>
(0ç‹—å°¾è‰é¸¢å°¾   1æ‚è‰²é¸¢å°¾  2ä½›å‰å°¼äºšé¸¢å°¾)<br>
æ ‡ç­¾ï¼š     1<br>
ç‹¬çƒ­ç ï¼š(0.            1.            0.)</p>
<pre><code class="language-python">import tensorflow as tf

classes = 3
labels = tf.constant([1, 0, 2])  # è¾“å…¥çš„å…ƒç´ å€¼æœ€å°ä¸º0ï¼Œæœ€å¤§ä¸º2
output = tf.one_hot(labels, depth=classes)
print(&quot;result of labels1:&quot;, output)
print(&quot;\n&quot;)

# è¿è¡Œç»“æœ
# result of labels1: tf.Tensor(
# [[0. 1. 0.]
#  [1. 0. 0.]
#  [0. 0. 1.]], shape=(3, 3), dtype=float32)
</code></pre>
</li>
<li>
<p>tf.nn.softmax</p>
<figure data-type="image" tabindex="2"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107111240411-2.png" alt="image-20210710144018858" loading="lazy"></figure>
<p>å½“nåˆ†ç±»çš„nä¸ªè¾“å‡º$$(y_0,y_1,...,y_{n-1})$$é€šè¿‡softmax()å‡½æ•°ï¼Œä¾¿ç¬¦åˆæ¦‚ç‡åˆ†å¸ƒäº†ã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ€</mi><mi>x</mi><mi>P</mi><mo>(</mo><mi>X</mi><mo>=</mo><mi>x</mi><mo>)</mo><mo>âˆˆ</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo><mi mathvariant="normal">ä¸”</mi><munder><mo>âˆ‘</mo><mi>x</mi></munder><mi>P</mi><mo>(</mo><mi>X</mi><mo>=</mo><mi>x</mi><mo>)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\forall x  P(X=x)\in[0,1]ä¸”\sum_x P(X=x)=1
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ€</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3000100000000003em;vertical-align:-1.250005em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mord cjk_fallback">ä¸”</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p>
<pre><code class="language-python">import tensorflow as tf

y = tf.constant([1.01, 2.01, -0.66])
y_pro = tf.nn.softmax(y)

print(&quot;After softmax, y_pro is:&quot;, y_pro)  # y_pro ç¬¦åˆæ¦‚ç‡åˆ†å¸ƒ

print(&quot;The sum of y_pro:&quot;, tf.reduce_sum(y_pro))  # é€šè¿‡softmaxåï¼Œæ‰€æœ‰æ¦‚ç‡åŠ èµ·æ¥å’Œä¸º1

# è¿è¡Œç»“æœ
# After softmax, y_pro is: tf.Tensor([0.25598174 0.69583046 0.0481878 ], shape=(3,), dtype=float32)
# The sum of y_pro: tf.Tensor(1.0, shape=(), dtype=float32)
</code></pre>
</li>
<li>
<p>assign_sub</p>
<p>èµ‹å€¼æ“ä½œï¼Œæ›´æ–°å‚æ•°çš„å€¼å¹¶è¿”å›ã€‚<br>
è°ƒç”¨assign_subå‰ï¼Œå…ˆç”¨tf.Variableå®šä¹‰å˜é‡wä¸ºå¯è®­ç»ƒ(å¯è‡ªæ›´æ–°)ã€‚<br>
w.assign_sub(wè¦è‡ªå‡çš„å†…å®¹)</p>
<pre><code class="language-python">import tensorflow as tf

x = tf.Variable(4)
x.assign_sub(1)
print(&quot;x:&quot;, x)  # 4-1=3

# è¿è¡Œç»“æœ
# x: &lt;tf.Variable 'Variable:0' shape=() dtype=int32, numpy=3&gt;
</code></pre>
</li>
<li>
<p>tf.argmax</p>
<p>è¿”å›å¼ é‡æ²¿æŒ‡å®šç»´åº¦æœ€å¤§å€¼çš„ç´¢å¼•<br>
tf.argmax(å¼ é‡å, axis=æ“ä½œè½´)</p>
<pre><code class="language-python">import numpy as np
import tensorflow as tf

test = np.array([[1, 2, 3], [2, 3, 4], [5, 4, 3], [8, 7, 2]])
print(&quot;test:\n&quot;, test)
print(&quot;æ¯ä¸€åˆ—çš„æœ€å¤§å€¼çš„ç´¢å¼•ï¼š&quot;, tf.argmax(test, axis=0))  # è¿”å›æ¯ä¸€åˆ—æœ€å¤§å€¼çš„ç´¢å¼•
print(&quot;æ¯ä¸€è¡Œçš„æœ€å¤§å€¼çš„ç´¢å¼•&quot;, tf.argmax(test, axis=1))  # è¿”å›æ¯ä¸€è¡Œæœ€å¤§å€¼çš„ç´¢å¼•

# è¿è¡Œç»“æœ
# æ¯ä¸€åˆ—çš„æœ€å¤§å€¼çš„ç´¢å¼•ï¼š tf.Tensor([3 3 1], shape=(3,), dtype=int64)
# æ¯ä¸€è¡Œçš„æœ€å¤§å€¼çš„ç´¢å¼• tf.Tensor([2 2 0 0], shape=(4,), dtype=int64)
</code></pre>
</li>
</ul>
<h3 id="15-é¸¢å°¾èŠ±æ•°æ®é›†è¯»å…¥">1.5 é¸¢å°¾èŠ±æ•°æ®é›†è¯»å…¥</h3>
<ul>
<li>
<p>æ•°æ®é›†ä»‹ç»</p>
<p>å…±æœ‰æ•°æ®150ç»„ï¼Œæ¯ç»„åŒ…æ‹¬èŠ±è¼é•¿ã€èŠ±è¼å®½ã€èŠ±ç“£é•¿ã€èŠ±ç“£å®½4ä¸ªè¾“å…¥ç‰¹å¾ã€‚åŒæ—¶ç»™å‡ºäº†ï¼Œè¿™ä¸€ç»„ç‰¹å¾å¯¹åº”çš„é¸¢å°¾èŠ±ç±»åˆ«ã€‚ç±»åˆ«åŒ…æ‹¬Setosa Irisï¼ˆç‹—å°¾è‰é¸¢å°¾ï¼‰ï¼ŒVersicolour Irisï¼ˆæ‚è‰²é¸¢å°¾ï¼‰ï¼ŒVirginica Irisï¼ˆå¼—å‰å°¼äºšé¸¢å°¾ï¼‰ä¸‰ç±»ï¼Œåˆ†åˆ«ç”¨æ•°å­—0ï¼Œ1ï¼Œ2è¡¨ç¤ºã€‚</p>
</li>
<li>
<p>ä»sklearnåŒ…datasetsè¯»å…¥æ•°æ®é›†ï¼Œè¯­æ³•ä¸ºï¼š</p>
<pre><code class="language-python">from sklearn.datasets import load_iris
x_data = datasets.load_iris().data  # è¿”å›irisæ•°æ®é›†æ‰€æœ‰è¾“å…¥ç‰¹å¾
y_data = datasets.load_iris().target  # è¿”å›irisæ•°æ®é›†æ‰€æœ‰æ ‡ç­¾
</code></pre>
</li>
<li>
<p>å®Œæ•´çš„ä»£ç </p>
<pre><code class="language-python">from sklearn import datasets
from pandas import DataFrame
import pandas as pd

x_data = datasets.load_iris().data  # .dataè¿”å›irisæ•°æ®é›†æ‰€æœ‰è¾“å…¥ç‰¹å¾
y_data = datasets.load_iris().target  # .targetè¿”å›irisæ•°æ®é›†æ‰€æœ‰æ ‡ç­¾
print(&quot;x_data from datasets: \n&quot;, x_data)
print(&quot;y_data from datasets: \n&quot;, y_data)

x_data = DataFrame(x_data, columns=['èŠ±è¼é•¿åº¦', 'èŠ±è¼å®½åº¦', 'èŠ±ç“£é•¿åº¦', 'èŠ±ç“£å®½åº¦'])  # ä¸ºè¡¨æ ¼å¢åŠ è¡Œç´¢å¼•ï¼ˆå·¦ä¾§ï¼‰å’Œåˆ—æ ‡ç­¾ï¼ˆä¸Šæ–¹ï¼‰
pd.set_option('display.unicode.east_asian_width', True)  # è®¾ç½®åˆ—åå¯¹é½
print(&quot;x_data add index: \n&quot;, x_data)

x_data['ç±»åˆ«'] = y_data  # æ–°åŠ ä¸€åˆ—ï¼Œåˆ—æ ‡ç­¾ä¸ºâ€˜ç±»åˆ«â€™ï¼Œæ•°æ®ä¸ºy_data
print(&quot;x_data add a column: \n&quot;, x_data)

#ç±»å‹ç»´åº¦ä¸ç¡®å®šæ—¶ï¼Œå»ºè®®ç”¨printå‡½æ•°æ‰“å°å‡ºæ¥ç¡®è®¤æ•ˆæœ

# è¿è¡Œç»“æœ
# x_data from datasets:
#  [[5.1 3.5 1.4 0.2]
#  [4.9 3.  1.4 0.2]
#  [4.7 3.2 1.3 0.2]
#  [4.6 3.1 1.5 0.2]
#  [5.  3.6 1.4 0.2]
#  ... ...
# y_data from datasets:
#  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#  0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
#  1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2
#  2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
#  2 2]
#
# x_data add a column: 
#       èŠ±è¼é•¿åº¦  èŠ±è¼å®½åº¦  èŠ±ç“£é•¿åº¦  èŠ±ç“£å®½åº¦  ç±»åˆ«
# 0         5.1       3.5       1.4       0.2     0
# 1         4.9       3.0       1.4       0.2     0
# 2         4.7       3.2       1.3       0.2     0
# 3         4.6       3.1       1.5       0.2     0
# 4         5.0       3.6       1.4       0.2     0
# ..        ...       ...       ...       ...   ...
# 145       6.7       3.0       5.2       2.3     2
# 146       6.3       2.5       5.0       1.9     2
# 147       6.5       3.0       5.2       2.0     2
# 148       6.2       3.4       5.4       2.3     2
# 149       5.9       3.0       5.1       1.8     2
#
# [150 rows x 5 columns]
</code></pre>
</li>
</ul>
<h3 id="16-ç¥ç»ç½‘ç»œå®ç°é¸¢å°¾èŠ±åˆ†ç±»">1.6 ç¥ç»ç½‘ç»œå®ç°é¸¢å°¾èŠ±åˆ†ç±»</h3>
<ol>
<li>å‡†å¤‡æ•°æ®</li>
</ol>
<ul>
<li>æ•°æ®é›†è¯»å…¥</li>
<li>æ•°æ®é›†ä¹±åº</li>
<li>ç”Ÿæˆè®­ç»ƒé›†å’Œæµ‹è¯•é›† (å³x_train / y_train, x_test / y_test)</li>
<li>é…æˆï¼ˆè¾“å…¥ç‰¹å¾ï¼Œæ ‡ç­¾ï¼‰å¯¹ï¼Œæ¯æ¬¡è¯»å…¥ä¸€å°æ’®ï¼ˆbatchï¼‰</li>
</ul>
<ol start="2">
<li>æ­å»ºç½‘ç»œ
<ul>
<li>å®šä¹‰ç¥ç»ç½‘ç»œä¸­æ‰€æœ‰å¯è®­ç»ƒå‚æ•°</li>
</ul>
</li>
<li>å‚æ•°ä¼˜åŒ–
<ul>
<li>åµŒå¥—å¾ªç¯è¿­ä»£ï¼Œwithç»“æ„æ›´æ–°å‚æ•°ï¼Œæ˜¾ç¤ºå½“å‰loss</li>
</ul>
</li>
<li>æµ‹è¯•æ•ˆæœ
<ul>
<li>è®¡ç®—å½“å‰å‚æ•°å‰å‘ä¼ æ’­åçš„å‡†ç¡®ç‡ï¼Œæ˜¾ç¤ºå½“å‰acc</li>
</ul>
</li>
<li>acc / loss å¯è§†åŒ–</li>
</ol>
<pre><code class="language-python"># -*- coding: UTF-8 -*-
# åˆ©ç”¨é¸¢å°¾èŠ±æ•°æ®é›†ï¼Œå®ç°å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­ï¼Œå¯è§†åŒ–lossæ›²çº¿

# å¯¼å…¥æ‰€éœ€æ¨¡å—
import tensorflow as tf
from sklearn import datasets
from matplotlib import pyplot as plt
import numpy as np

# å¯¼å…¥æ•°æ®ï¼Œåˆ†åˆ«ä¸ºè¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾
x_data = datasets.load_iris().data
y_data = datasets.load_iris().target

# éšæœºæ‰“ä¹±æ•°æ®ï¼ˆå› ä¸ºåŸå§‹æ•°æ®æ˜¯é¡ºåºçš„ï¼Œé¡ºåºä¸æ‰“ä¹±ä¼šå½±å“å‡†ç¡®ç‡ï¼‰
# seed: éšæœºæ•°ç§å­ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå½“è®¾ç½®ä¹‹åï¼Œæ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°éƒ½ä¸€æ ·ï¼ˆä¸ºæ–¹ä¾¿æ•™å­¦ï¼Œä»¥ä¿æ¯ä½åŒå­¦ç»“æœä¸€è‡´ï¼‰
np.random.seed(116)  # ä½¿ç”¨ç›¸åŒçš„seedï¼Œä¿è¯è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾ä¸€ä¸€å¯¹åº”
np.random.shuffle(x_data)
np.random.seed(116)
np.random.shuffle(y_data)
tf.random.set_seed(116)

# å°†æ‰“ä¹±åçš„æ•°æ®é›†åˆ†å‰²ä¸ºæ°¸ä¸ç›¸è§çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè®­ç»ƒé›†ä¸ºå‰120è¡Œï¼Œæµ‹è¯•é›†ä¸ºå30è¡Œ
x_train = x_data[:-30]
y_train = y_data[:-30]
x_test = x_data[-30:]
y_test = y_data[-30:]

# è½¬æ¢xçš„æ•°æ®ç±»å‹ï¼Œå¦åˆ™åé¢çŸ©é˜µç›¸ä¹˜æ—¶ä¼šå› æ•°æ®ç±»å‹ä¸ä¸€è‡´æŠ¥é”™
x_train = tf.cast(x_train, tf.float32)
x_test = tf.cast(x_test, tf.float32)

# from_tensor_sliceså‡½æ•°ä½¿è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾å€¼ä¸€ä¸€å¯¹åº”ã€‚ï¼ˆæŠŠæ•°æ®é›†åˆ†æ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡batchç»„æ•°æ®ï¼‰
train_db = tf.data.Dataset.from_tensor_slices((x_train, y_train)).batch(32)
test_db = tf.data.Dataset.from_tensor_slices((x_test, y_test)).batch(32)

# ç”Ÿæˆç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œ4ä¸ªè¾“å…¥ç‰¹å¾æ•…ï¼Œè¾“å…¥å±‚ä¸º4ä¸ªè¾“å…¥èŠ‚ç‚¹ï¼›å› ä¸º3åˆ†ç±»ï¼Œæ•…è¾“å‡ºå±‚ä¸º3ä¸ªç¥ç»å…ƒ
# ç”¨tf.Variable()æ ‡è®°å‚æ•°å¯è®­ç»ƒ
# ä½¿ç”¨seedä½¿æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°ç›¸åŒï¼ˆæ–¹ä¾¿æ•™å­¦ï¼Œä½¿å¤§å®¶ç»“æœéƒ½ä¸€è‡´ï¼Œåœ¨ç°å®ä½¿ç”¨æ—¶ä¸å†™seedï¼‰
w1 = tf.Variable(tf.random.truncated_normal([4, 3], stddev=0.1, seed=1))
b1 = tf.Variable(tf.random.truncated_normal([3], stddev=0.1, seed=1))

lr = 0.1  # å­¦ä¹ ç‡ä¸º0.1
train_loss_results = []  # å°†æ¯è½®çš„lossè®°å½•åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œä¸ºåç»­ç”»lossæ›²çº¿æä¾›æ•°æ®
test_acc = []  # å°†æ¯è½®çš„accè®°å½•åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œä¸ºåç»­ç”»accæ›²çº¿æä¾›æ•°æ®
epoch = 500  # å¾ªç¯500è½®
loss_all = 0  # æ¯è½®åˆ†4ä¸ªstepï¼Œloss_allè®°å½•å››ä¸ªstepç”Ÿæˆçš„4ä¸ªlossçš„å’Œ

# è®­ç»ƒéƒ¨åˆ†
for epoch in range(epoch):  #æ•°æ®é›†çº§åˆ«çš„å¾ªç¯ï¼Œæ¯ä¸ªepochå¾ªç¯ä¸€æ¬¡æ•°æ®é›†
    for step, (x_train, y_train) in enumerate(train_db):  #batchçº§åˆ«çš„å¾ªç¯ ï¼Œæ¯ä¸ªstepå¾ªç¯ä¸€ä¸ªbatch
        with tf.GradientTape() as tape:  # withç»“æ„è®°å½•æ¢¯åº¦ä¿¡æ¯
            y = tf.matmul(x_train, w1) + b1  # ç¥ç»ç½‘ç»œä¹˜åŠ è¿ç®—
            y = tf.nn.softmax(y)  # ä½¿è¾“å‡ºyç¬¦åˆæ¦‚ç‡åˆ†å¸ƒï¼ˆæ­¤æ“ä½œåä¸ç‹¬çƒ­ç åŒé‡çº§ï¼Œå¯ç›¸å‡æ±‚lossï¼‰
            y_ = tf.one_hot(y_train, depth=3)  # å°†æ ‡ç­¾å€¼è½¬æ¢ä¸ºç‹¬çƒ­ç æ ¼å¼ï¼Œæ–¹ä¾¿è®¡ç®—losså’Œaccuracy
            loss = tf.reduce_mean(tf.square(y_ - y))  # é‡‡ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°mse = mean(sum(y-out)^2)
            loss_all += loss.numpy()  # å°†æ¯ä¸ªstepè®¡ç®—å‡ºçš„lossç´¯åŠ ï¼Œä¸ºåç»­æ±‚losså¹³å‡å€¼æä¾›æ•°æ®ï¼Œè¿™æ ·è®¡ç®—çš„lossæ›´å‡†ç¡®
        # è®¡ç®—losså¯¹å„ä¸ªå‚æ•°çš„æ¢¯åº¦
        grads = tape.gradient(loss, [w1, b1])

        # å®ç°æ¢¯åº¦æ›´æ–° w1 = w1 - lr * w1_grad    b = b - lr * b_grad
        w1.assign_sub(lr * grads[0])  # å‚æ•°w1è‡ªæ›´æ–°
        b1.assign_sub(lr * grads[1])  # å‚æ•°bè‡ªæ›´æ–°

    # æ¯ä¸ªepochï¼Œæ‰“å°lossä¿¡æ¯
    print(&quot;Epoch {}, loss: {}&quot;.format(epoch, loss_all/4))
    train_loss_results.append(loss_all / 4)  # å°†4ä¸ªstepçš„lossæ±‚å¹³å‡è®°å½•åœ¨æ­¤å˜é‡ä¸­
    loss_all = 0  # loss_allå½’é›¶ï¼Œä¸ºè®°å½•ä¸‹ä¸€ä¸ªepochçš„lossåšå‡†å¤‡

    # æµ‹è¯•éƒ¨åˆ†
    # total_correctä¸ºé¢„æµ‹å¯¹çš„æ ·æœ¬ä¸ªæ•°, total_numberä¸ºæµ‹è¯•çš„æ€»æ ·æœ¬æ•°ï¼Œå°†è¿™ä¸¤ä¸ªå˜é‡éƒ½åˆå§‹åŒ–ä¸º0
    total_correct, total_number = 0, 0
    for x_test, y_test in test_db:
        # ä½¿ç”¨æ›´æ–°åçš„å‚æ•°è¿›è¡Œé¢„æµ‹
        y = tf.matmul(x_test, w1) + b1
        y = tf.nn.softmax(y)
        pred = tf.argmax(y, axis=1)  # è¿”å›yä¸­æœ€å¤§å€¼çš„ç´¢å¼•ï¼Œå³é¢„æµ‹çš„åˆ†ç±»
        # å°†predè½¬æ¢ä¸ºy_testçš„æ•°æ®ç±»å‹
        pred = tf.cast(pred, dtype=y_test.dtype)
        # è‹¥åˆ†ç±»æ­£ç¡®ï¼Œåˆ™correct=1ï¼Œå¦åˆ™ä¸º0ï¼Œå°†boolå‹çš„ç»“æœè½¬æ¢ä¸ºintå‹
        correct = tf.cast(tf.equal(pred, y_test), dtype=tf.int32)
        # å°†æ¯ä¸ªbatchçš„correctæ•°åŠ èµ·æ¥
        correct = tf.reduce_sum(correct)
        # å°†æ‰€æœ‰batchä¸­çš„correctæ•°åŠ èµ·æ¥
        total_correct += int(correct)
        # total_numberä¸ºæµ‹è¯•çš„æ€»æ ·æœ¬æ•°ï¼Œä¹Ÿå°±æ˜¯x_testçš„è¡Œæ•°ï¼Œshape[0]è¿”å›å˜é‡çš„è¡Œæ•°
        total_number += x_test.shape[0]
    # æ€»çš„å‡†ç¡®ç‡ç­‰äºtotal_correct/total_number
    acc = total_correct / total_number
    test_acc.append(acc)
    print(&quot;Test_acc:&quot;, acc)
    print(&quot;--------------------------&quot;)

# ç»˜åˆ¶ loss æ›²çº¿
plt.title('Loss Function Curve')  # å›¾ç‰‡æ ‡é¢˜
plt.xlabel('Epoch')  # xè½´å˜é‡åç§°
plt.ylabel('Loss')  # yè½´å˜é‡åç§°
plt.plot(train_loss_results, label=&quot;$Loss$&quot;)  # é€ç‚¹ç”»å‡ºtrian_loss_resultså€¼å¹¶è¿çº¿ï¼Œè¿çº¿å›¾æ ‡æ˜¯Loss
plt.legend()  # ç”»å‡ºæ›²çº¿å›¾æ ‡
plt.show()  # ç”»å‡ºå›¾åƒ

# ç»˜åˆ¶ Accuracy æ›²çº¿
plt.title('Acc Curve')  # å›¾ç‰‡æ ‡é¢˜
plt.xlabel('Epoch')  # xè½´å˜é‡åç§°
plt.ylabel('Acc')  # yè½´å˜é‡åç§°
plt.plot(test_acc, label=&quot;$Accuracy$&quot;)  # é€ç‚¹ç”»å‡ºtest_accå€¼å¹¶è¿çº¿ï¼Œè¿çº¿å›¾æ ‡æ˜¯Accuracy
plt.legend()
plt.show()

# è¿è¡Œç»“æœ
# --------------------------
# Epoch 498, loss: 0.03232626663520932
# Test_acc: 1.0
# --------------------------
# Epoch 499, loss: 0.032300274819135666
# Test_acc: 1.0
# --------------------------
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Deep Reinforcement Learning in a Handful of Trials using Probabilistic Dynamics Models]]></title>
        <id>https://perfectqing.github.io/blogs/post/Deep Reinforcement Learning in a Handful of Trials using Probabilistic Dynamics Models/</id>
        <link href="https://perfectqing.github.io/blogs/post/Deep Reinforcement Learning in a Handful of Trials using Probabilistic Dynamics Models/">
        </link>
        <updated>2021-06-11T07:00:00.000Z</updated>
        <content type="html"><![CDATA[<h1 id="deep-reinforcement-learning-in-a-handful-of-trials-using-probabilistic-dynamics-models">Deep Reinforcement Learning in a Handful of Trials using Probabilistic Dynamics Models</h1>
<h2 id="æ‘˜è¦">æ‘˜è¦ï¼š</h2>
<p>åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•å¯ä»¥è·å¾—å¾ˆå¥½çš„æ ·æœ¬æ•ˆç‡ï¼Œä½†åœ¨æ¸è¿‘æ€§èƒ½æ–¹é¢å¾€å¾€è½åäºæœ€ä½³çš„æ— æ¨¡å‹ç®—æ³•ã€‚å¯¹äºå¤§å®¹é‡å‚æ•°å‡½æ•°é€¼è¿‘å™¨ï¼Œä¾‹å¦‚æ·±åº¦ç½‘ç»œï¼Œå°¤å…¶å¦‚æ­¤ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•<strong>é€šè¿‡ä½¿ç”¨ä¸ç¡®å®šæ€§æ„ŸçŸ¥åŠ¨æ€æ¨¡å‹æ¥å¼¥åˆè¿™ä¸€å·®è·</strong>ã€‚æˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„ç®—æ³•ï¼Œç§°ä¸ºå¸¦è½¨è¿¹é‡‡æ ·çš„æ¦‚ç‡é›†æˆï¼ˆ<strong>PETS</strong>ï¼‰ï¼Œå®ƒå°†ä¸ç¡®å®šæ€§æ„ŸçŸ¥çš„æ·±å±‚ç½‘ç»œåŠ¨æ€æ¨¡å‹ä¸åŸºäºé‡‡æ ·çš„ä¸ç¡®å®šæ€§ä¼ æ’­ç›¸ç»“åˆã€‚æˆ‘ä»¬ä¸æœ€å…ˆè¿›çš„åŸºäºæ¨¡å‹å’Œæ— æ¨¡å‹çš„æ·±åº¦é€†å‘ç‰©æµç®—æ³•çš„æ¯”è¾ƒè¡¨æ˜ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åœ¨å‡ ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„åŸºå‡†ä»»åŠ¡ä¸Šä¸æ— æ¨¡å‹ç®—æ³•çš„æ¸è¿‘æ€§èƒ½ç›¸åŒ¹é…ï¼ŒåŒæ—¶<strong>éœ€è¦çš„æ ·æœ¬æ˜æ˜¾æ›´å°‘</strong>ï¼ˆä¾‹å¦‚ï¼Œåœ¨<em><strong>half-cheetah*** ä»»åŠ¡ä¸Šï¼Œåˆ†åˆ«æ¯”</strong>SAC</em>*(Soft Actor Critic )å’Œ<strong>Proximal Policy Optimization</strong> å°‘8å€å’Œ125å€ï¼‰ã€‚</p>
<h2 id="1-introduction">1 Introduction</h2>
<p>å¼ºåŒ–å­¦ä¹ ç®—æ³•ä¸ºå†³ç­–å’Œæ§åˆ¶æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–æ¡†æ¶ï¼šé€šè¿‡æŒ‡å®šä¸€ä¸ªæ›´é«˜çº§ç›®æ ‡å‡½æ•°ï¼Œå¼ºåŒ–å­¦ä¹ ç®—æ³•åŸåˆ™ä¸Šå¯ä»¥è‡ªåŠ¨å­¦ä¹ æ»¡è¶³è¯¥ç›®æ ‡çš„æ§åˆ¶ç­–ç•¥ã€‚ç„¶è€Œï¼Œç›®å‰çš„æ— æ¨¡å‹å¼ºåŒ–å­¦ä¹ ç®—æ³•<strong>è®­ç»ƒæˆæœ¬ç›¸å½“é«˜</strong>ï¼Œè¿™å¾€å¾€é™åˆ¶äº†å®ƒä»¬åœ¨æ¨¡æ‹Ÿé¢†åŸŸçš„åº”ç”¨ã€‚é™ä½æ ·æœ¬å¤æ‚æ€§çš„ä¸€ä¸ªæœ‰å‰é€”çš„æ–¹å‘æ˜¯æ¢ç´¢åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ (<strong>MBRL</strong>)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é¦–å…ˆè·å–ä¸–ç•Œçš„é¢„æµ‹æ¨¡å‹ï¼Œç„¶åä½¿ç”¨è¯¥æ¨¡å‹è¿›è¡Œå†³ç­–ã€‚ç„¶è€Œï¼ŒMBRLæ–¹æ³•åœ¨æ™®é€šåŸºå‡†ä»»åŠ¡ä¸Šçš„æ¸è¿‘æ€§èƒ½é€šå¸¸è½åäºæ— æ¨¡å‹æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶MBRLæ–¹æ³•å¾€å¾€å­¦ä¹ å¾—æ›´å¿«ï¼Œä½†å®ƒä»¬ä¹Ÿå¾€å¾€æ”¶æ•›åˆ°ä¸å¤ªç†æƒ³çš„è§£ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æœç€ç¼©å°åŸºäºæ¨¡å‹å’Œæ— æ¨¡å‹çš„RLæ–¹æ³•ä¹‹é—´çš„å·®è·è¿ˆå‡ºäº†ä¸€æ­¥ã€‚æˆ‘ä»¬çš„æ–¹æ³•åŸºäºå‡ ä¸ªè§‚å¯Ÿï¼Œè™½ç„¶ç›¸å¯¹ç®€å•ï¼Œä½†å¯¹äºè‰¯å¥½çš„æ€§èƒ½è‡³å…³é‡è¦ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆè§‚å¯Ÿåˆ°ï¼Œ<strong>æ¨¡å‹å®¹é‡</strong>æ˜¯MBRLæ–¹æ³•æˆåŠŸçš„å…³é”®å› ç´ ï¼šè™½ç„¶é«˜æ•ˆæ¨¡å‹(å¦‚é«˜æ–¯è¿‡ç¨‹)å¯ä»¥éå¸¸å¿«é€Ÿåœ°å­¦ä¹ ï¼Œä½†å®ƒä»¬å¾ˆéš¾è¡¨ç¤ºéå¸¸å¤æ‚å’Œä¸è¿ç»­çš„åŠ¨æ€ç³»ç»Ÿã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¥ç»ç½‘ç»œæ¨¡å‹å¯ä»¥æ‰©å±•åˆ°å…·æœ‰é«˜ç»´è¾“å…¥çš„å¤§æ•°æ®é›†ï¼Œå¹¶ä¸”å¯ä»¥æ›´æœ‰æ•ˆåœ°è¡¨ç¤ºè¿™æ ·çš„ç³»ç»Ÿã€‚ç„¶è€Œï¼Œç¥ç»ç½‘ç»œé¢ä¸´ç€ç›¸åçš„é—®é¢˜ï¼šå¿«é€Ÿå­¦ä¹ æ„å‘³ç€ç”¨å¾ˆå°‘çš„æ•°æ®å­¦ä¹ ï¼Œç¥ç»ç½‘ç»œå€¾å‘äºåœ¨å°æ•°æ®é›†ä¸Šè¿‡åº¦å­¦ä¹ ï¼Œå¯¹æœªæ¥åšå‡ºç³Ÿç³•çš„é¢„æµ‹ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼ŒMBRLä¸å›½å®¶æ ¸è®¡åˆ’å·²è¢«è¯æ˜æ ¼å¤–å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</p>
<p>æˆ‘ä»¬çš„ç¬¬äºŒä¸ªè§‚å¯Ÿæ˜¯ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé€šè¿‡å°†<strong>ä¸ç¡®å®šæ€§</strong>é€‚å½“åœ°çº³å…¥åŠ¨æ€æ¨¡å‹æ¥ç¼“è§£ã€‚æˆ‘ä»¬çš„å·¥ä½œæ˜¯ç¬¬ä¸€ä¸ªå°†è¿™äº›ç»„ä»¶èšé›†åœ¨ä¸€ä¸ªæ·±åº¦MBRLæ¡†æ¶ä¸­ï¼Œè¯¥æ¡†æ¶åœ¨åŸºå‡†æ§åˆ¶ä»»åŠ¡ä¸Šè¾¾åˆ°äº†æœ€å…ˆè¿›çš„æ— æ¨¡å‹RLæ–¹æ³•çš„æ¸è¿‘æ€§èƒ½ã€‚</p>
<p>æˆ‘ä»¬çš„ä¸»è¦è´¡çŒ®æ˜¯ä¸€ä¸ªåä¸ºâ€œè½¨è¿¹é‡‡æ ·æ¦‚ç‡é›†æˆ(PETS)â€çš„MBRLç®—æ³•ï¼Œè¯¥ç®—æ³•é‡‡ç”¨å¤§å®¹é‡ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œé€šè¿‡è‡ªä¸¾æ¨¡å‹<strong>é›†æˆä¸ç¡®å®šæ€§</strong>ï¼Œå…¶ä¸­æ¯ä¸ªæ¨¡å‹ç¼–ç åˆ†å¸ƒ(ä¸ç‚¹é¢„æµ‹ç›¸å)ï¼Œåœ¨æ ‡å‡†åŸºå‡†æ§åˆ¶ä»»åŠ¡ä¸Šä»¥æ ·æœ¬å¤æ‚æ€§çš„ä¸€å°éƒ¨åˆ†ä¸æ— æ¨¡å‹æ–¹æ³•çš„æ€§èƒ½ç›¸åª²ç¾ã€‚PETS<strong>ä¼˜äº</strong>ç°æœ‰æ¦‚ç‡MBRLç®—æ³•çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯èƒ½å¤Ÿéš”ç¦»ä¸¤ç§ä¸åŒç±»å‹çš„ä¸ç¡®å®šæ€§ï¼š<strong>ä»»æ„æ€§</strong>(å›ºæœ‰çš„ç³»ç»Ÿéšæœºæ€§)å’Œ<strong>è®¤çŸ¥æ€§</strong>(ç”±äºæ•°æ®æœ‰é™ï¼Œä¸»è§‚ä¸ç¡®å®šæ€§)ã€‚éš”ç¦»è®¤çŸ¥ä¸ç¡®å®šæ€§å¯¹äºæŒ‡å¯¼æ¢ç´¢ç‰¹åˆ«æœ‰ç”¨ï¼Œå°½ç®¡æˆ‘ä»¬å°†æ­¤ç•™ç»™æœªæ¥çš„å·¥ä½œã€‚æœ€åï¼Œæˆ‘ä»¬ç³»ç»Ÿåœ°åˆ†æäº†åœ¨æ¨¡å‹è®­ç»ƒå’Œè§„åˆ’è¿‡ç¨‹ä¸­ï¼Œå°†ä¸ç¡®å®šæ€§å¼•å…¥MBRLç¥ç»ç½‘ç»œå¦‚ä½•å½±å“æ€§èƒ½ã€‚æˆ‘ä»¬è¡¨æ˜ï¼ŒPETSå¯¹ä¸ç¡®å®šæ€§çš„ç‰¹æ®Šå¤„ç†æ˜¾è‘—å‡å°‘äº†å­¦ä¹ ä»»åŠ¡æ‰€éœ€çš„æ•°æ®é‡ã€‚</p>
<h2 id="2-related-work">2 Related work</h2>
<h2 id="3-model-based-reinforcement-learning">3 Model-based reinforcement learning</h2>
<p>ä»‹ç»åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç›¸å…³å†…å®¹ã€‚</p>
<p>ä¸€æ—¦æˆ‘ä»¬å­¦ä¹ åˆ°åŠ¨æ€æ¨¡å‹åï¼Œæˆ‘ä¹ˆå°±å¯ä»¥é€šè¿‡å­¦ä¹ åˆ°çš„è¿™ä¸ªæ¨¡å‹å»é¢„æµ‹ä¸€ç³»åˆ—åŠ¨ä½œæ‰€äº§ç”Ÿçš„çŠ¶æ€è½¨è¿¹çš„åˆ†å¸ƒã€‚é€šè¿‡è®¡ç®—çŠ¶æ€è½¨è¿¹ä¸Šçš„æœŸæœ›å›æŠ¥ï¼Œæˆ‘ä»¬å¯ä»¥è¯„ä¼°å¤šä¸ªå€™é€‰åŠ¨ä½œåºåˆ—ï¼Œå¹¶é€‰æ‹©æœ€ä½³åŠ¨ä½œåºåˆ—æ¥ä½¿ç”¨ã€‚</p>
<h2 id="4-uncertainty-aware-neural-network-dynamics-models">4 Uncertainty-aware neural network dynamics models</h2>
<p>æœ¬èŠ‚æè¿°äº†å‡ ç§æ–¹æ³•æ¥æ¨¡æ‹Ÿä»»åŠ¡çš„çœŸå®ï¼ˆä½†æœªçŸ¥çš„ï¼‰åŠ¨æ€å‡½æ•°ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„æ–¹æ³•ï¼šè‡ªä¸¾æ¦‚ç‡ç¥ç»ç½‘ç»œçš„é›†æˆ**ï¼ˆan ensemble of bootstrapped probabilistic neural networksï¼‰**ã€‚</p>
<p>è™½ç„¶ä¸ç¡®å®šæ€§æ„è¯†åŠ¨æ€æ¨¡å‹å·²ç»åœ¨è®¸å¤šå…ˆå‰çš„å·¥ä½œä¸­è¿›è¡Œäº†æ¢ç´¢ï¼Œä½†æ˜¯å…³äºä¸ç¡®å®šæ€§çš„å¼•å…¥çš„å®æ–½å’Œè®¾è®¡å†³ç­–çš„<strong>å…·ä½“ç»†èŠ‚</strong>è¿˜æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„ç»éªŒåˆ†æã€‚å› æ­¤ï¼Œå…ˆå‰çš„å·¥ä½œå·²ç»æ™®éå‘ç°ï¼Œè¡¨è¾¾æ€§å‚æ•°æ¨¡å‹ï¼Œä¾‹å¦‚æ·±åº¦ç¥ç»ç½‘ç»œï¼Œ<strong>ä¸€èˆ¬ä¸ä¼šäº§ç”ŸåŸºäºæ¨¡å‹çš„RLç®—æ³•</strong>ï¼Œè¿™äº›ç®—æ³•åœ¨æ¸è¿‘æ€§èƒ½æ–¹é¢ä¸å…¶æ— æ¨¡å‹çš„å¯¹åº”ç‰©ç›¸ç«äº‰ï¼Œå¹¶ä¸”ç»å¸¸ç”šè‡³å‘ç°æ›´ç®€å•çš„æ—¶å˜çº¿æ€§æ¨¡å‹å¯ä»¥ä¼˜äºè¡¨è¾¾æ€§ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p>
<p>ä¸€ä¸ªä¸»è¦çš„æŒ‘æˆ˜æ˜¯å»ºç«‹ä¸€ä¸ªåœ¨ä½å’Œé«˜æ•°æ®çŠ¶æ€ä¸‹è¡¨ç°è‰¯å¥½çš„æ¨¡å‹ï¼šåœ¨è®­ç»ƒçš„æ—©æœŸé˜¶æ®µï¼Œæ•°æ®æ˜¯ç¨€ç¼ºçš„ï¼Œå¹¶ä¸”é«˜è¡¨è¾¾çš„å‡½æ•°é€¼è¿‘å™¨å®¹æ˜“è¿‡æ‹Ÿåˆï¼›åœ¨è®­ç»ƒçš„åæœŸé˜¶æ®µï¼Œæ•°æ®æ˜¯ä¸°å¯Œçš„ï¼Œä½†æ˜¯å¯¹äºå…·æœ‰å¤æ‚åŠ¨æ€çš„ç³»ç»Ÿï¼Œç®€å•çš„å‡½æ•°é€¼è¿‘å™¨å¯èƒ½ä¼šä¸è¶³ï¼ˆæ‹Ÿåˆä¸å¤Ÿï¼‰ã€‚</p>
<p>åœ¨è¿™ç¯‡è®ºæ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶å¦‚ä½•å°†è¡¨è¾¾æ€§çš„ç¥ç»ç½‘ç»œçº³å…¥MBRLã€‚ä¸ºäº†è§£é‡Šä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬ç ”ç©¶äº†æ¨¡æ‹Ÿä¸¤ç§ä¸ç¡®å®šæ€§çš„ç¥ç»ç½‘ç»œã€‚ç¬¬ä¸€ç§ç±»å‹ï¼Œ<strong>éšæœºä¸ç¡®å®šæ€§</strong>ï¼Œæºäºç³»ç»Ÿå›ºæœ‰çš„éšæœºæ€§ï¼Œä¾‹å¦‚è§‚å¯Ÿå™ªå£°å’Œè¿‡ç¨‹å™ªå£°ã€‚éšæœºä¸ç¡®å®šæ€§å¯ä»¥é€šè¿‡è¾“å‡ºå‚æ•°åŒ–åˆ†å¸ƒçš„å‚æ•°æ¥æ•è·ï¼ŒåŒæ—¶ä»ç„¶æœ‰åŒºåˆ«åœ°è®­ç»ƒç½‘ç»œã€‚ç¬¬äºŒç§ç±»å‹â€”â€”<strong>è®¤çŸ¥ä¸ç¡®å®šæ€§</strong>â€”â€”å¯¹åº”äºå¯¹åŠ¨æ€åŠŸèƒ½çš„ä¸»è§‚ä¸ç¡®å®šæ€§ï¼Œå› ä¸ºç¼ºä¹è¶³å¤Ÿçš„æ•°æ®æ¥å”¯ä¸€å‡†ç¡®åœ°ç¡®å®šåº•å±‚ç³»ç»Ÿã€‚åœ¨æ— é™æ•°æ®çš„é™åˆ¶ä¸‹ï¼Œè®¤çŸ¥ä¸ç¡®å®šæ€§åº”è¯¥æ¶ˆå¤±ï¼Œä½†æ˜¯å¯¹äºæœ‰é™å¤§å°çš„æ•°æ®é›†ï¼Œé¢„æµ‹è½¬æ¢æ—¶ä¸»è§‚ä¸ç¡®å®šæ€§ä»ç„¶å­˜åœ¨ã€‚æ­£æ˜¯è´å¶æ–¯å»ºæ¨¡æ“…é•¿çš„ä¸»è§‚è®¤çŸ¥ä¸ç¡®å®šæ€§æœ‰åŠ©äºå‡è½»è¿‡åº¦æ‹Ÿåˆã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æè¿°å¦‚ä½•ä½¿ç”¨â€œæ¦‚ç‡ç½‘ç»œâ€çš„ç»„åˆæ¥æ•æ‰éšæœºä¸ç¡®å®šæ€§ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨â€œé›†åˆâ€æ¥æ•æ‰è®¤çŸ¥ä¸ç¡®å®šæ€§ã€‚è¡¨1æ€»ç»“äº†æ¯ç§ç»„åˆã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[TensorFlow2.0 å­¦ä¹ ç¬”è®°]]></title>
        <id>https://perfectqing.github.io/blogs/post/tf_learning/</id>
        <link href="https://perfectqing.github.io/blogs/post/tf_learning/">
        </link>
        <updated>2021-06-11T06:36:00.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€ç« ">ç¬¬ä¸€ç« </h1>
<h1 id="ç¬¬äºŒç« ">ç¬¬äºŒç« </h1>
<h2 id="21-å¸¸è§å‡½æ•°">2.1 å¸¸è§å‡½æ•°</h2>
<h3 id="tfwhere">tf.where()</h3>
<p>æ¡ä»¶è¯­å¥çœŸè¿”å›A,æ¡ä»¶è¯­å¥å‡è¿”å›B</p>
<p>tf.where(æ¡ä»¶è¯­å¥, çœŸè¿”å›A, å‡è¿”å›B)</p>
<pre><code class="language-python">import tensorflow as tf

a = tf.constant([1, 2, 3, 1, 1])
b = tf.constant([0, 1, 3, 4, 5])
c = tf.where(tf.greater(a, b), a, b)  # è‹¥ a &gt; b, è¿”å› a å¯¹åº”ä½ç½®çš„å…ƒç´ ,å¦åˆ™è¿”å› b å¯¹åº”çš„å…ƒç´ 
print('c:', c)
</code></pre>
<pre><code class="language-python">è¿è¡Œç»“æœ:
c: tf.Tensor([1 2 3 4 5], shape=(5,), dtype=int32)
</code></pre>
<h3 id="nprandomrandomstaterand">np.random.RandomState.rand()</h3>
<p>è¿”å›ä¸€ä¸ª [0, 1) ä¹‹é—´çš„éšæœºæ•°<br>
np.random.RandomState.rand(ç»´åº¦)  # ç»´åº¦ä¸ºç©ºï¼Œè¿”å›æ ‡é‡</p>
<pre><code class="language-python">import numpy as np
rdm = np.random.RandomState(seed=1)  # seed å®šä¹‰ç”Ÿæˆéšæœºæ•°
a = rdm.rand()  # è¿”å›ä¸€ä¸ªæ ‡é‡
b = rdm.rand(2, 3) # è¿”å›ç»´åº¦ä¸º2è¡Œ3åˆ—éšæœºæ•°çŸ©é˜µ
print('a:', a)
print('b:', b)
</code></pre>
<pre><code>è¿è¡Œç»“æœ:
a: 0.417022004702574
b: [[7.20324493e-01 1.14374817e-04 3.02332573e-01]
	[1.46755891e-01 9.23385948e-02 1.86260211e-01]]
</code></pre>
<h3 id="npvstack">np.vstack()</h3>
<p>å°†ä¸¤ä¸ªæ•°ç»„æŒ‰å‚ç›´æ–¹å‘å åŠ </p>
<p>np.vstack(æ•°ç»„1ï¼Œ æ•°ç»„2)</p>
<pre><code class="language-python">import numpy as np
a = np.array([1, 2, 3])
b = np.array([4, 5, 6])
c = np.vstack((a, b))
print('c:', c)
</code></pre>
<pre><code>è¿è¡Œç»“æœ:
c: [[1 2 3]
 	[4 5 6]]
</code></pre>
<h3 id="npmgrid-ravle-npc_">np.mgrid[]   .ravle()    np.c_[]</h3>
<p>np.mgrid[]            [èµ·å§‹å€¼, ç»“æŸå€¼)</p>
<p>np.mgrid[èµ·å§‹å€¼: ç»“æŸå€¼: æ­¥é•¿, èµ·å§‹å€¼: ç»“æŸå€¼: æ­¥é•¿, ...]</p>
<p>.ravle()   å°†xå˜ä¸ºä¸€ç»´æ•°ç»„ï¼Œâ€æŠŠ .å‰å˜é‡æ‹‰ç›´â€œ</p>
<p>np.c_[]  ä½¿è¿”å›çš„é—´éš”æ•°å€¼ç‚¹é…å¯¹</p>
<p>np.c_[æ•°ç»„1, æ•°ç»„2, ...]</p>
<pre><code class="language-python">import numpy as np
x, y = np.mgrid[1: 3: 1, 2: 4: 0.5]
grid = np.c_[x.ravel(), y.ravel()]
print('x:', x)
print('y:', y)
print('grid:\n', grid)
</code></pre>
<pre><code>è¿è¡Œç»“æœ:
x: [[1. 1. 1. 1.]
	[2. 2. 2. 2.]]
y: [[2.  2.5 3.  3.5]
	[2.  2.5 3.  3.5]]
grid:
 [[1.  2. ]
  [1.  2.5]
  [1.  3. ]
  [1.  3.5]
  [2.  2. ]
  [2.  2.5]
  [2.  3. ]
  [2.  3.5]]
</code></pre>
<h2 id="22-ç¥ç»ç½‘ç»œçš„å¤æ‚åº¦">2.2 ç¥ç»ç½‘ç»œçš„å¤æ‚åº¦</h2>
<p>âœ”ï¸ NNå¤æ‚åº¦ï¼šå¤šç”¨NNå±‚æ•°å’ŒNNå‚æ•°çš„ä¸ªæ•°è¡¨ç¤º</p>
<figure data-type="image" tabindex="1"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210315213822119.png" alt="image-20210315213822119" loading="lazy"></figure>
<p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong></p>
<p>âœ”ï¸ å±‚æ•° = éšè—å±‚çš„å±‚æ•° + 1ä¸ªè¾“å‡ºå±‚</p>
<p><u>ä¸Šå›¾ä¸º2å±‚NN</u></p>
<p>âœ”ï¸ æ€»å‚æ•° = æ€»w + æ€»b</p>
<p><u>ä¸Šå›¾ä¸º3 * 4 + 4 + 4 * 2 + 2 = 26</u></p>
<p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p>
<p>âœ”ï¸ ä¹˜åŠ è¿ç®—æ¬¡æ•°</p>
<p><u>ä¸Šå›¾ 3 * 4 + 4 * 2 = 20</u></p>
<h2 id="23-å­¦ä¹ ç‡">2.3 å­¦ä¹ ç‡</h2>
<p>å­¦ä¹ ç‡lr=0.001è¿‡æ…¢, lr=0.999ä¸æ”¶æ•›</p>
<p><strong>æŒ‡æ•°è¡°å‡å­¦ä¹ ç‡</strong></p>
<p>å¯ä»¥å…ˆç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡ï¼Œå¿«é€Ÿå¾—åˆ°è¾ƒä¼˜è§£ï¼Œç„¶åé€æ­¥å‡å°å­¦ä¹ ç‡ï¼Œä½¿æ¨¡å‹åœ¨è®­ç»ƒåæœŸç¨³å®šã€‚</p>
<p>æŒ‡æ•°è¡°å‡å­¦ä¹ ç‡ = åˆå§‹å­¦ä¹ ç‡ * å­¦ä¹ è¡°å‡ç‡ ^ (å½“å‰è½®æ•° / å¤šå°‘è½®è¡°å‡ä¸€æ¬¡)</p>
<pre><code class="language-python">epoch = 40
LR_BASE = 0.2
LRDECAY = 0.99
LR_STEP = 1

for epoch in range(epoch):
    lr = LR_BASE * LR_DECAY  ** (epoch / LR_STEP)
    with tf.GradientTape() as tape:
        loss = tf.square(w + 1)
    grads = tape.gradient(loss, w)
    
    w.assign_sub(lr * grads)
    print(&quot;After %s epoch, w is %f, loss is %f, lr is %f&quot; % (epoch, w.numpy(), loss, lr))
</code></pre>
<h2 id="24-æ¿€æ´»å‡½æ•°">2.4 æ¿€æ´»å‡½æ•°</h2>
<p>âœ”ï¸ Sigmoidå‡½æ•°</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">f(x)=\frac{1}{1+e^{-x}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>tf.nn.sig,oid(x)  # å°†è¾“å…¥å€¼å˜æ¢åˆ° (0, 1) ä¹‹é—´è¾“å‡º</p>
<figure data-type="image" tabindex="2"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316090549966.png" alt="image-20210316090549966" loading="lazy"></figure>
<p>âœ”ï¸ Tanhå‡½æ•°</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mfrac><mrow><mn>1</mn><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mn>2</mn><mi>x</mi></mrow></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mn>2</mn><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">f(x)=\frac{1-e^{-2x}}{1+e^{-2x}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">2</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">2</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>tf.math.tanh(x)</p>
<figure data-type="image" tabindex="3"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316091148114.png" alt="image-20210316091148114" loading="lazy"></figure>
<p>ç‰¹ç‚¹</p>
<ol>
<li>è¾“å‡ºæ˜¯0å‡å€¼</li>
<li>æ˜“é€ æˆæ¢¯åº¦æ¶ˆå¤±</li>
<li>å¹‚è¿ç®—å¤æ‚ï¼Œè®­ç»ƒæ—¶é—´é•¿</li>
</ol>
<p>âœ”ï¸ Reluå‡½æ•°</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mn>0</mn><mo>)</mo><mo>=</mo></mrow><annotation encoding="application/x-tex">f(x)=max(x, 0)=
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span></span></p>
<p>tf.nn.relu(x)</p>
<figure data-type="image" tabindex="4"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316091544443.png" alt="image-20210316091544443" loading="lazy"></figure>
<p>âœ”ï¸ Leaky Relu</p>
<p>tf.nn.leaky_relu(x)</p>
<figure data-type="image" tabindex="5"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316091802144.png" alt="image-20210316091802144" loading="lazy"></figure>
<p><strong>å¯¹äºåˆå­¦è€…çš„å»ºè®®</strong></p>
<figure data-type="image" tabindex="6"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316091926516.png" alt="image-20210316091926516" loading="lazy"></figure>
<p>âœ”ï¸ æŸå¤±å‡½æ•° (loss): é¢„æµ‹å€¼ (y) ä¸å·²çŸ¥ç­”æ¡ˆ (y_) çš„å·®è·</p>
<p>NNä¼˜åŒ–ç›®æ ‡ï¼š lossæœ€å°</p>
<ul>
<li>mse(Mean Squared Error)</li>
<li>è‡ªå®šä¹‰</li>
<li>ce(Cross Entropy)  # äº¤å‰ç†µ</li>
</ul>
<p>âœ”ï¸ å‡æ–¹è¯¯å·® mse</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>S</mi><mi>E</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mfrac><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo>(</mo><mi>y</mi><mo>âˆ’</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">MSE({y_\_},y)=\frac{\sum_{i=1}^n (y - y_\_)^2}{n}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.257108em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5711080000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.757em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>loss_mse = tf.reduce_mean(tf.square(y_ -  y))</p>
<figure data-type="image" tabindex="7"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316092407331.png" alt="image-20210316092407331" loading="lazy"></figure>
<p>ğŸ’¬ Example</p>
<p>é¢„æµ‹é…¸å¥¶æ—¥é”€é‡y, x1, x2 æ˜¯å½±å“æ—¥é”€é‡çš„å› ç´ ã€‚</p>
<p>å»ºæ¨¡å‰ï¼Œåº”é¢„å…ˆé‡‡é›†çš„æ•°æ®æœ‰ï¼šæ¯æ—¥x1ã€x2å’Œé”€é‡y_ ï¼ˆå³å·²çŸ¥ç­”æ¡ˆï¼Œæœ€ä½³æƒ…å†µï¼šäº§é‡=é”€é‡ï¼‰</p>
<p>æ‹Ÿé€ æ•°æ®é›†X, Y_: y_ = x1 + x2   å™ªå£°ï¼š-0.05 ~ +0.05   æ‹Ÿåˆå¯ä»¥é¢„æµ‹é”€é‡çš„å‡½æ•°</p>
<pre><code class="language-python">import tensorflow as tf
import numpy as np

SEED = 23455

rdm = np.random.RandomState(seed=SEED)

x = rdm.rand(32, 2)

y_ = [[x1 + x2 + (rdm.rand() / 10.0 - 0.05)] for x1, x2 in x]  # ç”Ÿæˆå™ªå£°[0, 1) / 10 = [0, 0.1)

x = tf.cast(x, dtype=tf.float32)

w1 = tf.Variable(tf.random.normal([2, 1], stddev=1, seed=1))

epoch = 15000
lr = 0.002

for epoch in range(epoch):
    with tf.GradientTape() as tape:
        y = tf.matmul(x, w1)
        loss_mse = tf.reduce_mean(tf.square(y_ - y))
    
    grads = tape.gradient(loss_mse, w1)
    w1.assign_sub(lr * grads)

    if epoch % 500 == 0:
        print(&quot;After %d training steps, w1 is &quot; % (epoch))
        print(w1.numpy())
print('Final w1 is:\n', w1.numpy())
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
After 14500 training steps, w1 is 
[[1.0002553 ]
 [0.99838644]]
Final w1 is:
 [[1.0009792]
  [0.9977485]]
</code></pre>
<p>âœ”ï¸ è‡ªå®šä¹‰æŸå¤±å‡½æ•°ï¼š</p>
<p>å¦‚é¢„æµ‹å•†å“é”€é‡ï¼Œé¢„æµ‹å¤šäº†ï¼ŒæŸå¤±æˆæœ¬ï¼Œé¢„æµ‹å°‘äº†ï¼ŒæŸå¤±åˆ©æ¶¦ã€‚</p>
<p>è‹¥åˆ©æ¶¦ â‰  æˆæœ¬ï¼Œåˆ™ mse äº§ç”Ÿçš„ loss æ— æ³•åˆ©ç›Šæœ€å¤§åŒ–</p>
<p>è‡ªå®šä¹‰æŸå¤±å‡½æ•°  loss(y_, y) =</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><munder><mo>âˆ‘</mo><mi>n</mi></munder><mrow><mi>f</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">loss(y_\_,y)=\sum_{n}{f(y_\_,y)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3000100000000003em;vertical-align:-1.250005em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></span></p>
<figure data-type="image" tabindex="8"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316094809367.png" alt="image-20210316094809367" loading="lazy"></figure>
<p>âœ”ï¸ äº¤å‰ç†µæŸå¤±å‡½æ•° CE (Cross Entropy): è¡¨å¾ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo>(</mo><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mo>âˆ’</mo><mo>âˆ‘</mo><mrow><msub><mi>y</mi><mi mathvariant="normal">_</mi></msub><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mi>y</mi></mrow></mrow><annotation encoding="application/x-tex">H(y_\_,y)=-\sum{y_\_*\ln y}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.065608em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight" style="margin-right:0.02778em;">_</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span></span></span></p>
<p>eg. äºŒåˆ†ç±»å·²çŸ¥ç­”æ¡ˆ y_ = (1, 0)    é¢„æµ‹ y1=(0.6, 0.5)  y2 = (0.8, 0.2), å“ªä¸ªæ›´æ¥è¿‘æ ‡å‡†ç­”æ¡ˆï¼Ÿ</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mn>1</mn></msub><mo>(</mo><mo>(</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>0.6</mn><mo separator="true">,</mo><mn>0.4</mn><mo>)</mo><mo>)</mo><mo>=</mo><mo>âˆ’</mo><mo>(</mo><mn>1</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.6</mn><mo>+</mo><mn>0</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.4</mn><mo>)</mo><mo>â‰ˆ</mo><mo>âˆ’</mo><mo>(</mo><mo>âˆ’</mo><mn>0.511</mn><mo>+</mo><mn>0</mn><mo>)</mo><mo>=</mo><mn>0.511</mn><mspace linebreak="newline"></mspace><msub><mi>H</mi><mn>2</mn></msub><mo>(</mo><mo>(</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo>)</mo><mo separator="true">,</mo><mo>(</mo><mn>0.8</mn><mo separator="true">,</mo><mn>0.2</mn><mo>)</mo><mo>)</mo><mo>=</mo><mo>âˆ’</mo><mo>(</mo><mn>1</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.8</mn><mo>+</mo><mn>0</mn><mo>âˆ—</mo><mi>ln</mi><mo>â¡</mo><mn>0.2</mn><mo>)</mo><mo>â‰ˆ</mo><mo>âˆ’</mo><mo>(</mo><mo>âˆ’</mo><mn>0.223</mn><mo>+</mo><mn>0</mn><mo>)</mo><mo>=</mo><mn>0.223</mn></mrow><annotation encoding="application/x-tex">H_1((1, 0), (0.6, 0.4)) = -(1 * \ln0.6 + 0 * \ln0.4)\approx -(-0.511 +0)=0.511\\
H_2((1, 0), (0.8, 0.2)) = -(1 * \ln0.8 + 0 * \ln0.2)\approx -(-0.223 +0)=0.223
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mord">1</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mord">1</span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ’</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">2</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">2</span><span class="mord">3</span></span></span></span></span></p>
<p>å› ä¸º H1 &gt; H2ï¼Œæ‰€ä»¥ y2 é¢„æµ‹æ›´å‡†</p>
<p>tf.losses.categorical_crossentropy(y_, y)</p>
<pre><code class="language-python">import tensorflow as tf

loss_ce1 = tf.losses.categorical_crossentropy([1, 0], [0.6, 0.4])
loss_ce2 = tf.losses.categorical_crossentropy([1, 0], [0.8, 0.2])
print('loss_ce1:', loss_ce1)
print('loss_ce2:', loss_ce2)
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š

loss_ce1: tf.Tensor(0.5108256, shape=(), dtype=float32)
loss_ce2: tf.Tensor(0.22314353, shape=(), dtype=float32)
</code></pre>
<figure data-type="image" tabindex="9"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210317085531909.png" alt="image-20210317085531909" loading="lazy"></figure>
<h3 id="softmax-ä¸äº¤å‰ç†µç»“åˆ">softmax ä¸äº¤å‰ç†µç»“åˆ</h3>
<p>âœ”ï¸ è¾“å‡ºå…ˆè¿‡softmaxå‡½æ•°ï¼Œå†è®¡ç®—yä¸y_çš„äº¤å‰ç†µæŸå¤±å‡½æ•°</p>
<p>tf.nn.softmax_cross_entropy_with_logits(y_, y)</p>
<pre><code class="language-python">import tensorflow as tf
import numpy as np

y_ = np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1],[1, 0, 0], [0, 1, 0]])
y = np.array([[12, 3, 2], [3, 10, 1], [1, 2, 5], [4, 6.5, 1.2], [3, 6, 1]])
y_pro = tf.nn.softmax(y)
loss_ce1 = tf.losses.categorical_crossentropy(y_, y_pro)
loss_ce2 = tf.nn.softmax_cross_entropy_with_logits(y_, y)
print('åˆ†å¸ƒè®¡ç®—çš„ç»“æœï¼š\n', loss_ce1)
print('ç»“åˆè®¡ç®—çš„ç»“æœï¼š\n', loss_ce2)
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
åˆ†å¸ƒè®¡ç®—çš„ç»“æœï¼š
 tf.Tensor(
[1.68795487e-04 1.03475622e-03 6.58839038e-02 2.58349207e+00
 5.49852354e-02], shape=(5,), dtype=float64)
ç»“åˆè®¡ç®—çš„ç»“æœï¼š
 tf.Tensor(
[1.68795487e-04 1.03475622e-03 6.58839038e-02 2.58349207e+00
 5.49852354e-02], shape=(5,), dtype=float64)
</code></pre>
<h2 id="25-ç¼“è§£è¿‡æ‹Ÿåˆ">2.5 ç¼“è§£è¿‡æ‹Ÿåˆ</h2>
<figure data-type="image" tabindex="10"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210317090543891.png" alt="image-20210317090543891" loading="lazy"></figure>
<p>âœ”ï¸  æ¬ æ‹Ÿåˆçš„è§£å†³æ–¹æ³•:</p>
<ul>
<li>å¢åŠ è¾“å…¥ç‰¹å¾é¡¹</li>
<li>å¢åŠ ç½‘ç»œå‚æ•°</li>
<li>å‡å°‘æ­£åˆ™åŒ–å‚æ•°</li>
</ul>
<p>âœ”ï¸ è¿‡æ‹Ÿåˆçš„è§£å†³æ–¹æ³•:</p>
<ul>
<li>æ•°æ®æ¸…æ´—</li>
<li>å¢å¤§è®­ç»ƒé›†</li>
<li>é‡‡ç”¨æ­£åˆ™åŒ–</li>
<li>å¢å¤§æ­£åˆ™åŒ–å‚æ•°</li>
</ul>
<p>âœ”ï¸ æ­£åˆ™åŒ–ç¼“è§£è¿‡æ‹Ÿåˆ</p>
<figure data-type="image" tabindex="11"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210317092518987.png" alt="image-20210317092518987" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210317092729741.png" alt="image-20210317092729741" loading="lazy"></figure>
<p>ä»£ç </p>
<h2 id="26-ä¼˜åŒ–å™¨">2.6 ä¼˜åŒ–å™¨</h2>
<h3 id="ç¥ç»ç½‘ç»œå‚æ•°ä¼˜åŒ–å™¨">ç¥ç»ç½‘ç»œå‚æ•°ä¼˜åŒ–å™¨</h3>
<p>å¾…ä¼˜åŒ–å‚æ•°wï¼ŒæŸå¤±å‡½æ•°lossï¼Œå­¦ä¹ ç‡lrï¼Œæ¯æ¬¡è¿­ä»£ä¸€ä¸ªbatchï¼Œt è¡¨ç¤ºå½“å‰batchè¿­ä»£çš„æ€»æ¬¡æ•°ï¼š</p>
<ol>
<li>è®¡ç®— t æ—¶åˆ»æŸå¤±å‡½æ•°å…³äºå½“å‰å‚æ•°çš„æ¢¯åº¦ $ g_t=\nabla loss = \frac{\partial loss}{\partial (w_t)} $</li>
<li>è®¡ç®— t æ—¶åˆ»ä¸€é˜¶åŠ¨é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">m_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’ŒäºŒé˜¶åŠ¨é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">V_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>è®¡ç®— t æ—¶åˆ»ä¸‹é™æ¢¯åº¦ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt></mrow><annotation encoding="application/x-tex">\eta_t = lr * m_t / \sqrt{V_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span></span></li>
<li>è®¡ç®— t + 1 æ—¶åˆ»å‚æ•°ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta _t = w_t - lr * m_t / \sqrt{V_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span></span></span></span></li>
</ol>
<p><strong>ä¸€é˜¶åŠ¨é‡</strong>ï¼šä¸æ¢¯åº¦ç›¸å…³çš„å‡½æ•°</p>
<p><strong>äºŒé˜¶åŠ¨é‡</strong>ï¼šä¸æ¢¯åº¦å¹³æ–¹ç›¸å…³çš„å‡½æ•°</p>
<h3 id="ä¼˜åŒ–å™¨">ä¼˜åŒ–å™¨</h3>
<p>âœ”ï¸ SGDï¼ˆæ—  momentumï¼‰ï¼Œå¸¸ç”¨çš„æ¢¯åº¦ä¸‹é™æ³•ã€‚</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>T</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m_t = g_t \ \ \ \ \ \ \ \  V_T = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\eta _t = lr * m_t / \sqrt{V_t} = lr * g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta _t = w_t - lr * m_t / \sqrt{V_t} = w_t -lr * g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>l</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>w</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - lr * \frac {\partial loss} {\partial w_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.325208em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<pre><code class="language-python"># SGD
w1.assign_sub(lr * grads[0])  # å‚æ•°w1è‡ªæ›´æ–°
b1.assign_sub(lr * grads[1])  # å‚æ•°b1è‡ªæ›´æ–°
</code></pre>
<pre><code class="language-python"># åˆ©ç”¨é¸¢å°¾èŠ±æ•°æ®é›†ï¼Œå®ç°å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­ï¼Œå¯è§†åŒ–lossæ›²çº¿

# å¯¼å…¥æ‰€éœ€æ¨¡å—
import tensorflow as tf
from sklearn import datasets
from matplotlib import pyplot as plt
import numpy as np
import time  ##1##

# å¯¼å…¥æ•°æ®ï¼Œåˆ†åˆ«ä¸ºè¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾
x_data = datasets.load_iris().data
y_data = datasets.load_iris().target

# éšæœºæ‰“ä¹±æ•°æ®ï¼ˆå› ä¸ºåŸå§‹æ•°æ®æ˜¯é¡ºåºçš„ï¼Œé¡ºåºä¸æ‰“ä¹±ä¼šå½±å“å‡†ç¡®ç‡ï¼‰
# seed: éšæœºæ•°ç§å­ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå½“è®¾ç½®ä¹‹åï¼Œæ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°éƒ½ä¸€æ ·ï¼ˆä¸ºæ–¹ä¾¿æ•™å­¦ï¼Œä»¥ä¿æ¯ä½åŒå­¦ç»“æœä¸€è‡´ï¼‰
np.random.seed(116)  # ä½¿ç”¨ç›¸åŒçš„seedï¼Œä¿è¯è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾ä¸€ä¸€å¯¹åº”
np.random.shuffle(x_data)
np.random.seed(116)
np.random.shuffle(y_data)
tf.random.set_seed(116)

# å°†æ‰“ä¹±åçš„æ•°æ®é›†åˆ†å‰²ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè®­ç»ƒé›†ä¸ºå‰120è¡Œï¼Œæµ‹è¯•é›†ä¸ºå30è¡Œ
x_train = x_data[:-30]
y_train = y_data[:-30]
x_test = x_data[-30:]
y_test = y_data[-30:]

# è½¬æ¢xçš„æ•°æ®ç±»å‹ï¼Œå¦åˆ™åé¢çŸ©é˜µç›¸ä¹˜æ—¶ä¼šå› æ•°æ®ç±»å‹ä¸ä¸€è‡´æŠ¥é”™
x_train = tf.cast(x_train, tf.float32)
x_test = tf.cast(x_test, tf.float32)

# from_tensor_sliceså‡½æ•°ä½¿è¾“å…¥ç‰¹å¾å’Œæ ‡ç­¾å€¼ä¸€ä¸€å¯¹åº”ã€‚ï¼ˆæŠŠæ•°æ®é›†åˆ†æ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡batchç»„æ•°æ®ï¼‰
train_db = tf.data.Dataset.from_tensor_slices((x_train, y_train)).batch(32)
test_db = tf.data.Dataset.from_tensor_slices((x_test, y_test)).batch(32)

# ç”Ÿæˆç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œ4ä¸ªè¾“å…¥ç‰¹å¾æ•…ï¼Œè¾“å…¥å±‚ä¸º4ä¸ªè¾“å…¥èŠ‚ç‚¹ï¼›å› ä¸º3åˆ†ç±»ï¼Œæ•…è¾“å‡ºå±‚ä¸º3ä¸ªç¥ç»å…ƒ
# ç”¨tf.Variable()æ ‡è®°å‚æ•°å¯è®­ç»ƒ
# ä½¿ç”¨seedä½¿æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°ç›¸åŒï¼ˆæ–¹ä¾¿æ•™å­¦ï¼Œä½¿å¤§å®¶ç»“æœéƒ½ä¸€è‡´ï¼Œåœ¨ç°å®ä½¿ç”¨æ—¶ä¸å†™seedï¼‰
w1 = tf.Variable(tf.random.truncated_normal([4, 3], stddev=0.1, seed=1))
b1 = tf.Variable(tf.random.truncated_normal([3], stddev=0.1, seed=1))

lr = 0.1  # å­¦ä¹ ç‡ä¸º0.1
train_loss_results = []  # å°†æ¯è½®çš„lossè®°å½•åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œä¸ºåç»­ç”»lossæ›²çº¿æä¾›æ•°æ®
test_acc = []  # å°†æ¯è½®çš„accè®°å½•åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œä¸ºåç»­ç”»accæ›²çº¿æä¾›æ•°æ®
epoch = 500  # å¾ªç¯500è½®
loss_all = 0  # æ¯è½®åˆ†4ä¸ªstepï¼Œloss_allè®°å½•å››ä¸ªstepç”Ÿæˆçš„4ä¸ªlossçš„å’Œ

# è®­ç»ƒéƒ¨åˆ†
now_time = time.time()  ##2##
for epoch in range(epoch):  # æ•°æ®é›†çº§åˆ«çš„å¾ªç¯ï¼Œæ¯ä¸ªepochå¾ªç¯ä¸€æ¬¡æ•°æ®é›†
    for step, (x_train, y_train) in enumerate(train_db):  # batchçº§åˆ«çš„å¾ªç¯ ï¼Œæ¯ä¸ªstepå¾ªç¯ä¸€ä¸ªbatch
        with tf.GradientTape() as tape:  # withç»“æ„è®°å½•æ¢¯åº¦ä¿¡æ¯
            y = tf.matmul(x_train, w1) + b1  # ç¥ç»ç½‘ç»œä¹˜åŠ è¿ç®—
            y = tf.nn.softmax(y)  # ä½¿è¾“å‡ºyç¬¦åˆæ¦‚ç‡åˆ†å¸ƒï¼ˆæ­¤æ“ä½œåä¸ç‹¬çƒ­ç åŒé‡çº§ï¼Œå¯ç›¸å‡æ±‚lossï¼‰
            y_ = tf.one_hot(y_train, depth=3)  # å°†æ ‡ç­¾å€¼è½¬æ¢ä¸ºç‹¬çƒ­ç æ ¼å¼ï¼Œæ–¹ä¾¿è®¡ç®—losså’Œaccuracy
            loss = tf.reduce_mean(tf.square(y_ - y))  # é‡‡ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°mse = mean(sum(y-out)^2)
            loss_all += loss.numpy()  # å°†æ¯ä¸ªstepè®¡ç®—å‡ºçš„lossç´¯åŠ ï¼Œä¸ºåç»­æ±‚losså¹³å‡å€¼æä¾›æ•°æ®ï¼Œè¿™æ ·è®¡ç®—çš„lossæ›´å‡†ç¡®
        # è®¡ç®—losså¯¹å„ä¸ªå‚æ•°çš„æ¢¯åº¦
        grads = tape.gradient(loss, [w1, b1])

        # å®ç°æ¢¯åº¦æ›´æ–° w1 = w1 - lr * w1_grad    b = b - lr * b_grad
        w1.assign_sub(lr * grads[0])  # å‚æ•°w1è‡ªæ›´æ–°
        b1.assign_sub(lr * grads[1])  # å‚æ•°bè‡ªæ›´æ–°

    # æ¯ä¸ªepochï¼Œæ‰“å°lossä¿¡æ¯
    print(&quot;Epoch {}, loss: {}&quot;.format(epoch, loss_all / 4))
    train_loss_results.append(loss_all / 4)  # å°†4ä¸ªstepçš„lossæ±‚å¹³å‡è®°å½•åœ¨æ­¤å˜é‡ä¸­
    loss_all = 0  # loss_allå½’é›¶ï¼Œä¸ºè®°å½•ä¸‹ä¸€ä¸ªepochçš„lossåšå‡†å¤‡

    # æµ‹è¯•éƒ¨åˆ†
    # total_correctä¸ºé¢„æµ‹å¯¹çš„æ ·æœ¬ä¸ªæ•°, total_numberä¸ºæµ‹è¯•çš„æ€»æ ·æœ¬æ•°ï¼Œå°†è¿™ä¸¤ä¸ªå˜é‡éƒ½åˆå§‹åŒ–ä¸º0
    total_correct, total_number = 0, 0
    for x_test, y_test in test_db:
        # ä½¿ç”¨æ›´æ–°åçš„å‚æ•°è¿›è¡Œé¢„æµ‹
        y = tf.matmul(x_test, w1) + b1
        y = tf.nn.softmax(y)
        pred = tf.argmax(y, axis=1)  # è¿”å›yä¸­æœ€å¤§å€¼çš„ç´¢å¼•ï¼Œå³é¢„æµ‹çš„åˆ†ç±»
        # å°†predè½¬æ¢ä¸ºy_testçš„æ•°æ®ç±»å‹
        pred = tf.cast(pred, dtype=y_test.dtype)
        # è‹¥åˆ†ç±»æ­£ç¡®ï¼Œåˆ™correct=1ï¼Œå¦åˆ™ä¸º0ï¼Œå°†boolå‹çš„ç»“æœè½¬æ¢ä¸ºintå‹
        correct = tf.cast(tf.equal(pred, y_test), dtype=tf.int32)
        # å°†æ¯ä¸ªbatchçš„correctæ•°åŠ èµ·æ¥
        correct = tf.reduce_sum(correct)
        # å°†æ‰€æœ‰batchä¸­çš„correctæ•°åŠ èµ·æ¥
        total_correct += int(correct)
        # total_numberä¸ºæµ‹è¯•çš„æ€»æ ·æœ¬æ•°ï¼Œä¹Ÿå°±æ˜¯x_testçš„è¡Œæ•°ï¼Œshape[0]è¿”å›å˜é‡çš„è¡Œæ•°
        total_number += x_test.shape[0]
    # æ€»çš„å‡†ç¡®ç‡ç­‰äºtotal_correct/total_number
    acc = total_correct / total_number
    test_acc.append(acc)
    print(&quot;Test_acc:&quot;, acc)
    print(&quot;--------------------------&quot;)
total_time = time.time() - now_time  ##3##
print(&quot;total_time&quot;, total_time)  ##4##

# ç»˜åˆ¶ loss æ›²çº¿
plt.title('Loss Function Curve')  # å›¾ç‰‡æ ‡é¢˜
plt.xlabel('Epoch')  # xè½´å˜é‡åç§°
plt.ylabel('Loss')  # yè½´å˜é‡åç§°
plt.plot(train_loss_results, label=&quot;$Loss$&quot;)  # é€ç‚¹ç”»å‡ºtrian_loss_resultså€¼å¹¶è¿çº¿ï¼Œè¿çº¿å›¾æ ‡æ˜¯Loss
plt.legend()  # ç”»å‡ºæ›²çº¿å›¾æ ‡
plt.show()  # ç”»å‡ºå›¾åƒ

# ç»˜åˆ¶ Accuracy æ›²çº¿
plt.title('Acc Curve')  # å›¾ç‰‡æ ‡é¢˜
plt.xlabel('Epoch')  # xè½´å˜é‡åç§°
plt.ylabel('Acc')  # yè½´å˜é‡åç§°
plt.plot(test_acc, label=&quot;$Accuracy$&quot;)  # é€ç‚¹ç”»å‡ºtest_accå€¼å¹¶è¿çº¿ï¼Œè¿çº¿å›¾æ ‡æ˜¯Accuracy
plt.legend()
plt.show()

# æœ¬æ–‡ä»¶è¾ƒ class1\p45_iris.py ä»…æ·»åŠ å››å¤„æ—¶é—´è®°å½•  ç”¨ ##n## æ ‡è¯†
# è¯·å°†lossæ›²çº¿ã€ACCæ›²çº¿ã€total_timeè®°å½•åˆ° class2\ä¼˜åŒ–å™¨å¯¹æ¯”.docx  å¯¹æ¯”å„ä¼˜åŒ–å™¨æ”¶æ•›æƒ…å†µ
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
--------------------------
Epoch 498, loss: 0.03232627175748348
Test_acc: 1.0
--------------------------
Epoch 499, loss: 0.032300276681780815
Test_acc: 1.0
--------------------------
total_time 12.701475381851196
</code></pre>
<p>âœ”ï¸ SGDMï¼ˆå«momentumçš„SGDï¼‰ï¼Œåœ¨SGDåŸºç¡€ä¸Šå¢åŠ ä¸€é˜¶åŠ¨é‡ã€‚</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>T</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m_t = \beta * m_{t-1} + (1-\beta)*g_t \ \ \ \ \ \ \ \  V_T = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mo>(</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">\eta _t = lr * m_t / \sqrt{V_t} = lr * m_t = lr*(\beta*m_{t-1}+(1-\beta)*g_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mo>(</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta _t = w_t - lr * (\beta*m_{t-1}+(1-\beta)*g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><strong>Codes:</strong></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>T</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m_t = \beta * m_{t-1} + (1-\beta)*g_t \ \ \ \ \ \ \ \  V_T = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„
m_w, m_b = 0, 0
beta = 0.9
# sgd-momentum
m_w = beta * m_w + (1 - beta) * grads[0]
m_b = beta * m_b + (1 - beta) * grads[1]
w1.assign_sub(lr * m_w)
b1.assign_sub(lr * m_b)
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
--------------------------
Epoch 498, loss: 0.03065542411059141
Test_acc: 1.0
--------------------------
Epoch 499, loss: 0.030630568508058786
Test_acc: 1.0
--------------------------
total_time 10.623216390609741
</code></pre>
<p>âœ”ï¸ Adagradï¼Œåœ¨SGDåŸºç¡€ä¸Šå¢åŠ äºŒé˜¶åŠ¨é‡</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></munderover><msubsup><mi>g</mi><mi>Ï„</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">m_t = g_t \   \ \ \ \ \ \ V_t =\sum_{\tau=1}^t g_\tau ^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.047674em;vertical-align:-1.267113em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7805610000000003em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>)</mo><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></msubsup><msubsup><mi>g</mi><mi>Ï„</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">\eta_t = lr * m_t / (\sqrt{V_t})=lr*g_t / (\sqrt{\sum_{\tau=1}^t g_\tau ^2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.8399999999999999em;vertical-align:-0.5381269999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.301873em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.933456em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.261873em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5381269999999999em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><munderover><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></munderover><msubsup><mi>g</mi><mi>Ï„</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta_t = w_t - lr * g_t/ (\sqrt{\sum_{\tau=1}^t g_\tau ^2})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.275424em;vertical-align:-1.267113em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0083110000000004em;"><span class="svg-align" style="top:-5.235424em;"><span class="pstrut" style="height:5.235424em;"></span><span class="mord" style="padding-left:1.056em;"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7805610000000003em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.968311000000001em;"><span class="pstrut" style="height:5.235424em;"></span><span class="hide-tail" style="min-width:0.742em;height:3.315424em;"><svg width='400em' height='3.315424em' viewBox='0 0 400000 3315' preserveAspectRatio='xMinYMin slice'><path d='M702 80H400000v40H742v3181l-4 4-4 4c-.667.7
-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667
-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155
 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„ï¼š
v_w, v_b = 0, 0
# adagrad
v_w += tf.square(grads[0])
v_b += tf.square(grads[1])
w1.assign_sub(lr * grads[0] / tf.sqrt(v_w))
b1.assign_sub(lr * grads[1] / tf.sqrt(v_b))
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
--------------------------
Epoch 498, loss: 0.03176002576947212
Test_acc: 1.0
--------------------------
Epoch 499, loss: 0.03173917159438133
Test_acc: 1.0
--------------------------
total_time 7.388378620147705
</code></pre>
<p>âœ”ï¸ RMSPropï¼ŒSGDåŸºç¡€ä¸Šå¢åŠ äºŒé˜¶åŠ¨é‡</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>g</mi><mi>t</mi></msub><mtext>Â Â Â Â Â Â Â </mtext><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><mi>Î²</mi><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">m_t = g_t \   \ \ \ \ \ \ V_t =\beta * V_{t-1}+(1-\beta)*g_t ^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mspace">Â </span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>m</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><msub><mi>V</mi><mi>t</mi></msub></msqrt><mo>)</mo><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><mi>Î²</mi><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">\eta_t = lr * m_t / (\sqrt{V_t})=lr*g_t / (\sqrt{\beta * V_{t-1}+(1-\beta)*g_t ^2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1016650000000001em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.851665em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.811665em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.18833500000000003em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.282046em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.957954em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959079999999998em;"><span style="top:-2.454244em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24575599999999992em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.917954em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.282046em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub><mi mathvariant="normal">/</mi><mo>(</mo><msqrt><mrow><mi>Î²</mi><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>Î²</mi><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta_t = w_t - lr * g_t/ (\sqrt{\beta * V_{t-1}+(1-\beta)*g_t ^2})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.5331710000000001em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.306829em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959079999999998em;"><span style="top:-2.454244em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24575599999999992em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2668289999999995em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5331710000000001em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„
v_w, v_b = 0, 0
beta = 0.9
# rmsprop
v_w = beta * v_w + (1 - beta) * tf.square(grads[0])
v_b = beta * v_b + (1 - beta) * tf.square(grads[1])
w1.assign_sub(lr * grads[0] / tf.sqrt(v_w))
b1.assign_sub(lr * grads[1] / tf.sqrt(v_b))
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
--------------------------
Epoch 498, loss: nan
Test_acc: 0.36666666666666664
--------------------------
Epoch 499, loss: nan
Test_acc: 0.36666666666666664
--------------------------
total_time 12.019102573394775
</code></pre>
<p>âœ”ï¸ Adamï¼ŒåŒæ—¶ç»“åˆSGDMä¸€é˜¶åŠ¨é‡å’ŒRMSPropäºŒé˜¶åŠ¨é‡</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>m</mi><mi>t</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>âˆ—</mo><msub><mi>m</mi><mrow><mi>t</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>Î²</mi><mn>1</mn></msub><mo>)</mo><mo>âˆ—</mo><msub><mi>g</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">m_t = \beta_1*m_{t-1}+(1-\beta_1)*g_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>ä¿®æ­£ä¸€é˜¶åŠ¨é‡çš„åå·®ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><msub><mi>m</mi><mi>t</mi></msub><mo>^</mo></mover><mo>=</mo><mfrac><msub><mi>m</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>Î²</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\hat{m_t}=\frac{m_t}{1-\beta_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1925999999999999em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7114919999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mi>t</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>2</mn></msub><mo>âˆ—</mo><msub><mi>V</mi><mrow><mi>s</mi><mi>t</mi><mi>e</mi><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>Î²</mi><mn>2</mn></msub><mo>)</mo><mo>âˆ—</mo><msubsup><mi>g</mi><mi>t</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">V_t=\beta_2*V_{step-1}+(1-\beta_2)*g_t ^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">p</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.061108em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>ä¿®æ­£äºŒé˜¶åŠ¨é‡çš„åå·®ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><msub><mi>V</mi><mi>t</mi></msub><mo>^</mo></mover><mo>=</mo><mfrac><msub><mi>V</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\hat{V_t}=\frac {V_t}{1-\beta_2 ^t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0967699999999998em;vertical-align:-0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.4653909999999999em;vertical-align:-0.5769599999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.22222em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mover accent="true"><msub><mi>m</mi><mi>t</mi></msub><mo>^</mo></mover><mi mathvariant="normal">/</mi><msqrt><mover accent="true"><msub><mi>V</mi><mi>t</mi></msub><mo>^</mo></mover></msqrt><mo>=</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mfrac><msub><mi>m</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>1</mn><mi>t</mi></msubsup></mrow></mfrac><mi mathvariant="normal">/</mi><msqrt><mfrac><msub><mi>V</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">\eta_t = lr *\hat{m_t}/\sqrt{\hat{V_t}}=lr*\frac{m_t}{1-\beta_1 ^t} / \sqrt{\frac{V_t}{1-\beta_2 ^t}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.3333849999999998em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0833849999999998em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9467699999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.25233em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;">^</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3.0433850000000002em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15661500000000006em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.6992644999999997em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7114919999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1407355000000003em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.22222em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.1007355em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6992644999999997em;"><span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>Î·</mi><mi>t</mi></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>âˆ’</mo><mi>l</mi><mi>r</mi><mo>âˆ—</mo><mfrac><msub><mi>m</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>1</mn><mi>t</mi></msubsup></mrow></mfrac><mi mathvariant="normal">/</mi><msqrt><mfrac><msub><mi>V</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>âˆ’</mo><msubsup><mi>Î²</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - \eta_t = w_t-lr*\frac{m_t}{1-\beta_1^t}/ \sqrt{\frac{V_t}{1-\beta_2 ^t}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Î·</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.6992644999999997em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7114919999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">/</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1407355000000003em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.6411000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05278em;">Î²</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7841428571428571em;"><span style="top:-2.188485714285714em;margin-left:-0.05278em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span><span style="top:-2.8448em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.31151428571428574em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.22222em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5769599999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.1007355em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6992644999999997em;"><span></span></span></span></span></span></span></span></span></p>
<pre><code class="language-python"># ä¸SGDä¸åŒä¹‹å¤„
m_w, m_b = 0, 0
v_w, v_b = 0, 0
beta1, beta2 = 0.9, 0.999
delta_w, delta_b = 0, 0
global_step = 0  # åé¢ +1
# adam
m_w = beta1 * m_w + (1 - beta1) * grads[0]
m_b = beta1 * m_b + (1 - beta1) * grads[1]
v_w = beta2 * v_w + (1 - beta2) * tf.square(grads[0])
v_b = beta2 * v_b + (1 - beta2) * tf.square(grads[1])

m_w_correction = m_w / (1 - tf.pow(beta1, int(global_step)))
m_b_correction = m_b / (1 - tf.pow(beta1, int(global_step)))
v_w_correction = v_w / (1 - tf.pow(beta2, int(global_step)))
v_b_correction = v_b / (1 - tf.pow(beta2, int(global_step)))

w1.assign_sub(lr * m_w_correction / tf.sqrt(v_w_correction))
b1.assign_sub(lr * m_b_correction / tf.sqrt(v_b_correction))
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
--------------------------
Epoch 498, loss: 0.013929554144851863
Test_acc: 1.0
--------------------------
Epoch 499, loss: 0.013926223502494395
Test_acc: 1.0
--------------------------
total_time 8.114784002304077
</code></pre>
<h1 id="ç¬¬ä¸‰ç« -ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ">ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ</h1>
<ul>
<li>ç¥ç»ç½‘ç»œæ­å»ºå…«è‚¡</li>
<li>irisä»£ç å¤ç°</li>
<li>MNISTæ•°æ®é›†</li>
<li>è®­ç»ƒMNISTæ•°æ®é›†</li>
<li>Fashionæ•°æ®é›†</li>
</ul>
<h2 id="31-ç”¨-tensorflow-api-tfkeras-æ­å»ºç½‘ç»œå…«è‚¡">3.1 ç”¨ Tensorflow API: tf.keras æ­å»ºç½‘ç»œå…«è‚¡</h2>
<h3 id="å…­æ­¥æ³•">å…­æ­¥æ³•</h3>
<p>import</p>
<p>train, test  # æŒ‡å®šè®­ç»ƒé›†ç‰¹å¾å’Œæ ‡ç­¾</p>
<p>model = tf.keras.models.Sequential  # é€å±‚æè¿°ç½‘ç»œ</p>
<p>model.compile  # ä½¿ç”¨å“ªç§ä¼˜åŒ–å™¨ã€æŸå¤±å‡½æ•°ã€è¯„æµ‹æŒ‡æ ‡ç­‰</p>
<p>model.fit  # è®­ç»ƒè¿‡ç¨‹ï¼Œå‘ŠçŸ¥è®­ç»ƒé›†è¾“å…¥ç‰¹å¾æ ‡ç­¾ï¼Œbatchï¼Œè¿­ä»£æ¬¡æ•°</p>
<p>model.summray  # æ‰“å°å‡ºç½‘ç»œç»“æ„å’Œå‚æ•°ç»Ÿè®¡</p>
<p><strong>model = tf.keras.models.Sequential([ç½‘ç»œç»“æ„])  # æè¿°å„å±‚ç½‘ç»œ</strong></p>
<p>âœ”ï¸ ç½‘ç»œç»“æ„ä¸¾ä¾‹ï¼š</p>
<ul>
<li>
<p>æ‹‰ç›´å±‚ï¼štf.keras.layers.Flatten()</p>
</li>
<li>
<p>å…¨è¿æ¥å±‚ï¼štf.keras.layers.Dense(ç¥ç»å…ƒä¸ªæ•°, activation=&quot;æ¿€æ´»å‡½æ•°&quot;, kernel_regularizer=å“ªç§æ­£åˆ™åŒ–)</p>
<p>activation('å¯é€‰å­—ç¬¦ä¸²'): relu, softmax, sigmoid, tanh</p>
<p>kernel_regularizerå¯é€‰: tf.keras.regularizers.l1(), tf.kers.regularizers.l2()</p>
</li>
<li>
<p>å·ç§¯å±‚ï¼štf.keras.layers.Conv2D(filters=å·ç§¯æ ¸ä¸ªæ•°, kernel_size=å·ç§¯æ ¸å°ºå¯¸, strides=å·ç§¯æ­¥é•¿, padding=&quot;valid&quot; or &quot;same&quot;)</p>
</li>
</ul>
<p>LSTMå±‚ï¼štf.keras.layers.LSTM()</p>
<p><strong>model.compile(optimizer=ä¼˜åŒ–å™¨, loss=æŸå¤±å‡½æ•°, metrics=['å‡†ç¡®ç‡'])</strong></p>
<p>âœ”ï¸ Optimizerå¯é€‰ï¼š(ä½¿ç”¨å·¦è¾¹å­—ç¬¦ä¸²æˆ–å³è¾¹å‡½æ•°å½¢å¼ï¼Œè‡ªå®šä¹‰å­¦ä¹ ç‡ç­‰)</p>
<ul>
<li>'sgd' or tf,keras.optimizers.SGD(lr=å­¦ä¹ ç‡, momentum=åŠ¨é‡å‚æ•°)</li>
<li>'adagrad' or tf.keras.optimizer.Adagrad(lr=å­¦ä¹ ç‡)</li>
<li>'adadelta' or tf.keras.optimizer.Adadelta(lr=å­¦ä¹ ç‡)</li>
<li>'adam' or tf.keras.optimizer.Adam(lr=å­¦ä¹ ç‡, beta_1=0.9, beta_2=0.999)</li>
</ul>
<p>âœ”ï¸ losså¯é€‰ï¼š</p>
<ul>
<li>'mse' or tf,keras.losses.MeanSquaredError()</li>
<li>'sparse_categorical_crossentropy' or tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False)  # åœ¨è¯¢é—®æ˜¯å¦æ˜¯åŸå§‹è¾“å‡ºï¼Œç»è¿‡æ¦‚ç‡åˆ†å¸ƒä¸ºFalseï¼Œæ²¡æœ‰ç»è¿‡æ¦‚ç‡åˆ†å¸ƒç›´æ¥è¾“å‡ºä¸ºTrue</li>
</ul>
<p>âœ”ï¸ Metricså¯é€‰ï¼š</p>
<ul>
<li>'accuracy': y_ å’Œ y éƒ½æ˜¯æ•°å€¼ï¼Œå¦‚ y_=[1]    y=[1]</li>
</ul>
<ul>
<li>'categorical_accuracy': y_ å’Œ y éƒ½æ˜¯ç‹¬çƒ­ç ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰ï¼Œå¦‚ y_=[0, 1, 0]    y=[0.256, 0.695, 0.048]_</li>
<li><em>'sparse_categorical_accuracy': y</em> æ˜¯æ•°å€¼ï¼Œy æ˜¯ç‹¬çƒ­ç ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰ï¼Œå¦‚ y_=[1]    y=[0.256, 0.695, 0.048]</li>
</ul>
<p><strong>model.fit(è®­ç»ƒé›†çš„è¾“å…¥ç‰¹å¾, è®­ç»ƒé›†çš„æ ‡ç­¾, batch_size= , epocher= , validation_data=(æµ‹è¯•é›†çš„è¾“å…¥ç‰¹å¾ï¼Œæµ‹è¯•é›†çš„æ ‡ç­¾), validation_split=ä»è®­ç»ƒé›†åˆ’åˆ†å¤šå°‘æ¯”ä¾‹ç»™æµ‹è¯•é›†, validation_freq=å¤šå°‘æ¬¡epochæµ‹è¯•ä¸€æ¬¡)</strong></p>
<p>â­• validation_data, validation_split äºŒé€‰å…¶ä¸€</p>
<p><strong>model.summary()</strong> æ‰“å°å‡ºç½‘ç»œçš„ç»“æ„å’Œå‚æ•°ç»Ÿè®¡</p>
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
dense (Dense)                (None, 3)                 15
=================================================================
Total params: 15
Trainable params: 15
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<p><strong>p8_iris_sequential</strong></p>
<pre><code class="language-python">import tensorflow as tf
from sklearn import datasets
import numpy as np

x_train = datasets.load_iris().data
y_train = datasets.load_iris().target

np.random.seed(116)
np.random.shuffle(x_train)
np.random.seed(116)
np.random.shuffle(y_train)
tf.random.set_seed(116)

model = tf.keras.models.Sequential([
    tf.keras.layers.Dense(3, activation='softmax', kernel_regularizer=tf.keras.regularizers.l2())
])

model.compile(
    optimizer=tf.keras.optimizers.SGD(lr=0.1),
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

model.fit(x_train, y_train, batch_size=32, epochs=500, validation_split=0.2, validation_freq=20)

model.summary()
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
Epoch 500/500
4/4 [==============================] - 0s 6ms/step - loss: 0.3634 - sparse_categorical_accuracy: 0.9304 - val_loss: 0.3516 - val_sparse_categorical_accuracy: 0.8667
Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
dense (Dense)                (None, 3)                 15
=================================================================
Total params: 15
Trainable params: 15
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<p><strong>ç”¨Tensorflow API: tf.keras æ­å»ºç½‘ç»œå…«è‚¡</strong></p>
<p>class MyModel(Model) model = MyModel</p>
<pre><code class="language-python">class MyModel(Model):
    def __init__(self):
        super(MyModel, self).__init__()
        å®šä¹‰ç½‘ç»œç»“æ„å—
    def call(self, x):
        è°ƒç”¨ç½‘ç»œç»“æ„å—ï¼Œå®ç°å‰å‘ä¼ æ’­
        return y
model = MyModel()
</code></pre>
<p>ğŸš©<br>
_<em>init</em>_()  å®šä¹‰æ‰€æ¬²è¦ç½‘ç»œç»“æ„å—<br>
call()   å†™å‡ºå‰å‘ä¼ æ’­</p>
<pre><code class="language-python"># ä¸iris_sequentialä¸åŒä¹‹å¤„
from tensorflow.keras.layers import Dense
from tensorflow.keras import Model

class IrisModel(Model):
    def __init__(self):
        super(IrisModel, self).__init__()
        self.d1 = Dense(3, activation='softmax', kernel_regularizer=tf.keras.regularizers.l2())

    def call(self, x):
        y = self.d1(x)
        return y

model = IrisModel()
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
Epoch 500/500
4/4 [==============================] - 0s 5ms/step - loss: 0.3634 - sparse_categorical_accuracy: 0.9304 - val_loss: 0.3516 - val_sparse_categorical_accuracy: 0.8667
Model: &quot;iris_model&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
dense (Dense)                multiple                  15
=================================================================
Total params: 15
Trainable params: 15
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<p>âœ”ï¸ MNISTæ•°æ®é›†ï¼š</p>
<p>æä¾›6ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„ 0~9 æ‰‹å†™æ•°å­—å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒã€‚</p>
<p>æä¾›1ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„ 0~9 æ‰‹å†™æ•°å­—å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯•ã€‚</p>
<p>âœ”ï¸ å¯¼å…¥MNISTæ•°æ®é›†ï¼š</p>
<p>mnist = tf.keras.datasets.mnist</p>
<p>(x_train, y_train), (x_test, y_test) = mnist.load_data()</p>
<pre><code class="language-python">import tensorflow as tf
import matplotlib.pyplot as plt

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()

# å¯è§†åŒ–è®­ç»ƒé›†è¾“å…¥ç‰¹å¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
plt.imshow(x_train[0], cmap='gray')  # ç»˜åˆ¶ç°åº¦å›¾
plt.show()

# æ‰“å°å‡ºè®­ç»ƒé›†è¾“å…¥ç‰¹å¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
print(&quot;x_train[0]:\n&quot;, x_train[0])
# æ‰“å°å‡ºè®­ç»ƒé›†æ ‡ç­¾çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
print(&quot;y_train[0]:\n&quot;, y_train[0])

# æ‰“å°å‡ºæ•´ä¸ªè®­ç»ƒé›†çš„è¾“å…¥ç‰¹å¾å½¢çŠ¶
print(&quot;x_train.shape:\n&quot;, x_train.shape)
# æ‰“å°å‡ºæ•´ä¸ªè®­ç»ƒé›†æ ‡ç­¾çš„å½¢çŠ¶
print(&quot;y_train.shape:\n&quot;, y_train.shape)
# æ‰“å°å‡ºæ•´ä¸ªæµ‹è¯•é›†çš„è¾“å…¥ç‰¹å¾å½¢çŠ¶
print(&quot;x_test.shape:\n&quot;, x_test.shape)
# æ‰“å°å‡ºæ•´ä¸ªæµ‹è¯•é›†æ ‡ç­¾çš„å½¢çŠ¶
print(&quot;y_test.shape:\n&quot;, y_test.shape)
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š
x_train[0]:
 'ä¸€ä¸ªäºŒç»´æ•°ç»„'
y_train[0]:
 5
x_train.shape:
 (60000, 28, 28)
y_train.shape:
 (60000,)
x_test.shape:
 (10000, 28, 28)
y_test.shape:
 (10000,)
</code></pre>
<p>âœ”ï¸ ä½œä¸ºè¾“å…¥ç‰¹å¾ï¼Œè¾“å…¥ç¥ç»ç½‘ç»œæ—¶ï¼Œå°†æ•°æ®æ‹‰ä¼¸ä¸ºä¸€ç»´æ•°ç»„ï¼š</p>
<p>tf.keras.latyers.Flatten()</p>
<p>[0 0 0 48 238 252 252 ...... ...... ...... 253 186 12 0 0 0 0 0]</p>
<p><strong>ğŸ’¬ Codes</strong></p>
<pre><code class="language-python">import tensorflow as tf

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0  # æ•°å€¼å˜å°åæ›´åˆ©äºç¥ç»ç½‘ç»œçš„å¸æ”¶

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),  # ç¬¬ä¸€ä¸ªDenseæ˜¯éšè—å±‚
    tf.keras.layers.Dense(10, activation='softmax')  # ç¬¬äºŒä¸ªDenseæ˜¯è¾“å‡ºå±‚
])

model.compile(
    optimizer='adam',
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1)
model.summary()
</code></pre>
<pre><code>Epoch 5/5
1875/1875 [==============================] - 1s 780us/step - loss: 0.0434 - sparse_categorical_accuracy: 0.9866 - val_loss: 0.0856 - val_sparse_categorical_accuracy: 0.9738
Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
flatten (Flatten)            (None, 784)               0
_________________________________________________________________
dense (Dense)                (None, 128)               100480
_________________________________________________________________
dense_1 (Dense)              (None, 10)                1290
=================================================================
Total params: 101,770
Trainable params: 101,770
Non-trainable params: 0
</code></pre>
<pre><code class="language-python"># class
from tensorflow.keras.layers import Dense, Flatten
from tensorflow.keras import Model

class MnistModel(Model):
    def __init__(self):
        super(MnistModel, self).__init__()
        self.flatten = Flatten()
        self.d1 = Dense(128, activation='relu')
        self.d2 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.flatten(x)
        x = self.d1(x)
        y = self.d2(x)
        return y

</code></pre>
<p>âœ”ï¸ FASHIONæ•°æ®é›†ï¼š</p>
<p>æä¾›6ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„è¡£è£¤ç­‰å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒã€‚</p>
<p>æä¾›1ä¸‡å¼  28 * 28 åƒç´ ç‚¹çš„è¡£è£¤ç­‰å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯•ã€‚</p>
<p>âœ”ï¸ å¯¼å…¥FASHIONæ•°æ®é›†ï¼š</p>
<p>fashion = tf.keras.datasets.fashion_mnist</p>
<p>(x_train, y_train), (x_test, y_test) = fashion.load_data()</p>
<p><strong>ğŸ’¬ Codes</strong></p>
<pre><code class="language-python">import tensorflow as tf

fashion = tf.keras.datasets.fashion_mnist
(x_train, y_train), (x_test, y_test) = fashion.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(
    optimizer='adam',
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1)
model.summary()
</code></pre>
<pre><code>è¿è¡Œç»“æœï¼š

</code></pre>
<h1 id="ç¬¬å››ç« -ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•">ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•</h1>
<ol>
<li>è‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨</li>
<li>æ•°æ®å¢å¼ºï¼Œæ‰©å……æ•°æ®é›†</li>
<li>æ–­ç‚¹ç»­è®­ï¼Œå­˜å–æ¨¡å‹</li>
<li>å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬</li>
<li>acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœ</li>
<li>åº”ç”¨ç¨‹åºï¼Œç»™å›¾è¯†ç‰©</li>
</ol>
<h2 id="41-è‡ªåˆ¶æ•°æ®é›†è§£å†³æœ¬é¢†åŸŸåº”ç”¨">4.1 è‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨</h2>
<p>è§‚å¯Ÿæ•°æ®é›†ç»“æ„ï¼Œç»™x_train, y_train, x_test, y_testèµ‹å€¼</p>
<p>mnist_image_labelæ–‡ä»¶å¤¹ï¼šAI &gt; class4 &gt; MNIST_FC &gt; mnist_image_label</p>
<p>mnist_train_jpg_60000</p>
<p>mnist_test_jpg_10000    <strong>å›¾ç‰‡</strong></p>
<figure data-type="image" tabindex="13"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210319084059005.png" alt="image-20210319084059005" loading="lazy"></figure>
<p>mnist_train_jpg_60000.txt</p>
<p>mnist_test_jpg_10000.txt    <strong>æ ‡ç­¾</strong></p>
<figure data-type="image" tabindex="14"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210319084817742.png" alt="image-20210319084817742" loading="lazy"></figure>
<pre><code class="language-python">mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()

def generareds(å›¾ç‰‡è·¯å¾„, æ ‡ç­¾æ–‡ä»¶):  # æ›¿æ¢ä¸ŠåŠ è½½æ–‡ä»¶ä¸ºæœ¬åœ°æ•°æ®é›†
</code></pre>
<pre><code class="language-python">def generateds(path, txt):
    f = open(txt, 'r')  # ä»¥åªè¯»å½¢å¼æ‰“å¼€txtæ–‡ä»¶
    contents = f.readlines()  # è¯»å–æ–‡ä»¶ä¸­æ‰€æœ‰è¡Œ
    f.close()  # å…³é—­txtæ–‡ä»¶
    x, y_ = [], []  # å»ºç«‹ç©ºåˆ—è¡¨
    for content in contents:  # é€è¡Œå–å‡º
        value = content.split()  # ä»¥ç©ºæ ¼åˆ†å¼€ï¼Œå›¾ç‰‡è·¯å¾„ä¸ºvalue[0] , æ ‡ç­¾ä¸ºvalue[1] , å­˜å…¥åˆ—è¡¨
        img_path = path + value[0]  # æ‹¼å‡ºå›¾ç‰‡è·¯å¾„å’Œæ–‡ä»¶å
        img = Image.open(img_path)  # è¯»å…¥å›¾ç‰‡
        img = np.array(img.convert('L'))  # å›¾ç‰‡å˜ä¸º8ä½å®½ç°åº¦å€¼çš„np.arrayæ ¼å¼
        img = img / 255.  # æ•°æ®å½’ä¸€åŒ– ï¼ˆå®ç°é¢„å¤„ç†ï¼‰
        x.append(img)  # å½’ä¸€åŒ–åçš„æ•°æ®ï¼Œè´´åˆ°åˆ—è¡¨x
        y_.append(value[1])  # æ ‡ç­¾è´´åˆ°åˆ—è¡¨y_
        print('loading : ' + content)  # æ‰“å°çŠ¶æ€æç¤º

    x = np.array(x)  # å˜ä¸ºnp.arrayæ ¼å¼
    y_ = np.array(y_)  # å˜ä¸ºnp.arrayæ ¼å¼
    y_ = y_.astype(np.int64)  # å˜ä¸º64ä½æ•´å‹
    return x, y_  # è¿”å›è¾“å…¥ç‰¹å¾xï¼Œè¿”å›æ ‡ç­¾y_
</code></pre>
<h2 id="42-æ•°æ®å¢å¼º">4.2 æ•°æ®å¢å¼º</h2>
<p>image_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(<br>
rescale = æ‰€æœ‰æ•°æ®å°†ä¹˜ä»¥è¯¥æ•°å€¼<br>
rotation_range = éšæœºæ—‹è½¬è§’åº¦æ•°èŒƒå›´<br>
width_shift_range = éšæœºå®½åº¦åç§»é‡<br>
height_shift_range = éšæœºé«˜åº¦åç§»é‡<br>
æ°´å¹³ç¿»è½¬ï¼šhorizontal_flip = æ˜¯å¦éšæœºæ°´å¹³ç¿»è½¬<br>
éšå³ç¼©æ”¾ï¼šzoom_range = éšæœºç¼©æ”¾çš„èŒƒå›´[1 - n, 1 + n]<br>
)<br>
image_gen_train.fit(x_train)</p>
<p><strong>ğŸ’¬ Example</strong></p>
<pre><code class="language-python">image_gen_train = ImageDataGenerator(
	rescale=1. / 1.,  # å¦‚ä¸ºå›¾åƒï¼Œåˆ†æ¯ä¸º255æ—¶ï¼Œå¯å½’è‡³0~1
    rotation_range=45,  # éšæœº45åº¦æ—‹è½¬
    width_shift_range=.15,  # å®½åº¦åç§»
    height_shift_range=.15,  # é«˜åº¦åç§»
    horizontal_flip=False,  # æ°´å¹³ç¿»è½¬
    zoom_range=0.5  # å°†å›¾åƒéšæœºç¼©æ”¾é˜ˆé‡50%
)
image_gen_train.fit(x_train)
# æ­¤å¤„x_trainè¦ä¿®æ”¹ç»´åº¦
x_train = x_train.reshape(x_train.shape[0], 28, 28, 1)
# (60000, 28, 28)  â†’  (60000, 28, 28, 1)
model.fit(x_trsain, y_train, batch_size=32, ......)
# æ”¹ä¸º
model.fit(image_gen_train.flow(x_train, y_train, batch_size=32), ......)
</code></pre>
<p><strong>p13_mnist_train_ex2.py</strong></p>
<pre><code class="language-python">import tensorflow as tf
from tensorflow.keras.preprocessing.image import ImageDataGenerator

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0
x_train = x_train.reshape(x_train.shape[0], 28, 28, 1)  # ç»™æ•°æ®å¢åŠ ä¸€ä¸ªç»´åº¦,ä»(60000, 28, 28)reshapeä¸º(60000, 28, 28, 1)

image_gen_train = ImageDataGenerator(
    rescale=1. / 1.,  # å¦‚ä¸ºå›¾åƒï¼Œåˆ†æ¯ä¸º255æ—¶ï¼Œå¯å½’è‡³0ï½1
    rotation_range=45,  # éšæœº45åº¦æ—‹è½¬
    width_shift_range=.15,  # å®½åº¦åç§»
    height_shift_range=.15,  # é«˜åº¦åç§»
    horizontal_flip=False,  # æ°´å¹³ç¿»è½¬
    zoom_range=0.5  # å°†å›¾åƒéšæœºç¼©æ”¾é˜ˆé‡50ï¼…
)
image_gen_train.fit(x_train)

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

model.fit(image_gen_train.flow(x_train, y_train, batch_size=32), epochs=5, validation_data=(x_test, y_test),
          validation_freq=1)
model.summary()
</code></pre>
<h2 id="43-æ–­ç‚¹ç»­è®­">4.3 æ–­ç‚¹ç»­è®­</h2>
<p><strong>è¯»å–ä¿å­˜æ¨¡å‹</strong></p>
<p>âœ”ï¸ è¯»å–æ¨¡å‹</p>
<p>load_weights(è·¯å¾„æ–‡ä»¶å)</p>
<pre><code class="language-python">checkpoint_save_path = './checkpoint/mnist.ckpt'
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model------------')
    model.load_weights(checkpoint_save_path)
</code></pre>
<p>âœ”ï¸ ä¿å­˜æ¨¡å‹</p>
<p>tf.keras.callbacks.ModelCheckpoint(</p>
<p>â€‹	filepath=è·¯å¾„æ–‡ä»¶å,</p>
<p>â€‹	save_weights_only=True/False,</p>
<p>â€‹	save_best_only=True/False</p>
<p>)</p>
<p>history = model.fit(callbacks=[cp_callback])</p>
<pre><code class="language-python">cp_callback = tf.keras.callbacks.ModelCheckpoint(
	filepath=checkpoint_save_path,
    save_weights_only=True,
    save_best_only=True
)
history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1, callbacks=[cp_callback])
</code></pre>
<h2 id="44-å‚æ•°æå–æŠŠå‚æ•°å­˜å…¥æ–‡æœ¬">4.4 å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬</h2>
<p>âœ”ï¸ æå–å¯è®­ç»ƒå‚æ•°</p>
<p>model.trainable_variables  è¿”å›æ¨¡å‹ä¸­å¯è®­ç»ƒçš„å‚æ•°</p>
<p>âœ”ï¸ è®¾ç½®printè¾“å‡ºæ ¼å¼</p>
<p>np.set_printoptions(threshold=è¶…è¿‡å¤šå°‘çœç•¥æ˜¾ç¤º)</p>
<pre><code class="language-python">np.set_printoptions(threshold=np.inf)  # np.infè¡¨ç¤ºæ— é™å¤§
print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()
</code></pre>
<h2 id="45-acclosså¯è§†åŒ–æŸ¥çœ‹è®­ç»ƒæ•ˆæœ">4.5 acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœ</h2>
<p>accæ›²çº¿ä¸lossæ›²çº¿</p>
<p><strong>history = model.fit</strong>(è®­ç»ƒé›†æ•°æ®, è®­ç»ƒé›†æ ‡ç­¾, batch_size=, epochs=, validation_split=ç”¨ä½œæµ‹è¯•æ•°æ®çš„æ¯”ä¾‹, validation_data=æµ‹è¯•é›†, validation_freq=æµ‹è¯•é¢‘ç‡)</p>
<p><strong>history:</strong></p>
<p>è®­ç»ƒé›†lossï¼šloss</p>
<p>æµ‹è¯•é›†lossï¼šval_loss</p>
<p>è®­ç»ƒé›†å‡†ç¡®ç‡ï¼šsparse_categorical_accuracy</p>
<p>æµ‹è¯•é›†å‡†ç¡®ç‡ï¼šval_sparse_categorical_accuracy</p>
<pre><code class="language-python">acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']
</code></pre>
<pre><code class="language-python">import os

import numpy as np
import tensorflow as tf
import matplotlib.pyplot as plt

np.set_printoptions(threshold=np.inf)

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(
	optimizer='adam',
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

checkpoint_save_path = './checkpoint/mnist.ckpt'
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model------------')
    model.load_weights(checkpoint_save_path)
    
cp_callback = tf.keras.callbacks.ModelCheckpoint(
    filepath=checkpoint_save_path,
    save_weights_only=True,
    save_best_only=True                                                )

history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1, callbacks=[cp_callback])
model.summary()

print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()


########################Show###################
acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']

plt.subplot(1, 2, 1)  # åˆ†ä¸ºä¸€è¡Œä¸¤åˆ—ï¼Œå…ˆç”»ç¬¬ä¸€åˆ—
plt.plot(acc, label='Training Accuracy')
plt.plot(val_acc, label='Validation Accuracy')
plt.title('Training and Validation Accuracy')
plt.legend()

plt.subplot(1, 2, 2)  # åˆ†ä¸ºä¸€è¡Œä¸¤åˆ—ï¼Œç”»ç¬¬äºŒåˆ—
plt.plot(loss, label='Training Loss')
plt.plot(val_loss, label='Validation Loss')
plt.title('Training and Validation Loss')
plt.legend()
plt.show()
</code></pre>
<figure data-type="image" tabindex="15"><img src="C:%5CUsers%5CDell%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210320102608494.png" alt="image-20210320102608494" loading="lazy"></figure>
<h2 id="46-ç»™å›¾è¯†ç‰©">4.6 ç»™å›¾è¯†ç‰©</h2>
<p>âœ”ï¸ å‰å‘ä¼ æ’­æ‰§è¡Œåº”ç”¨</p>
<p>predict(è¾“å…¥ç‰¹å¾, batch_size=æ•´æ•°)</p>
<p>è¿”å›å‰å‘ä¼ æ’­è®¡ç®—ç»“æœ</p>
<p><strong>å¤ç°æ¨¡å‹ï¼ˆå‰å‘ä¼ æ’­ï¼‰</strong>  model = tf.keras.models.Sequential([......])</p>
<p><strong>åŠ è½½å‚æ•°</strong>  model.load_weights(model_save_path)</p>
<p><strong>é¢„æµ‹ç»“æœ</strong>  result = model.predict(x_predict)</p>
<pre><code class="language-python">from PIL import Image
import numpy as np
import tensorflow as tf
import matplotlib.pyplot as plt

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.load_weights(model_save_path)

preNum = int(input('input the number of test pictures:'))

for i in range(preNum):
    image_path = input('the path of test picture:')
    img = Image.open(image_path)
    img = img.resize((28, 28), Image.ANTIALIAS)
    img_arr = np.array(img.convert('L'))
    
    # img_arr = 255 - img_arr
    
    # å°†å›¾ç‰‡å¤„ç†ä¸ºé«˜å¯¹æ¯”åº¦å›¾ç‰‡
    for i in range(28):
        for j in range(28):
            if img_arr[i][j] &lt; 200:
                img_arr[i][j] = 255
            else:
                img_arr[i][j] = 0
    
    
    img_arr = img_arr / 255.0  # å½’ä¸€åŒ–
    x_predict = img_arr[tf.newaxis, ...]
    result = model.predict(x_predict)
    pred = tf.argmax(result, axis=1)
    print('\n')
    tf.print(pred)

    plt.pause(1)
    plt.close()
</code></pre>
<h1 id="ç¬¬äº”ç« -å·ç§¯è®¡ç®—è¿‡ç¨‹">ç¬¬äº”ç«  å·ç§¯è®¡ç®—è¿‡ç¨‹</h1>
<ul>
<li>
<p>å·ç§¯è®¡ç®—å¯è®¤ä¸ºæ˜¯ä¸€ç§æœ‰æ•ˆæå–å›¾åƒç‰¹å¾çš„æ–¹æ³•</p>
</li>
<li>
<p>ä¸€èˆ¬ä¼šç”¨ä¸€ä¸ªæ­£æ–¹å½¢çš„å·ç§¯æ ¸ï¼ŒæŒ‰æŒ‡å®šæ­¥é•¿ï¼Œåœ¨è¾“å…¥ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨ï¼Œéå†è¾“å…¥ç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªåƒç´ ç‚¹ã€‚æ¯ä¸€ä¸ªæ­¥é•¿ï¼Œå·ç§¯æ ¸ä¼šä¸è¾“å…¥ç‰¹å¾å›¾å‡ºç°é‡åˆåŒºåŸŸï¼Œé‡åˆåŒºåŸŸå¯¹åº”å…ƒç´ ç›¸ä¹˜ã€æ±‚å’Œå†åŠ ä¸Šåç½®é¡¹å¾—åˆ°è¾“å‡ºç‰¹å¾çš„ä¸€ä¸ªåƒç´ ç‚¹ã€‚</p>
</li>
</ul>
<p>è¾“å…¥ç‰¹å¾å›¾çš„æ·±åº¦ï¼ˆ<strong>channelæ•°</strong>ï¼‰ï¼Œå†³å®šäº†å½“å‰å±‚å·ç§¯æ ¸çš„æ·±åº¦ï¼›</p>
<p>å½“å‰å±‚å·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œå†³å®šäº†å½“å‰å±‚è¾“å‡ºç‰¹å¾å›¾çš„æ·±åº¦ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[MODEL-ENSEMBLE TRUST-REGION POLICY OPTIMIZATION]]></title>
        <id>https://perfectqing.github.io/blogs/post/OPTIMIZATION/</id>
        <link href="https://perfectqing.github.io/blogs/post/OPTIMIZATION/">
        </link>
        <updated>2021-06-11T02:24:17.000Z</updated>
        <content type="html"><![CDATA[<h1 id="model-ensemble-trust-region-policy-optimization">MODEL-ENSEMBLE TRUST-REGION POLICY OPTIMIZATION</h1>
<h2 id="æ‘˜è¦">æ‘˜è¦ï¼š</h2>
<p>å€ŸåŠ©æ·±åº¦å­¦ä¹ çš„æœ€æ–°è¿›å±•ï¼Œæ— æ¨¡å‹å¼ºåŒ–å­¦ä¹ æ–¹æ³•åœ¨è¶Šæ¥è¶Šå¤šçš„ä»»åŠ¡ä¸­å–å¾—äº†æˆåŠŸã€‚ç„¶è€Œï¼Œå®ƒä»¬å¾€å¾€é­å—é«˜æ ·æœ¬å¤æ‚æ€§çš„å›°æ‰°ï¼Œè¿™é˜»ç¢äº†å®ƒä»¬åœ¨ç°å®ä¸–ç•Œé¢†åŸŸä¸­çš„åº”ç”¨ã€‚æˆ–è€…ï¼ŒåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ <strong>æœ‰æœ›é™ä½æ ·æœ¬å¤æ‚æ€§</strong>ï¼Œä½†å¾€å¾€éœ€è¦ä»”ç»†è°ƒæ•´ï¼Œè¿„ä»Šä¸ºæ­¢ï¼Œå®ƒä¸»è¦åœ¨<strong>ç®€å•æ¨¡å‹è¶³ä»¥å­¦ä¹ </strong>çš„é™åˆ¶æ€§é¢†åŸŸå–å¾—äº†æˆåŠŸã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº†å½“ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œæ¥å­¦ä¹ æ¨¡å‹å’Œç­–ç•¥æ—¶ï¼ŒåŸºäºæ™®é€šæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•çš„è¡Œä¸ºï¼Œå¹¶ä¸”æˆ‘ä»¬è¡¨æ˜ï¼Œå­¦ä¹ çš„ç­–ç•¥å€¾å‘äºåˆ©ç”¨æ•°æ®ä¸è¶³çš„åŒºåŸŸæ¥å­¦ä¹ æ¨¡å‹ï¼Œå¯¼è‡´è®­ç»ƒä¸ç¨³å®šã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ä¸€ç»„æ¨¡å‹æ¥ä¿æŒæ¨¡å‹çš„ä¸ç¡®å®šæ€§ï¼Œå¹¶è§„èŒƒå­¦ä¹ è¿‡ç¨‹ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥è¡¨æ˜ï¼Œä¼¼ç„¶æ¯”å¯¼æ•°çš„ä½¿ç”¨æ¯”æ—¶é—´çš„åå‘ä¼ æ’­äº§ç”Ÿæ›´ç¨³å®šçš„å­¦ä¹ ã€‚</p>
<p>æ€»ä¹‹ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ¨¡å‹é›†æˆä¿¡ä»»åŒºåŸŸç­–ç•¥ä¼˜åŒ–(ME-TRPO)ä¸æ— æ¨¡å‹æ·±åº¦RLæ–¹æ³•ç›¸æ¯”ï¼Œåœ¨æŒ‘æˆ˜è¿ç»­æ§åˆ¶åŸºå‡†ä»»åŠ¡<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mrow></mrow><mrow><mn>1</mn><mo separator="true">,</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">^{1,2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>ä¸Š<strong>æ˜¾è‘—é™ä½äº†æ ·æœ¬å¤æ‚æ€§</strong>ã€‚</p>
<h2 id="1-introduction">1 Introduction</h2>
<p>æ·±åº¦å¼ºåŒ–å­¦ä¹ è¿‘å¹´æ¥å–å¾—äº†å¾ˆå¤šä»¤äººå°è±¡æ·±åˆ»çš„æˆæœï¼Œè¿™äº›ç»“æœä¸­çš„è®¸å¤šæ˜¯ä½¿ç”¨æ— æ¨¡å‹å¼ºåŒ–å­¦ä¹ ç®—æ³•å®ç°çš„ï¼Œè¯¥ç®—æ³•ä¸è¯•å›¾æ„å»ºç¯å¢ƒæ¨¡å‹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•åˆ©ç”¨ç¯å¢ƒçš„å·²å­¦ä¹ åˆ°çš„æ¨¡å‹æ¥è¾…åŠ©å­¦ä¹ ã€‚è¿™äº›æ–¹æ³•å¯èƒ½æ¯”æ— æ¨¡å‹ç®—æ³•å…·æœ‰æ›´é«˜çš„æ ·æœ¬æ•ˆç‡ï¼Œå› æ­¤å¯ä»¥åº”ç”¨äºä½æ ·æœ¬å¤æ‚åº¦è‡³å…³é‡è¦çš„ç°å®ä»»åŠ¡ã€‚ç„¶è€Œï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™æ ·çš„æ–¹æ³•éœ€è¦<strong>ä¸€ä¸ªå…³äºå­¦ä¹ æ¨¡å‹çš„éå¸¸ä¸¥æ ¼çš„å½¢å¼</strong>ï¼Œä»¥åŠä¸ºä½¿å®ƒä»¬é€‚ç”¨è€Œè¿›è¡Œçš„ä»”ç»†è°ƒæ•´ã€‚è™½ç„¶å°†åŸºäºæ¨¡å‹çš„ç®—æ³•æ‰©å±•åˆ°æ·±åº¦ç¥ç»ç½‘ç»œæ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•çš„æƒ³æ³•ï¼Œä½†è¿„ä»Šä¸ºæ­¢æˆåŠŸçš„åº”ç”¨ç›¸å¯¹è¾ƒå°‘ã€‚</p>
<p>åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ çš„æ ‡å‡†æ–¹æ³•åœ¨æ¨¡å‹å­¦ä¹ å’Œç­–ç•¥ä¼˜åŒ–ä¹‹é—´äº¤æ›¿ã€‚åœ¨æ¨¡å‹å­¦ä¹ é˜¶æ®µï¼Œä»ä¸ç¯å¢ƒçš„äº¤äº’ä¸­æ”¶é›†æ ·æœ¬ï¼Œå¹¶ä½¿ç”¨ç›‘ç£å­¦ä¹ æ¥å°†åŠ¨åŠ›å­¦æ¨¡å‹æ‹Ÿåˆåˆ°è§‚å¯Ÿå€¼ã€‚åœ¨ç­–ç•¥ä¼˜åŒ–é˜¶æ®µï¼Œå­¦ä¹ çš„æ¨¡å‹ç”¨äºæœç´¢æ”¹è¿›çš„ç­–ç•¥ã€‚</p>
<p>è™½ç„¶æ™®é€šçš„åŸºäºæ¨¡å‹çš„åå‘å­¦ä¹ å¯ä»¥åœ¨ä½ç»´ä»»åŠ¡ä¸­ä»¥ç›¸å¯¹ç®€å•çš„åŠ¨åŠ›å­¦å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†æˆ‘ä»¬å‘ç°åœ¨æ›´å…·æŒ‘æˆ˜æ€§çš„è¿ç»­æ§åˆ¶ä»»åŠ¡ä¸­ï¼Œæ€§èƒ½éå¸¸ä¸ç¨³å®šã€‚å½“ä½¿ç”¨è¯¸å¦‚æ·±åº¦ç¥ç»ç½‘ç»œçš„è¡¨è¾¾æ¨¡å‹æ—¶ï¼Œè¿™ä¸ªé—®é¢˜ä¸¥é‡æ¶åŒ–ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œçš„é›†åˆæ¥ä¿æŒæ¨¡å‹çš„ä¸ç¡®å®šæ€§ï¼Œç»™å®šä»ç¯å¢ƒä¸­æ”¶é›†çš„æ•°æ®ã€‚åœ¨æ¨¡å‹å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ”¹å˜ç¥ç»ç½‘ç»œçš„æƒå€¼åˆå§‹åŒ–å’Œè®­ç»ƒè¾“å…¥åºåˆ—æ¥åŒºåˆ†ç¥ç»ç½‘ç»œã€‚ç„¶åï¼Œåœ¨ç­–ç•¥å­¦ä¹ æœŸé—´ï¼Œæˆ‘ä»¬é€šè¿‡ç»“åˆæ¥è‡ªæƒ³è±¡çš„éšæœºå±•å¼€çš„æ¢¯åº¦æ¥è°ƒæ•´ç­–ç•¥æ›´æ–°ã€‚æ¯ä¸ªæƒ³è±¡çš„æ­¥éª¤éƒ½æ˜¯ä»ç³»ç»¼é¢„æµ‹ä¸­ç»Ÿä¸€é‡‡æ ·çš„ã€‚ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œç­–ç•¥å­¦ä¼šäº†åœ¨å®é™…ç¯å¢ƒä¸­é‡åˆ°çš„å„ç§å¯èƒ½çš„æƒ…å†µä¸‹å˜å¾—å¥å£®ã€‚ä¸ºäº†é¿å…è¿‡åº¦é€‚åº”è¿™ä¸ªæ­£åˆ™åŒ–ç›®æ ‡ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡å‹é›†æˆè¿›è¡Œæ—©æœŸåœæ­¢ç­–ç•¥è®­ç»ƒã€‚</p>
<p>æ ‡å‡†çš„åŸºäºæ¨¡å‹çš„æŠ€æœ¯éœ€è¦åœ¨è®¸å¤šæ—¶é—´æ­¥éª¤ä¸Šå¯¹æ¨¡å‹è¿›è¡ŒåŒºåˆ†ï¼Œè¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸ºæ—¶é—´åå‘ä¼ æ’­(BPTT)ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨æ–‡çŒ®ä¸­ï¼ŒBPTTå¯ä»¥å¯¼è‡´çˆ†ç‚¸å’Œæ¶ˆå¤±æ¢¯åº¦(Hochreiterï¼Œ1991ï¼›Bengioç­‰äººï¼Œ1994å¹´)ã€‚å³ä½¿åº”ç”¨äº†æ¢¯åº¦è£å‰ªï¼ŒBPTTä»ç„¶ä¼šé™·å…¥ç³Ÿç³•çš„å±€éƒ¨æœ€ä¼˜ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨ä¼¼ç„¶æ¯”æ–¹æ³•ä»£æ›¿BPTTæ¥ä¼°è®¡æ¢¯åº¦ï¼Œè¿™ä»…åˆ©ç”¨æ¨¡å‹ä½œä¸ºæ¨¡æ‹Ÿå™¨ï¼Œè€Œä¸æ˜¯ç”¨äºç›´æ¥æ¢¯åº¦è®¡ç®—ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¿¡ä»»åŒºç­–ç•¥ä¼˜åŒ–(TRPO)(èˆ’å°”æ›¼ç­‰äººï¼Œ2015)ï¼Œè¯¥ç­–ç•¥å¯¹ç­–ç•¥æ–½åŠ ä¿¡ä»»åŒºçº¦æŸï¼Œä»¥è¿›ä¸€æ­¥ç¨³å®šå­¦ä¹ ã€‚</p>
<p>åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†æ¨¡å‹é›†æˆä¿¡ä»»åŒºåŸŸç­–ç•¥ä¼˜åŒ–(ME-TRPO)ï¼Œè¿™æ˜¯ä¸€ç§åŸºäºæ¨¡å‹çš„ç®—æ³•ï¼Œå…¶æ€§èƒ½ä¸æœ€å…ˆè¿›çš„æ— æ¨¡å‹ç®—æ³•ç›¸åŒï¼Œæ ·æœ¬å¤æ‚åº¦é™ä½äº†100å€ã€‚æˆ‘ä»¬è¯æ˜äº†æ¨¡å‹é›†æˆæŠ€æœ¯æ˜¯å…‹æœåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ä¸­æ¨¡å‹åå·®æŒ‘æˆ˜çš„æœ‰æ•ˆæ–¹æ³•ã€‚æˆ‘ä»¬è¯æ˜ç”¨TRPOä»£æ›¿BPTTå¯ä»¥äº§ç”Ÿæ›´ç¨³å®šçš„å­¦ä¹ å’Œæ›´å¥½çš„æœ€ç»ˆæ€§èƒ½ã€‚æœ€åï¼Œæˆ‘ä»¬ç”¨ç¥ç»ç½‘ç»œä½œä¸ºå‡½æ•°é€¼è¿‘å™¨ï¼Œå¯¹åŸºäºå…¸å‹æ¨¡å‹çš„çº¿æ€§å›å½’è¿›è¡Œäº†å®è¯åˆ†æï¼Œå¹¶æŒ‡å‡ºå…¶åœ¨åº”ç”¨äºå…·æœ‰æŒ‘æˆ˜æ€§çš„è¿ç»­æ§åˆ¶ä»»åŠ¡æ—¶çš„ç¼ºé™·ã€‚</p>
<h2 id="2-related-work">2 Related Work</h2>
<p>å·²ç»æœ‰å¤§é‡åŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ çš„å·¥ä½œã€‚å®ƒä»¬çš„ä¸åŒä¹‹å¤„åœ¨äºæ¨¡å‹å‚æ•°åŒ–çš„é€‰æ‹©ï¼Œè¿™ä¸åˆ©ç”¨æ¨¡å‹è¿›è¡Œæ”¿ç­–å­¦ä¹ çš„ä¸åŒæ–¹å¼æœ‰å…³ã€‚æœ‰è¶£çš„æ˜¯ï¼Œè¿„ä»Šä¸ºæ­¢æœ€ä»¤äººå°è±¡æ·±åˆ»çš„æœºå™¨äººå­¦ä¹ åº”ç”¨æ˜¯ä½¿ç”¨æœ€ç®€å•çš„æ¨¡å‹å‚æ•°åŒ–å®ç°çš„ï¼Œå³çº¿æ€§æ¨¡å‹(å·´å†…å°”&amp;æ–½è€å¾·ï¼Œ2001ï¼›Abbeelç­‰äººï¼Œ2006å¹´ï¼›Levine  &amp;  Abbeelï¼Œ2014ï¼›Watterç­‰äººï¼Œ2015å¹´ï¼›Levineç­‰äººï¼Œ2016å¹´aï¼›åº“é©¬å°”ç­‰äººï¼Œ2016)ï¼Œå…¶ä¸­æ¨¡å‹æˆ–è€…ç›´æ¥åœ¨åŸå§‹çŠ¶æ€ä¸Šè¿è¡Œï¼Œæˆ–è€…åœ¨çŠ¶æ€çš„ç‰¹å¾è¡¨ç¤ºä¸Šè¿è¡Œã€‚è¿™ç§æ¨¡å‹æ˜¯éå¸¸æ•°æ®æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”å…è®¸é€šè¿‡æ¥è‡ªæœ€ä¼˜æ§åˆ¶çš„æŠ€æœ¯è¿›è¡Œéå¸¸æœ‰æ•ˆçš„ç­–ç•¥ä¼˜åŒ–ã€‚ç„¶è€Œï¼Œå®ƒä»¬åªæœ‰æœ‰é™çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¸èƒ½å¾ˆå¥½åœ°æ‰©å±•åˆ°å¤æ‚çš„éçº¿æ€§åŠ¨åŠ›å­¦æˆ–é«˜ç»´çŠ¶æ€ç©ºé—´ï¼Œé™¤éä½¿ç”¨å•ç‹¬çš„ç‰¹å¾å­¦ä¹ é˜¶æ®µ(Watterç­‰äººï¼Œ2015)ã€‚</p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨éå‚æ•°æ¨¡å‹ï¼Œå¦‚é«˜æ–¯è¿‡ç¨‹(GPs)(æ‹‰æ–¯å§†æ£®ç­‰äººï¼Œ2003å¹´ï¼›Koç­‰äººï¼Œ2007å¹´ï¼›Deisenroth &amp;  Rasmussenï¼Œ2011)ã€‚è¿™ç§æ¨¡å‹å¯ä»¥æœ‰æ•ˆåœ°ä¿æŒé¢„æµ‹çš„ä¸ç¡®å®šæ€§ï¼Œå¹¶ä¸”åªè¦æœ‰è¶³å¤Ÿçš„æ•°æ®å¯ç”¨ï¼Œå°±å…·æœ‰æ— é™çš„è¡¨ç¤ºèƒ½åŠ›ã€‚ç„¶è€Œï¼Œå®ƒä»¬é­å—ç€ç»´åº¦çš„è¯…å’’ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒä»¬çš„åº”ç”¨ä»…é™äºç›¸å¯¹ä½ç»´çš„ç¯å¢ƒã€‚å°†GPsçš„ä¸ç¡®å®šæ€§ä¼°è®¡çº³å…¥æ”¿ç­–æ›´æ–°çš„è®¡ç®—è´¹ç”¨ä¹Ÿå¸¦æ¥äº†é¢å¤–çš„æŒ‘æˆ˜ã€‚</p>
<p>æ·±åº¦ç¥ç»ç½‘ç»œåœ¨å°†æ— æ¨¡å‹å¼ºåŒ–å­¦ä¹ ç®—æ³•å‡çº§åˆ°å…·æœ‰æŒ‘æˆ˜æ€§çš„åœºæ™¯æ–¹é¢å–å¾—äº†å·¨å¤§æˆåŠŸ(Mnihç­‰äººï¼Œ2015ï¼›Silverç­‰äººï¼Œ2016å¹´ï¼›èˆ’å°”æ›¼ç­‰äººï¼Œ2015å¹´ï¼›2016).ç„¶è€Œï¼Œåœ¨å°†å®ƒä»¬åº”ç”¨äºåŸºäºæ¨¡å‹çš„é€†å‘ç‰©æµæ–¹é¢å–å¾—çš„æˆåŠŸæœ‰é™ã€‚å°½ç®¡è®¸å¤šå…ˆå‰çš„ç ”ç©¶å·²ç»åœ¨ç›¸å¯¹ç®€å•çš„é¢†åŸŸæ˜¾ç¤ºå‡ºæœ‰å¸Œæœ›çš„ç»“æœ(Nguyen  &amp;Wiå“å°”ï¼Œ1990ï¼›Schmidhuber &amp;  Huberï¼Œ1991ï¼›çº¦æ—¦&amp;é²æ¢…å°”å“ˆç‰¹ï¼Œ1992å¹´ï¼›Galç­‰äººï¼Œ2016)ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä»–ä»¬åœ¨æ›´å…·æŒ‘æˆ˜æ€§é¢†åŸŸçš„åº”ç”¨è¦ä¹ˆéœ€è¦ä¸æ— æ¨¡å‹æŠ€æœ¯ç›¸ç»“åˆ(Ohç­‰äººï¼Œ2015ï¼›Heessç­‰äººï¼Œ2015å¹´ï¼›Nagabandiç­‰äººï¼Œ2017å¹´)ï¼Œæˆ–ç‰¹å®šé¢†åŸŸçš„æ”¿ç­–å­¦ä¹ æˆ–è§„åˆ’ç®—æ³•(Lenzç­‰äººï¼Œ2015å¹´ï¼›Agrawalç­‰äººï¼Œ2016å¹´ï¼›Pinto  &amp; Guptaï¼Œ2016ï¼›Levineç­‰äººï¼Œ2016bFinn &amp;  Levineï¼Œ2017ï¼›å¥ˆå°”ç­‰äººï¼Œ2017å¹´)ã€‚åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¡¨æ˜ï¼Œä¸ç»“åˆåŸºäºæ¨¡å‹å’Œæ— æ¨¡å‹å…ƒç´ çš„æ–¹æ³•ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„çº¯åŸºäºæ¨¡å‹çš„æ–¹æ³•æé«˜äº†æ ·æœ¬çš„å¤æ‚æ€§ã€‚</p>
<p>æœ€è¿‘çš„ä¸¤é¡¹ç ”ç©¶æ˜¾ç¤ºäº†ä¸€ç§æ›´æ™®éé€‚ç”¨çš„åŸºäºæ¨¡å‹çš„åå‘é“¾è·¯ç®—æ³•çš„è‰¯å¥½è¿¹è±¡ã€‚Depewegç­‰äºº(2017)åˆ©ç”¨è´å¶æ–¯ç¥ç»ç½‘ç»œ(BNNs)å­¦ä¹ åŠ¨æ€æ¨¡å‹ä¸Šçš„åˆ†å¸ƒï¼Œå¹¶ä½¿ç”¨åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–åœ¨ä»è¯¥åˆ†å¸ƒé‡‡æ ·çš„æ¨¡å‹é›†åˆä¸Šè®­ç»ƒç­–ç•¥ã€‚Mishraç­‰äºº(2017)åœ¨è½¨è¿¹çš„æ—¶é—´å»¶ä¼¸æ®µä¸Šå­¦ä¹ æ½œåœ¨å˜é‡åŠ¨æ€æ¨¡å‹ï¼Œå¹¶åœ¨æ½œåœ¨ç©ºé—´ä¸Šä½¿ç”¨åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–æ¥è®­ç»ƒç­–ç•¥ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥åœ¨ç®—æ³•å¼€å§‹è¿è¡Œä¹‹å‰æ”¶é›†çš„å›ºå®šæ ·æœ¬æ•°æ®é›†ä¸Šå·¥ä½œã€‚å› æ­¤ï¼Œä»–ä»¬çš„è¯„ä¼°ä»…é™äºéšæœºæ¢ç´¢è¶³ä»¥æ”¶é›†æ¨¡å‹å­¦ä¹ æ•°æ®çš„é¢†åŸŸã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬çš„æ–¹æ³•åˆ©ç”¨äº†äº¤æ›¿æ‰§è¡Œæ¨¡å‹å­¦ä¹ å’Œç­–ç•¥å­¦ä¹ çš„è¿­ä»£è¿‡ç¨‹ï¼Œå› æ­¤å¯ä»¥åº”ç”¨äºæ›´å…·æŒ‘æˆ˜æ€§çš„é¢†åŸŸã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æå‡ºçš„æ”¹è¿›ä¸è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯æ­£äº¤çš„ï¼Œå¹¶ä¸”æœ‰å¯èƒ½ç»“åˆèµ·æ¥äº§ç”Ÿæ›´å¥½çš„ç»“æœã€‚</p>
<h2 id="3-preliminaries">3 Preliminaries</h2>
<p>å¼ºåŒ–å­¦ä¹ ç›¸å…³</p>
<h2 id="4-vanilla-model-based-deep-reinforcement-learning">4 Vanilla model-based deep reinforcement learning</h2>
<p>åœ¨æœ€æˆåŠŸçš„æ— æ¨¡å‹å¼ºåŒ–å­¦ä¹ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¿­ä»£åœ°æ”¶é›†æ•°æ®ï¼Œä¼°è®¡ç­–ç•¥çš„æ¢¯åº¦ï¼Œæ”¹è¿›ç­–ç•¥ï¼Œç„¶åä¸¢å¼ƒæ•°æ®ã€‚ç›¸åï¼ŒåŸºäºæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ æ›´å¹¿æ³›åœ°ä½¿ç”¨æ•°æ®ï¼›å®ƒä½¿ç”¨æ”¶é›†çš„æ‰€æœ‰æ•°æ®æ¥è®­ç»ƒç¯å¢ƒåŠ¨æ€çš„æ¨¡å‹ã€‚è®­ç»ƒå¥½çš„æ¨¡å‹å¯ä»¥ä½œä¸ºè®­ç»ƒç­–ç•¥çš„æ¨¡æ‹Ÿå™¨ï¼Œä¹Ÿå¯ä»¥æä¾›æ¢¯åº¦ä¿¡æ¯(è¨é¡¿ï¼Œ1990ï¼›Deisenroth  &amp;  Rasmussenï¼Œ2011ï¼›Depewegç­‰äººï¼Œ2017å¹´ï¼›è¨é¡¿ï¼Œ1991)ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†åŸºäºæ™®é€šæ¨¡å‹çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•(è§ç®—æ³•1)ã€‚æˆ‘ä»¬å‡è®¾æ¨¡å‹å’Œç­–ç•¥ç”±ç¥ç»ç½‘ç»œè¡¨ç¤ºï¼Œä½†æ˜¯è¯¥æ–¹æ³•å¯¹äºå…¶ä»–ç±»å‹çš„å‡½æ•°é€¼è¿‘å™¨æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<h3 id="41-model-learning">4.1 Model learning</h3>
<p>è¿‡æ¸¡åŠ¨æ€ç”¨å‰é¦ˆç¥ç»ç½‘ç»œå»ºæ¨¡ï¼Œä½¿ç”¨æ ‡å‡†å®è·µæ¥è®­ç»ƒç¥ç»ç½‘ç»œä»¥é¢„æµ‹ç»™å®šçŠ¶æ€å’ŒåŠ¨ä½œä½œä¸ºè¾“å…¥çš„çŠ¶æ€(è€Œä¸æ˜¯ä¸‹ä¸€ä¸ªçŠ¶æ€)çš„å˜åŒ–ã€‚è¿™ç¼“è§£äº†ç¥ç»ç½‘ç»œå¯¹è¾“å…¥çŠ¶æ€çš„è®°å¿†ï¼Œå°¤å…¶æ˜¯åœ¨å˜åŒ–å¾ˆå°æ—¶(Deisenroth  &amp; Rasmussenï¼Œ2011ï¼›å‚…ç­‰ï¼Œ2016ï¼›Nagabandiç­‰äººï¼Œ2017å¹´)ã€‚æˆ‘ä»¬è¡¨ç¤ºä¸‹ä¸€ä¸ªçŠ¶æ€çš„å‡½æ•°é€¼è¿‘å™¨ï¼Œå®ƒæ˜¯ç¥ç»ç½‘ç»œçš„è¾“å…¥çŠ¶æ€å’Œè¾“å‡ºçš„å’Œã€‚æ¨¡å‹å­¦ä¹ çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä½¿L21æ­¥é¢„æµ‹æŸå¤±æœ€å°çš„å‚æ•°Ï†3:å…¶ä¸­Dæ˜¯å­˜å‚¨ä»£ç†ç»å†çš„è½¬æ¢çš„è®­ç»ƒæ•°æ®é›†ã€‚æˆ‘ä»¬ä½¿ç”¨äºšå½“ä¼˜åŒ–å™¨(Kingma &amp;  Baï¼Œ2014)æ¥è§£å†³è¿™ä¸ªç›‘ç£å­¦ä¹ é—®é¢˜ã€‚éµå¾ªæ ‡å‡†æŠ€æœ¯ä»¥é¿å…è¿‡åº¦æ‹Ÿåˆå¹¶ä¿ƒè¿›å­¦ä¹ ï¼Œä¾‹å¦‚åˆ†ç¦»éªŒè¯æ•°æ®é›†ä»¥æå‰åœæ­¢è®­ç»ƒï¼Œä»¥åŠå°†ç¥ç»ç½‘ç»œçš„è¾“å…¥å’Œè¾“å‡ºæ ‡å‡†åŒ–4</p>
<h3 id="42-policy-learning">4.2 Policy learning</h3>
<p>ç­–ç•¥å­¦ä¹ </p>
<h2 id="5-model-ensemble-trust-region-policy-optimization">5 Model-Ensemble Trust-Region policy optimization</h2>
<p>ä½¿ç”¨ç¬¬4èŠ‚ä¸­æè¿°çš„æ™®é€šæ–¹æ³•ï¼Œæˆ‘ä»¬å‘ç°å­¦ä¹ çš„ç­–ç•¥é€šå¸¸åˆ©ç”¨åŠ¨åŠ›å­¦æ¨¡å‹å¯ç”¨çš„ç¨€ç¼ºè®­ç»ƒæ•°æ®çš„åŒºåŸŸã€‚å› ä¸ºæˆ‘ä»¬åœ¨æ”¹è¿›å…³äºè¿‘ä¼¼MDPè€Œä¸æ˜¯çœŸå®çš„æ”¿ç­–ï¼Œé‚£ä¹ˆå¯¹æ”¿ç­–æœ‰åˆ©çš„é¢„æµ‹å¯èƒ½æ˜¯é”™è¯¯çš„ã€‚è¿™ç§è¿‡æ‹Ÿåˆé—®é¢˜å¯ä»¥é€šè¿‡ä»¥ç±»ä¼¼äºç›‘ç£å­¦ä¹ çš„æ–¹å¼æå‰åœæ­¢ä½¿ç”¨éªŒè¯åˆå§‹çŠ¶æ€æ¥éƒ¨åˆ†ç¼“è§£ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å‘ç°è¿™æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæ€§èƒ½ä»ç„¶æ˜¯ä½¿ç”¨ç›¸åŒçš„å­¦ä¹ æ¨¡å‹æ¥è¯„ä¼°çš„ï¼Œè¿™å¾€å¾€ä¼šçŠ¯ä¸€è‡´çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œè™½ç„¶æ¢¯åº¦å‰ªè¾‘é€šå¸¸å¯ä»¥è§£å†³çˆ†ç‚¸æ¢¯åº¦ï¼ŒBPTTä»ç„¶é­å—æ¶ˆå¤±æ¢¯åº¦ï¼Œè¿™å¯¼è‡´æ”¿ç­–é™·å…¥ç³Ÿç³•çš„å±€éƒ¨æœ€ä¼˜(æœ¬å‰å¥¥ç­‰äººï¼Œ1994ï¼›Pascanuç­‰äººï¼Œ2013å¹´)ã€‚è¿™äº›é—®é¢˜åœ¨é•¿è§†é‡ä¼˜åŒ–æ—¶å°¤ä¸ºä¸¥é‡ï¼Œè¿™åœ¨å¼ºåŒ–å­¦ä¹ é—®é¢˜ä¸­éå¸¸å¸¸è§ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨æå‡ºæˆ‘ä»¬çš„æ–¹æ³•ï¼Œæ¨¡å‹é›†æˆä¿¡ä»»åŒºåŸŸç­–ç•¥ä¼˜åŒ–ã€‚ä¼ªä»£ç å¦‚ç®—æ³•2æ‰€ç¤ºã€‚ME-TRPOç»“åˆäº†å¯¹æ™®é€šæ–¹æ³•çš„ä¸‰ç§ä¿®æ”¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ‹Ÿåˆä¸€ç»„åŠ¨åŠ›å­¦æ¨¡å‹{fÏ†1ï¼Œ.ã€‚ã€‚ä½¿ç”¨ç›¸åŒçš„çœŸå®ä¸–ç•Œæ•°æ®ã€‚è¿™äº›æ¨¡å‹é€šè¿‡æ ‡å‡†ç›‘ç£å­¦ä¹ è¿›è¡Œè®­ç»ƒï¼Œå¦‚ç¬¬4.1èŠ‚æ‰€è¿°ï¼Œå®ƒä»¬çš„åŒºåˆ«ä»…åœ¨äºåˆå§‹æƒé‡å’Œå°æ‰¹é‡æ ·æœ¬çš„é‡‡æ ·é¡ºåºã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¿¡ä»»åŒºåŸŸç­–ç•¥ä¼˜åŒ–(TRPO)æ¥ä¼˜åŒ–æ¨¡å‹é›†æˆä¸Šçš„ç­–ç•¥ã€‚ç¬¬ä¸‰ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡å‹é›†æˆæ¥ç›‘æ§ç­–ç•¥åœ¨éªŒè¯æ•°æ®ä¸Šçš„æ€§èƒ½ï¼Œå¹¶åœ¨ç­–ç•¥åœæ­¢æ”¹è¿›æ—¶åœæ­¢å½“å‰è¿­ä»£ã€‚ä¸‹é¢è¯¦ç»†æè¿°ç¬¬äºŒå’Œç¬¬ä¸‰ä¿®æ”¹ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://perfectqing.github.io/blogs/post/hello-gridea/</id>
        <link href="https://perfectqing.github.io/blogs/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>