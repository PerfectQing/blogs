<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±• | BLOG</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://perfectqing.github.io/blogs/favicon.ico?v=1626771746855">
<link rel="stylesheet" href="https://perfectqing.github.io/blogs/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ğŸ‘  ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•
âœï¸  æœ¬ç« ç›®æ ‡ï¼šè‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨ã€æ•°æ®å¢å¼ºï¼Œæ‰©å……æ•°æ®é›†ã€æ–­ç‚¹ç»­è®­ï¼Œå­˜å–æ¨¡å‹ã€å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬ã€acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœã€åº”ç”¨ç¨‹åºï¼Œç»™å›¾è¯†ç‰©

ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•..." />
    <meta name="keywords" content="TensorFlow ç¬”è®°" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://perfectqing.github.io/blogs">
        <img src="https://perfectqing.github.io/blogs/images/avatar.png?v=1626771746855" class="site-logo">
        <h1 class="site-title">BLOG</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      Carry on what you want...
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> Copyright Â© AlsoRan | <a class="rss" href="https://perfectqing.github.io/blogs/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•</h2>
            <div class="post-date">2021-07-16</div>
            
              <div class="feature-container" style="background-image: url('https://perfectqing.github.io/blogs/post-images/hello-gridea.png')">
              </div>
            
            <div class="post-content" v-pre>
              <p>ğŸ‘  ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•<br>
âœï¸  æœ¬ç« ç›®æ ‡ï¼šè‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨ã€æ•°æ®å¢å¼ºï¼Œæ‰©å……æ•°æ®é›†ã€æ–­ç‚¹ç»­è®­ï¼Œå­˜å–æ¨¡å‹ã€å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬ã€acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœã€åº”ç”¨ç¨‹åºï¼Œç»™å›¾è¯†ç‰©</p>
<!-- more -->
<h2 id="ç¬¬å››ç« -ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•">ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•</h2>
<h4 id="æœ¬ç« ç›®æ ‡">æœ¬ç« ç›®æ ‡ï¼š</h4>
<ol>
<li>è‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨</li>
<li>æ•°æ®å¢å¼ºï¼Œæ‰©å……æ•°æ®é›†</li>
<li>æ–­ç‚¹ç»­è®­ï¼Œå­˜å–æ¨¡å‹</li>
<li>å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬</li>
<li>acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœ</li>
<li>åº”ç”¨ç¨‹åºï¼Œç»™å›¾è¯†ç‰©</li>
</ol>
<h4 id="41-è‡ªåˆ¶æ•°æ®é›†è§£å†³æœ¬é¢†åŸŸåº”ç”¨">4.1 è‡ªåˆ¶æ•°æ®é›†ï¼Œè§£å†³æœ¬é¢†åŸŸåº”ç”¨</h4>
<p>è§‚å¯Ÿæ•°æ®é›†ç»“æ„ï¼Œç»™x_train, y_train, x_test, y_testèµ‹å€¼</p>
<p>mnist_image_labelæ–‡ä»¶å¤¹ï¼š <code>class4 &gt; MNIST_FC &gt; mnist_image_label</code></p>
<p>mnist_train_jpg_60000<br>
mnist_test_jpg_10000</p>
<figure data-type="image" tabindex="1"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_210715130025image-20210319084059005.png" alt="4-1" loading="lazy"></figure>
<p>mnist_train_jpg_60000.txt<br>
mnist_test_jpg_10000.txt</p>
<figure data-type="image" tabindex="2"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107151301194-2.png" alt="4-2" loading="lazy"></figure>
<pre><code class="language-python">mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
</code></pre>
<pre><code class="language-python">def generareds(å›¾ç‰‡è·¯å¾„, æ ‡ç­¾æ–‡ä»¶):  # æ›¿æ¢ä¸ŠåŠ è½½æ–‡ä»¶ä¸ºæœ¬åœ°æ•°æ®é›†
</code></pre>
<pre><code class="language-python">def generateds(path, txt):
    f = open(txt, 'r')  # ä»¥åªè¯»å½¢å¼æ‰“å¼€txtæ–‡ä»¶
    contents = f.readlines()  # è¯»å–æ–‡ä»¶ä¸­æ‰€æœ‰è¡Œ
    f.close()  # å…³é—­txtæ–‡ä»¶
    x, y_ = [], []  # å»ºç«‹ç©ºåˆ—è¡¨
    for content in contents:  # é€è¡Œå–å‡º
        value = content.split()  # ä»¥ç©ºæ ¼åˆ†å¼€ï¼Œå›¾ç‰‡è·¯å¾„ä¸ºvalue[0] , æ ‡ç­¾ä¸ºvalue[1] , å­˜å…¥åˆ—è¡¨
        img_path = path + value[0]  # æ‹¼å‡ºå›¾ç‰‡è·¯å¾„å’Œæ–‡ä»¶å
        img = Image.open(img_path)  # è¯»å…¥å›¾ç‰‡
        img = np.array(img.convert('L'))  # å›¾ç‰‡å˜ä¸º8ä½å®½ç°åº¦å€¼çš„np.arrayæ ¼å¼
        img = img / 255.  # æ•°æ®å½’ä¸€åŒ– ï¼ˆå®ç°é¢„å¤„ç†ï¼‰
        x.append(img)  # å½’ä¸€åŒ–åçš„æ•°æ®ï¼Œè´´åˆ°åˆ—è¡¨x
        y_.append(value[1])  # æ ‡ç­¾è´´åˆ°åˆ—è¡¨y_
        print('loading : ' + content)  # æ‰“å°çŠ¶æ€æç¤º

    x = np.array(x)  # å˜ä¸ºnp.arrayæ ¼å¼
    y_ = np.array(y_)  # å˜ä¸ºnp.arrayæ ¼å¼
    y_ = y_.astype(np.int64)  # å˜ä¸º64ä½æ•´å‹
    return x, y_  # è¿”å›è¾“å…¥ç‰¹å¾xï¼Œè¿”å›æ ‡ç­¾y_
</code></pre>
<h4 id="42-æ•°æ®å¢å¼º">4.2 æ•°æ®å¢å¼º</h4>
<p>æ•°æ®å¢å¼ºï¼ˆå¢å¤§æ•°æ®é‡ï¼‰</p>
<pre><code class="language-python"># tensorflow2 ç»™å‡ºçš„æ•°æ®å¢å¼ºå‡½æ•°
image_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(
	rescale = æ‰€æœ‰æ•°æ®å°†ä¹˜ä»¥è¯¥æ•°å€¼
    rotation_range = éšæœºæ—‹è½¬è§’åº¦æ•°èŒƒå›´
    width_shift_range = éšæœºå®½åº¦åç§»é‡
    height_shift_range = éšæœºé«˜åº¦åç§»é‡
    æ°´å¹³ç¿»è½¬ï¼šhorizontal_flip = æ˜¯å¦éšæœºæ°´å¹³ç¿»è½¬
    éšå³ç¼©æ”¾ï¼šzoom_range = éšæœºç¼©æ”¾çš„èŒƒå›´[1 - n, 1 + n]
)
image_gen_train.fit(x_train)
</code></pre>
<p><strong>ğŸ’¬ Example</strong></p>
<pre><code class="language-python">image_gen_train = ImageDataGenerator(
	rescale=1. / 1.,  # å¦‚ä¸ºå›¾åƒï¼Œåˆ†æ¯ä¸º255æ—¶ï¼Œå¯å½’è‡³0~1
    rotation_range=45,  # éšæœº45åº¦æ—‹è½¬
    width_shift_range=.15,  # å®½åº¦åç§»
    height_shift_range=.15,  # é«˜åº¦åç§»
    horizontal_flip=False,  # æ°´å¹³ç¿»è½¬
    zoom_range=0.5  # å°†å›¾åƒéšæœºç¼©æ”¾é˜ˆé‡50%
)
image_gen_train.fit(x_train)
# æ­¤å¤„x_trainè¦ä¿®æ”¹ç»´åº¦
x_train = x_train.reshape(x_train.shape[0], 28, 28, 1)
# (60000, 28, 28)  â†’  (60000, 28, 28, 1)
model.fit(x_trsain, y_train, batch_size=32, ......)
# æ”¹ä¸º
model.fit(image_gen_train.flow(x_train, y_train, batch_size=32), ......)
</code></pre>
<p><strong>p13_mnist_train_ex2.py</strong></p>
<pre><code class="language-python">import tensorflow as tf
from tensorflow.keras.preprocessing.image import ImageDataGenerator

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0
x_train = x_train.reshape(x_train.shape[0], 28, 28, 1)  # ç»™æ•°æ®å¢åŠ ä¸€ä¸ªç»´åº¦,ä»(60000, 28, 28)reshapeä¸º(60000, 28, 28, 1)  æœ€åä¸€ä¸ª1è¡¨ç¤ºå•é€šé“(ç°åº¦å€¼)

image_gen_train = ImageDataGenerator(
    rescale=1. / 1.,  # å¦‚ä¸ºå›¾åƒï¼Œåˆ†æ¯ä¸º255æ—¶ï¼Œå¯å½’è‡³0ï½1
    rotation_range=45,  # éšæœº45åº¦æ—‹è½¬
    width_shift_range=.15,  # å®½åº¦åç§»
    height_shift_range=.15,  # é«˜åº¦åç§»
    horizontal_flip=False,  # æ°´å¹³ç¿»è½¬
    zoom_range=0.5  # å°†å›¾åƒéšæœºç¼©æ”¾é˜ˆé‡50ï¼…
)
image_gen_train.fit(x_train)

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

model.fit(image_gen_train.flow(x_train, y_train, batch_size=32), epochs=5, validation_data=(x_test, y_test),
          validation_freq=1)
model.summary()
</code></pre>
<h4 id="43-æ–­ç‚¹ç»­è®­">4.3 æ–­ç‚¹ç»­è®­</h4>
<h5 id="è¯»å–ä¿å­˜æ¨¡å‹">è¯»å–ä¿å­˜æ¨¡å‹</h5>
<ul>
<li>
<p>è¯»å–æ¨¡å‹</p>
<p>load_weights(è·¯å¾„æ–‡ä»¶å)</p>
<pre><code class="language-python">checkpoint_save_path = './checkpoint/mnist.ckpt'
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model------------')
    model.load_weights(checkpoint_save_path)
</code></pre>
</li>
<li>
<p>ä¿å­˜æ¨¡å‹</p>
<pre><code class="language-python">tf.keras.callbacks.ModelCheckpoint(
    filepath=è·¯å¾„æ–‡ä»¶å,
    save_weights_only=True/False,  # åªä¿ç•™æ¨¡å‹å‚æ•°
    save_best_only=True/False  # åªä¿ç•™æœ€ä¼˜æ¨¡å‹
)
history = model.fit(callbacks=[cp_callback])
</code></pre>
<pre><code class="language-python">cp_callback = tf.keras.callbacks.ModelCheckpoint(
	filepath=checkpoint_save_path,
    save_weights_only=True,  # åªä¿ç•™æ¨¡å‹å‚æ•°
    save_best_only=True  # åªä¿ç•™æœ€ä¼˜æ¨¡å‹
)
history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1, callbacks=[cp_callback])
</code></pre>
</li>
<li>
<p>å®Œæ•´ä»£ç </p>
<pre><code class="language-python">import tensorflow as tf
import os

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/mnist.ckpt&quot;
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True)

history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])
model.summary()
</code></pre>
</li>
</ul>
<h4 id="44-å‚æ•°æå–æŠŠå‚æ•°å­˜å…¥æ–‡æœ¬">4.4 å‚æ•°æå–ï¼ŒæŠŠå‚æ•°å­˜å…¥æ–‡æœ¬</h4>
<ul>
<li>
<p>æå–å¯è®­ç»ƒå‚æ•°</p>
<p><code>model.trainable_variables</code>  è¿”å›æ¨¡å‹ä¸­å¯è®­ç»ƒçš„å‚æ•°</p>
</li>
<li>
<p>è®¾ç½®printè¾“å‡ºæ ¼å¼</p>
<p><code>np.set_printoptions(threshold=è¶…è¿‡å¤šå°‘çœç•¥æ˜¾ç¤º)</code></p>
<pre><code class="language-python">np.set_printoptions(threshold=np.inf)  # np.infè¡¨ç¤ºæ— é™å¤§

print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()
</code></pre>
</li>
<li>
<p>å®Œæ•´ä»£ç </p>
<pre><code class="language-python">import tensorflow as tf
import os
import numpy as np
np.set_printoptions(threshold=np.inf)
mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0
model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])
model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])
checkpoint_save_path = &quot;./checkpoint/mnist.ckpt&quot;
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)
cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True)
history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])
model.summary()
print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()
</code></pre>
</li>
</ul>
<h4 id="45-acclosså¯è§†åŒ–æŸ¥çœ‹è®­ç»ƒæ•ˆæœ">4.5 acc/losså¯è§†åŒ–ï¼ŒæŸ¥çœ‹è®­ç»ƒæ•ˆæœ</h4>
<ul>
<li>
<p>accæ›²çº¿ä¸lossæ›²çº¿</p>
<p><strong>history = model.fit</strong>(è®­ç»ƒé›†æ•°æ®, è®­ç»ƒé›†æ ‡ç­¾, batch_size=, epochs=, validation_split=ç”¨ä½œæµ‹è¯•æ•°æ®çš„æ¯”ä¾‹, validation_data=æµ‹è¯•é›†, validation_freq=æµ‹è¯•é¢‘ç‡)</p>
<p><strong>history:</strong> (è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šä¿å­˜è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„loss)</p>
<p>è®­ç»ƒé›†lossï¼šloss<br>
æµ‹è¯•é›†lossï¼šval_loss<br>
è®­ç»ƒé›†å‡†ç¡®ç‡ï¼šsparse_categorical_accuracy<br>
æµ‹è¯•é›†å‡†ç¡®ç‡ï¼šval_sparse_categorical_accuracy</p>
<pre><code class="language-python">acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']
</code></pre>
</li>
<li>
<p>å®Œæ•´ä»£ç  (æœ€å¥½å¯ä»¥èƒŒä¸‹æ¥)</p>
<pre><code class="language-python">import os

import numpy as np
import tensorflow as tf
import matplotlib.pyplot as plt

np.set_printoptions(threshold=np.inf)

mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(
	optimizer='adam',
    loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
    metrics=['sparse_categorical_accuracy']
)

checkpoint_save_path = './checkpoint/mnist.ckpt'
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model------------')
    model.load_weights(checkpoint_save_path)
    
cp_callback = tf.keras.callbacks.ModelCheckpoint(
    filepath=checkpoint_save_path,
    save_weights_only=True,
    save_best_only=True                                                )

history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1, callbacks=[cp_callback])
model.summary()

print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()


########################Show###################
acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']

plt.subplot(1, 2, 1)  # åˆ†ä¸ºä¸€è¡Œä¸¤åˆ—ï¼Œå…ˆç”»ç¬¬ä¸€åˆ—
plt.plot(acc, label='Training Accuracy')
plt.plot(val_acc, label='Validation Accuracy')
plt.title('Training and Validation Accuracy')
plt.legend()

plt.subplot(1, 2, 2)  # åˆ†ä¸ºä¸€è¡Œä¸¤åˆ—ï¼Œç”»ç¬¬äºŒåˆ—
plt.plot(loss, label='Training Loss')
plt.plot(val_loss, label='Validation Loss')
plt.title('Training and Validation Loss')
plt.legend()
plt.show()
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107151302104-3.png" alt="4-3" loading="lazy"></figure>
</li>
</ul>
<h4 id="46-ç»™å›¾è¯†ç‰©">4.6 ç»™å›¾è¯†ç‰©</h4>
<ul>
<li>
<p>å‰å‘ä¼ æ’­æ‰§è¡Œåº”ç”¨</p>
<p>predict(è¾“å…¥ç‰¹å¾, batch_size=æ•´æ•°)</p>
<p>è¿”å›å‰å‘ä¼ æ’­è®¡ç®—ç»“æœ</p>
</li>
</ul>
<p><strong>å¤ç°æ¨¡å‹ï¼ˆå‰å‘ä¼ æ’­ï¼‰</strong>  <code>model = tf.keras.models.Sequential([......])</code><br>
<strong>åŠ è½½å‚æ•°</strong>  <code>model.load_weights(model_save_path)</code><br>
<strong>é¢„æµ‹ç»“æœ</strong>  <code>result = model.predict(x_predict)</code></p>
<pre><code class="language-python">from PIL import Image
import numpy as np
import tensorflow as tf
import matplotlib.pyplot as plt

model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(128, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.load_weights(model_save_path)

preNum = int(input('input the number of test pictures:'))


for i in range(preNum):
    image_path = input('the path of test picture:')
    img = Image.open(image_path)
    # è®­ç»ƒå›¾ç‰‡æ˜¯28è¡Œ28åˆ—çš„ç°åº¦å›¾ï¼Œæ•…è¾“å…¥çš„ä»»æ„å°ºå¯¸çš„å›¾ç‰‡éœ€è¦resize()
    img = img.resize((28, 28), Image.ANTIALIAS)
    img_arr = np.array(img.convert('L'))
    
    # img_arr = 255 - img_arr  # é¢„å¤„ç†ï¼Œä¸åé¢çš„é¢„å¤„ç†äºŒé€‰å…¶ä¸€
    
    # å°†å›¾ç‰‡å¤„ç†ä¸ºé«˜å¯¹æ¯”åº¦å›¾ç‰‡ï¼Œå³é¢„å¤„ç†
    for i in range(28):
        for j in range(28):
            if img_arr[i][j] &lt; 200:
                img_arr[i][j] = 255
            else:
                img_arr[i][j] = 0
    
    
    img_arr = img_arr / 255.0  # å½’ä¸€åŒ–
    x_predict = img_arr[tf.newaxis, ...]
    result = model.predict(x_predict)
    pred = tf.argmax(result, axis=1)
    print('\n')
    tf.print(pred)
    
    plt.pause(1)
    plt.close()
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://perfectqing.github.io/blogs/tag/S2mqBZ0HP/" class="tag">
                    TensorFlow ç¬”è®°
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://perfectqing.github.io/blogs/post/ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ/">
                  <h3 class="post-title">
                    ç¬¬ä¸‰ç«  ä½¿ç”¨å…«è‚¡æ­å»ºç¥ç»ç½‘ç»œ
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
