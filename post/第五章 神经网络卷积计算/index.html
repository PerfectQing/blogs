<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®— | BLOG</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://perfectqing.github.io/blogs/favicon.ico?v=1626771561435">
<link rel="stylesheet" href="https://perfectqing.github.io/blogs/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ğŸ‘  ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—
âœï¸  æœ¬ç« ç›®æ ‡ï¼šä»‹ç»ä»¥åŠå®ç°ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—

ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—
5.1 å·ç§¯è®¡ç®—è¿‡ç¨‹


å…¨è¿æ¥NNï¼šæ¯ä¸ªç¥ç»å…ƒä¸å‰å‘ç›¸é‚»å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½æœ‰è¿æ¥å…³ç³»ï¼Œè¾“å…¥æ˜¯ç‰¹å¾ï¼Œè¾“å‡ºä¸ºé¢„æµ‹çš„ç»“æœã€‚
å‚æ•°ä¸ªæ•°ï¼š..." />
    <meta name="keywords" content="TensorFlow ç¬”è®°" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://perfectqing.github.io/blogs">
        <img src="https://perfectqing.github.io/blogs/images/avatar.png?v=1626771561435" class="site-logo">
        <h1 class="site-title">BLOG</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      Carry on what you want...
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> Copyright Â© AlsoRan | <a class="rss" href="https://perfectqing.github.io/blogs/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—</h2>
            <div class="post-date">2021-07-18</div>
            
              <div class="feature-container" style="background-image: url('https://perfectqing.github.io/blogs/post-images/hello-gridea.png')">
              </div>
            
            <div class="post-content" v-pre>
              <p>ğŸ‘  ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—<br>
âœï¸  æœ¬ç« ç›®æ ‡ï¼šä»‹ç»ä»¥åŠå®ç°ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—</p>
<!-- more -->
<h3 id="ç¬¬äº”ç« -ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—">ç¬¬äº”ç«  ç¥ç»ç½‘ç»œå·ç§¯è®¡ç®—</h3>
<h4 id="51-å·ç§¯è®¡ç®—è¿‡ç¨‹">5.1 å·ç§¯è®¡ç®—è¿‡ç¨‹</h4>
<ul>
<li>
<p>å…¨è¿æ¥NNï¼šæ¯ä¸ªç¥ç»å…ƒä¸å‰å‘ç›¸é‚»å±‚çš„æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½æœ‰è¿æ¥å…³ç³»ï¼Œè¾“å…¥æ˜¯ç‰¹å¾ï¼Œè¾“å‡ºä¸ºé¢„æµ‹çš„ç»“æœã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">å‚</mi><mi mathvariant="normal">æ•°</mi><mi mathvariant="normal">ä¸ª</mi><mi mathvariant="normal">æ•°</mi><mi mathvariant="normal">ï¼š</mi><msub><mo>âˆ‘</mo><mrow><mi mathvariant="normal">å„</mi><mi mathvariant="normal">å±‚</mi></mrow></msub><mo>(</mo><mi mathvariant="normal">å‰</mi><mi mathvariant="normal">å±‚</mi><mo>Ã—</mo><mi mathvariant="normal">å</mi><mi mathvariant="normal">å±‚</mi><mo>+</mo><mi mathvariant="normal">å</mi><mi mathvariant="normal">å±‚</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">å‚æ•°ä¸ªæ•°ï¼š\sum_{å„å±‚}(å‰å±‚\timesåå±‚+åå±‚)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mord cjk_fallback">å‚</span><span class="mord cjk_fallback">æ•°</span><span class="mord cjk_fallback">ä¸ª</span><span class="mord cjk_fallback">æ•°</span><span class="mord cjk_fallback">ï¼š</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.29971000000000003em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">å„</span><span class="mord cjk_fallback mtight">å±‚</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord cjk_fallback">å‰</span><span class="mord cjk_fallback">å±‚</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å±‚</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">å</span><span class="mord cjk_fallback">å±‚</span><span class="mclose">)</span></span></span></span></p>
<figure data-type="image" tabindex="1"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180548055-1.png" alt="5-1" loading="lazy"></figure>
<p>ç”±äºå®é™…é¡¹ç›®ä¸­çš„å›¾ç‰‡æ˜¯é«˜åˆ†è¾¨ç‡å½©è‰²å›¾ï¼Œå‚æ•°è¿‡å¤šï¼Œå°†å¯èƒ½å¯¼è‡´æ¨¡å‹è¿‡æ‹Ÿåˆã€‚<br>
æ•…å®é™…åº”ç”¨æ—¶ä¼šå…ˆå¯¹åŸå§‹å›¾åƒè¿›è¡Œç‰¹å¾æå–ï¼Œå†æŠŠæå–åˆ°çš„ç‰¹å¾é€ç»™å…¨è¿æ¥ç½‘ç»œã€‚</p>
</li>
<li>
<p>å·ç§¯ (Convolutional)</p>
<p>å·ç§¯è®¡ç®—å¯è®¤ä¸ºæ˜¯ä¸€ç§æœ‰æ•ˆæå–å›¾åƒç‰¹å¾çš„æ–¹æ³•<br>
è¾“å…¥ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨ï¼Œéå†è¾“å…¥ç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªåƒç´ ç‚¹ã€‚æ¯ä¸€ä¸ªæ­¥é•¿ï¼Œå·ç§¯æ ¸ä¼šä¸è¾“å…¥ç‰¹å¾å›¾å‡ºç°é‡åˆåŒºåŸŸï¼Œé‡åˆåŒºåŸŸå¯¹åº”å…ƒç´ ç›¸ä¹˜ã€æ±‚å’Œå†åŠ ä¸Šåç½®é¡¹å¾—åˆ°è¾“å‡ºç‰¹å¾çš„ä¸€ä¸ªåƒç´ ç‚¹ã€‚</p>
<p>è¦ä½¿å·ç§¯æ ¸çš„é€šé“æ•°ä¸è¾“å…¥ç‰¹å¾å›¾çš„é€šé“æ•°ä¸€è‡´ã€‚</p>
<p><strong>è¾“å…¥ç‰¹å¾å›¾çš„æ·±åº¦ï¼ˆchannelæ•°ï¼‰ï¼Œå†³å®šäº†å½“å‰å±‚å·ç§¯æ ¸çš„æ·±åº¦ï¼›</strong><br>
<strong>å½“å‰å±‚å·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œå†³å®šäº†å½“å‰å±‚è¾“å‡ºç‰¹å¾å›¾çš„æ·±åº¦ã€‚</strong></p>
<figure data-type="image" tabindex="2"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180550435-2.png" alt="5-2" loading="lazy"></figure>
<ul>
<li>å•é€šé“</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180550525-3.png" alt="5-3" loading="lazy"></figure>
<ul>
<li>ä¸‰é€šé“</li>
</ul>
<figure data-type="image" tabindex="4"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180550585-4.png" alt="5-4" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://mlnotebook.github.io/img/CNN/convSobel.gif" alt="5-5" loading="lazy"></figure>
<p>å½“æœ‰nä¸ªå·ç§¯æ ¸æ—¶ï¼Œä¼šæœ‰nå¼ è¾“å‡ºç‰¹å¾å›¾ï¼Œå åŠ åœ¨è¾“å‡ºç‰¹å¾å›¾çš„åé¢ã€‚</p>
</li>
</ul>
<h4 id="52-æ„Ÿå—é‡">5.2 æ„Ÿå—é‡</h4>
<ul>
<li>
<p>æ„Ÿå—é‡ï¼ˆReceptive Fieldï¼‰ï¼šå·ç§¯ç¥ç»ç½‘ç»œå„è¾“å‡ºç‰¹å¾å›¾çš„æ¯ä¸ªåƒç´ ç‚¹ï¼Œåœ¨åŸå§‹è¾“å…¥å›¾ç‰‡ä¸Šæ˜ å°„åŒºåŸŸçš„å¤§å°ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180551055-6.png" alt="5-6" loading="lazy"></figure>
<p>ä¸Šè¿°ä¸¤ä¸ªæ„Ÿå—é‡ç›¸åŒï¼Œæ•…ç‰¹å¾æå–èƒ½åŠ›æ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li>
<p>å¦‚ä½•é€‰æ‹©ï¼Œåˆ™éœ€è¦è€ƒè™‘è®¡ç®—é‡</p>
<figure data-type="image" tabindex="7"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180551105-7.png" alt="5-7" loading="lazy"></figure>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>9</mn><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>+</mo><mn>9</mn><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>2</mn><mo>âˆ’</mo><mn>2</mn><mo>)</mo><mo>=</mo><mn>18</mn><msup><mi>x</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>180</mn><mi>x</mi><mo>+</mo><mn>180</mn><mspace linebreak="newline"></mspace><mn>25</mn><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>4</mn><mo>)</mo><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mn>4</mn><mo>)</mo><mo>=</mo><mn>25</mn><msup><mi>x</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>200</mn><mi>x</mi><mo>+</mo><mn>400</mn></mrow><annotation encoding="application/x-tex">9(x-2)(x-2) + 9(x-2-2)(x-2-2)=18x^2-180x+180\\
25(x-4)(x-4) = 25x^2-200x+400
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">9</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">9</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">8</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">8</span><span class="mord">0</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">8</span><span class="mord">0</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">0</span><span class="mord">0</span></span></span></span></span></p>
</li>
</ul>
<h4 id="53-å…¨é›¶å¡«å……-padding">5.3 å…¨é›¶å¡«å…… (Padding)</h4>
<figure data-type="image" tabindex="8"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180931445-8.png" alt="5-8" loading="lazy"></figure>
<ul>
<li>
<p>å·ç§¯ç‰¹å¾å›¾ç»´åº¦è®¡ç®—å…¬å¼</p>
<figure data-type="image" tabindex="9"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180931505-9.png" alt="5-9" loading="lazy"></figure>
<p>TensorFlowç”¨å‚æ•°<code>padding='SAME'</code> æˆ–è€… <code>padding='VALID'</code> è¡¨ç¤ºæ˜¯å¦ä¸ºå…¨é›¶å¡«å……</p>
</li>
</ul>
<h4 id="54-tensorflow-æè¿°å·ç§¯è®¡ç®—å±‚">5.4 TensorFlow æè¿°å·ç§¯è®¡ç®—å±‚</h4>
<pre><code class="language-python">tf.keras.layers.Conv2D(
    filters=å·ç§¯æ ¸ä¸ªæ•°,
    kernel_size=å·ç§¯æ ¸å°ºå¯¸,  #  æ­£æ–¹å½¢å†™æ ¸é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆæ ¸é«˜hï¼Œæ ¸å®½wï¼‰
    strides=æ»‘åŠ¨æ­¥é•¿,  # æ¨ªçºµå‘ç›¸åŒå†™æ­¥é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆçºµå‘æ­¥é•¿hï¼Œæ¨ªå‘æ­¥é•¿wï¼‰ï¼Œé»˜è®¤1
    padding='same' or 'valid',  # ä½¿ç”¨å…¨é›¶å¡«å……æ˜¯'same'ï¼Œä¸ä½¿ç”¨æ˜¯'valid'(é»˜è®¤)
    activation='relu' or 'sigmoid' or 'tanh' or 'softmax'ç­‰,  # å¦‚æœ‰BN(æ‰¹æ ‡å‡†åŒ–)æ­¤å¤„ä¸å†™
    input_shape=(é«˜, å®½, é€šé“æ•°)  # è¾“å…¥ç‰¹å¾å›¾ç»´åº¦ï¼Œå¯çœç•¥
)
</code></pre>
<pre><code class="language-python">model = tf.keras.models.Sequential([
    Conv2D(6, 5, padding='valid', activation='sigmoid'),
    MaxPool2D(2, 2),
    Conv2D(6, (5, 5), padding='valid', activation='sigmoid'),
    MaxPool2D(2, (2, 2)),
    Conv2D(filters=6, kernel_size=(5, 5), padding='valid', activation='sigmoid'),
    MaxPool2D(pool_size(2, 2), strides=2),
    Flatten(),
    Dense(10, activation='softmax')
])
</code></pre>
<h4 id="55-æ‰¹æ ‡å‡†åŒ–batch-normalization-bn">5.5 æ‰¹æ ‡å‡†åŒ–ï¼ˆBatch Normalization, BNï¼‰</h4>
<p>æ ‡å‡†åŒ–ï¼šä½¿æ•°æ®ç¬¦åˆ0å‡å€¼ï¼Œ1ä¸ºæ ‡å‡†å·®çš„åˆ†å¸ƒã€‚<br>
æ‰¹æ ‡å‡†åŒ–ï¼šå¯¹ä¸€å°æ‰¹æ•°æ®ï¼ˆbatchï¼‰ï¼Œåšæ ‡å‡†åŒ–å¤„ç†ã€‚</p>
<p>æ‰¹æ ‡å‡†åŒ–åï¼Œç¬¬kä¸ªå·ç§¯æ ¸çš„è¾“å‡ºç‰¹å¾å›¾ï¼ˆfeature mapï¼‰ä¸­ç¬¬iä¸ªåƒç´ ç‚¹</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><msup><mi>H</mi><mo mathvariant="normal">â€²</mo></msup><mi>i</mi><mi>k</mi></msubsup><mo>=</mo><mfrac><mrow><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup><mo>âˆ’</mo><msubsup><mi>Î¼</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mrow><msubsup><mi>Î´</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mfrac></mrow><annotation encoding="application/x-tex">{H&#x27;}_{i}^{k}=\frac{H_i^k-\mu_{batch}^k}{\delta_{batch}^k}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2879em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0409em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.254792em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.548324em;vertical-align:-1.0222159999999998em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.526108em;"><span style="top:-2.2790920000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8309079999999999em;"><span style="top:-2.398692em;margin-left:-0.03785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0222159999999998em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<figure data-type="image" tabindex="10"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180931575-10.png" alt="5-10" loading="lazy"></figure>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">H_i^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.107772em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>: æ‰¹æ ‡å‡†åŒ–å‰ï¼Œç¬¬kä¸ªå·ç§¯æ ¸ï¼Œè¾“å‡ºç‰¹å¾å›¾ç¬¬iä¸ªåƒç´ ç‚¹</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î¼</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">\mu_{batch}^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.132216em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span>: æ‰¹æ ‡å‡†åŒ–å‰ï¼Œç¬¬kä¸ªå·ç§¯æ ¸ï¼Œbatchå¼ è¾“å‡ºç‰¹å¾å›¾ä¸­æ‰€æœ‰åƒç´ ç‚¹å¹³å‡å€¼</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î´</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">\delta_{batch}^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.132216em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span>: æ‰¹æ ‡å‡†åŒ–å‰ï¼Œç¬¬kä¸ªå·ç§¯æ ¸ï¼Œbatchå¼ è¾“å‡ºç‰¹å¾å›¾ä¸­æ‰€æœ‰åƒç´ ç‚¹æ ‡å‡†å·®</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î¼</mi><mrow></mrow><mi>k</mi></msubsup><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup></mrow><annotation encoding="application/x-tex">\mu_{}^k=\frac{1}{m}\sum_{i=1}^m H_i^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.096108em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.194108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.441336em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>             <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>Î´</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup><mo>=</mo><msqrt><mrow><mi>Î´</mi><mo>+</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mo>(</mo><msubsup><mi>H</mi><mi>i</mi><mi>k</mi></msubsup><mo>âˆ’</mo><msubsup><mi>Î¼</mi><mrow><mi>b</mi><mi>a</mi><mi>t</mi><mi>c</mi><mi>h</mi></mrow><mi>k</mi></msubsup><msup><mo>)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\delta_{batch}^k =\sqrt{\delta+\frac{1}{m}\sum_{i=1}^m (H_i^k-\mu_{batch}^k)^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.132216em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-2.4168920000000003em;margin-left:-0.03785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.84em;vertical-align:-0.604946em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.235054em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathdefault" style="margin-right:0.03785em;">Î´</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.830908em;"><span style="top:-2.4231360000000004em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8309079999999999em;"><span style="top:-2.398692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">h</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30130799999999996em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.195054em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.604946em;"><span></span></span></span></span></span></span></span></span></p>
<ul>
<li>
<p>ä¸ºæ¯ä¸ªå·ç§¯æ ¸**å¼•å…¥å¯è®­ç»ƒå‚æ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î³</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">Î³</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Î²</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span></span></span></span>ï¼Œè°ƒæ•´æ‰¹å½’ä¸€åŒ–çš„åŠ›åº¦ã€‚</p>
<figure data-type="image" tabindex="11"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932045-11.png" alt="5-11" loading="lazy"></figure>
</li>
<li>
<p>BNå±‚ä½äºå·ç§¯å±‚ä¹‹åï¼Œæ¿€æ´»å±‚ä¹‹å‰ã€‚</p>
<p><code>å·ç§¯(Convolutional)</code>  â†’  <code>æ‰¹æ ‡å‡†åŒ–(BN)</code>  â†’  <code>æ¿€æ´»(Activation)</code></p>
</li>
<li>
<p>TensorFlow æè¿°æ‰¹æ ‡å‡†åŒ–</p>
<p><code>tf.keras.layers.BatchNormalization()</code></p>
<pre><code class="language-python">model = tf.keras.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # å·ç§¯å±‚
    BatchNormalization(),  # BNå±‚
    Activation('relu'),  # æ¿€æ´»å±‚
    MaxPool2D(pool_size(2, 2), strides=2, padding='same'),  #æ± åŒ–å±‚
    Dropout(0.2)  # Dropoutå±‚
])
</code></pre>
</li>
</ul>
<h4 id="56-æ± åŒ–pooling">5.6 æ± åŒ–ï¼ˆPoolingï¼‰</h4>
<p>æ± åŒ–ç”¨äºå‡å°‘ç‰¹å¾æ•°æ®é‡ã€‚<br>
<strong>æœ€å¤§æ± åŒ–</strong>å¯æå–å›¾ç‰‡çº¹ç†ï¼Œ<strong>å‡å€¼æ± åŒ–</strong>å¯ä¿ç•™èƒŒæ™¯ç‰¹å¾ã€‚</p>
<figure data-type="image" tabindex="12"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932125-12.png" alt="5-12" loading="lazy"></figure>
<ul>
<li>
<p>TensorFlow æè¿°æ± åŒ–</p>
<pre><code class="language-python"># æœ€å¤§æ± åŒ–
tf.keras.layers.MaxPool2D(
    pool_size=æ± åŒ–æ ¸å°ºå¯¸,  # æ­£æ–¹å½¢å†™æ ¸é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆæ ¸é«˜hï¼Œæ ¸å®½wï¼‰
    sreides=æ± åŒ–æ­¥é•¿,  # æ­¥é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆçºµå‘æ­¥é•¿hï¼Œæ¨ªå‘æ­¥é•¿wï¼‰ï¼Œé»˜è®¤ä¸ºpool_size
    padding='valid' or 'same'  # ä½¿ç”¨å…¨é›¶å¡«å……æ˜¯'same'ï¼Œä¸ä½¿ç”¨æ˜¯'valid'ï¼ˆé»˜è®¤ï¼‰
)
</code></pre>
<pre><code class="language-python"># å‡å€¼æ± åŒ–
tf.keras.layers.MaxPool2D(
    pool_size=æ± åŒ–æ ¸å°ºå¯¸,  # æ­£æ–¹å½¢å†™æ ¸é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆæ ¸é«˜hï¼Œæ ¸å®½wï¼‰
    sreides=æ± åŒ–æ­¥é•¿,  # æ­¥é•¿æ•´æ•°ï¼Œæˆ–ï¼ˆçºµå‘æ­¥é•¿hï¼Œæ¨ªå‘æ­¥é•¿wï¼‰ï¼Œé»˜è®¤ä¸ºpool_size
    padding='valid' or 'same'  # ä½¿ç”¨å…¨é›¶å¡«å……æ˜¯'same'ï¼Œä¸ä½¿ç”¨æ˜¯'valid'ï¼ˆé»˜è®¤ï¼‰
)
</code></pre>
<pre><code class="language-python">model = tf.keras.layers.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # å·ç§¯å±‚
    BatchNormalization(),  # BNå±‚
    Activation('relu'),  # æ¿€æ´»å±‚
    MaxPool2D(pool_size=(2, 2), strides=2, padding='same'),  # æ± åŒ–å±‚
    Dropout(0.2)  # Dropoutå±‚
])
</code></pre>
</li>
</ul>
<h4 id="57-èˆå¼ƒdropout">5.7 èˆå¼ƒï¼ˆDropoutï¼‰</h4>
<p>åœ¨ç¥ç»ç½‘ç»œè®­ç»ƒæ—¶ï¼Œï¼ˆä¸ºäº†ç¼“è§£ç¥ç»ç½‘ç»œçš„è¿‡æ‹Ÿåˆï¼‰å°†ä¸€éƒ¨åˆ†ç¥ç»å…ƒæŒ‰ç…§ä¸€å®šæ¦‚ç‡ä»ç¥ç»ç½‘ç»œä¸­æš‚æ—¶èˆå¼ƒã€‚ç¥ç»ç½‘ç»œä½¿ç”¨æ—¶ï¼Œè¢«èˆå¼ƒçš„ç¥ç»å…ƒæ¢å¤é“¾æ¥ã€‚</p>
<figure data-type="image" tabindex="13"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932215-13.png" alt="5-13" loading="lazy"></figure>
<p><code>tf.keras.layers.Dropout(èˆå¼ƒçš„æ¦‚ç‡)</code></p>
<pre><code class="language-python">model = tf.keras.layers.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # å·ç§¯å±‚
    BatchNormalization(),  # BNå±‚
    Activation('relu'),  # æ¿€æ´»å±‚
    MaxPool2D(pool_size=(2, 2), strides=2, padding='same'),  # æ± åŒ–å±‚
    Dropout(0.2)  # Dropoutå±‚  éšæœºèˆå¼ƒ20%çš„ç¥ç»å…ƒ
])
</code></pre>
<h4 id="58-å·ç§¯ç¥ç»ç½‘ç»œå°ç»“">5.8 å·ç§¯ç¥ç»ç½‘ç»œå°ç»“</h4>
<p>å·ç§¯ç¥ç»ç½‘ç»œï¼šå€ŸåŠ©å·ç§¯æ ¸æå–ç‰¹å¾åï¼Œé€å…¥å…¨è¿æ¥ç½‘ç»œã€‚</p>
<ul>
<li>
<p>å·ç§¯ç¥ç»ç½‘ç»œçš„ä¸»è¦æ¨¡å—</p>
<p><code>å·ç§¯(Convolutional)</code>ã€<code>æ‰¹æ ‡å‡†åŒ–(BN)</code>ã€<code>æ¿€æ´»(Activation)</code>ã€<code>æ± åŒ–(Pooling)</code>ã€<code>å…¨è¿æ¥(FC)</code></p>
<p>å‰å››ä¸ªæ˜¯å¯¹è¾“å…¥ç‰¹å¾æå–</p>
</li>
<li>
<p>å·ç§¯æ˜¯ä»€ä¹ˆï¼Ÿ  <strong>å·ç§¯å°±æ˜¯ç‰¹å¾æå–å™¨ï¼Œå°±æ˜¯CBAPD</strong></p>
<pre><code class="language-python">model = tf.keras.layers.models.Sequential([
    Conv2D(filters=6, kernel_size=(5, 5), padding='same'),  # C
    BatchNormalization(),  # B
    Activation('relu'),  # A
    MaxPool2D(pool_size=(2, 2), strides=2, padding='same'),  # P
    Dropout(0.2)  # D
])
</code></pre>
</li>
</ul>
<h4 id="59-cifar10æ•°æ®é›†">5.9 CIFAR10æ•°æ®é›†</h4>
<p><code>æä¾›5ä¸‡å¼ 32*32åƒç´ ç‚¹çš„ååˆ†ç±»å½©è‰²å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºè®­ç»ƒã€‚ æä¾›1ä¸‡å¼ 32*32åƒç´ ç‚¹çš„ååˆ†ç±»å½©è‰²å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œç”¨äºæµ‹è¯•ã€‚</code></p>
<figure data-type="image" tabindex="14"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932275-14.png" alt="5-14" loading="lazy"></figure>
<ul>
<li>
<p>å¯¼å…¥cifar10æ•°æ®é›†ï¼š</p>
<pre><code class="language-python">cifar10 = tf.keras.datasets.cifar10
(x_train, y_train), (x_test, y_test) = cifar10.load_data()
</code></pre>
<pre><code class="language-python">plt.imshow(x_train[0])  # ç»˜åˆ¶å›¾ç‰‡
plt.show()
</code></pre>
<pre><code class="language-python">print('x_train[0]:\n', x_train[0])
print('y_train[0]:', y_train[0])
print('x_test.shape:', x_test.shape)
</code></pre>
</li>
</ul>
<h4 id="510-å·ç§¯ç¥ç»ç½‘ç»œæ­å»ºç¤ºä¾‹">5.10 å·ç§¯ç¥ç»ç½‘ç»œæ­å»ºç¤ºä¾‹</h4>
<pre><code>C(æ ¸ï¼š6*5*5ï¼Œæ­¥é•¿ï¼š1ï¼Œå¡«å……ï¼šsame)
B(yes)
A(relu)
P(maxï¼Œæ ¸ï¼š2*2ï¼Œæ­¥é•¿ï¼š2ï¼Œå¡«å……ï¼šsame)
D(0.2)

Flatten
Dense(ç¥ç»å…ƒï¼š128ï¼Œæ¿€æ´»ï¼šreluï¼ŒDropoutï¼š0.2)
Dense(ç¥ç»å…ƒï¼š10ï¼Œæ¿€æ´»ï¼šsoftmax)
</code></pre>
<pre><code class="language-python"># å…¶ä»–ä¸åŒç½‘ç»œç»“æ„ä¹Ÿä»…åœ¨æ­¤å¤„classå®šä¹‰ç»“æ„çš„ä¸åŒ
class Baseline(Model):
    def __init__(self):
        super(Baseline, self).__init__()
        self.c1 = Conv2D(filters=6, kernel_size=(5, 5), padding='same')
        self.b1 = BatchNormalization()
        self.a1 = Activation()
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d1 = Dropout(0.2)
        
        self.flatten = Flatten()
        self.f1 = Dense(128, activation='relu')
        self.d2 = Dropout(0.2)
        self.f2 = Dense(10, activation='softmax')
    
    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.p1(x)
        x = self.d1(x)
        
        x = self.flatten(x)
        x = self.f1(x)
        x = self.d2(x)
        y = self.f2(x)
        return y
</code></pre>
<ul>
<li>
<p>å®Œæ•´cifar10ä»£ç </p>
<pre><code class="language-python">import tensorflow as tf
import os
import numpy as np
from matplotlib import pyplot as plt
from tensorflow.keras.layers import Conv2D, BatchNormalization, Activation, MaxPool2D, Dropout, Flatten, Dense
from tensorflow.keras import Model

np.set_printoptions(threshold=np.inf)

cifar10 = tf.keras.datasets.cifar10
(x_train, y_train), (x_test, y_test) = cifar10.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0


class Baseline(Model):
    def __init__(self):
        super(Baseline, self).__init__()
        self.c1 = Conv2D(filters=6, kernel_size=(5, 5), padding='same')  # å·ç§¯å±‚
        self.b1 = BatchNormalization()  # BNå±‚
        self.a1 = Activation('relu')  # æ¿€æ´»å±‚
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')  # æ± åŒ–å±‚
        self.d1 = Dropout(0.2)  # dropoutå±‚

        self.flatten = Flatten()
        self.f1 = Dense(128, activation='relu')
        self.d2 = Dropout(0.2)
        self.f2 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.p1(x)
        x = self.d1(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.d2(x)
        y = self.f2(x)
        return y


model = Baseline()

model.compile(optimizer='adam',
              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=False),
              metrics=['sparse_categorical_accuracy'])

checkpoint_save_path = &quot;./checkpoint/Baseline.ckpt&quot;
if os.path.exists(checkpoint_save_path + '.index'):
    print('-------------load the model-----------------')
    model.load_weights(checkpoint_save_path)

cp_callback = tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,
                                                 save_weights_only=True,
                                                 save_best_only=True)

history = model.fit(x_train, y_train, batch_size=32, epochs=5, validation_data=(x_test, y_test), validation_freq=1,
                    callbacks=[cp_callback])
model.summary()

# print(model.trainable_variables)
file = open('./weights.txt', 'w')
for v in model.trainable_variables:
    file.write(str(v.name) + '\n')
    file.write(str(v.shape) + '\n')
    file.write(str(v.numpy()) + '\n')
file.close()

###############################################    show   ###############################################

# æ˜¾ç¤ºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„accå’Œlossæ›²çº¿
acc = history.history['sparse_categorical_accuracy']
val_acc = history.history['val_sparse_categorical_accuracy']
loss = history.history['loss']
val_loss = history.history['val_loss']

plt.subplot(1, 2, 1)
plt.plot(acc, label='Training Accuracy')
plt.plot(val_acc, label='Validation Accuracy')
plt.title('Training and Validation Accuracy')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(loss, label='Training Loss')
plt.plot(val_loss, label='Validation Loss')
plt.title('Training and Validation Loss')
plt.legend()
plt.show()


# è¿è¡Œç»“æœ
# Epoch 4/5
# 1563/1563 [==============================] - 4s 3ms/step - loss: 1.1299 - sparse_categorical_accuracy: 0.5955 - val_loss: 1.4539 - val_sparse_categorical_accuracy: 0.5108
# Epoch 5/5
# 1563/1563 [==============================] - 4s 3ms/step - loss: 1.1136 - sparse_categorical_accuracy: 0.6032 - val_loss: 1.1590 - val_sparse_categorical_accuracy: 0.5951
# Model: &quot;baseline&quot;
# _________________________________________________________________
# Layer (type)                 Output Shape              Param #   
# =================================================================
# conv2d (Conv2D)              multiple                  456       
# _________________________________________________________________
# batch_normalization (BatchNo multiple                  24        
# _________________________________________________________________
# activation (Activation)      multiple                  0         
# _________________________________________________________________
# max_pooling2d (MaxPooling2D) multiple                  0         
# _________________________________________________________________
# dropout (Dropout)            multiple                  0         
# _________________________________________________________________
# flatten (Flatten)            multiple                  0         
# _________________________________________________________________
# dense (Dense)                multiple                  196736    
# _________________________________________________________________
# dropout_1 (Dropout)          multiple                  0         
# _________________________________________________________________
# dense_1 (Dense)              multiple                  1290      
# =================================================================
# Total params: 198,506
# Trainable params: 198,494
# Non-trainable params: 12
# _________________________________________________________________
# 
# Process finished with exit code 0
</code></pre>
</li>
</ul>
<h4 id="511-ç»å…¸å·ç§¯ç½‘ç»œlenet">5.11 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”LeNet</h4>
<p>LeNetç”±Yann LeCunäº1998å¹´æå‡ºï¼Œå·ç§¯ç½‘ç»œå¼€ç¯‡ä¹‹ä½œã€‚</p>
<blockquote>
<p>Yann Lecun, Leon Bottou, Y. Bengio, Patrick Haffner. Gradient-Based Learning Applied to Document Recognition. Proceedings of the IEEE, 1998</p>
</blockquote>
<p>é€šè¿‡å…±äº«å·ç§¯æ ¸ï¼Œå‡å°äº†ç½‘ç»œå‚æ•°ã€‚</p>
<figure data-type="image" tabindex="15"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932315-15.png" alt="5-15" loading="lazy"></figure>
<p>Noneè¡¨ç¤ºLeNetæå‡ºå½“æ—¶è¿˜æ²¡æœ‰è¿™äº›æ“ä½œã€‚</p>
<ul>
<li>
<p>LeNetç½‘ç»œç»“æ„</p>
<pre><code class="language-python">class LeNet5(Model):
    def __init__(self):
        super(LeNet5, self).__init__()
        self.c1 = Conv2D(filters=6, kernel_size=(5, 5), activation='sigmoid')
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2)
        self.c2 = Conv2D(filters=16, kernel_size=(5, 5), activation='sigmoid')
        self.p2 = MaxPool2D(pool_size=(2, 2), strides=2)
        
        self.flatten = Flatten()
        self.f1 = Dense(120, activation='sigmoid')
        self.f2 = Dense(84, activation='sigmoid')
        self.f3 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.p1(x)

        x = self.c2(x)
        x = self.p2(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.f2(x)
        y = self.f3(x)
        return y
</code></pre>
</li>
</ul>
<h4 id="512-ç»å…¸å·ç§¯ç½‘ç»œalexnet">5.12 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”AlexNet</h4>
<p>AlexNetç½‘ç»œè¯ç”Ÿäº2012å¹´ï¼Œå½“å¹´ImageNetç«èµ›çš„å† å†›ï¼ŒTop5é”™è¯¯ç‡ä¸º16.4%ã€‚</p>
<blockquote>
<p>Alex Krizhevsky, Ilya Sutskever, Geoffrey E. Hinton. ImageNet Classification with Deep Convolutional Neural Networks. In NIPS, 2012</p>
</blockquote>
<figure data-type="image" tabindex="16"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932385-16.png" alt="5-16" loading="lazy"></figure>
<ul>
<li>
<p>AlexNet class ä»£ç </p>
<pre><code class="language-python">class AlexNet8(Model):
    def __init__(self):
        super(AlexNet8, self).__init__()
        self.c1 = Conv2D(filters=96, kernel_size=(3, 3))
        self.b1 = BatchNormalization()
        self.a1 = Activation('relu')
        self.p1 = MaxPool2D(pool_size=(3, 3), strides=2)
        
        self.c2 = Conv2D(filters=256, kernel_size=(3, 3))
        self.b2 = BatchNormalization()
        self.a2 = Activation('relu')
        self.p2 = MaxPool2D(pool_size=(3, 3), strides=2)
        
        self.c3 = Conv2D(filters=384, kernel_size=(3, 3), padding='same', activation='relu')
                         
        self.c4 = Conv2D(filters=384, kernel_size=(3, 3), padding='same', activation='relu')
                         
        self.c5 = Conv2D(filters=256, kernel_size=(3, 3), padding='same', activation='relu')
        self.p3 = MaxPool2D(pool_size=(3, 3), strides=2)

        self.flatten = Flatten()
        self.f1 = Dense(2048, activation='relu')
        self.d1 = Dropout(0.5)
        self.f2 = Dense(2048, activation='relu')
        self.d2 = Dropout(0.5)
        self.f3 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.p1(x)

        x = self.c2(x)
        x = self.b2(x)
        x = self.a2(x)
        x = self.p2(x)

        x = self.c3(x)

        x = self.c4(x)

        x = self.c5(x)
        x = self.p3(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.d1(x)
        x = self.f2(x)
        x = self.d2(x)
        y = self.f3(x)
        return y
</code></pre>
</li>
</ul>
<h4 id="513-ç»å…¸å·ç§¯ç½‘ç»œvggnet">5.13 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”VGGNet</h4>
<p>VGGNetè¯ç”Ÿäº2014å¹´ï¼Œå½“å¹´ImageNetç«èµ›çš„äºšå†›ï¼ŒTop5é”™è¯¯ç‡å‡å°åˆ°7.3%ã€‚</p>
<blockquote>
<p>K. Simonyan, A. Zisserman. Very Deep Convolutional Networks for Large-Scale Image Recognition.In ICLR, 2015.</p>
</blockquote>
<figure data-type="image" tabindex="17"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932445-17.png" alt="5-17" loading="lazy"></figure>
<ul>
<li>
<p>VGGNet class ä»£ç </p>
<pre><code class="language-python">class VGG16(Model):
    def __init__(self):
        super(VGG16, self).__init__()
        self.c1 = Conv2D(filters=64, kernel_size=(3, 3), padding='same')  # å·ç§¯å±‚1
        self.b1 = BatchNormalization()  # BNå±‚1
        self.a1 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c2 = Conv2D(filters=64, kernel_size=(3, 3), padding='same')
        self.b2 = BatchNormalization()  # BNå±‚1
        self.a2 = Activation('relu')  # æ¿€æ´»å±‚1
        self.p1 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d1 = Dropout(0.2)  # dropoutå±‚

        self.c3 = Conv2D(filters=128, kernel_size=(3, 3), padding='same')
        self.b3 = BatchNormalization()  # BNå±‚1
        self.a3 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c4 = Conv2D(filters=128, kernel_size=(3, 3), padding='same')
        self.b4 = BatchNormalization()  # BNå±‚1
        self.a4 = Activation('relu')  # æ¿€æ´»å±‚1
        self.p2 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d2 = Dropout(0.2)  # dropoutå±‚

        self.c5 = Conv2D(filters=256, kernel_size=(3, 3), padding='same')
        self.b5 = BatchNormalization()  # BNå±‚1
        self.a5 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c6 = Conv2D(filters=256, kernel_size=(3, 3), padding='same')
        self.b6 = BatchNormalization()  # BNå±‚1
        self.a6 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c7 = Conv2D(filters=256, kernel_size=(3, 3), padding='same')
        self.b7 = BatchNormalization()
        self.a7 = Activation('relu')
        self.p3 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d3 = Dropout(0.2)

        self.c8 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b8 = BatchNormalization()  # BNå±‚1
        self.a8 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c9 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b9 = BatchNormalization()  # BNå±‚1
        self.a9 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c10 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b10 = BatchNormalization()
        self.a10 = Activation('relu')
        self.p4 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d4 = Dropout(0.2)

        self.c11 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b11 = BatchNormalization()  # BNå±‚1
        self.a11 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c12 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b12 = BatchNormalization()  # BNå±‚1
        self.a12 = Activation('relu')  # æ¿€æ´»å±‚1
        
        self.c13 = Conv2D(filters=512, kernel_size=(3, 3), padding='same')
        self.b13 = BatchNormalization()
        self.a13 = Activation('relu')
        self.p5 = MaxPool2D(pool_size=(2, 2), strides=2, padding='same')
        self.d5 = Dropout(0.2)

        self.flatten = Flatten()  # æœªè®¡å…¥å±‚æ•°
        self.f1 = Dense(512, activation='relu')
        self.d6 = Dropout(0.2)
        self.f2 = Dense(512, activation='relu')
        self.d7 = Dropout(0.2)
        self.f3 = Dense(10, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.b1(x)
        x = self.a1(x)
        x = self.c2(x)
        x = self.b2(x)
        x = self.a2(x)
        x = self.p1(x)
        x = self.d1(x)

        x = self.c3(x)
        x = self.b3(x)
        x = self.a3(x)
        x = self.c4(x)
        x = self.b4(x)
        x = self.a4(x)
        x = self.p2(x)
        x = self.d2(x)

        x = self.c5(x)
        x = self.b5(x)
        x = self.a5(x)
        x = self.c6(x)
        x = self.b6(x)
        x = self.a6(x)
        x = self.c7(x)
        x = self.b7(x)
        x = self.a7(x)
        x = self.p3(x)
        x = self.d3(x)

        x = self.c8(x)
        x = self.b8(x)
        x = self.a8(x)
        x = self.c9(x)
        x = self.b9(x)
        x = self.a9(x)
        x = self.c10(x)
        x = self.b10(x)
        x = self.a10(x)
        x = self.p4(x)
        x = self.d4(x)

        x = self.c11(x)
        x = self.b11(x)
        x = self.a11(x)
        x = self.c12(x)
        x = self.b12(x)
        x = self.a12(x)
        x = self.c13(x)
        x = self.b13(x)
        x = self.a13(x)
        x = self.p5(x)
        x = self.d5(x)

        x = self.flatten(x)
        x = self.f1(x)
        x = self.d6(x)
        x = self.f2(x)
        x = self.d7(x)
        y = self.f3(x)
        return y
</code></pre>
</li>
</ul>
<h4 id="514-ç»å…¸å·ç§¯ç½‘ç»œinceptionnet">5.14 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”InceptionNet</h4>
<p>InceptionNetè¯ç”Ÿäº2014å¹´ï¼Œå½“å¹´ImageNetç«èµ›å† å†›ï¼ŒTop5é”™è¯¯ç‡ä¸º6.67%ã€‚</p>
<blockquote>
<p>Szegedy C, Liu W, Jia Y, et al. Going Deeper with Convolutions. In CVPR, 2015.</p>
</blockquote>
<figure data-type="image" tabindex="18"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932495-18.png" alt="5-18" loading="lazy"></figure>
<blockquote>
<p>åŒä¸€å±‚ç½‘ç»œå†…ä½¿ç”¨ä¸åŒå°ºå¯¸çš„å·ç§¯æ ¸ï¼Œæå‡äº†æ¨¡å‹æ„ŸçŸ¥åŠ›ï¼›ä½¿ç”¨äº†æ‰¹æ ‡å‡†åŒ–ï¼Œç¼“è§£äº†æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
</blockquote>
<ul>
<li>
<p>InceptionNet class ä»£ç </p>
<pre><code class="language-python">class ConvBNRelu(Model):
    def __init__(self, ch, kernelsz=3, strides=1, padding='same'):
        super(ConvBNRelu, self).__init__()
        self.model = tf.keras.models.Sequential([
            Conv2D(ch, kernelsz, strides=strides, padding=padding),
            BatchNormalization(),
            Activation('relu')
        ])

    def call(self, x):
        x = self.model(x, training=False) #åœ¨training=Falseæ—¶ï¼ŒBNé€šè¿‡æ•´ä¸ªè®­ç»ƒé›†è®¡ç®—å‡å€¼ã€æ–¹å·®å»åšæ‰¹å½’ä¸€åŒ–ï¼Œtraining=Trueæ—¶ï¼Œé€šè¿‡å½“å‰batchçš„å‡å€¼ã€æ–¹å·®å»åšæ‰¹å½’ä¸€åŒ–ã€‚æ¨ç†æ—¶ training=Falseæ•ˆæœå¥½
        return x
    
    
class InceptionBlk(Model):
    def __init__(self, ch, strides=1):
        super(InceptionBlk, self).__init__()
        self.ch = ch
        self.strides = strides
        self.c1 = ConvBNRelu(ch, kernelsz=1, strides=strides)
        self.c2_1 = ConvBNRelu(ch, kernelsz=1, strides=strides)
        self.c2_2 = ConvBNRelu(ch, kernelsz=3, strides=1)
        self.c3_1 = ConvBNRelu(ch, kernelsz=1, strides=strides)
        self.c3_2 = ConvBNRelu(ch, kernelsz=5, strides=1)
        self.p4_1 = MaxPool2D(3, strides=1, padding='same')
        self.c4_2 = ConvBNRelu(ch, kernelsz=1, strides=strides)

    def call(self, x):
        x1 = self.c1(x)
        x2_1 = self.c2_1(x)
        x2_2 = self.c2_2(x2_1)
        x3_1 = self.c3_1(x)
        x3_2 = self.c3_2(x3_1)
        x4_1 = self.p4_1(x)
        x4_2 = self.c4_2(x4_1)
        # concat along axis=channel
        x = tf.concat([x1, x2_2, x3_2, x4_2], axis=3)
        return x

class Inception10(Model):
    def __init__(self, num_blocks, num_classes, init_ch=16, **kwargs):
        super(Inception10, self).__init__(**kwargs)
        self.in_channels = init_ch
        self.out_channels = init_ch
        self.num_blocks = num_blocks
        self.init_ch = init_ch
        self.c1 = ConvBNRelu(init_ch)
        self.blocks = tf.keras.models.Sequential()
        for block_id in range(num_blocks):
            for layer_id in range(2):
                if layer_id == 0:
                    block = InceptionBlk(self.out_channels, strides=2)
                else:
                    block = InceptionBlk(self.out_channels, strides=1)
                self.blocks.add(block)
            # enlarger out_channels per block
            self.out_channels *= 2
        self.p1 = GlobalAveragePooling2D()
        self.f1 = Dense(num_classes, activation='softmax')

    def call(self, x):
        x = self.c1(x)
        x = self.blocks(x)
        x = self.p1(x)
        y = self.f1(x)
        return y
    
model = Inception10(num_blocks=2, num_classes=10)
</code></pre>
</li>
</ul>
<h4 id="515-ç»å…¸å·ç§¯ç½‘ç»œresnet">5.15 ç»å…¸å·ç§¯ç½‘ç»œâ€”â€”ResNet</h4>
<p>ResNetè¯ç”Ÿäº2015å¹´ï¼Œå½“å¹´ImageNetç«èµ›å† å†›ï¼ŒTop5é”™è¯¯ç‡ä¸º3.57%ã€‚</p>
<blockquote>
<p>Kaiming He, Xiangyu Zhang, Shaoqing Ren. Deep Residual Learning for Image Recognition. In CPVR, 2016</p>
</blockquote>
<ul>
<li>
<p>ç½‘ç»œå±‚æ•°åŠ æ·±æé«˜è¯†åˆ«å‡†ç¡®ç‡</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ¨¡å‹åç§°</th>
<th style="text-align:center">ç½‘ç»œå±‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">LeNet</td>
<td style="text-align:center">5</td>
</tr>
<tr>
<td style="text-align:center">AlexNet</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:center">VGGNet</td>
<td style="text-align:center">16/19</td>
</tr>
<tr>
<td style="text-align:center">InceptionNet V1</td>
<td style="text-align:center">22</td>
</tr>
</tbody>
</table>
<figure data-type="image" tabindex="19"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932545-19.png" alt="5-19" loading="lazy"></figure>
</li>
</ul>
<blockquote>
<p>ResNetæå‡ºäº†å±‚é—´æ®‹å·®è·³è¿ï¼Œå¼•å…¥äº†å‰æ–¹ä¿¡æ¯ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œä½¿ç¥ç»ç½‘ç»œå±‚æ•°å¢åŠ æˆä¸ºå¯èƒ½ã€‚</p>
</blockquote>
<ul>
<li>
<p>æ®‹å·®è·³è¿</p>
<figure data-type="image" tabindex="20"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180932595-20.png" alt="5-20" loading="lazy"></figure>
<p>Inceptionå—ä¸­çš„â€+â€œæ˜¯æ²¿æ·±åº¦æ–¹å‘å åŠ ï¼ˆåƒå±‚è›‹ç³•å±‚æ•°å åŠ ï¼‰<br>
ResNetå—ä¸­çš„â€+â€œæ˜¯ç‰¹å¾å›¾å¯¹åº”å…ƒç´ å€¼ç›¸åŠ ï¼ˆçŸ©é˜µå€¼ç›¸åŠ ï¼‰</p>
</li>
<li>
<p>è¿æ¥æ–¹å¼</p>
<figure data-type="image" tabindex="21"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180933065-21.png" alt="5-21" loading="lazy"></figure>
<p>ä¸¤ç§å †å ä¸åŒçš„æ–¹æ³•ï¼šï¼ˆå †å å‰åçš„ç»´åº¦ä¼šä¸ç›¸åŒï¼‰</p>
<figure data-type="image" tabindex="22"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180933135-22.png" alt="5-22" loading="lazy"></figure>
<pre><code class="language-python">class ResnetBlock(Model):

    def __init__(self, filters, strides=1, residual_path=False):
        super(ResnetBlock, self).__init__()
        self.filters = filters
        self.strides = strides
        self.residual_path = residual_path

        self.c1 = Conv2D(filters, (3, 3), strides=strides, padding='same', use_bias=False)
        self.b1 = BatchNormalization()
        self.a1 = Activation('relu')

        self.c2 = Conv2D(filters, (3, 3), strides=1, padding='same', use_bias=False)
        self.b2 = BatchNormalization()

        # residual_pathä¸ºTrueæ—¶ï¼Œå¯¹è¾“å…¥è¿›è¡Œä¸‹é‡‡æ ·ï¼Œå³ç”¨1x1çš„å·ç§¯æ ¸åšå·ç§¯æ“ä½œï¼Œä¿è¯xèƒ½å’ŒF(x)ç»´åº¦ç›¸åŒï¼Œé¡ºåˆ©ç›¸åŠ 
        if residual_path:
            self.down_c1 = Conv2D(filters, (1, 1), strides=strides, padding='same', use_bias=False)
            self.down_b1 = BatchNormalization()
        
        self.a2 = Activation('relu')

    def call(self, inputs):
        residual = inputs  # residualç­‰äºè¾“å…¥å€¼æœ¬èº«ï¼Œå³residual=x
        # å°†è¾“å…¥é€šè¿‡å·ç§¯ã€BNå±‚ã€æ¿€æ´»å±‚ï¼Œè®¡ç®—F(x)
        x = self.c1(inputs)
        x = self.b1(x)
        x = self.a1(x)

        x = self.c2(x)
        y = self.b2(x)

        if self.residual_path:
            residual = self.down_c1(inputs)
            residual = self.down_b1(residual)

        out = self.a2(y + residual)  # æœ€åè¾“å‡ºçš„æ˜¯ä¸¤éƒ¨åˆ†çš„å’Œï¼Œå³F(x)+xæˆ–F(x)+Wx,å†è¿‡æ¿€æ´»å‡½æ•°
        return out
</code></pre>
</li>
<li>
<p>ResNet è¡¨ç¤º</p>
<figure data-type="image" tabindex="23"><img src="https://images.cnblogs.com/cnblogs_com/ache/1998711/o_2107180933195-23.png" alt="5-23" loading="lazy"></figure>
<pre><code class="language-python">class ResNet18(Model):

    def __init__(self, block_list, initial_filters=64):  # block_listè¡¨ç¤ºæ¯ä¸ªblockæœ‰å‡ ä¸ªå·ç§¯å±‚
        super(ResNet18, self).__init__()
        self.num_blocks = len(block_list)  # å…±æœ‰å‡ ä¸ªblock
        self.block_list = block_list
        self.out_filters = initial_filters
        self.c1 = Conv2D(self.out_filters, (3, 3), strides=1, padding='same', use_bias=False)
        self.b1 = BatchNormalization()
        self.a1 = Activation('relu')
        self.blocks = tf.keras.models.Sequential()
        # æ„å»ºResNetç½‘ç»œç»“æ„
        for block_id in range(len(block_list)):  # ç¬¬å‡ ä¸ªresnet block
            for layer_id in range(block_list[block_id]):  # ç¬¬å‡ ä¸ªå·ç§¯å±‚

                if block_id != 0 and layer_id == 0:  # å¯¹é™¤ç¬¬ä¸€ä¸ªblockä»¥å¤–çš„æ¯ä¸ªblockçš„è¾“å…¥è¿›è¡Œä¸‹é‡‡æ ·
                    block = ResnetBlock(self.out_filters, strides=2, residual_path=True)
                else:
                    block = ResnetBlock(self.out_filters, residual_path=False)
                self.blocks.add(block)  # å°†æ„å»ºå¥½çš„blockåŠ å…¥resnet
            self.out_filters *= 2  # ä¸‹ä¸€ä¸ªblockçš„å·ç§¯æ ¸æ•°æ˜¯ä¸Šä¸€ä¸ªblockçš„2å€
        self.p1 = tf.keras.layers.GlobalAveragePooling2D()
        self.f1 = tf.keras.layers.Dense(10, activation='softmax', kernel_regularizer=tf.keras.regularizers.l2())

    def call(self, inputs):
        x = self.c1(inputs)
        x = self.b1(x)
        x = self.a1(x)
        x = self.blocks(x)
        x = self.p1(x)
        y = self.f1(x)
        return y
model = ResNet18([2, 2, 2, 2])
</code></pre>
</li>
</ul>
<h4 id="516-ç»å…¸å·ç§¯ç½‘ç»œå°ç»“">5.16 ç»å…¸å·ç§¯ç½‘ç»œå°ç»“</h4>
<ul>
<li>
<p>LeNet</p>
<p>å·ç§¯ç½‘ç»œå¼€ç¯‡ä¹‹ä½œï¼Œå…±äº«å·ç§¯æ ¸ï¼Œå‡å°‘ç½‘ç»œå‚æ•°ã€‚</p>
</li>
<li>
<p>AlexNet</p>
<p>ä½¿ç”¨reluæ¿€æ´»å‡½æ•°ï¼Œæå‡è®­ç»ƒé€Ÿåº¦ï¼›<br>
ä½¿ç”¨Dropoutï¼Œç¼“è§£è¿‡æ‹Ÿåˆã€‚</p>
</li>
<li>
<p>VGGNet</p>
<p>å°å°ºå¯¸å·ç§¯æ ¸å‡å°‘å‚æ•°ï¼Œç½‘ç»œç»“æ„è§„æ•´ï¼Œé€‚åˆå¹¶è¡ŒåŠ é€Ÿã€‚</p>
</li>
<li>
<p>InceptionNet</p>
<p>ä¸€å±‚å†…ä½¿ç”¨ä¸åŒå°ºå¯¸å·ç§¯æ ¸ï¼Œæå‡æ„ŸçŸ¥åŠ›ï¼›ä½¿ç”¨BNï¼ˆæ‰¹æ ‡å‡†åŒ–ï¼‰æ“ä½œï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
</li>
<li>
<p>ResNet</p>
<p>å±‚é—´æ®‹å·®è·³è¿ï¼Œå¼•å…¥å‰æ–¹ä¿¡æ¯ï¼Œç¼“è§£æ¨¡å‹é€€åŒ–ï¼Œä½¿ç¥ç»ç½‘ç»œå±‚æ•°åŠ æ·±æˆä¸ºå¯èƒ½ã€‚</p>
</li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://perfectqing.github.io/blogs/tag/S2mqBZ0HP/" class="tag">
                    TensorFlow ç¬”è®°
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://perfectqing.github.io/blogs/post/ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•/">
                  <h3 class="post-title">
                    ç¬¬å››ç«  ç¥ç»ç½‘ç»œå…«è‚¡åŠŸèƒ½æ‰©å±•
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
